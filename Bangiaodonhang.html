<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PHIẾU BÀN GIAO ĐƠN HÀNG</title>
  <style>
    /* Giữ nguyên phần CSS như cũ */
  </style>
</head>
<body>
  <!-- Giữ nguyên phần HTML như cũ -->

  <script>
  (function() {
    // URL của Google Apps Script web app
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbzxa3Tu7TMjk8_TeE3ihsq_caT1WuR48mK_OcCHJTf0Y5uk88qH0UA4Z0_6UCjDhK4z/exec';

    // Hiển thị ngày giờ hiện tại
    function showDateTime() {
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,'0');
      const mm = String(now.getMonth()+1).padStart(2,'0');
      const yyyy = now.getFullYear();
      const hh = String(now.getHours()).padStart(2,'0');
      const min = String(now.getMinutes()).padStart(2,'0');
      document.getElementById('delivery-date').textContent = `${dd}/${mm}/${yyyy}`;
      document.getElementById('delivery-time').textContent = `${hh}:${min}`;
    }

    // Định dạng tiền tệ
    function formatCurrency(amount) {
      return amount ? parseInt(amount).toLocaleString('vi-VN') : '0';
    }

    // Viết hoa chữ cái đầu
    function capitalizeFirstLetter(str) {
      if (!str) return '';
      return str.toLowerCase().split(' ').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      ).join(' ');
    }

    // Hiển thị dữ liệu ra bảng - KHÔNG LỌC DỮ LIỆU
    function displayData(data) {
      const totalOrders = data.length;
      const totalOrdersStr = totalOrders < 10 ? '0' + totalOrders : totalOrders;
      document.getElementById('total-orders').textContent = totalOrdersStr;
      
      // Tính tổng tiền từ tất cả bản ghi
      const totalAmount = data.reduce((sum, item) => sum + (parseInt(item.totalAmount) || 0, 0);
      document.getElementById('total-receivable').textContent = formatCurrency(totalAmount);

      let html = '';
      if (data.length === 0) {
        html = '<tr><td colspan="4">Không có dữ liệu</td></tr>';
      } else {
        // Hiển thị tất cả bản ghi không qua bất kỳ bộ lọc nào
        data.forEach(item => {
          html += `
            <tr>
              <td>${item.date || ''}</td>
              <td style="text-align:left">${capitalizeFirstLetter(item.customer || '')}</td>
              <td style="text-align:left" class="driver-cell">${item.driver || ''}</td>
              <td style="text-align:right">${formatCurrency(item.totalAmount)}</td>
            </tr>`;
        });
      }
      document.getElementById('data-container').innerHTML = html;
    }

    // Tải dữ liệu từ Google Apps Script web app - KHÔNG ÁP DỤNG BỘ LỌC
    function loadData() {
      showDateTime();

      // Thêm tham số ?all=true để yêu cầu tất cả dữ liệu (nếu API hỗ trợ)
      // Hoặc đơn giản là gọi API mà không có tham số lọc
      fetch(webAppUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          // Hiển thị toàn bộ dữ liệu nhận được
          displayData(data);
        })
        .catch(err => {
          console.error('Lỗi tải dữ liệu:', err);
          document.getElementById('data-container').innerHTML =
            '<tr><td colspan="4" style="padding:10px;">Không thể tải dữ liệu</td></tr>';
        });
    }

    // Khởi chạy khi trang được tải
    window.addEventListener('load', loadData);
  })();
  </script>
</body>
</html>

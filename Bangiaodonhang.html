<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dữ liệu Check kho</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    h2 {
      color: #333;
      text-align: center;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #e0e0e0;
    }
    .loading, .error {
      text-align: center;
      padding: 20px;
      font-size: 18px;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <h2>Dữ liệu Check kho</h2>
  <div id="loading" class="loading">Đang tải dữ liệu...</div>
  <div id="error" class="error" style="display: none;"></div>
  <table id="dataTable" style="display: none;">
    <thead>
      <tr>
        <th>Ngày</th>
        <th>Tên khách hàng</th>
        <th>Thủ kho nhận bàn giao</th>
        <th>Tổng tiền hàng</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    async function fetchData() {
      try {
        // Gọi API từ Google Apps Script Web App
        const response = await fetch('https://script.google.com/macros/s/AKfycbzxa3Tu7TMjk8_TeE3ihsq_caT1WuR48mK_OcCHJTf0Y5uk88qH0UA4Z0_6UCjDhK4z/exec', {
          method: 'GET',
          mode: 'cors'
        });
        if (!response.ok) throw new Error(`Lỗi HTTP: ${response.status} - ${response.statusText}`);
        const htmlContent = await response.text();

        // Debug: Log nội dung HTML để kiểm tra
        console.log('HTML trả về:', htmlContent);

        // Phân tích HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        const table = doc.querySelector('table');
        if (!table) throw new Error('Không tìm thấy bảng trong dữ liệu trả về');

        const rows = table.querySelectorAll('tr');
        if (rows.length <= 1) throw new Error('Không có dữ liệu trong bảng');

        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = ''; // Xóa nội dung cũ

        // Bỏ qua hàng tiêu đề (hàng đầu tiên)
        for (let i = 1; i < rows.length; i++) {
          const cells = rows[i].querySelectorAll('td');
          if (cells.length >= 4) {
            const row = document.createElement('tr');
            // Gán giá trị từ các ô, đảm bảo không lỗi nếu ô trống
            row.innerHTML = `
              <td>${cells[0]?.textContent || ''}</td>
              <td>${cells[1]?.textContent || ''}</td>
              <td>${cells[2]?.textContent || ''}</td>
              <td>${cells[3]?.textContent || ''}</td>
            `;
            tableBody.appendChild(row);
          }
        }

        // Hiển thị bảng, ẩn loading
        document.getElementById('loading').style.display = 'none';
        document.getElementById('dataTable').style.display = 'table';
      } catch (error) {
        console.error('Lỗi khi tải dữ liệu:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = `Lỗi: ${error.message}. Vui lòng kiểm tra URL hoặc dữ liệu nguồn.`;
      }
    }

    // Gọi hàm fetchData khi trang tải
    window.onload = fetchData;
  </script>
</body>
</html>

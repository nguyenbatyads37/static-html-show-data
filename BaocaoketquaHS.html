<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Báo Cáo Học Tập</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 14px;
      margin: 0;
      padding: 10px;
      background-color: #fffbe6;
      color: #333;
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .header h1 {
      font-size: 22px;
      font-weight: bold;
      margin: 10px 0;
      color: #2c3e50;
    }
    .header h2 {
      font-size: 18px;
      font-weight: bold;
      margin: 5px 0;
      color: #5e4b0e;
    }
    .info {
      margin-bottom: 15px;
      background-color: #f2f2f2;
      padding: 10px;
      border-radius: 5px;
    }
    .info p {
      margin: 5px 0;
    }
    .section {
      margin-bottom: 20px;
    }
    .section h3 {
      font-size: 16px;
      font-weight: bold;
      color: #8b4513;
      margin-bottom: 10px;
    }
    ul {
      padding-left: 20px;
    }
    ul li {
      margin-bottom: 5px;
    }
    .feedback-box {
      background-color: #ffe0e0;
      padding: 10px;
      border-left: 4px solid #c62828;
      border-radius: 4px;
    }
    .praise-box {
      background-color: #e8f5e9;
      border-left: 4px solid #2e7d32;
    }
    .student-photo {
      text-align: center;
      margin-top: 10px;
    }
    .student-photo img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ccc;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>LỚP TIẾNG ANH CLC - CÔ THẢO LINH</h1>
    <h2 id="report-date">BÁO CÁO HỌC TẬP NGÀY ...</h2>
  </div>

  <div class="info">
    <p><strong>Họ tên học sinh:</strong> <span id="student-name">...</span></p>
    <p><strong>ID:</strong> <span id="student-id">...</span></p>
    <p><strong>Lớp:</strong> <span id="student-class">...</span></p>
    <div class="student-photo"><img id="student-photo" src="https://via.placeholder.com/100" alt="Ảnh học sinh" onerror="this.src='https://via.placeholder.com/100'"></div>
  </div>

  <div class="section">
    <h3>I. KIẾN THỨC CẦN GHI NHỚ</h3>
    <ul id="section-knowledge"><li>...</li></ul>
  </div>

  <div class="section">
    <h3>II. NHIỆM VỤ VỀ NHÀ</h3>
    <ul id="section-homework"><li>...</li></ul>
  </div>

  <div class="section">
    <h3>III. NHẬN XÉT CỦA CÔ GIÁO</h3>
    <div class="praise-box">
      <strong>CÔ KHEN:</strong>
      <ul id="section-praise"><li>...</li></ul>
    </div>
    <div class="feedback-box" style="margin-top:10px;">
      <strong>CÔ PHÊ BÌNH:</strong>
      <ul id="section-criticism"><li>...</li></ul>
    </div>
  </div>

  <script>
    function getParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    function renderList(text, elementId) {
      const container = document.getElementById(elementId);
      if (!text || text.trim() === '') {
        container.innerHTML = '<li>Không có nội dung</li>';
        return;
      }
      const items = text.split(',').map(s => s.trim()).filter(Boolean);
      container.innerHTML = '';
      items.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${index + 1}.</strong> ${item}`;
        container.appendChild(li);
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const idhs = getParam('idhs');
      const anhhs = getParam('anhhs');
      const lop = getParam('lop');

      document.getElementById('student-id').textContent = idhs || '...';
      document.getElementById('student-class').textContent = lop || '...';
      if (anhhs) {
        document.getElementById('student-photo').src = anhhs;
      }

      const today = new Date();
      const formattedDate = today.toLocaleDateString('vi-VN');
      document.getElementById('report-date').textContent = 'BÁO CÁO HỌC TẬP NGÀY ' + formattedDate;

      try {
        const sheetId = '1Fld-_6pKzx6WPkNJPw8buTMSqIilL5e4aQwC5klxAz0';
        const gid = '538903881';
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${gid}`;
        const res = await fetch(url);
        const text = await res.text();
        const json = JSON.parse(text.match(/\\{.*\\}/s)[0]);
        const rows = json.table.rows;

        let found = false;
        for (const row of rows) {
          const rowId = row.c[0]?.v?.toString();
          if (rowId === idhs) {
            found = true;
            const name = row.c[2]?.v || 'Không rõ';
            const praise = row.c[9]?.v || '';
            const criticism = row.c[10]?.v || '';
            const knowledge = row.c[11]?.v || '';
            const homework = row.c[12]?.v || '';

            document.getElementById('student-name').textContent = name;
            renderList(knowledge, 'section-knowledge');
            renderList(homework, 'section-homework');
            renderList(praise, 'section-praise');
            renderList(criticism, 'section-criticism');
            break;
          }
        }

        if (!found) {
          alert('Không tìm thấy học sinh với ID này.');
        }
      } catch (err) {
        console.error(err);
        alert('Lỗi khi tải dữ liệu từ Google Sheets.');
      }
    });
  </script>
</body>
</html>





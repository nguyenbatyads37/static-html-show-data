<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Bảng Lương</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .header-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .footer {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
        }
        .signature {
            text-align: center;
            width: 200px;
        }
        .signature-line {
            border-top: 1px solid #000;
            margin-top: 50px;
            padding-top: 5px;
        }
        .staff-signature {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>PHIẾU BẢNG LƯƠNG</h1>
    
    <div class="header-info">
        <div>
            <p><strong>Đơn vị:</strong> <span id="don-vi">Trung tâm giáo dục Khoa Bảng</span></p>
            <p><strong>Tháng:</strong> <span id="thang">4</span></p>
        </div>
        <div>
            <p><strong>Mã phiếu:</strong> <span id="ma-phieu">[Số phiếu]</span></p>
            <p><strong>Ngày lập:</strong> <span id="ngay-lap"></span></p>
        </div>
    </div>
    
    <table id="bang-luong">
        <thead>
            <tr>
                <th>STT</th>
                <th>Ngày</th>
                <th>Tên Nhân sự</th>
                <th>Lớp phụ trách</th>
                <th>Chuyên cần</th>
                <th>Số giờ làm</th>
                <th>Tổng công việc</th>
                <th>Việc Đạt</th>
                <th>Chấn</th>
                <th>BTVN</th>
                <th>Số HS được nhận xét</th>
            </tr>
        </thead>
        <tbody id="noi-dung-bang">
            <!-- Nội dung sẽ được thêm bằng JavaScript -->
        </tbody>
    </table>
    
    <div class="footer">
        <div>
            <p><strong>Tổng số giờ làm:</strong> <span id="tong-gio">[Tổng giờ]</span></p>
            <p><strong>Tổng lương:</strong> <span id="tong-luong">[Tổng lương]</span> VNĐ</p>
        </div>
        <div class="signature">
            <p><strong>Người lập</strong></p>
            <p>(Ký, ghi rõ họ tên)</p>
            <div class="signature-line"></div>
        </div>
    </div>

    <!-- Phần chữ ký nhân sự -->
    <div class="staff-signature" id="staff-signature-container">
        <!-- Chữ ký nhân sự sẽ được thêm bằng JavaScript -->
    </div>

    <script>
        // Biến tên nhân sự
        const ten = "";

        // Lấy tham số từ URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return params.get('data');
        }

        // Định dạng ngày tháng
        function formatDate(date) {
            const d = new Date(date);
            let day = d.getDate();
            let month = d.getMonth() + 1;
            const year = d.getFullYear();

            if (day < 10) day = '0' + day;
            if (month < 10) month = '0' + month;

            return `${day}/${month}/${year}`;
        }

        // Xử lý dữ liệu và điền vào bảng
        function populateTable() {
            // Cập nhật ngày lập là ngày hiện tại
            document.getElementById('ngay-lap').textContent = formatDate(new Date());

            const dataParam = getUrlParams();
            if (!dataParam) return;

            // Giải mã URL và tách các phần
            const decodedData = decodeURIComponent(dataParam);
            
            // Tách header và các dòng dữ liệu
            const parts = decodedData.split('_b_');
            if (parts.length < 2) return;

            // Xử lý header (phần đầu tiên)
            const headerData = parts[0].split('_a_');
            if (headerData.length >= 4) {
                document.getElementById('don-vi').textContent = headerData[0] || "Trung tâm giáo dục Khoa Bảng";
                document.getElementById('thang').textContent = headerData[1] || "4";
                document.getElementById('ma-phieu').textContent = headerData[2];
                document.getElementById('ngay-lap').textContent = headerData[3] || formatDate(new Date());
            }

            // Xử lý các dòng dữ liệu
            const tableBody = document.getElementById('noi-dung-bang');
            const signatureContainer = document.getElementById('staff-signature-container');
            let totalHours = 0;
            let totalSalary = 0;
            const staffNames = new Set(); // Dùng Set để lưu tên nhân sự không trùng lặp

            for (let i = 1; i < parts.length; i++) {
                const rowData = parts[i].split('_a_');
                if (rowData.length >= 11) {
                    const row = document.createElement('tr');
                    
                    // STT
                    const sttCell = document.createElement('td');
                    sttCell.textContent = i;
                    row.appendChild(sttCell);
                    
                    // Các ô dữ liệu
                    for (let j = 0; j < 10; j++) {
                        const cell = document.createElement('td');
                        cell.textContent = rowData[j];
                        row.appendChild(cell);

                        // Lưu tên nhân sự (cột thứ 2)
                        if (j === 2 && rowData[j]) {
                            staffNames.add(rowData[j]);
                        }
                    }
                    
                    tableBody.appendChild(row);
                    
                    // Tính tổng giờ làm (giả sử cột 5 là số giờ làm)
                    const hours = parseFloat(rowData[5]) || 0;
                    totalHours += hours;
                }
            }

            // Cập nhật tổng số giờ và lương (giả sử lương = giờ * 50,000)
            document.getElementById('tong-gio').textContent = totalHours;
            document.getElementById('tong-luong').textContent = (totalHours * 50000).toLocaleString();

            // Thêm chữ ký nhân sự
            staffNames.forEach(name => {
                const signatureDiv = document.createElement('div');
                signatureDiv.className = 'signature';
                signatureDiv.innerHTML = `
                    <p><strong>${name}</strong></p>
                    <p>(Ký, ghi rõ họ tên)</p>
                    <div class="signature-line"></div>
                `;
                signatureContainer.appendChild(signatureDiv);
            });
        }

        // Gọi hàm khi trang tải xong
        window.onload = populateTable;
    </script>
</body>
</html>

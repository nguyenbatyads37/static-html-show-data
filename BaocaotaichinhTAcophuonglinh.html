<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Báo cáo tài chính</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .trf-container {
      width: 800px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px 30px;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .header-left h1 {
      margin: 0;
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }
    .logo-group img {
      max-height: 50px;
    }
    .section-title {
      background-color: #e6e6e6;
      padding: 5px 10px;
      font-weight: bold;
      margin-top: 20px;
      margin-bottom: 10px;
      font-size: 16px;
    }
    .candidate-details, .test-results {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    .candidate-details td,
    .candidate-details th,
    .test-results td,
    .test-results th {
      border: 1px solid #ccc;
      padding: 8px;
    }
    .candidate-photo {
      width: 100px;
      height: 120px;
      background-color: #ddd;
      display: inline-block;
      margin-bottom: 10px;
      text-align: center;
      line-height: 120px;
      color: #666;
      font-size: 14px;
    }
    .score-table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 10px;
    }
    .score-table th,
    .score-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .score-table th {
      background-color: #e6e6e6;
    }
    .overall-score {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #c00;
      margin-top: 10px;
      margin-bottom: 30px;
    }
    .stamp-signature {
      display: flex;
      justify-content: space-between;
      margin-top: 40px;
      align-items: center;
    }
    .stamp {
      width: 150px;
      height: 100px;
      border: 1px dashed #999;
      text-align: center;
      line-height: 100px;
      color: #999;
    }
    .signature {
      width: 200px;
      border-bottom: 1px solid #999;
      text-align: center;
      color: #666;
      padding-bottom: 5px;
    }
    .footer-note {
      font-size: 12px;
      color: #666;
      margin-top: 20px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    .data-table th, .data-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    .data-table th {
      background-color: #f2f2f2;
      text-align: center;
    }
    .data-table tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .center-text {
      text-align: center;
    }
    .summary-row {
      font-weight: bold;
      background-color: #e6e6e6 !important;
    }
    /* Đảm bảo nội dung trong ô tự động xuống dòng và căn dọc lên trên */
    .data-table td, .data-table th {
      white-space: normal;
      overflow-wrap: break-word;
      word-wrap: break-word;
      vertical-align: top;
    }

    @media print {
      body {
        background-color: white;
        padding: 0;
      }
      .trf-container {
        box-shadow: none;
        border: none;
        padding: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="trf-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1>BÁO CÁO TÀI CHÍNH</h1>
      <p><strong>Lớp Tiếng Anh CLC cô Thảo Linh</strong></p>
    </div>
    <div class="logo-group">
      <img src="https://private-user-images.githubusercontent.com/193345119/429776636-ade0b260-d005-4548-928e-a87508323214.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDM2NTU4OTAsIm5iZiI6MTc0MzY1NTU5MCwicGF0aCI6Ii8xOTMzNDUxMTkvNDI5Nzc2NjM2LWFkZTBiMjYwLWQwMDUtNDU0OC05MjhlLWE4NzUwODMyMzIxNC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwNDAzJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDQwM1QwNDQ2MzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1jN2JmMTRlM2Y3OWM1ZmIwZmUxZDhjOTYyMDFiYjVkYjM1ZGJkMmRlNmMxOTAxYTc2YzQxZTQwYTEwZTM3ZTI4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.UVd4ob1NF_asHrx6aXoS5Asg7BmEzbI6LWhCoaW4Axw" alt="Logo">
    </div>
  </div>

  <!-- Candidate Details -->
  <div class="section-title">BÁO CÁO TỔNG QUAN</div>
  <!-- Scores -->
  <table class="score-table">
    <tr>
      <th>DOANH THU</th>
      <th>TỔNG HỌC SINH</th>
      <th>CHI PHÍ APP</th>
      <th>CHI PHÍ NHÂN SỰ</th>
    </tr>
    <tr>
      <td id="revenue">[Doanh thu]</td>
      <td id="total-students">[Tổng học sinh]</td>
      <td id="app-cost">[Chi phí app]</td>
      <td id="staff-cost">[Chi phí nhân sự]</td>
    </tr>
  </table>

  <!-- Chi tiết học tập -->
  <div class="section-title">HỌC PHÍ TỪNG LỚP</div>
  <table class="data-table">
    <thead>
      <tr>
        <th>STT</th>
        <th>Lớp</th>
        <th>Họ và tên</th>
        <th>Lịch học cố định</th>
        <th>Tháng tính học phí</th>
        <th>Số buổi học</th>
        <th>Số buổi tính phí</th>
        <th>Số buổi hỗ trợ</th>
        <th>Học phí/buổi</th>
        <th>Học phí cô hỗ trợ</th>
        <th>Tổng học phí</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
    <tfoot>
      <tr class="summary-row">
        <td colspan="9">Tổng cộng</td>
        <td class="center-text" id="total-support">0</td>
        <td class="center-text" id="total-tuition">0</td>
      </tr>
    </tfoot>
  </table>

  <!-- Stamp and Signature -->
  <div class="stamp-signature">
    <div class="stamp">Official Stamp</div>
    <div class="signature">Administrator Signature</div>
  </div>

  <script>
    // Lấy tham số từ URL sử dụng URLSearchParams
    const params = new URLSearchParams(window.location.search);
    
    // Cập nhật thông tin tổng quan
    document.getElementById('revenue').textContent = params.get('doanhthu') || '[Doanh thu]';
    document.getElementById('total-students').textContent = params.get('tonghocsinh') || '[Tổng học sinh]';
    document.getElementById('app-cost').textContent = params.get('chiphi_app') || '[Chi phí app]';
    document.getElementById('staff-cost').textContent = params.get('chiphi_nhansu') || '[Chi phí nhân sự]';
    
    // Xử lý dữ liệu bảng chi tiết từ tham số 'data'
    const data = params.get('data');
    
    if (data) {
      const danhSachLopHoc = data.split('_b_').map((item, index) => {
        const parts = item.split('_a_');
        return {
          stt: index + 1,
          lop: parts[0] || 'N/A',
          hoten: parts[1] || 'N/A',
          lichhoc: parts[2] || 'N/A',
          thang: parts[3] || 'N/A',
          sobuoihoc: parts[4] ? parseInt(parts[4]) : 0,
          sobuoitinhphi: parts[5] ? parseInt(parts[5]) : 0,
          sobuoihotro: parts[6] ? parseInt(parts[6]) : 0,
          hocphibuoi: parts[7] ? parseInt(parts[7]) : 0,
          hocphihotro: parts[8] ? parseInt(parts[8]) : 0,
          tonghocphi: parts[9] ? parseInt(parts[9]) : 0
        };
      });
      
      // Render các dòng dữ liệu vào bảng chi tiết
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = danhSachLopHoc.map(item => `
        <tr>
          <td class="center-text">${item.stt}</td>
          <td>${item.lop}</td>
          <td>${item.hoten}</td>
          <td>${item.lichhoc}</td>
          <td>${item.thang}</td>
          <td class="center-text">${item.sobuoihoc}</td>
          <td class="center-text">${item.sobuoitinhphi}</td>
          <td class="center-text">${item.sobuoihotro}</td>
          <td class="center-text">${item.hocphibuoi.toLocaleString()}</td>
          <td class="center-text">${item.hocphihotro.toLocaleString()}</td>
          <td class="center-text">${item.tonghocphi.toLocaleString()}</td>
        </tr>
      `).join('');
      
      // Tính toán tổng hợp
      if (danhSachLopHoc.length > 0) {
        const totalSupport = danhSachLopHoc.reduce((sum, item) => sum + item.hocphihotro, 0);
        const totalTuition = danhSachLopHoc.reduce((sum, item) => sum + item.tonghocphi, 0);
        
        document.getElementById('total-support').textContent = totalSupport.toLocaleString();
        document.getElementById('total-tuition').textContent = totalTuition.toLocaleString();
      }
    } else {
      document.getElementById('tableBody').innerHTML = `
        <tr>
          <td colspan="11" class="center-text">Không có dữ liệu lớp học</td>
        </tr>
      `;
    }
  </script>
  
</div>

</body>
</html>

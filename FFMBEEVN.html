<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Hỗ Trợ Điền Thông Tin Đơn Hàng</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
        }
        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }
        .panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #ccc;
        }
        .iframe-container {
            flex: 1;
            height: 100%;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        h1, h2, h3 {
            color: #333;
        }
        textarea {
            width: 95%;
            height: 150px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #e9ecef;
            cursor: text;
        }
        .instructions {
            background-color: #fffbe6;
            border: 1px solid #ffe58f;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h1>Công Cụ Hỗ Trợ Điền Liệu</h1>
        <div class="instructions">
            <strong>Hướng dẫn:</strong>
            <ol>
                <li>Dán toàn bộ nội dung JSON của đơn hàng vào ô bên dưới.</li>
                <li>Nhấn nút "Tách và điền dữ liệu".</li>
                <li>Sao chép (copy) thông tin từ các ô bên dưới và dán (paste) vào biểu mẫu tương ứng ở bên phải.</li>
            </ol>
        </div>

        <h2>1. Dữ liệu đơn hàng (JSON)</h2>
        <textarea id="jsonData" placeholder="Dán nội dung JSON vào đây..."></textarea>
        <button onclick="processData()">Tách và điền dữ liệu</button>

        <hr style="margin: 30px 0;">

        <h2>2. Thông tin đã được tách</h2>
        <p>Nhấn vào ô để sao chép nội dung.</p>
        <div class="form-grid" id="outputForm">
            <div class="form-group"><label for="outMaDonHang">Mã đơn hàng</label><input type="text" id="outMaDonHang" readonly></div>
            <div class="form-group"><label for="outNgayLenDon">Ngày lên đơn</label><input type="text" id="outNgayLenDon" readonly></div>
            <div class="form-group"><label for="outName">Name*</label><input type="text" id="outName" readonly></div>
            <div class="form-group"><label for="outPhone">Phone*</label><input type="text" id="outPhone" readonly></div>
            <div class="form-group"><label for="outAdd">Add</label><input type="text" id="outAdd" readonly></div>
            <div class="form-group"><label for="outCity">City</label><input type="text" id="outCity" readonly></div>
            <div class="form-group"><label for="outState">State</label><input type="text" id="outState" readonly></div>
            <div class="form-group"><label for="outZipcode">Zipcode</label><input type="text" id="outZipcode" readonly></div>
            <div class="form-group"><label for="outMatHang">Mặt hàng</label><input type="text" id="outMatHang" readonly></div>
            <div class="form-group"><label for="outTenMatHang1">Tên mặt hàng 1</label><input type="text" id="outTenMatHang1" readonly></div>
            <div class="form-group"><label for="outSoLuongMatHang1">Số lượng mặt hàng 1</label><input type="text" id="outSoLuongMatHang1" readonly></div>
            <div class="form-group"><label for="outTenMatHang2">Tên mặt hàng 2</label><input type="text" id="outTenMatHang2" readonly></div>
            <div class="form-group"><label for="outSoLuongMatHang2">Số lượng mặt hàng 2</label><input type="text" id="outSoLuongMatHang2" readonly></div>
            <div class="form-group"><label for="outQuaTang">Quà tặng</label><input type="text" id="outQuaTang" readonly></div>
            <div class="form-group"><label for="outSoLuongQuaKem">Số lượng quà kèm</label><input type="text" id="outSoLuongQuaKem" readonly></div>
            <div class="form-group"><label for="outGiaBan">Giá bán</label><input type="text" id="outGiaBan" readonly></div>
            <div class="form-group"><label for="outLoaiTienThanhToan">Loại tiền thanh toán</label><input type="text" id="outLoaiTienThanhToan" readonly></div>
            <div class="form-group"><label for="outTongTienVND">Tổng tiền VNĐ</label><input type="text" id="outTongTienVND" readonly></div>
            <div class="form-group"><label for="outHinhThucThanhToan">Hình thức thanh toán</label><input type="text" id="outHinhThucThanhToan" readonly></div>
            <div class="form-group"><label for="outGhiChu">Ghi chú</label><input type="text" id="outGhiChu" readonly></div>
            <div class="form-group"><label for="outSoWhatsAppViber">Số Whats app/Viber</label><input type="text" id="outSoWhatsAppViber" readonly></div>
            <div class="form-group"><label for="outGhiChuBee">Ghi chú của BEE</label><input type="text" id="outGhiChuBee" readonly></div>
            <div class="form-group"><label for="outDanhDau">Đánh dấu</label><input type="text" id="outDanhDau" readonly></div>
            <div class="form-group"><label for="outNgayDongHang">Ngày đóng hàng</label><input type="text" id="outNgayDongHang" readonly></div>
            <div class="form-group"><label for="outMaTracking">Mã Tracking</label><input type="text" id="outMaTracking" readonly></div>
            <div class="form-group"><label for="outTrangThaiGiaoHang">Trạng thái giao hàng</label><input type="text" id="outTrangThaiGiaoHang" readonly></div>
            <div class="form-group"><label for="outThoiGianGiaoDuKien">Thời gian giao dự kiến</label><input type="text" id="outThoiGianGiaoDuKien" readonly></div>
            <div class="form-group"><label for="outPhiShipNoiDiaUSD">Phí ship nội địa Mỹ (usd)</label><input type="text" id="outPhiShipNoiDiaUSD" readonly></div>
            <div class="form-group"><label for="outPhiXuLyDonUSD">Phí xử lý đơn đóng hàng-Lưu kho(usd)</label><input type="text" id="outPhiXuLyDonUSD" readonly></div>
            <div class="form-group"><label for="outGHI_CHU">GHI CHÚ (Thêm)</label><input type="text" id="outGHI_CHU" readonly></div>
            <div class="form-group"><label for="outNgayDoiSoat">Ngày đối soát</label><input type="text" id="outNgayDoiSoat" readonly></div>
        </div>
    </div>
    <div class="iframe-container">
        <h3>Biểu mẫu đích để điền thông tin</h3>
        <iframe src="https://script.google.com/macros/s/AKfycbzo3JdiCq7q62z4YV-KfStgt494Rl4BBVKNSRBCutSLKJfRt-92kU2vcEvKjH3wB7DM/exec"></iframe>
    </div>
</div>

<script>
    function formatDate(dateString) {
        if (!dateString) return '';
        try {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        } catch (e) {
            return dateString; // Trả về chuỗi gốc nếu không thể định dạng
        }
    }

    function processData() {
        const jsonInput = document.getElementById('jsonData').value;
        if (!jsonInput.trim()) {
            alert('Vui lòng dán dữ liệu JSON vào ô.');
            return;
        }

        try {
            const data = JSON.parse(jsonInput);

            // Mapping data from JSON to form fields
            document.getElementById('outMaDonHang').value = data.maDonHang || '';
            document.getElementById('outNgayLenDon').value = formatDate(data.ngayLenDon);
            document.getElementById('outName').value = data.name || '';
            document.getElementById('outPhone').value = data.phone || '';
            document.getElementById('outAdd').value = data.address || '';
            document.getElementById('outCity').value = data.city || '';
            document.getElementById('outState').value = data.state || '';
            document.getElementById('outZipcode').value = data.zipcode || '';
            document.getElementById('outMatHang').value = data.matHang || '';
            document.getElementById('outTenMatHang1').value = data.tenMatHang1 || '';
            document.getElementById('outSoLuongMatHang1').value = data.soLuongMatHang1 || '';
            document.getElementById('outTenMatHang2').value = data.tenMatHang2 || '';
            document.getElementById('outSoLuongMatHang2').value = data.soLuongMatHang2 || '';
            document.getElementById('outQuaTang').value = data.quaTang || '';
            document.getElementById('outSoLuongQuaKem').value = data.soLuongQuaKem || '';
            document.getElementById('outGiaBan').value = data.giaBan || '';
            document.getElementById('outLoaiTienThanhToan').value = data.loaiTienThanhToan || '';
            document.getElementById('outTongTienVND').value = data.tongTienVND || '';
            document.getElementById('outHinhThucThanhToan').value = data.hinhThucThanhToan || '';
            document.getElementById('outGhiChu').value = data.ghiChu || '';
            document.getElementById('outSoWhatsAppViber').value = data.soWhatsAppViber || '';
            document.getElementById('outGhiChuBee').value = data.ghiChuBee || '';
            document.getElementById('outDanhDau').value = data.danhDau || '';
            document.getElementById('outNgayDongHang').value = formatDate(data.ngayDongHang);
            document.getElementById('outMaTracking').value = data.maTracking || '';
            document.getElementById('outTrangThaiGiaoHang').value = data.trangThaiGiaoHang || '';
            document.getElementById('outThoiGianGiaoDuKien').value = data.thoiGianGiaoDuKien || '';
            document.getElementById('outPhiShipNoiDiaUSD').value = data.phiShipNoiDiaUSD || '';
            document.getElementById('outPhiXuLyDonUSD').value = data.phiXuLyDonUSD || '';
            document.getElementById('outGHI_CHU').value = data.ghiChu2 || '';
            document.getElementById('outNgayDoiSoat').value = formatDate(data.ngayDoiSoat);

        } catch (error) {
            alert('Lỗi: Dữ liệu JSON không hợp lệ. Vui lòng kiểm tra lại.\n' + error.message);
        }
    }

    // Add click-to-copy functionality to all output inputs
    document.querySelectorAll('#outputForm input').forEach(input => {
        input.addEventListener('click', function() {
            this.select();
            try {
                document.execCommand('copy');
                // Optional: show a small notification that text was copied
            } catch (err) {
                console.error('Không thể sao chép văn bản: ', err);
            }
        });
    });

</script>

</body>
</html>

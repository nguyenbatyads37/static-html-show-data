<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hợp đồng thi công</title>
    <style>
        /* --- CSS CHO TRÌNH DUYỆT WEB --- */
        @page {
            size: A4;
            margin: 20mm 25mm;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 13pt;
            line-height: 1.3;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 20mm 25mm;
            background: white;
        }

        .container {
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 13pt;
            margin: 0;
            font-weight: bold;
            text-transform: uppercase;
        }

        .header h2 {
            font-size: 13pt;
            margin: 5px 0 0 0;
            text-decoration: underline;
            font-weight: bold;
        }

        .header p {
            margin: 5px 0;
            font-size: 11pt;
        }

        .location-date {
            text-align: right;
            font-style: italic;
            margin-bottom: 15px;
            font-size: 13pt;
        }

        .contract-title {
            text-align: center;
            margin: 20px 0 15px 0;
        }

        .contract-title h1 {
            font-size: 16pt;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .contract-title p {
            font-size: 13pt;
            margin: 0;
        }

        .content {
            margin-top: 15px;
        }

        .content>p {
            text-align: justify;
            margin: 10px 0;
            font-size: 13pt;
            line-height: 1.5;
        }

        .content p strong {
            font-weight: bold;
        }

        .content ul,
        .content ol {
            list-style-position: outside;
            padding-left: 30px;
            margin: 8px 0;
        }

        .content li {
            text-align: justify;
            margin: 5px 0;
            font-size: 13pt;
            line-height: 1.5;
        }

        .content ul li {
            list-style-type: none;
            position: relative;
        }

        .content ul li::before {
            content: "- ";
            position: absolute;
            left: -20px;
        }

        .aligned-line {
            display: flex;
            justify-content: space-between;
            padding-left: 20px;
            margin: 8px 0;
            text-align: justify;
            font-size: 13pt;
        }

        .article {
            margin-top: 25px;
        }

        .article-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 13pt;
            text-transform: uppercase;
        }

        .signature-section {
            margin-top: 50px;
            display: flex;
            justify-content: space-around;
            text-align: center;
            page-break-inside: avoid;
        }

        .signature {
            flex: 1;
            font-weight: bold;
            font-size: 13pt;
        }

        .signature span {
            display: block;
            margin-bottom: 5px;
        }

        .signature p {
            margin: 0;
            font-style: italic;
            font-weight: normal;
            font-size: 11pt;
        }

        .hotline {
            font-weight: bold;
            text-align: left;
            margin-top: 30px;
            font-size: 13pt;
        }

        /* Nút Tải về */
        .btn-export {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 25px;
            background: #0d6efd;
            color: white;
            border: 2px solid white;
            border-radius: 50px;
            font-weight: bold;
            font-family: Arial, sans-serif;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        /* Số đỏ có thể chỉnh sửa */
        .editable-red {
            color: #dc3545;
            font-weight: bold;
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
            border: 1px dashed #dc3545;
            display: inline-block;
            min-width: 20px;
        }

        @media print {
            .btn-export { display: none; }
            .editable-red {
                color: black !important;
                background: transparent !important;
                border: none !important;
                padding: 0 !important;
            }
        }
    </style>
</head>

<body>

    <button onclick="exportDocExact()" class="btn-export" id="btnExport">Tải Hợp Đồng (.doc)</button>

    <div class="container" id="contract-content">
        <div class="header">
            <h1>CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</h1>
            <h2>Độc lập - Tự do – Hạnh phúc</h2>
            <p>* * * * * * * * *</p>
        </div>

        <p class="location-date">
            Đà Nẵng, ngày <span id="ngay_ky" class="editable-red" contenteditable="true">...</span> tháng <span
                id="thang_ky" class="editable-red" contenteditable="true">...</span> năm <span id="nam_ky"
                class="editable-red" contenteditable="true">....</span>.
        </p>

        <div class="contract-title">
            <h1>HỢP ĐỒNG THI CÔNG</h1>
            <p>Số: HĐTC <span id="so_hd" class="editable-red" contenteditable="true">02/2025</span>/danangaluminium</p>
        </div>

        <div class="content">
            <p>- Căn cứ Luật Thương Mại của Quốc Hội Nước Cộng Hòa Xã Hội Chủ Nghĩa Việt Nam số 36/2005/QH 11 ngày 14/06/2006</p>
            <p>- Căn cứ và khả năng và nhu cầu của hai bên, dựa trên tinh thần trung thực và thiện chí hợp tác của hai bên.</p>
            <p>
                Hôm nay, ngày <span id="ngay_ht" class="editable-red" contenteditable="true">.....</span> tháng <span
                    id="thang_ht" class="editable-red" contenteditable="true">...</span> năm <span id="nam_ht"
                    class="editable-red" contenteditable="true">...</span> tại văn phòng Công Ty Cổ Phần nội thất nhôm kính Đà Nẵng Aluminium.
            </p>

            <p style="margin-top: 15px;"><strong>Bên A: (Ông/Bà): <span id="ten_kh" contenteditable="true" class="editable-red">…..</span></strong></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Địa chỉ:</strong> <span id="dia_chi_kh" contenteditable="true" class="editable-red">…………………………………………………………………………………</span></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Điện thoại:</strong> <span id="sdt_kh" contenteditable="true" class="editable-red">................................................</span></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>CMND/CCCD:</strong> <span id="cccd_kh" contenteditable="true" class="editable-red">………………………………………………………….</span></p>

            <p style="margin-top: 15px;"><strong>Bên B: CÔNG TY CỔ PHẦN NỘI THẤT NHÔM KÍNH ĐÀ NẴNG ALUMINIUM</strong></p>
            <div class="aligned-line">
                <span><strong>Đại diện:</strong> (Ông) PHẠM NGUYỄN HOÀNG ANH</span>
                <span><strong>Chức vụ:</strong> Giám đốc</span>
            </div>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Số CMND:</strong> 201554312</p>
            <div class="aligned-line">
                <span><strong>Thực hiện hợp đồng:</strong> (Ông) <span id="nguoi_thuc_hien" class="editable-red" contenteditable="true">VÕ VĂN TRỌNG</span></span>
                <span><strong>Chức vụ:</strong> Phó giám đốc</span>
            </div>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Số CMND:</strong> <span id="cmnd_nguoi_thuc_hien">241278338</span></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Địa chỉ:</strong> 64 Đặng Văn Ngữ, Phường Khuê Trung, Quận Cẩm Lệ, TP Đà Nẵng.</p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Điện thoại:</strong> <span id="sdt_b">0935683508</span> – 0775 988 928</p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Mã số thuế:</strong> 0402 190 590</p>

            <div class="article">
                <p class="article-title">Điều 1:<br>NỘI DUNG CÔNG VIỆC VÀ THỜI GIAN THỰC HIỆN</p>
                <ul>
                    <li>Bên A đồng ‎‎ý cho bên B thi công hạng mục công trình: Thi công lắp dựng các hạng mục căn cứ theo Phụ lục 01 hợp đồng số: <span id="phu_luc" class="editable-red" contenteditable="true">PLHĐTC 02/2024/danangaluminium</span> , đính kèm bản vẽ.</li>
                    <li>Bên B thi công theo kích thước thực tế tại công trình, sau khi thi công xong 2 bên sẽ kiểm tra kích thước và số lượng thực tế để thanh lý hợp đồng.</li>
                    <li>Địa điểm lắp dựng: <span id="dia_diem" class="editable-red" contenteditable="true">108 NGUYỄN QUANG LÂM</span> - ĐÀ NẴNG</li>
                    <li>Thời gian hoàn thành: <span id="thoi_gian" class="editable-red" contenteditable="true">20</span> ngày kể từ ngày bàn giao mặt bằng</li>
                </ul>
            </div>

            <div class="article">
                <p class="article-title">Điều 2:<br>GIÁ TRỊ HỢP ĐỒNG VÀ PHƯƠNG THỨC THANH TOÁN</p>
                <ol>
                    <li>
                        <strong>Giá trị hợp đồng tạm tính:</strong> <span id="tong_tien" class="editable-red" contenteditable="true">0</span> VNĐ
                        <div id="contract-value-words" style="font-style: italic; padding-left: 20px;">(Bằng chữ: .../.)</div>
                    </li>
                    <li>
                        <strong>Phương thức thanh toán:</strong>
                        <ul>
                            <li><strong>a/ Hình thức thanh toán:</strong> Chuyển khoản qua số TK: 33556688 - Phạm Nguyễn Hoàng Anh - Sacombank, Chi nhánh Cẩm Lệ.</li>
                            <li><strong>b/ Thời hạn thanh toán:</strong> Chia làm 3 đợt:
                                <ul>
                                    <li>Đợt 1: Bên A tạm ứng <span id="coc_tien" class="editable-red" contenteditable="true">0</span> vnđ (Bằng chữ: <span id="coc_chu">....</span>).</li>
                                    <li>Đợt 2: Bên A thanh toán <span id="dot2_tien" class="editable-red" contenteditable="true">0</span> vnđ khi tập kết vật tư (Bằng chữ: <span id="dot2_chu">....</span>).</li>
                                    <li>Đợt 3: Thanh toán số tiền còn lại sau khi nghiệm thu.</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="article">
                <p class="article-title">Điều 3:<br>TRÁCH NHIỆM CÁC BÊN</p>
                <ol>
                    <li><strong>Trách nhiệm bên A:</strong> Bàn giao mặt bằng, hỗ trợ điện nước, thanh toán đúng hạn.</li>
                    <li><strong>Trách nhiệm bên B:</strong> Đảm bảo chất lượng, tiến độ, an toàn lao động và bảo hành công trình theo đúng cam kết.</li>
                </ol>
            </div>

            <p class="hotline">HOTLINE BẢO HÀNH : 0968414260 MR.TRỌNG</p>

            <div class="signature-section">
                <div class="signature">
                    <span>ĐẠI DIỆN BÊN A</span>
                    <p>(Ký và ghi rõ họ tên)</p>
                </div>
                <div class="signature">
                    <span>QUẢN LÝ THI CÔNG</span>
                    <p>(Ký và ghi rõ họ tên)</p>
                </div>
                <div class="signature">
                    <span>ĐẠI DIỆN BÊN B</span>
                    <p>(Ký và ghi rõ họ tên)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- HÀM ĐỌC SỐ TIỀN TIẾNG VIỆT CHUẨN ---
        function docSoTiengViet(so) {
            if (so == 0) return "Không đồng";
            const ChuSo = ["không", "một", "hai", "ba", "bốn", "năm", "sáu", "bảy", "tám", "chín"];
            const Tien = ["", "nghìn", "triệu", "tỷ", "nghìn tỷ", "triệu tỷ"];

            function docBlock(n, isFirstBlock) {
                let tram = Math.floor(n / 100);
                let chuc = Math.floor((n % 100) / 10);
                let donvi = n % 10;
                let res = "";
                if (isFirstBlock || tram > 0) res += ChuSo[tram] + " trăm ";
                else if (chuc > 0 || donvi > 0) res += "không trăm ";

                if (chuc > 1) {
                    res += ChuSo[chuc] + " mươi ";
                    if (donvi == 1) res += "mốt ";
                    else if (donvi == 5) res += "lăm ";
                    else if (donvi > 0) res += ChuSo[donvi] + " ";
                } else if (chuc == 1) {
                    res += "mười ";
                    if (donvi == 5) res += "lăm ";
                    else if (donvi > 0) res += ChuSo[donvi] + " ";
                } else if (donvi > 0) {
                    res += (res !== "" ? "linh " : "") + ChuSo[donvi] + " ";
                }
                return res;
            }

            let strSo = so.toString();
            let blocks = [];
            while (strSo.length > 0) {
                blocks.push(parseInt(strSo.slice(-3)));
                strSo = strSo.slice(0, -3);
            }

            let chuoi = "";
            for (let i = blocks.length - 1; i >= 0; i--) {
                let b = docBlock(blocks[i], i === blocks.length - 1);
                if (b !== "") chuoi += b + Tien[i] + " ";
            }
            chuoi = chuoi.trim();
            return chuoi.charAt(0).toUpperCase() + chuoi.slice(1) + " đồng";
        }

        document.addEventListener('DOMContentLoaded', function () {
            const fmt = (v) => v.toString().replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, '.');

            function updateAllWords() {
                ['tong_tien', 'coc_tien', 'dot2_tien'].forEach(id => {
                    const el = document.getElementById(id);
                    const val = parseInt(el.textContent.replace(/\./g, '')) || 0;
                    const text = val > 0 ? docSoTiengViet(val) : ".../.";
                    
                    if (id === 'tong_tien') document.getElementById('contract-value-words').textContent = "(Bằng chữ: " + text + ")";
                    if (id === 'coc_tien') document.getElementById('coc_chu').textContent = text;
                    if (id === 'dot2_tien') document.getElementById('dot2_chu').textContent = text;
                });
            }

            // Gán sự kiện nhập số
            ['tong_tien', 'coc_tien', 'dot2_tien'].forEach(id => {
                document.getElementById(id).addEventListener('input', function(e) {
                    let cursor = window.getSelection().getRangeAt(0).startOffset;
                    let oldLen = this.textContent.length;
                    let raw = this.textContent.replace(/\D/g, '');
                    this.textContent = fmt(raw);
                    updateAllWords();
                    // Giữ vị trí con trỏ (tương đối)
                    let newRange = document.createRange();
                    let selection = window.getSelection();
                    let newPos = Math.max(0, cursor + (this.textContent.length - oldLen));
                    newRange.setStart(this.childNodes[0] || this, Math.min(newPos, this.textContent.length));
                    newRange.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(newRange);
                });
            });

            // Set ngày tháng mặc định
            const now = new Date();
            document.getElementById('ngay_ky').textContent = now.getDate();
            document.getElementById('thang_ky').textContent = now.getMonth() + 1;
            document.getElementById('nam_ky').textContent = now.getFullYear();
            document.getElementById('ngay_ht').textContent = now.getDate();
            document.getElementById('thang_ht').textContent = now.getMonth() + 1;
            document.getElementById('nam_ht').textContent = now.getFullYear();
        });

        // --- XUẤT WORD ---
        function exportDocExact() {
            const btn = document.getElementById('btnExport');
            btn.innerText = "Đang xử lý...";
            
            setTimeout(() => {
                const content = document.getElementById('contract-content').cloneNode(true);
                
                // 1. Chuyển Flexbox sang Table (Word hiểu tốt hơn)
                content.querySelectorAll('.aligned-line').forEach(line => {
                    const spans = line.querySelectorAll('span');
                    const table = `<table width="100%" style="border-collapse:collapse;margin:5pt 0;">
                        <tr>
                            <td align="left" style="font-family:'Times New Roman';font-size:13pt;">${spans[0]?.innerHTML || ''}</td>
                            <td align="right" style="font-family:'Times New Roman';font-size:13pt;">${spans[1]?.innerHTML || ''}</td>
                        </tr>
                    </table>`;
                    line.outerHTML = table;
                });

                content.querySelectorAll('.signature-section').forEach(sec => {
                    const sigs = sec.querySelectorAll('.signature');
                    let cells = '';
                    sigs.forEach(s => {
                        cells += `<td align="center" width="33%" style="font-family:'Times New Roman';font-size:13pt;font-weight:bold;vertical-align:top;">${s.innerHTML}</td>`;
                    });
                    sec.outerHTML = `<table width="100%" style="margin-top:40pt;"><tr>${cells}</td></tr></table>`;
                });

                // 2. Fix List (Dấu gạch đầu dòng)
                content.querySelectorAll('ul li').forEach(li => {
                    li.innerHTML = "- " + li.innerHTML;
                    li.style.listStyle = "none";
                });

                // 3. Xóa màu nền editable
                content.querySelectorAll('.editable-red').forEach(el => {
                    el.style.color = "black";
                    el.style.background = "none";
                    el.style.border = "none";
                });

                const header = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                <head><meta charset='utf-8'><style>
                    @page { size: 21cm 29.7cm; margin: 2cm 2.5cm; }
                    body { font-family: 'Times New Roman', serif; font-size: 13pt; line-height: 1.5; }
                    p { margin: 0 0 6pt 0; text-align: justify; }
                    .header h1, .header h2 { text-align: center; margin: 0; }
                </style></head><body>`;
                const footer = `</body></html>`;

                const blob = new Blob(['\ufeff', header + content.innerHTML + footer], { type: 'application/msword' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = "Hop_Dong_Thi_Cong_" + (document.getElementById('ten_kh').textContent.trim() || "Khach_Hang") + ".doc";
                link.click();
                
                btn.innerText = "Tải Hợp Đồng (.doc)";
            }, 100);
        }
    </script>
</body>
</html>




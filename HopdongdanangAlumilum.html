<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hợp đồng thi công</title>
    <style>
        /* --- CSS CHO TRÌNH DUYỆT WEB --- */
        @page {
            size: A4;
            margin: 20mm 25mm;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 13pt;
            line-height: 1.3;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 20mm 25mm;
            background: white;
        }

        .container { width: 100%; }
        .header { text-align: center; margin-bottom: 15px; }
        .header h1 { font-size: 13pt; margin: 0; font-weight: bold; text-transform: uppercase; }
        .header h2 { font-size: 13pt; margin: 5px 0 0 0; text-decoration: underline; font-weight: bold; }
        .header p { margin: 5px 0; font-size: 11pt; }
        .location-date { text-align: right; font-style: italic; margin-bottom: 15px; font-size: 13pt; }
        .contract-title { text-align: center; margin: 20px 0 15px 0; }
        .contract-title h1 { font-size: 16pt; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
        .contract-title p { font-size: 13pt; margin: 0; }
        .content { margin-top: 15px; }
        .content > p { text-align: justify; margin: 10px 0; font-size: 13pt; line-height: 1.5; }
        .content p strong { font-weight: bold; }
        
        /* List styles */
        .content ul, .content ol { list-style-position: outside; padding-left: 30px; margin: 8px 0; }
        .content li { text-align: justify; margin: 5px 0; font-size: 13pt; line-height: 1.5; }
        .content ul li { list-style-type: none; position: relative; }
        /* Dùng CSS để hiển thị dấu gạch trên Web */
        .content ul li::before { content: "- "; position: absolute; left: -20px; }

        .aligned-line {
            display: flex;
            justify-content: space-between;
            padding-left: 20px;
            margin: 8px 0;
            text-align: justify;
            font-size: 13pt;
        }

        .article { margin-top: 25px; }
        .article-title { text-align: center; font-weight: bold; margin-bottom: 12px; font-size: 13pt; text-transform: uppercase; }
        .article ol { padding-left: 30px; }
        .article ol li { margin: 8px 0; }
        .article ul ul { padding-left: 25px; margin: 5px 0; }

        .signature-section {
            margin-top: 50px;
            display: flex;
            justify-content: space-around;
            text-align: center;
            page-break-inside: avoid;
        }

        .signature { flex: 1; font-weight: bold; font-size: 13pt; }
        .signature span { display: block; margin-bottom: 5px; }
        .signature p { margin: 0; font-style: italic; font-weight: normal; font-size: 11pt; }
        .hotline { font-weight: bold; text-align: left; margin-top: 30px; font-size: 13pt; }
        
        #contract-value-words { font-style: italic; padding-left: 20px; margin-top: 5px; font-size: 13pt; }
        #tong_tien, #coc_tien, #dot2_tien { font-weight: bold; }

        /* Nút Tải về */
        .btn-export {
            position: fixed;
            top: 20px; right: 20px;
            padding: 12px 25px;
            background: #0d6efd;
            color: white;
            border: 2px solid white;
            border-radius: 50px;
            font-weight: bold;
            font-family: Arial, sans-serif;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .btn-export:hover { background: #0b5ed7; }
        @media print { .btn-export { display: none; } }
    </style>
</head>
<body>

    <button onclick="exportDocExact()" class="btn-export" id="btnExport">Tải Hợp Đồng (.doc)</button>

    <div class="container" id="contract-content">
        <div class="header">
            <h1>CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</h1>
            <h2>Độc lập  - Tự do – Hạnh phúc</h2>
            <p>* * * * * * * * *</p>
        </div>
        
        <p class="location-date">
            Đà Nẵng, ngày <span id="ngay_ky">...</span> tháng <span id="thang_ky">...</span> năm <span id="nam_ky">....</span>.
        </p>

        <div class="contract-title">
            <h1>HỢP ĐỒNG THI CÔNG</h1>
            <p>Số: HĐTC <span id="so_hd">02/2025</span>/danangaluminium</p>
        </div>

        <div class="content">
            <p>- Căn cứ Luật Thương Mại của Quốc Hội Nước Cộng Hòa Xã Hội Chủ Nghĩa Việt Nam số 36/2005/QH 11 ngày 14/06/2006</p>
            <p>- Căn cứ và khả năng và nhu cầu của hai bên, dựa trên tinh thần trung thực và thiện chí hợp tác của hai bên.</p>
            <p>
                Hôm nay, ngày <span id="ngay_ht">.....</span> tháng <span id="thang_ht">...</span> năm <span id="nam_ht">...</span> tại văn phòng Công Ty Cổ Phần nội thất nhôm kính Đà Nẵng Aluminium.
            </p>

            <p style="margin-top: 15px;"><strong>Bên A: (Ông/Bà): <span id="ten_kh">…..</span></strong></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Địa chỉ:</strong> <span id="dia_chi_kh">……………………………………………………………………………………………………………..</span></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Điện thoại:</strong> <span id="sdt_kh">................................................</span></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>CMND/CCCD:</strong> <span id="cccd_kh">……………………………………………………………………………….</span></p>
            
            <p style="margin-top: 15px;"><strong>Bên B: CÔNG TY CỔ PHẦN NỘI THẤT NHÔM KÍNH ĐÀ NẴNG ALUMINIUM</strong></p>
            <div class="aligned-line" style="margin: 5px 0;">
                <span><strong>Đại diện:</strong> (Ông) PHẠM NGUYỄN HOÀNG ANH</span>
                <span><strong>Chức vụ:</strong> Giám đốc</span>
            </div>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Số CMND:</strong> 201554312</p>
            <div class="aligned-line" style="margin: 5px 0;">
                <span><strong>Thực hiện hợp đồng:</strong> (Ông) <span id="nguoi_thuc_hien">VÕ VĂN TRỌNG</span></span>
                <span><strong>Chức vụ:</strong> Phó giám đốc</span>
            </div>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Số CMND:</strong> <span id="cmnd_nguoi_thuc_hien">241278338</span></p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Địa chỉ:</strong> 64 Đặng Văn Ngữ, Phường Khuê Trung, Quận Cẩm Lệ, TP Đà Nẵng.</p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Điện thoại:</strong> <span id="sdt_b">0935683508</span> – 0775 988 928</p>
            <p style="padding-left: 20px; margin: 5px 0;"><strong>Mã số thuế:</strong> 0402 190 590</p>
            <p style="margin-top: 15px;">Sau khi thỏa thuận, hai bên thống nhất ký kết hợp đồng với các điều khoản sau:</p>
            
            <div class="article">
                <p class="article-title">Điều 1:<br>NỘI DUNG CÔNG VIỆC VÀ THỜI GIAN THỰC HIỆN</p>
                <ul>
                    <li>Bên A đồng ‎‎ý cho bên B thi công hạng mục công trình: Thi công lắp dựng các hạng mục căn cứ theo Phụ lục 01 hợp đồng số: <span id="phu_luc">PLHĐTC 02/2024/danangaluminium</span> , đính kèm bản vẽ.</li>
                    <li>Bên B thi công theo kích thước thực tế tại công trình, sau khi thi công xong 2 bên sẽ kiểm tra kích thước và số lượng thực tế để thanh lý hợp đồng.</li>
                    <li>Địa điểm lắp dựng: <span id="dia_diem">108 NGUYỄN QUANG LÂM</span> - ĐÀ NẴNG</li>
                    <li>Thời gian hoàn thành: <span id="thoi_gian">20</span> ngày kể từ ngày bàn giao mặt bằng</li>
                </ul>
            </div>

            <div class="article">
                <p class="article-title">Điều 2:<br>GIÁ TRỊ HỢP ĐỒNG VÀ PHƯƠNG THỨC THANH TOÁN</p>
                <ol>
                    <li>
                        <strong>Giá trị hợp đồng tạm tính:</strong> <span id="tong_tien">0</span> VNĐ (Chưa bao gồm thuế VAT)
                        <div id="contract-value-words">(Bằng chữ: .../.).</div>
                    </li>
                    <li>
                        <strong>Phương thức thanh toán:</strong>
                        <ul>
                            <li><strong>a/ Hình thức thanh toán:</strong> Thanh toán bằng chuyển khoản:
                                <ul>
                                    <li>Tài khoản số: 33556688 -Phạm Nguyễn Hoàng Anh - Sacombank, Chi nhánh Cẩm Lệ</li>
                                </ul>
                            </li>
                            <li><strong>b/ Thời hạn thanh toán:</strong> Chia làm 3 đợt:
                                <ul>
                                    <li>Đợt 1: Bên A tạm ứng cho bên B <span id="coc_tien">0</span> vnđ để giữ giá vật liệu. (Bằng chữ: <span id="coc_chu">….</span> đồng).</li>
                                    <li>Đợt 2: Bên A thanh toán 50% giá trị hợp đồng, khi bên B tập kết vật tư đầy đủ đến chân công trình tương ứng với số tiền là <span id="dot2_tien">0</span> vnđ (Bằng chữ: <span id="dot2_chu">….</span> đồng).</li>
                                    <li>Đợt 3: Bên A thanh toán số tiền còn lại sau khi lắp đặt hoàn thiện xong công trình theo khối lượng thực tế.</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="article">
                <p class="article-title">Điều 3:<br>TRÁCH NHIỆM CÁC BÊN</p>
                <ol>
                    <li><strong>Trách nhiệm bên A:</strong>
                        <ul>
                            <li>Bàn giao mặt bằng, giám sát, kiểm tra chất lượng, chủng loại hàng hóa và công tác lắp đặt.</li>
                            <li>Cử cán bộ giám sát nghiệm thu thực tế tại công trình.</li>
                            <li>Hỗ trợ điện cho bên B thi công lắp ráp tại hiện trường.</li>
                            <li>Thanh toán theo đúng thỏa thuận hợp đồng.</li>
                            <li>Có quyền trả và hủy hợp đồng nếu sảy ra sai sót hoạt do bên B thi công không theo tiến độ.</li>
                        </ul>
                    </li>
                    <li><strong>Trách nhiệm bên B:</strong>
                        <ul>
                            <li>Chịu trách nhiệm về toàn bộ chất lượng kỹ thuật, mỹ thuật của công trình phù hợp với thiết kế và dự toán được duyệt.</li>
                            <li>Những vật tư dùng cho công trình phải đúng chủng loại theo thiết kế và dự toán trước khi đưa vào công trình.</li>
                            <li>Chịu trách nhiệm hoàn toàn về an toàn lao động, PCCC và vệ sinh môi trường do bên B thi công trong suốt quá trình thi công công trình.</li>
                            <li>Quản lý tốt các hồ sơ, mặt bằng, thiết bị được bên A bàn giao.</li>
                            <li>Đảm bảo đúng tiến độ theo thỏa thuận.</li>
                            <li>Bảo hành công trình: bảo hành theo phụ lục đính kèm.</li>
                            <li>Cửa kính lề sàn bảo hành 2 năm, 0% chi phí bảo hành.</li>
                            <li>Chế độ bảo hành trong vòng 24h sẽ có nhân viên đến nếu sảy ra sự cố.</li>
                            <li>Tiến hành thu hồi sản phẩm đã lắp đặt nếu như bên A không thực hiện thanh toán đầy đủ.</li>
                            <li>Bảo hành các hệ cửa và vách kính 15 năm, Phụ kiện Bảo hành 5 năm.</li>
                            <li>Vách kính chống vô nước 99%.</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="article">
                <p class="article-title">Điều 4:<br>NGHIỆM THU, BÀN GIAO CÔNG TRÌNH</p>
                <ul>
                    <li>Bên A có trách nhiệm nghiệm thu công trình từ khi có thông báo của bên B, bên B có trách nhiệm chuẩn bị đầy đủ hồ sơ và thiết bị để nghiệm thu.</li>
                    <li>Bên A được quyền hủy hợp đồng và trả hàng, được bồi thường 100% giá trị hợp đồng nếu như Bên B vi phạm các điều khoản trên.</li>
                </ul>
            </div>

            <div class="article">
                <p class="article-title">Điều 5:<br>CAM KẾT CHUNG</p>
                <ul>
                    <li>Hai bên cam kết thực hiện đầy đủ các điều khoản đã ghi trong hợp đồng này. Trong quá trình thực hiện hợp đồng nếu có vướng mắc phải thông báo kịp thời cho nhau để cùng bàn bạc, xử lý trên nguyên tắc 2 bên cùng có lợi.</li>
                    <li>Trường hợp có tranh chấp hợp đồng, 2 bên không cùng giải quyết được thì đưa ra tòa án kinh tế TP Đà Nẵng để giải quyết. Quyết định của tòa án kinh tế là chung thẩm cho cả hai bên, mọi chi phí tranh chấp bên có lỗi chịu.</li>
                    <li>Hợp đồng này được thanh lý khi 02 bên đã hoàn thành nghĩa vụ của mình theo Hợp đồng này.</li>
                    <li>Hợp đồng này được lập thành 2 bản, bên A giữ 1 bản, bên B giữ 1 bản và có giá trị pháp lý như nhau.</li>
                </ul>
            </div>

            <p class="hotline">HOTLINE BẢO HÀNH : 0968414260 MR.TRỌNG</p>

            <div class="signature-section">
                <div class="signature">
                    <span>ĐẠI DIỆN BÊN A</span>
                    <p>(Ký và ghi rõ họ tên)</p>
                </div>
                <div class="signature">
                    <span>QUẢN LÝ THI CÔNG</span>
                    <p>(Ký và ghi rõ họ tên)</p>
                </div>
                <div class="signature">
                    <span>ĐẠI DIỆN BÊN B</span>
                    <p>(Ký và ghi rõ họ tên)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT CHÍNH -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Phần điền dữ liệu (giữ nguyên logic của bạn) ---
            const urlParams = new URLSearchParams(window.location.search);
            const getValue = (key) => urlParams.get(key);
            const setText = (id, val, def='') => {
                const el = document.getElementById(id);
                if(el) el.textContent = val ? decodeURIComponent(val) : def;
            };

            const today = new Date();
            const d = getValue('ngay_ky') || today.getDate();
            const m = getValue('thang_ky') || (today.getMonth() + 1);
            const y = getValue('nam_ky') || today.getFullYear();

            setText('ngay_ky', d); setText('thang_ky', m); setText('nam_ky', y);
            setText('ngay_ht', d); setText('thang_ht', m); setText('nam_ht', y);
            setText('so_hd', getValue('so_hd'), '02/2025');
            setText('ten_kh', getValue('ten_kh'));
            setText('dia_chi_kh', getValue('dia_chi_kh'));
            setText('sdt_kh', getValue('sdt_kh'));
            setText('cccd_kh', getValue('cccd_kh'));
            setText('nguoi_thuc_hien', getValue('nguoi_thuc_hien'), 'VÕ VĂN TRỌNG');
            setText('cmnd_nguoi_thuc_hien', getValue('cmnd_nguoi_thuc_hien'), '241278338');
            setText('sdt_b', getValue('sdt_b'), '0935683508');
            setText('phu_luc', getValue('phu_luc'), 'PLHĐTC 02/2024/danangaluminium');
            setText('dia_diem', getValue('dia_diem'), '108 NGUYỄN QUANG LÂM');
            setText('thoi_gian', getValue('thoi_gian'), '20');

            const fmt = (v) => v ? v.toString().replace(/[^0-9]/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, '.') : '0';
            setText('tong_tien', fmt(getValue('tong_tien')));
            setText('coc_tien', fmt(getValue('coc_tien')));
            setText('dot2_tien', fmt(getValue('dot2_tien')));

            // Đọc số thành chữ
            const readNum = (n) => {
                const dv = ["", "một", "hai", "ba", "bốn", "năm", "sáu", "bảy", "tám", "chín"];
                const ch = ["linh", "mười", "hai mươi", "ba mươi", "bốn mươi", "năm mươi", "sáu mươi", "bảy mươi", "tám mươi", "chín mươi"];
                const tr = ["không trăm", "một trăm", "hai trăm", "ba trăm", "bốn trăm", "năm trăm", "sáu trăm", "bảy trăm", "tám trăm", "chín trăm"];
                const gr = ["", "nghìn", "triệu", "tỷ"];
                
                if(n==0) return "Không đồng";
                let s = n.toString(), parts = [], words = [];
                while(s.length>0) { parts.unshift(s.slice(Math.max(0, s.length-3))); s = s.slice(0, Math.max(0, s.length-3)); }
                
                for(let i=0; i<parts.length; i++) {
                    let val = parseInt(parts[i]);
                    let sub = [];
                    let h = Math.floor(val/100), t = Math.floor((val%100)/10), u = val%10;
                    if(i>0 || h>0) sub.push(tr[h]);
                    if(t==0 && u!=0 && (i>0 || h>0)) sub.push(ch[0]);
                    else if(t>0) sub.push(t==1 ? "mười" : ch[t]);
                    if(u!=0) {
                        if(t>1 && u==1) sub.push("mốt");
                        else if(u==5 && t>0) sub.push("lăm");
                        else if(t==1 && u==5) sub.push("lăm");
                        else sub.push(dv[u]);
                    }
                    if(sub.length>0) { words.push(sub.join(" ")); words.push(gr[parts.length-1-i]); }
                }
                let r = words.join(" ").replace(/\s+/g, ' ').trim();
                return r.charAt(0).toUpperCase() + r.slice(1) + " đồng";
            };

            const updateWords = (idVal, idOut, prefix, suffix) => {
                const el = document.getElementById(idVal);
                const out = document.getElementById(idOut);
                if(el && out) {
                    const val = parseInt(el.textContent.replace(/\./g, ''));
                    if(val > 0) out.textContent = prefix + readNum(val) + suffix;
                    else out.textContent = prefix + ".../." + suffix;
                }
            };

            if(getValue('tong_tien')) updateWords('tong_tien', 'contract-value-words', '(Bằng chữ: ', '.)');
            if(getValue('coc_tien')) updateWords('coc_tien', 'coc_chu', '', '');
            if(getValue('dot2_tien')) updateWords('dot2_tien', 'dot2_chu', '', '');
        });

        // ============================================
        // HÀM XUẤT FILE WORD GIỮ NGUYÊN FORMAT IN
        // ============================================
        function exportDocExact() {
            var btn = document.getElementById('btnExport');
            btn.innerText = "Đang xử lý...";
            btn.disabled = true;

            setTimeout(() => {
                try {
                    // 1. Sao chép nội dung
                    var src = document.getElementById('contract-content');
                    var clone = src.cloneNode(true);

                    // 2. XỬ LÝ DANH SÁCH (Quan trọng để giữ format gạch đầu dòng)
                    // Word không hiểu ::before, nên ta phải chèn text "- " trực tiếp vào HTML
                    var listItems = clone.querySelectorAll('.content ul li');
                    listItems.forEach(li => {
                        li.style.listStyle = 'none';
                        li.innerHTML = '<span style="mso-tab-count:0">&nbsp;</span>- ' + li.innerHTML;
                        // Chỉnh margin âm để giống format web
                        li.style.marginLeft = '0px'; 
                        li.style.textIndent = '-15px'; 
                        li.style.paddingLeft = '15px';
                    });

                    // 3. XỬ LÝ FLEXBOX -> TABLE (Để giữ bố cục ngang)
                    // 3.1. Các dòng Đại diện/Chức vụ
                    var lines = clone.querySelectorAll('.aligned-line');
                    lines.forEach(div => {
                        var spans = div.querySelectorAll('span');
                        var tbl = document.createElement('table');
                        tbl.setAttribute('width', '100%');
                        tbl.style.width = '100%';
                        tbl.style.borderCollapse = 'collapse';
                        tbl.style.marginTop = '5px';
                        tbl.style.marginBottom = '5px';
                        
                        var tr = document.createElement('tr');
                        // Cột 1
                        var td1 = document.createElement('td');
                        td1.style.width = '55%'; // Bên trái rộng hơn chút để tên dài không xuống dòng
                        td1.style.verticalAlign = 'top';
                        td1.style.fontFamily = 'Times New Roman';
                        td1.style.fontSize = '13pt';
                        td1.innerHTML = spans[0] ? spans[0].innerHTML : '';
                        
                        // Cột 2
                        var td2 = document.createElement('td');
                        td2.style.width = '45%';
                        td2.style.verticalAlign = 'top';
                        td2.style.textAlign = 'right'; // Căn phải bên phải
                        td2.style.fontFamily = 'Times New Roman';
                        td2.style.fontSize = '13pt';
                        // Để text "Chức vụ: ..." căn trái trong khối căn phải (đẹp hơn)
                        if(spans[1]) {
                            td2.innerHTML = '<div style="display:inline-block; text-align:left;">' + spans[1].innerHTML + '</div>';
                        }

                        tr.appendChild(td1);
                        tr.appendChild(td2);
                        tbl.appendChild(tr);
                        div.parentNode.replaceChild(tbl, div);
                    });

                    // 3.2. Phần Chữ Ký (3 cột)
                    var sigSec = clone.querySelector('.signature-section');
                    if(sigSec) {
                        var items = sigSec.querySelectorAll('.signature');
                        var tblSig = document.createElement('table');
                        tblSig.setAttribute('width', '100%');
                        tblSig.style.width = '100%';
                        tblSig.style.marginTop = '50px';
                        tblSig.style.textAlign = 'center';
                        
                        var trSig = document.createElement('tr');
                        items.forEach(item => {
                            var td = document.createElement('td');
                            td.style.width = '33%';
                            td.style.verticalAlign = 'top';
                            td.style.fontFamily = 'Times New Roman';
                            td.style.fontSize = '13pt';
                            td.style.fontWeight = 'bold';
                            td.innerHTML = item.innerHTML;
                            trSig.appendChild(td);
                        });
                        tblSig.appendChild(trSig);
                        sigSec.parentNode.replaceChild(tblSig, sigSec);
                    }

                    // 4. CSS CHO WORD (MSO CSS)
                    // Thiết lập khổ giấy A4, margin chuẩn, và ép font chữ Times New Roman
                    var css = `
                        <style>
                            @page {
                                mso-page-orientation: portrait;
                                size: 21cm 29.7cm;
                                margin: 2.0cm 2.5cm 2.0cm 2.5cm;
                            }
                            body {
                                font-family: 'Times New Roman', serif;
                                font-size: 13pt;
                                tab-interval: 36pt;
                            }
                            table {
                                border-collapse: collapse;
                                width: 100%;
                                font-family: 'Times New Roman', serif;
                                font-size: 13pt;
                                mso-table-lspace: 0pt;
                                mso-table-rspace: 0pt;
                            }
                            td {
                                padding: 0;
                                margin: 0;
                            }
                            p {
                                margin: 5pt 0;
                                text-align: justify;
                                line-height: 120%;
                                font-family: 'Times New Roman', serif;
                                font-size: 13pt;
                            }
                            /* Fix danh sách */
                            ul, ol { margin: 0; padding-left: 30px; }
                            li { margin-bottom: 5pt; }
                        </style>
                    `;

                    // 5. GỘP HTML
                    var html = `
                        <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                              xmlns:w='urn:schemas-microsoft-com:office:word' 
                              xmlns='http://www.w3.org/TR/REC-html40'>
                        <head>
                            <meta charset='utf-8'>
                            <title>Hợp Đồng</title>
                            ${css}
                        </head>
                        <body>
                            ${clone.innerHTML}
                        </body>
                        </html>
                    `;

                    // 6. TẠO FILE
                    var blob = new Blob(['\ufeff', html], {
                        type: 'application/msword'
                    });
                    
                    // Tên file theo tên khách
                    var name = "Hop_Dong";
                    var kh = document.getElementById('ten_kh').innerText;
                    if(kh && kh.trim() !== '…..') name += "_" + kh.trim().replace(/[^a-zA-Z0-9]/g, '_');
                    name += ".doc";

                    // Tải xuống
                    var url = URL.createObjectURL(blob);
                    var link = document.createElement('a');
                    link.href = url;
                    link.download = name;
                    document.body.appendChild(link);
                    link.click();
                    setTimeout(() => {
                        document.body.removeChild(link);
                        window.URL.revokeObjectURL(url);
                        btn.innerText = "Tải Hợp Đồng (.doc)";
                        btn.disabled = false;
                    }, 500);

                } catch (e) {
                    alert("Lỗi: " + e.message);
                    btn.disabled = false;
                }
            }, 100);
        }
    </script>
</body>
</html>




<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hợp Đồng Thi Công - Đà Nẵng Aluminium</title>
    <style>
        @page { size: A4; margin: 20mm 25mm; }
        * { box-sizing: border-box; }
        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 13pt;
            line-height: 1.4;
            background: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        /* Container cho tờ giấy A4 */
        .page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm 25mm;
            margin: 20px auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }

        /* Header */
        .header { text-align: center; text-transform: uppercase; margin-bottom: 20px; }
        .header h1 { font-size: 13pt; margin: 0; font-weight: bold; }
        .header h2 { font-size: 13pt; margin: 5px 0; text-decoration: underline; font-weight: bold; }

        .location-date { text-align: right; font-style: italic; margin-bottom: 20px; }

        .contract-title { text-align: center; margin-bottom: 25px; }
        .contract-title h1 { font-size: 16pt; text-transform: uppercase; margin: 0; }

        /* Row thông tin */
        .info-row {
            display: flex;
            margin: 8px 0;
            align-items: baseline;
        }
        .info-label { font-weight: bold; white-space: nowrap; margin-right: 5px; }
        
        /* Vùng nhập liệu */
        .editable {
            flex: 1;
            border-bottom: 1px dotted #000;
            min-height: 20px;
            outline: none;
            word-break: break-word;
            color: #d32f2f; /* Màu đỏ khi sửa trên web */
            font-weight: bold;
        }

        .article-title {
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            margin: 20px 0 10px 0;
        }

        .signature-section {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
        }
        .sig-box { text-align: center; width: 30%; font-weight: bold; }
        .sig-box p { font-style: italic; font-weight: normal; font-size: 11pt; margin: 5px 0; }

        /* Nút bấm */
        .toolbar {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            display: flex; flex-direction: column; gap: 10px;
        }
        .btn {
            padding: 10px 20px; background: #007bff; color: white;
            border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-export { background: #28a745; }

        @media print {
            body { background: none; }
            .page { margin: 0; box-shadow: none; }
            .toolbar { display: none; }
            .editable { color: black !important; border-bottom: 1px solid black; }
        }
    </style>
</head>
<body>

    <div class="toolbar">
        <button class="btn" onclick="window.print()">In Hợp Đồng (PDF)</button>
        <button class="btn btn-export" onclick="exportDoc()">Tải về file Word (.doc)</button>
    </div>

    <div class="page" id="contract-content">
        <div class="header">
            <h1>CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</h1>
            <h2>Độc lập - Tự do – Hạnh phúc</h2>
            <p>* * * * * * * * *</p>
        </div>

        <div class="location-date">
            Đà Nẵng, ngày <span contenteditable="true" class="editable" id="ngay_ky">...</span> 
            tháng <span contenteditable="true" class="editable" id="thang_ky">...</span> 
            năm <span contenteditable="true" class="editable" id="nam_ky">2025</span>
        </div>

        <div class="contract-title">
            <h1>HỢP ĐỒNG THI CÔNG</h1>
            <p>Số: HĐTC <span contenteditable="true" class="editable" id="so_hd">02/2025</span>/danangaluminium</p>
        </div>

        <div class="content">
            <p style="font-style: italic; font-size: 11pt;">- Căn cứ Luật Thương Mại số 36/2005/QH 11 ngày 14/06/2006.</p>
            <p style="font-style: italic; font-size: 11pt;">- Căn cứ nhu cầu và khả năng thực tế của hai bên.</p>

            <p style="margin: 15px 0;">Hôm nay, ngày <span id="ngay_ht">...</span> tháng <span id="thang_ht">...</span> năm <span id="nam_ht">...</span> tại Đà Nẵng, chúng tôi gồm:</p>

            <p><strong>BÊN A (Chủ đầu tư):</strong></p>
            <div class="info-row">
                <span class="info-label">Ông/Bà:</span>
                <span contenteditable="true" class="editable" id="ten_kh"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Địa chỉ:</span>
                <span contenteditable="true" class="editable" id="dia_chi_kh"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Điện thoại:</span>
                <span contenteditable="true" class="editable" id="sdt_kh"></span>
            </div>
            <div class="info-row">
                <span class="info-label">CMND/CCCD:</span>
                <span contenteditable="true" class="editable" id="cccd_kh"></span>
            </div>

            <p style="margin-top: 15px;"><strong>BÊN B (Đơn vị thi công): CÔNG TY CP NỘI THẤT NHÔM KÍNH ĐÀ NẴNG ALUMINIUM</strong></p>
            <div class="info-row">
                <span class="info-label">Đại diện:</span>
                <span>Ông PHẠM NGUYỄN HOÀNG ANH - Chức vụ: Giám đốc</span>
            </div>
            <div class="info-row">
                <span class="info-label">Phụ trách:</span>
                <span contenteditable="true" class="editable">VÕ VĂN TRỌNG - Chức vụ: Phó giám đốc</span>
            </div>
            <div class="info-row">
                <span class="info-label">Địa chỉ:</span>
                <span>64 Đặng Văn Ngữ, Khuê Trung, Cẩm Lệ, Đà Nẵng</span>
            </div>
            <div class="info-row">
                <span class="info-label">Mã số thuế:</span>
                <span>0402 190 590</span>
            </div>

            <div class="article-title">ĐIỀU 1: NỘI DUNG VÀ TIẾN ĐỘ</div>
            <p>- Bên A đồng ý cho bên B thi công hạng mục: <span contenteditable="true" class="editable">Lắp đặt cửa nhôm kính nội thất.</span></p>
            <p>- Địa điểm: <span contenteditable="true" class="editable" id="dia_diem"></span></p>
            <p>- Thời gian hoàn thành: <span contenteditable="true" class="editable">20</span> ngày kể từ ngày nhận mặt bằng.</p>

            <div class="article-title">ĐIỀU 2: GIÁ TRỊ VÀ THANH TOÁN</div>
            <div class="info-row">
                <span class="info-label">1. Tổng giá trị tạm tính:</span>
                <span contenteditable="true" class="editable" id="tong_tien">0</span> <span>VNĐ</span>
            </div>
            <p id="tong_tien_chu" style="font-style: italic;">(Bằng chữ: Không đồng./.)</p>

            <p><strong>2. Thanh toán:</strong></p>
            <p>- Đợt 1: Tạm ứng <span contenteditable="true" class="editable" id="coc_tien">0</span> VNĐ ngay sau khi ký hợp đồng.</p>
            <p>- Đợt 2: Thanh toán <span contenteditable="true" class="editable" id="dot2_tien">0</span> VNĐ khi tập kết vật tư.</p>
            <p>- Đợt 3: Thanh toán số còn lại sau khi nghiệm thu thực tế.</p>

            <div class="article-title">ĐIỀU 3: CAM KẾT CHUNG</div>
            <p>- Bên B cam kết bảo hành khung nhôm 15 năm, phụ kiện 05 năm.</p>
            <p>- Bên A có trách nhiệm thanh toán đúng tiến độ và bàn giao mặt bằng thi công.</p>
            <p>- Hợp đồng được lập thành 02 bản có giá trị pháp lý như nhau.</p>

            <div class="signature-section">
                <div class="sig-box">ĐẠI DIỆN BÊN A<p>(Ký, ghi rõ họ tên)</p></div>
                <div class="sig-box">QUẢN LÝ THI CÔNG<p>(Ký, ghi rõ họ tên)</p></div>
                <div class="sig-box">ĐẠI DIỆN BÊN B<p>(Ký, ghi rõ họ tên)</p></div>
            </div>

            <p style="margin-top: 40px; font-weight: bold;">HOTLINE BẢO HÀNH: 0968.414.260 (MR. TRỌNG)</p>
        </div>
    </div>

    <script>
        // --- HÀM ĐỌC SỐ THÀNH CHỮ ---
        function docSoTiengViet(so) {
            if (so == 0) return "Không đồng";
            const ChuSo = ["không", "một", "hai", "ba", "bốn", "năm", "sáu", "bảy", "tám", "chín"];
            const Tien = ["", "nghìn", "triệu", "tỷ", "nghìn tỷ", "triệu tỷ"];

            function docBlock(n, first) {
                let tram = Math.floor(n / 100), chuc = Math.floor((n % 100) / 10), dv = n % 10, res = "";
                if (first || tram > 0) res += ChuSo[tram] + " trăm ";
                else if (chuc > 0 || dv > 0) res += "không trăm ";
                if (chuc > 1) { res += ChuSo[chuc] + " mươi "; if (dv == 1) res += "mốt "; else if (dv == 5) res += "lăm "; else if (dv > 0) res += ChuSo[dv] + " "; }
                else if (chuc == 1) { res += "mười "; if (dv == 5) res += "lăm "; else if (dv > 0) res += ChuSo[dv] + " "; }
                else if (dv > 0) res += (res ? "linh " : "") + ChuSo[dv] + " ";
                return res;
            }

            let str = so.toString(), blocks = [];
            while (str.length > 0) { blocks.push(parseInt(str.slice(-3))); str = str.slice(0, -3); }
            let chuoi = "";
            for (let i = blocks.length - 1; i >= 0; i--) {
                let b = docBlock(blocks[i], i === blocks.length - 1);
                if (b) chuoi += b + Tien[i] + " ";
            }
            return chuoi.trim().charAt(0).toUpperCase() + chuoi.trim().slice(1) + " đồng./.";
        }

        // --- XỬ LÝ NHẬP LIỆU ---
        document.addEventListener('input', function (e) {
            if (['tong_tien', 'coc_tien', 'dot2_tien'].includes(e.target.id)) {
                let val = e.target.innerText.replace(/\D/g, '');
                if (val) {
                    e.target.innerText = parseInt(val).toLocaleString('vi-VN');
                    // Giữ con trỏ ở cuối
                    let range = document.createRange();
                    let sel = window.getSelection();
                    range.selectNodeContents(e.target);
                    range.collapse(false);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
                if (e.target.id === 'tong_tien') {
                    document.getElementById('tong_tien_chu').innerText = "(Bằng chữ: " + docSoTiengViet(val || 0) + ")";
                }
            }
            // Đồng bộ ngày tháng
            if (['ngay_ky', 'thang_ky', 'nam_ky'].includes(e.target.id)) {
                document.getElementById('ngay_ht').innerText = document.getElementById('ngay_ky').innerText;
                document.getElementById('thang_ht').innerText = document.getElementById('thang_ky').innerText;
                document.getElementById('nam_ht').innerText = document.getElementById('nam_ky').innerText;
            }
        });

        // --- XUẤT FILE WORD ---
        function exportDoc() {
            let content = document.getElementById('contract-content').cloneNode(true);
            
            // Chuyển info-row sang table để Word giữ dòng kẻ
            content.querySelectorAll('.info-row').forEach(row => {
                let label = row.querySelector('.info-label')?.innerText || "";
                let val = row.querySelector('.editable')?.innerText || row.innerText.replace(label, "");
                row.outerHTML = `<table width="100%" style="margin:2pt 0;"><tr>
                    <td width="100pt"><b>${label}</b></td>
                    <td style="border-bottom:1px solid black;">${val}</td>
                </tr></table>`;
            });

            // Chuyển chữ ký sang table
            let sigSection = content.querySelector('.signature-section');
            let sigs = sigSection.querySelectorAll('.sig-box');
            sigSection.outerHTML = `<table width="100%" style="margin-top:30pt;"><tr>
                <td align="center"><b>${sigs[0].childNodes[0].textContent}</b><br><i>(Ký, rõ họ tên)</i></td>
                <td align="center"><b>${sigs[1].childNodes[0].textContent}</b><br><i>(Ký, rõ họ tên)</i></td>
                <td align="center"><b>${sigs[2].childNodes[0].textContent}</b><br><i>(Ký, rõ họ tên)</i></td>
            </tr></table>`;

            // Làm sạch định dạng
            content.querySelectorAll('.editable').forEach(el => {
                el.style.color = "black";
                el.style.borderBottom = "none";
            });

            let header = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head><meta charset='utf-8'><style>
                body { font-family: 'Times New Roman'; font-size: 13pt; }
                p { margin: 0; padding: 2pt 0; text-align: justify; }
            </style></head><body>`;
            let footer = "</body></html>";
            
            let blob = new Blob(['\ufeff', header + content.innerHTML + footer], { type: 'application/msword' });
            let link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = "Hop_Dong_" + (document.getElementById('ten_kh').innerText || "Khach_Hang") + ".doc";
            link.click();
        }

        // Mặc định ngày hôm nay
        const d = new Date();
        document.getElementById('ngay_ky').innerText = d.getDate();
        document.getElementById('thang_ky').innerText = d.getMonth() + 1;
        document.getElementById('ngay_ht').innerText = d.getDate();
        document.getElementById('thang_ht').innerText = d.getMonth() + 1;
        document.getElementById('nam_ht').innerText = 2025;
    </script>
</body>
</html>




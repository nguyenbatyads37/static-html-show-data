function callDeepSeek(prompt, outputCell) {
  var url = "https://api.deepseek.com/v1/chat/completions";
  var apiKey = "sk-your-api-key-here"; // ⚠️ Replace with your actual API key (store securely!)
  
  var payload = {
    "model": "deepseek-chat",
    "messages": [
      { "role": "system", "content": "You are a helpful assistant." },
      { "role": "user", "content": prompt }
    ]
  };

  var options = {
    "method": "POST",
    "contentType": "application/json",
    "headers": { "Authorization": "Bearer " + apiKey },
    "payload": JSON.stringify(payload),
    "muteHttpExceptions": true // Prevents HTTP errors from throwing exceptions
  };

  try {
    // 1. Fetch API response
    var response = UrlFetchApp.fetch(url, options);
    var responseText = response.getContentText();
    
    // 2. Check if response is valid JSON
    var json;
    try {
      json = JSON.parse(responseText);
    } catch (e) {
      throw new Error("API returned non-JSON: " + responseText);
    }

    // 3. Handle API errors (e.g., invalid key, rate limits)
    if (json.error) {
      throw new Error("API Error: " + json.error.message);
    }

    // 4. Extract and return the AI response
    var result = json.choices[0].message.content;
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    sheet.getRange(outputCell).setValue(result);
    
    return result; // Optional: Display in the cell calling the function

  } catch (e) {
    var errorMsg = "❌ Error: " + e.message;
    console.error(errorMsg);
    
    // Write error to the output cell (helps debugging)
    SpreadsheetApp.getActiveSheet().getRange(outputCell).setValue(errorMsg);
    return errorMsg;
  }
}

<!DOCTYPE html>
<html lang="vi">
</* --- C√ÄI ƒê·∫∂T CHUNG & TABS - T√îNG M√ÄU XANH L√Åhead>
  <meta charset="UTF-8">
  <title>B√°o c√°o t·ªïng h·ª£p</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href=" C√ÇY --- */
    :root {
        --primary-color: #2d7c2d;https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css /* M√†u xanh l√° c√¢y ƒë·∫≠m ch·ªß ƒë·∫°o */
        --primary-light: #4CAF50; /* M√†u2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet xanh l√° c√¢y s√°ng h∆°n */
        --primary-dark: #1b4b1b;
        --secondary-">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fontcolor: #FFC107;
        --text-dark: #333;
        --text-medium: #555;
        --bg-light: #f4f4f4;
        --border--awesome/6.0.0-beta3/css/all.min.css">
  <style>
    color: #e0e0e0;
        --font-main: 'Roboto', Arial, sans-serif;
        --gold: #FFD700;
        --silver: #C0C0C0/* --- C√ÄI ƒê·∫∂T CHUNG & TABS - T√îNG M√ÄU XANH L√Å;
        --bronze: #CD7F32;
        --danger-color: #e74c C√ÇY --- */
    :root {
        --primary-color: #2d7c2d; --primary-light: #4CAF50; --primary-dark: #1b4b1b;
        3c;
        --warning-color: #f39c12;
        --info-color--secondary-color: #FFC107; --text-dark: #333; --text-medium: #1abc9c;
    }
    
    body { 
        font-family: var(--font-main); 
        padding: 20px; 
        background-color: var(--bg-light: #555;
        --bg-light: #f4f4f4; --border-color: #); 
        color: var(--text-dark);
        line-height: 1.6;
    }
e0e0e0; --font-main: 'Roboto', Arial, sans-serif;
        --gold    
    .tab-container { 
        overflow: hidden; 
        border-bottom: 2: #FFD700; --silver: #C0C0C0; --bronze: #CDpx solid var(--border-color); 
        margin-bottom: 30px; 
        background-color: #fff;
        padding: 0 10px;
        border-radius: 87F32;
        --danger-color: #e74c3c; --warning-color: #px 8px 0 0;
        box-shadow: 0 2px 5px rgba(0f39c12; --info-color: #1abc9c;
    }
    body,0,0,0.05);
    }
    .tab-container button {
      background { font-family: var(--font-main); padding: 20px; background-color: var(---color: transparent; float: left; border: none; outline: none; cursor: pointer;
      paddingbg-light); color: var(--text-dark); line-height: 1.6; }
    : 14px 20px; transition: all 0.3s ease; font-size: 17px; font-weight: 500;
      color: var(--text-medium); border.tab-container { overflow: hidden; border-bottom: 2px solid var(--border-color); margin-bottom: 3px solid transparent; margin-right: 5px;
    }
    .tab-container-bottom: 30px; background-color: #fff; padding: 0 10px; border-radius: 8px 8px 0 0; box-shadow: 0 2px button:hover { background-color: #f9f9f9; color: var(--primary-dark); } 5px rgba(0,0,0,0.05); }
    .tab-container button { background
    .tab-container button.active { color: var(--primary-color); font-weight: 700;-color: transparent; float: left; border: none; outline: none; cursor: pointer; padding: 1 border-bottom-color: var(--primary-color); }
    .tab-content { display: none; padding4px 20px; transition: all 0.3s ease; font-size: 17: 6px 12px; border-top: none; animation: fadeIn 0.5s;px; font-weight: 500; color: var(--text-medium); border-bottom:  }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to3px solid transparent; margin-right: 5px; }
    .tab-container button:hover { background { opacity: 1; transform: translateY(0); } }

    /* --- STYLES CHUNG CHO-color: #f9f9f9; color: var(--primary-dark); }
    .tab-container button.active { color: var(--primary-color); font-weight: 700; border-bottom- B·∫¢NG & CƒÇN L·ªÄ --- */
    .table-responsive-container { overflow-x: auto;color: var(--primary-color); }
    .tab-content { display: none; padding: 6 margin-bottom: 25px; }
    table { 
        width: 100%;px 12px; border-top: none; animation: fadeIn 0.5s; }
    @ border-collapse: collapse; table-layout: auto; 
        margin-top: 20px; backgroundkeyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: : #fff; border-radius: 8px; overflow: hidden; 
        box-shadow: 1; transform: translateY(0); } }

    /* --- STYLES CHUNG CHO B·∫¢NG &0 4px 12px rgba(0,0,0,0.06);
    } CƒÇN L·ªÄ --- */
    .table-responsive-container { overflow-x: auto; margin-bottom: 25px; }
    table { width: 100%; border-collapse: collapse; table
    th, td { border: 1px solid var(--border-color); padding: 12px 1-layout: auto; margin-top: 20px; background: #fff; border-radius: 5px; white-space: nowrap; vertical-align: middle; }
    
    th { text-align: center8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0, !important; font-weight: 500; }
    td { text-align: right !important; }0,0.06); }
    th, td { border: 1px solid var(--border-color); padding
    .text-left { text-align: left !important; }
    .text-center { text-align: 12px 15px; white-space: nowrap; vertical-align: middle; }
    th { text-align: center !important; font-weight: 500; }
    td { text-align: right !important; }
    .text-left { text-align: left !important; }
    .text-center { text-align: center !important; }
    tbody tr { transition: all 0.25s ease-in-out; }
    tbody tr:not(.total-row):not(.row-selected):not(.highlight):hover { transform: translateY(-2px) scale(1.005); box-shadow: 0 8px 20px rgba(0,0,0,0.08); z-index: 10; background: center !important; }

    tbody tr { transition: all 0.25s ease-in-out; }
    tbody tr:not(.total-row):not(.row-selected):not(.highlight):hover { transform: translateY(-2px) scale(1.005); box-shadow: 0 8px 20px rgba(0,0,0,0.08); z-index: 10; background-color: #fcfcfc; }
    tbody tr:nth-child(even) { background-color: #-color: #fcfcfc; }
    tbody tr:nth-child(even) { background-color: #f9f9f9; }
    
    tr.total-row { background: #e8f5e9 !important; font-weight: 700; font-size: 1.05em; color: var(--text-dark) !important; border-top: 3px solid var(--primary-colorf9f9f9; }
    tr.total-row { background: #e8f5e9); }
    tr.total-row, tr.total-row:hover { transform: none; box-shadow: none !important; font-weight: 700; font-size: 1.05em; color; }
    .total-label { text-align: left !important; }

    .header { display: var(--text-dark) !important; border-top: 3px solid var(--primary-color); }
    tr.total-row, tr.total-row:hover { transform: none; box-shadow: none; }
    .total-label { text-align: left !important; }

    .header { display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
    .header img { height: 70px; width: 70px; margin-right: 20px; border-radius: 8px; object-fit: cover; }
    .header h2 { margin: 0; color: var(--primary-color); font-size: 1.8em; font-weight: 700; }
    
    .sidebar { flex-shrink: 0; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); }
    .sidebar h3 { background: var(--primary-color); color: #fff; padding: 12px 15px; margin: 20px 0 10px; border-radius: 6px; font-size: 1.1em; }
    .sidebar label { display: block; margin: 12px 0; font-size: 0.95em; color: var(--text-medium); }
    .sidebar .indent { margin-left: 20px; }
    .sidebar input[type="date"] { width: 100%; box-sizing: border-box; padding: 10px 12px; margin: 6px 0 12px; border: 1px solid var(--border-color); border-radius: 6px; }

    /* === C√°c TAB c≈© === */
    #CostReport .report-container, #ChartReport .report-container { display: flex; gap: 20px; }
    #CostReport .sidebar, #ChartReport .sidebar { width: 260px; }
    #CostReport .main-detailed, #ChartReport .main-detailed { flex-grow: 1; }
    #CostReport th.green-header, #ChartReport th.green-header, #SaleReport th { background: var(--primary-light); color: white; }
    #CostReport th.yellow-header, #ChartReport th.yellow-header { background: var(--secondary-color); color: var(--text-dark); }
    .daily-breakdown h3 { margin-top: 30px; background: #f0f0f0; padding: 10px; border-left: 5px solid var(--primary-color); border-radius: 4px; }
    #ChartReport .charts-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    #ChartReport .chart-wrapper { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
    #ChartReport .chart-wrapper canvas { width: 100% !important; height: 400px !important; }
    #ChartReport .chart-toggle-controls { margin: 20px 0; padding: 10px; background: #eee; border-radius: 8px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; }
    #SaleReport .report-container { display: flex; flex-wrap: nowrap; gap: 20px; align-items: flex-start; max-width: 1800px; margin: 0 auto; }
    #SaleReport tbody tr { cursor: pointer; }
    #SaleReport tbody tr.row-selected, #SaleReport tbody tr.row-selected:hover { background-color: #FFF5: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
    .header img { height: 70px; width: 70px; margin-right: 20px; border-radius: 8px; object-fit: cover; }
    .header h2 { margin: 0; color: var(--primary-color); font-size: 1.8em; font-weight: 700; }
    
    /* === TAB 1, 2, 3: B√ÅO C√ÅO C≈® === */
    .sidebar { flex-shrink: 0; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); }
    .sidebar h3 { background: var(--primary-color); color: #fff; padding: 12px 15px; margin: 20px 0 10px; border-radius: 6px; font-size: 1.1em; }
    .sidebar label { display: block; margin: 12px 0; font-size: 0.95em; color: var(--text-9D !important; color: var(--text-dark) !important; font-weight: 600; }medium); }
    .sidebar .indent { margin-left: 20px; }
    .sidebar input[type="date"] { width: 100%; box-sizing: border-box; padding: 10px 12px; margin: 6px 0 12px; border: 1px solid var(--border-color); border-radius: 6px; }
    #CostReport .report-container, #ChartReport .report-container { display: flex; gap: 20px; }
    #CostReport .sidebar, #ChartReport .sidebar { width: 260px; }
    #CostReport .main-detailed, #ChartReport .main-detailed { flex-grow: 1; }
    #CostReport th.green-header, #ChartReport th.green-header, #SaleReport th { background: var(--primary-light
    @media (max-width: 1200px) { #SaleReport .report-container {); color: white; }
    #CostReport th.yellow-header, #ChartReport th.yellow-header { background: var(--secondary-color); color: var(--text-dark); }
    .daily-breakdown h3 { margin-top: 30px; background: #f0f0f0; padding: 10px; border-left: 5px solid var(--primary-color); border-radius: 4px; }
    #ChartReport .charts-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    #ChartReport .chart-wrapper { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
    #ChartReport .chart-wrapper canvas { width: 100% !important; height: 400px !important; }
    #ChartReport .chart-toggle-controls { margin: 20px 0; padding: 10px; background: #eee; border-radius: 8px; display: flex; flex-wrap: wrap; gap:  flex-direction: column; } #SaleReport .sidebar, #SaleReport .main-detailed { width: 1015px; align-items: center; }
    #SaleReport .report-container { display: flex; flex-wrap: nowrap; gap: 20px; align-items: flex-start; max-width: 1800px; margin: 0 auto; }
    #SaleReport tbody tr { cursor: pointer; }
    #SaleReport tbody tr.row-selected, #SaleReport tbody tr.row-selected:hover { background-color: #FFF59D !important; color: var(--text-dark) !important; font-weight: 600; }
    @media (max-width: 1200px) { #SaleReport .report-container { flex-direction: column; } #SaleReport .sidebar, #SaleReport .main-detailed { width: 100%; position: static; max-height: none; } }
    
    /* === TAB 4: B√ÅO C√ÅO HI·ªÜU QU·∫¢ MKT (M0%; position: static; max-height: none; } }
    
    /* === TAB MKT === */
    ·ªöI) === */
    #MktReport .report-header { text-align: center; margin-#MktReport .report-header { text-align: center; margin-bottom: 20px; padding:bottom: 20px; padding: 20px; background-color: #fff; border-radius: 8 20px; background-color: #fff; border-radius: 8px; box-shadow: 0px; box-shadow: 0 2px 10px rgba(0,0,0,0 2px 10px rgba(0,0,0,0.05); }
    #.05); }
    #MktReport .report-title { font-size: 22px;MktReport .report-title { font-size: 22px; font-weight: 700 font-weight: 700; color: var(--text-dark); margin-bottom: 5px; }; color: var(--text-dark); margin-bottom: 5px; }
    #MktReport .report
    #MktReport .report-date { color: var(--text-medium); font-size: -date { color: var(--text-medium); font-size: 16px; }
    #MktReport .filter-container { display: flex; flex-wrap: wrap; gap: 20px16px; }
    #MktReport .filter-container { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; padding: 15px; background; margin-bottom: 20px; padding: 15px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); align-items: center; }
,0,0.05); align-items: center; }
    #MktReport .filter-    #MktReport .filter-group { display: flex; align-items: center; gap: 1group { display: flex; align-items: center; gap: 10px; }
    #MktReport label { font-weight: 500; color: var(--text-dark); }
    0px; }
    #MktReport label { font-weight: 500; color: var#MktReport input[type="date"], #MktReport select { padding: 8px 12(--text-dark); }
    #MktReport input[type="date"], #MktReport select { paddingpx; border: 1px solid var(--border-color); border-radius: 4px; font-family: inherit: 8px 12px; border: 1px solid var(--border-color); border-radius: 4; background-color: #fff; }
    #MktReport button { background-color: var(--primarypx; font-family: inherit; background-color: #fff; }
    #MktReport button { background-color-color); color: white; border: none; cursor: pointer; font-weight: 600;: var(--primary-color); color: white; border: none; cursor: pointer; font-weight:  transition: background-color 0.2s; padding: 8px 15px; border-radius: 4600; transition: background-color 0.2s; padding: 8px 15px; border-px; }
    #MktReport button:hover { background-color: var(--primary-dark); }radius: 4px; }
    #MktReport button:hover { background-color: var(--primary
    #MktReport th { background-color: var(--primary-light); color: white; }
    #-dark); }
    #MktReport th { background-color: var(--primary-light); color:MktReport .highlight { background-color: #e8f5e9 !important; font-weight: 60 white; }
    #MktReport .highlight { background-color: #e8f5e9 !important;0; }
    #MktReport .section-title { font-size: 20px; font-weight: font-weight: 600; }
    #MktReport .section-title { font-size:  600; color: var(--primary-dark); margin: 25px 0 15px 20px; font-weight: 600; color: var(--primary-dark); margin: 250; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color); }
    px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid#MktReport .error-message, #MktReport .loading { color: var(--text-medium); text var(--primary-color); }
    #MktReport .error-message, #MktReport .loading {-align: center; padding: 20px; font-size: 18px; font-weight: color: var(--text-medium); text-align: center; padding: 20px; font-size:  500;}
    @media (max-width: 768px) { #Mkt18px; font-weight: 500;}
    @media (max-width: 7Report .filter-container { flex-direction: column; align-items: flex-start; } }

    /*68px) { #MktReport .filter-container { flex-direction: column; align-items: flex === TAB NH√ÇN S·ª∞ === */
    #StaffReport .report-container { display: flex; gap: 25-start; } }

    /* === TAB 5: B√ÅO C√ÅO NH√ÇN S·ª∞ (Tpx; }
    #StaffReport .sidebar { flex: 0 0 300px; background: white; border-radius: 8px; padding: 20px; height: fit-content; box√≠ch h·ª£p) === */
    #StaffReport .report-container { display: flex; gap: 25px; }
    #StaffReport .sidebar { flex: 0 0 300px; background: white-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    #StaffReport .sidebar h3 { font-size: 1.3rem; color: var; border-radius: 8px; padding: 20px; height: fit-content; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    (--text-dark); margin-bottom: 20px; padding-bottom: 10px; border-bottom#StaffReport .sidebar h3 { font-size: 1.3rem; color: var(--text-dark); margin: 2px solid var(--primary-color); }
    #StaffReport .sidebar label { font-weight: 5-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--00; margin-bottom: 5px; display: block; font-size: 0.95primary-color); }
    #StaffReport .sidebar label { font-weight: 500; margin-bottom: 5px; display: block; font-size: 0.95rem; }
    rem; }
    #StaffReport .sidebar input[type="date"], #StaffReport .sidebar select { width#StaffReport .sidebar input[type="date"], #StaffReport .sidebar select { width: 100%; padding: 100%; padding: 10px; border: 1px solid var(--border-color); border-: 10px; border: 1px solid var(--border-color); border-radius: 6radius: 6px; margin-bottom: 15px; transition: all 0.3s ease; }
px; margin-bottom: 15px; transition: all 0.3s ease; }
    #Staff    #StaffReport .sidebar input[type="date"]:focus, #StaffReport .sidebar select:focus { borderReport .sidebar input[type="date"]:focus, #StaffReport .sidebar select:focus { border-color: var-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(4(--primary-color); box-shadow: 0 0 0 3px rgba(45, 15, 124, 45, 0.2); outline: none; }
    #24, 45, 0.2); outline: none; }
    #StaffReport .sidebarStaffReport .sidebar button { width: 100%; padding: 12px; background: linear-gradient(90deg, var(--primary-color), var(--primary-light)); color: white; border: none; button { width: 100%; padding: 12px; background: linear-gradient(90deg, border-radius: 6px; font-size: 1.1rem; font-weight: 60 var(--primary-color), var(--primary-light)); color: white; border: none; border-radius:0; cursor: pointer; transition: all 0.3s ease; margin-top: 10px 6px; font-size: 1.1rem; font-weight: 600; cursor: pointer;; }
    #StaffReport .main-detailed { flex: 1; min-width: 0; }
 transition: all 0.3s ease; margin-top: 10px; }
    #StaffReport .main    #StaffReport .header { display: flex; align-items: center; background: white; padding: 15-detailed { flex: 1; min-width: 0; }
    #StaffReport .header {px 20px; border-radius: 8px; box-shadow: 0 4px  display: flex; align-items: center; background: white; padding: 15px 20px; border12px rgba(0,0,0,0.06); margin-bottom: 25px-radius: 8px; box-shadow: 0 4px 12px rgba(0,; }
    #StaffReport h3.report-title { font-size: 1.8rem; font0,0,0.06); margin-bottom: 25px; }
    #StaffReport h-weight: 600; color: var(--text-dark); margin-bottom: 25px; }
    #StaffReport .section-title { font-size: 1.5rem; color:3.report-title { font-size: 1.8rem; font-weight: 600; color: var(--text-dark); margin-bottom: 25px; }
    #StaffReport . var(--text-dark); padding-bottom: 10px; margin-bottom: 20px; border-bottomsection-title { font-size: 1.5rem; color: var(--text-dark); padding-bottom: : 2px solid #f0f0f0; }
    #StaffReport .sortable-header { cursor10px; margin-bottom: 20px; border-bottom: 2px solid #f0f0: pointer; user-select: none; position: relative; }
    #StaffReport .sortable-headerf0; }
    #StaffReport .sortable-header { cursor: pointer; user-select: none; position:hover { background-color: #e8f5e9; }
    #StaffReport .sortable: relative; }
    #StaffReport .sortable-header:hover { background-color: #e8-header::after { content: ' \f0dc'; font-family: 'Font Awesome 6 Free'; fontf5e9; }
    #StaffReport .sortable-header::after { content: ' \f-weight: 900; color: #aaa; opacity: 0.5; position: absolute; right0dc'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: #: 8px; }
    #StaffReport .sortable-header.sorted-desc::after { content:aaa; opacity: 0.5; position: absolute; right: 8px; }
    #Staff ' \f0dd'; opacity: 1; color: var(--primary-color); }
    #StaffReport .sortable-header.sorted-asc::after { content: ' \f0de'; opacity: 1; colorReport .sortable-header.sorted-desc::after { content: ' \f0dd'; opacity: 1;: var(--primary-color); }
    #StaffReport .clickable-staff-row:hover { background-color color: var(--primary-color); }
    #StaffReport .sortable-header.sorted-asc::after { content: #e8f5e9; }
    #StaffReport .highlighted-row { background-color: ' \f0de'; opacity: 1; color: var(--primary-color); }
    #StaffReport: var(--primary-color) !important; color: white !important; font-weight: bold; }
 .clickable-staff-row:hover { background-color: #e8f5e9; }
    #StaffReport .highlighted-row { background-color: var(--primary-color) !important; color:    #StaffReport .daily-summary-row { background-color: #f3faf4; font-weight: bold white !important; font-weight: bold; }
    #StaffReport .daily-summary-row { background; cursor: pointer; }
    #StaffReport .daily-summary-row:hover { background-color: #e8f5e9; }
    #StaffReport .expand-icon { margin-right: -color: #f3faf4; font-weight: bold; cursor: pointer; }
    #StaffReport .daily-summary-row:hover { background-color: #e8f5e9; }
10px; width: 1em; display: inline-block; transition: transform 0.2s ease-in    #StaffReport .expand-icon { margin-right: 10px; width: 1em; display-out; font-size: 0.8em; }
    #StaffReport .daily-summary-: inline-block; transition: transform 0.2s ease-in-out; font-size: row.expanded .expand-icon { transform: rotate(90deg); }
    #StaffReport .details0.8em; }
    #StaffReport .daily-summary-row.expanded .expand-icon {-container-row { display: none; }
    #StaffReport .details-container-row td { padding transform: rotate(90deg); }
    #StaffReport .details-container-row { display: none; }: 0 !important; border: 0 !important; }
    #StaffReport .nested-table-container { padding: 15px 20px; background-color: #fdfdfd; border-top: 2
    #StaffReport .details-container-row td { padding: 0 !important; border: 0 !importantpx solid var(--primary-color); }
    #StaffReport .chart-grid { display: grid; grid-template; }
    #StaffReport .nested-table-container { padding: 15px 20px; background--columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25color: #fdfdfd; border-top: 2px solid var(--primary-color); }
    #px; }
    #StaffReport .chart-container { background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.StaffReport .chart-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax06); padding: 20px; }
    #StaffReport .chart-title { font-size(350px, 1fr)); gap: 25px; }
    #StaffReport .chart-: 1.2rem; font-weight: 600; margin-bottom: 15pxcontainer { background: white; border-radius: 8px; box-shadow: 0 4px 12px; color: var(--text-dark); display: flex; align-items: center; }
    #StaffReport . rgba(0,0,0,0.06); padding: 20px; }
    #StaffReportchart-title i { margin-right: 10px; font-size: 1.4rem; color: .chart-title { font-size: 1.2rem; font-weight: 600; var(--primary-color); }
    #StaffReport .chart-wrapper { position: relative; height: 30 margin-bottom: 15px; color: var(--text-dark); display: flex; align-items: center0px; width: 100%; }
    #StaffReport #daily-trend-chart-container { height: 400px; padding: 20px; background: white; border-radius: ; }
    #StaffReport .chart-title i { margin-right: 10px; font-size:8px; box-shadow: 0 4px 12px rgba(0,0,0, 1.4rem; color: var(--primary-color); }
    #StaffReport .chart-wrapper { position: relative; height: 300px; width: 100%; }
    #StaffReport0.06); }
    
    /* --- HI·ªÜU ·ª®NG CHUNG --- */
    . #daily-trend-chart-container { height: 400px; padding: 20px; background:bg-green { background-color: #e8f5e9 !important; color: #2e7d white; border-radius: 8px; box-shadow: 0 4px 12px rgba32; }
    .bg-yellow { background-color: #fffde7 !important; color: #f(0,0,0,0.06); }
    
    /* --- HI·ªÜU ·ª®NG CHUNG --- */
    .bg-green { background-color: #e8f5e9 !important; color57f17; }
    .top-1, .top-2, .top-3 { font: #2e7d32; }
    .bg-yellow { background-color: #fffde-weight: 700 !important; }
    .top-1 td:first-child::before, .top7 !important; color: #f57f17; }
    .top-1, .top-2-2 td:first-child::before, .top-3 td:first-child::before { margin-right: , .top-3 { font-weight: 700 !important; }
    .top-1 td8px; font-size: 1.1em; }
    .top-1 { background-color:first-child::before, .top-2 td:first-child::before, .top-3 td:first-: #fffbeb !important; border-left: 5px solid var(--gold); }
    .topchild::before { margin-right: 8px; font-size: 1.1em; }
-1 td:first-child::before { content: "ü•á"; }
    .top-2 { background-color:    .top-1 { background-color: #fffbeb !important; border-left: 5px solid var #f5f7fa !important; border-left: 5px solid var(--silver); }
    .(--gold); }
    .top-1 td:first-child::before { content: "ü•á"; }
    .top-2 td:first-child::before { content: "ü•à"; }
    .top-3 { background-colortop-2 { background-color: #f5f7fa !important; border-left: 5px solid var: #fff5eb !important; border-left: 5px solid var(--bronze); }
    .top(--silver); }
    .top-2 td:first-child::before { content: "ü•à"; }
    -3 td:first-child::before { content: "ü•â"; }
    
    /* --- THAY.top-3 { background-color: #fff5eb !important; border-left: 5px solid var(-- ƒê·ªîI: CH·ªà B√ÅO ƒêANG T·∫¢I V·ªöI LOGO --- */
    @bronze); }
    .top-3 td:first-child::before { content: "ü•â"; }keyframes pulse {
      0% { transform: scale(1); opacity: 0.7; }
      
    
    /* --- CH·ªà B√ÅO ƒêANG T·∫¢I (C·∫¨P NH·∫¨T)50% { transform: scale(1.08); opacity: 0.9; }
      1 --- */
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 00% { transform: scale(1); opacity: 0.7; }
    }
    #0.6; }
        50% { transform: scale(1.05); opacity: 0loading-overlay {
      position: fixed; top: 0; left: 0; width: 1.8; }
    }
    #loading-overlay {
      position: fixed; top: 000%; height: 100%;
      background: rgba(255, 255; left: 0; width: 100%; height: 100%;
      background:, 255, 0.9); 
      display: flex; justify-content: center; align-items: center;
      z-index: 9999;
      transition: all  rgba(255, 255, 255, 0.9); display: flex; justify-content: center; align-items: center;
      z-index: 9999;
0.3s ease; visibility: hidden; opacity: 0; backdrop-filter: blur(4px);      transition: all 0.3s ease; visibility: hidden; opacity: 0; backdrop-filter:
    }
    #loading-overlay.visible { visibility: visible; opacity: 1; }
     blur(4px);
    }
    #loading-overlay.visible { visibility: visible; opacity: #loading-overlay .loader-content {
      display: flex; flex-direction: column; align-items1; }
    .loading-content { display: flex; flex-direction: column; align-items: center; justify: center; text-align: center;
    }
    #loading-overlay img {
      width: 150px; height: auto;
      animation: pulse 1.8s infinite ease-in--content: center; text-align: center; }
    .loading-logo { max-width: out;
    }
    #loading-overlay p {
      margin-top: 20px;200px; width: 40vw; height: auto; animation: pulse 2s infinite ease font-size: 1.2em; font-weight: 500; color: var(--primary-in-out; }
    .loading-text { margin-top: 20px; font--dark);
    }
  </style>
</head>
<body>
  
  <div idsize: 1.3em; font-weight: 500; color: var(--primary-color="loading-overlay">
    <div class="loader-content">
      <img src="https://www); }
  </style>
</head>
<body>
  
  <div id="loading-overlay.appsheet.com/template/gettablefileurl?appName=Appsheet-325045">
    <div class="loading-content">
      <img src="https://www.appsheet.268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%com/template/gettablefileurl?appName=Appsheet-325045268&20%E1%BA%A3nh_Images%2Ff930e667tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E.%E1%BA%A2nh.025539.jpg" alt="ƒêang t·∫£i1%BA%A3nh_Images%2Ff930e667.%E1%...">
      <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
    </div>
  </div>

  <divBA%A2nh.025539.jpg" alt="Loading..." class="loading-logo">
      <div class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </div>
  </div> class="tab-container">
    <button class="tablinks" onclick="openTab(event, 'Cost

  <div class="tab-container">
    <button class="tablinks" onclick="openTab(Report')" id="defaultOpen">B√°o c√°o chi ph√≠</button>
    <button class="tablinks" onclick="openevent, 'CostReport')" id="defaultOpen">B√°o c√°o chi ph√≠</button>
    <button classTab(event, 'SaleReport')">B√°o c√°o Sale</button>
    <button class="tablinks"="tablinks" onclick="openTab(event, 'SaleReport')">B√°o c√°o Sale</button>
 onclick="openTab(event, 'ChartReport')">B√°o c√°o Bi·ªÉu ƒë·ªì</button>
    <    <button class="tablinks" onclick="openTab(event, 'ChartReport')">B√°o c√°o Bibutton class="tablinks" onclick="openTab(event, 'MktReport')">B√°o c√°o Hi·ªáu·ªÉu ƒë·ªì</button>
    <button class="tablinks" onclick="openTab(event, 'MktReport')">B√°o c√°o Hi·ªáu qu·∫£ MKT</button>
    <button class="tablinks" onclick="openTab( qu·∫£ MKT</button>
    <button class="tablinks" onclick="openTab(event, 'Staffevent, 'StaffReport')">B√°o c√°o Nh√¢n s·ª±</button>
  </div>
  
  <!-- =Report')">B√°o c√°o Nh√¢n s·ª±</button>
  </div>
  
  <div id="CostReport"====================== TAB 1: B√ÅO C√ÅO CHI PH√ç ======================= -->
  <div id="Cost class="tab-content">
     <div class="report-container">
        <div class="sidebar">
          Report" class="tab-content">
     <div class="report-container">
        <div class="<h3>Ng√†y</h3> <label>T·ª´ ng√†y:<input type="date" id="start-date-tab1"></label> <labelsidebar">
          <h3>Ng√†y</h3> <label>T·ª´ ng√†y:<input type="date" id="start-date->ƒê·∫øn ng√†y:<input type="date" id="end-date-tab1"></label>
          <h3>Stab1"></label> <label>ƒê·∫øn ng√†y:<input type="date" id="end-date-tab·∫£n ph·∫©m</h3> <label><input type="checkbox" id="product-all-tab1" checked> T·∫•t c·∫£</label>1"></label>
          <h3>S·∫£n ph·∫©m</h3> <label><input type="checkbox" id="product-all <div id="product-options-tab1"></div>
          <h3>Ca</h3> <label><input type="checkbox" id="ca-all-tab1" checked> T·∫•t c·∫£</label> <div id="ca-options-tab1-tab1" checked> T·∫•t c·∫£</label> <div id="product-options-tab1"></div>
          <h3>"></div>
          <h3>Team</h3> <label><input type="checkbox" id="team-all-tab1" checked>Ca</h3> <label><input type="checkbox" id="ca-all-tab1" checked> T·∫•t c·∫£</label T·∫•t c·∫£</label> <div id="team-options-tab1"></div>
          <h3>Th·ªã tr∆∞·ªùng</h3> <> <div id="ca-options-tab1"></div>
          <h3>Team</h3> <label><input type="checkboxlabel><input type="checkbox" id="market-all-tab1" checked> T·∫•t c·∫£</label> <div id" id="team-all-tab1" checked> T·∫•t c·∫£</label> <div id="team-options="market-options-tab1"></div>
        </div>
        <div class="main-detailed">
          <div class-tab1"></div>
          <h3>Th·ªã tr∆∞·ªùng</h3> <label><input type="checkbox" id="market-all="header"> <img src="https://www.appsheet.com/template/gettablefileurl?appName-tab1" checked> T·∫•t c·∫£</label> <div id="market-options-tab1"></div>
=Appsheet-325045268&tableName=Kho%20%E1%        </div>
        <div class="main-detailed">
          <div class="header"> <img src="httpsBA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%://www.appsheet.com/template/gettablefileurl?appName=Appsheet-32502Ff930e667.%E1%BA%A2nh.025545268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2Ff930e639.jpg" alt="Logo"> <h2>D·ªÆ LI·ªÜU CHI PH√ç ADS</h2> </div>
          <67.%E1%BA%A2nh.025539.jpg" alt="Logodiv class="table-responsive-container">
            <table id="summary-table-cost">
              <thead>
                <tr>
                  <th class="green-header">STT</th> <th class="green-header">Team</th> <th class"> <h2>D·ªÆ LI·ªÜU CHI PH√ç ADS</h2> </div>
          <div class="table-responsive-container">
            <table id="summary-table-cost">
              <thead>
                <tr>
                  <th class="="green-header">Marketing</th>
                  <th class="green-header">S·ªë Mess</th> <th class="green-green-header">STT</th> <th class="green-header">Team</th> <th class="green-headerheader">CPQC</th> <th class="green-header">S·ªë ƒê∆°n</th>
                  <th class="green-header">Marketing</th>
                  <th class="green-header">S·ªë Mess</th> <th class="green-header">">DS Ch·ªët</th> <th class="yellow-header">T·ªâ l·ªá ch·ªët</th> <th class="yellow-header">Gi√° Mess</th>
                  <th class="yellow-header">CPS</th> <th class="yellow-headerCPQC</th> <th class="green-header">S·ªë ƒê∆°n</th>
                  <th class="green-header">%CP/DS</th> <th class="yellow-header">Gi√° TB ƒê∆°n</th>
                </tr>
              </thead>
              <">DS Ch·ªët</th> <th class="yellow-header">T·ªâ l·ªá ch·ªët</th> <th class="yellow-tbody id="summary-body-cost"></tbody>
              <tfoot id="summary-foot-cost"></tfoot>header">Gi√° Mess</th>
                  <th class="yellow-header">CPS</th> <th class="yellow-header
            </table>
          </div>
          <div class="table-responsive-container">
            <table id="kpi-summary-table">
                <thead>
                  <tr>
                    <th class="green-header">STT">%CP/DS</th> <th class="yellow-header">Gi√° TB ƒê∆°n</th>
                </tr>
              </thead>
              <</th><th class="green-header">Team</th><th class="green-header">Marketing</th>
                    <th classtbody id="summary-body-cost"></tbody>
              <tfoot id="summary-foot-cost"></tfoot>="green-header">CPQC</th><th class="green-header">DS Ch·ªët</th><th class="green
            </table>
          </div>
          <div class="table-responsive-container">
            <table id="kpi-header">DS ƒêi</th>
                    <th class="green-header">DS Sau Ship</th><th class="green-header-summary-table">
                <thead>
                  <tr>
                    <th class="green-header">STT</th><th class="green-header">Team</th><th class="green-header">Marketing</th>
                    <th class="">DS Th√†nh C√¥ng</th>
                    <th class="yellow-header">%CP/DS</th><th class="yellow-header">%green-header">CPQC</th><th class="green-header">DS Ch·ªët</th><th class="green KPI</th>
                  </tr>
                </thead>
                <tbody id="kpi-summary-body"></tbody>
                <tfoot id="kpi-summary-foot"></tfoot>
            </table>
          </div>
          <div class="daily--header">DS ƒêi</th>
                    <th class="green-header">DS Sau Ship</th><th class="green-headerbreakdown" id="daily-breakdown-cost"></div>
        </div>
    </div>
  </div>

  <div id">DS Th√†nh C√¥ng</th>
                    <th class="yellow-header">%CP/DS</th><th class="yellow-header">%="SaleReport" class="tab-content">
      <div class="report-container">
          <div class=" KPI</th>
                  </tr>
                </thead>
                <tbody id="kpi-summary-body"></tbody>
                sidebar">
            <h3>B·ªô l·ªçc</h3>
            <label>T·ª´ ng√†y:<input type="date" id="start-<tfoot id="kpi-summary-foot"></tfoot>
            </table>
          </div>
          <div classdate-sale"></label> 
            <label>ƒê·∫øn ng√†y:<input type="date" id="end-date-="daily-breakdown" id="daily-breakdown-cost"></div>
        </div>
    </div>
  </div>sale"></label>
            <h3>S·∫£n ph·∫©m</h3> <label><input type="checkbox" id="product-all

  <!-- ======================= TAB 2: B√ÅO C√ÅO SALE ======================= -->
  <div id-sale" checked> T·∫•t c·∫£</label> <div id="product-options-sale" class="indent">="SaleReport" class="tab-content">
      <div class="report-container">
          <div class="</div>
            <h3>Ca</h3> <label><input type="checkbox" id="ca-all-sale" checked>sidebar">
            <h3>B·ªô l·ªçc</h3>
            <label>T·ª´ ng√†y:<input type="date" id="start- T·∫•t c·∫£</label> <div id="ca-options-sale" class="indent"></div>
            <h3>Teamdate-sale"></label> 
            <label>ƒê·∫øn ng√†y:<input type="date" id="end-date-</h3> <label><input type="checkbox" id="team-all-sale" checked> T·∫•t c·∫£</label>sale"></label>
            <h3>S·∫£n ph·∫©m</h3> <label><input type="checkbox" id="product-all <div id="team-options-sale" class="indent"></div>
            <h3>Th·ªã tr∆∞·ªùng</h3> <label-sale" checked> T·∫•t c·∫£</label> <div id="product-options-sale" class="indent">><input type="checkbox" id="market-all-sale" checked> T·∫•t c·∫£</label> <div id</div>
            <h3>Ca</h3> <label><input type="checkbox" id="ca-all-sale" checked>="market-options-sale" class="indent"></div>
          </div>
          <div class="main-detailed">
 T·∫•t c·∫£</label> <div id="ca-options-sale" class="indent"></div>
            <h3>Team            <div class="header"> <img src="https://www.appsheet.com/template/gettable</h3> <label><input type="checkbox" id="team-all-sale" checked> T·∫•t c·∫£</label>fileurl?appName=Appsheet-325045268&tableName=Kho%20 <div id="team-options-sale" class="indent"></div>
            <h3>Th·ªã tr∆∞·ªùng</h3> <label%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3><input type="checkbox" id="market-all-sale" checked> T·∫•t c·∫£</label> <div idnh_Images%2Ff930e667.%E1%BA%A2nh.02="market-options-sale" class="indent"></div>
          </div>
          <div class="main-detailed5539.jpg" alt="Logo"> <h2>D·ªÆ LI·ªÜU T·ªîNG H·ª¢P SALE">
            <div class="header"> <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%</h2> </div>
            <div class="table-responsive-container">
              <table id="summary-table20%E1%BA%A3nh&fileName=Kho%20%E1%BA%-sale">
                <thead>
                  <tr><th>STT</th> <th>Team</th> <th>Sale</th> <th>S·ªë Mess</th>A3nh_Images%2Ff930e667.%E1%BA%A2<th>S·ªë ƒê∆°n</th> <th>Ph·∫£n h·ªìi</th> <th>DS Ch·ªët</th> <th>T·ªâ l·ªá ch·ªët</th></tr>nh.025539.jpg" alt="Logo"> <h2>D·ªÆ LI·ªÜU T·ªîNG H
                </thead>
                <tbody id="summary-body-sale"></tbody>
                <tfoot id="summary·ª¢P SALE</h2> </div>
            <div class="table-responsive-container">
              <table id="summary-table-foot-sale"></tfoot>
              </table>
            </div>
            <div class="daily-breakdown" id="daily--sale">
                <thead>
                  <tr><th>STT</th> <th>Team</th> <th>Sale</th> <th>S·ªë Mess</th>breakdown-sale"></div>
          </div>
      </div>
  </div>
    
  <div id="Chart<th>S·ªë ƒê∆°n</th> <th>Ph·∫£n h·ªìi</th> <th>DS Ch·ªët</th> <th>T·ªâ l·ªá ch·ªët</th></tr>Report" class="tab-content">
      <div class="report-container">
        <div class="
                </thead>
                <tbody id="summary-body-sale"></tbody>
                <tfoot id="summarysidebar">
          <h3>Ng√†y</h3> <label>T·ª´ ng√†y:<input type="date" id="start-date-tab3"></label> <label>ƒê·∫øn ng√†y:<input type="date" id="end-date-tab-foot-sale"></tfoot>
              </table>
            </div>
            <div class="daily-breakdown" id="daily-3"></label>
          <h3>S·∫£n ph·∫©m</h3> <label><input type="checkbox" id="product-allbreakdown-sale"></div>
          </div>
      </div>
  </div>
    
  <!-- ======================= TAB -tab3" checked> T·∫•t c·∫£</label> <div id="product-options-tab3"></div>
3: B√ÅO C√ÅO BI·ªÇU ƒê·ªí ======================= -->
  <div id="Chart          <h3>Th·ªã tr∆∞·ªùng</h3> <label><input type="checkbox" id="market-all-tab3" checkedReport" class="tab-content">
      <div class="report-container">
        <div class="> T·∫•t c·∫£</label> <div id="market-options-tab3"></div>
        </div>
        <sidebar">
          <h3>Ng√†y</h3> <label>T·ª´ ng√†y:<input type="date" id="start-date-div class="main-detailed">
          <div class="header"> <img src="https://www.apptab3"></label> <label>ƒê·∫øn ng√†y:<input type="date" id="end-date-tabsheet.com/template/gettablefileurl?appName=Appsheet-325045263"></label>
          <h3>S·∫£n ph·∫©m</h3> <label><input type="checkbox" id="product-all8&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20-tab3" checked> T·∫•t c·∫£</label> <div id="product-options-tab3"></div>
%E1%BA%A3nh_Images%2Ff930e667.%E          <h3>Th·ªã tr∆∞·ªùng</h3> <label><input type="checkbox" id="market-all-tab3" checked1%BA%A2nh.025539.jpg" alt="Logo"> <h2>B> T·∫•t c·∫£</label> <div id="market-options-tab3"></div>
        </div>
        <√ÅO C√ÅO HI·ªÜU SU·∫§T THEO NG√ÄY</h2> </div>
          <div class="tablediv class="main-detailed">
          <div class="header"> <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-32504526-responsive-container">
            <table id="date-summary-table">
              <thead> <tr> <th>Ng√†y8&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20</th><th>T·ªïng CPQC</th><th>DS Ch·ªët</th><th>T·ªâ l·ªá ch·ªët TB</th> <th>Gi√° Mess</th>%E1%BA%A3nh_Images%2Ff930e667.%E<th>CPS</th><th>%CP/DS</th> </tr> </thead>
              <tbody id="date-summary-body1%BA%A2nh.025539.jpg" alt="Logo"> <h2>B"></tbody>
            </table>
          </div>
          <div class="chart-toggle-controls">
              <label class√ÅO C√ÅO HI·ªÜU SU·∫§T THEO NG√ÄY</h2> </div>
          <div class="table="toggle-all"><input type="checkbox" id="toggle-all-charts" checked> Ch·ªçn/B·ªè ch·ªçn-responsive-container">
            <table id="date-summary-table">
              <thead> <tr> <th>Ng√†y t·∫•t c·∫£</label>
              <label><input type="checkbox" class="chart-toggle" data-chart="cp</th><th>T·ªïng CPQC</th><th>DS Ch·ªët</th><th>T·ªâ l·ªá ch·ªët TB</th> <th>Gi√° Mess</th><th>qcChart" checked> CPQC</label>
              <label><input type="checkbox" class="chart-toggle"CPS</th><th>%CP/DS</th> </tr> </thead>
              <tbody id="date-summary-body"></tbody>
             data-chart="dsChotChart" checked> DS Ch·ªët</label>
              <label><input type</table>
          </div>
          <div class="chart-toggle-controls">
              <label class="toggle-="checkbox" class="chart-toggle" data-chart="rateChart" checked> T·ªâ l·ªá ch·ªët</label>
              <label><input type="checkbox" class="chart-toggle" data-chart="messChart" checked> Gi√°all"><input type="checkbox" id="toggle-all-charts" checked> Ch·ªçn/B·ªè ch·ªçn t·∫•t c·∫£</label> Mess</label>
              <label><input type="checkbox" class="chart-toggle" data-chart="
              <label><input type="checkbox" class="chart-toggle" data-chart="cpqcChart" checked> CPcpsChart" checked> CPS</label>
              <label><input type="checkbox" class="chart-toggle" dataQC</label>
              <label><input type="checkbox" class="chart-toggle" data-chart="dsChotChart" checked> DS Ch·ªët</label>
              <label><input type="checkbox" class-chart="cpDsRatioChart" checked> %CP/DS</label>
              <label><input type="checkbox"="chart-toggle" data-chart="rateChart" checked> T·ªâ l·ªá ch·ªët</label>
              <label class="chart-toggle" data-chart="productSalesChart" checked> DS theo S·∫£n ph·∫©m</label>
              <label><input type="checkbox" class="chart-toggle" data-chart="messChart" checked> Gi√° Mess</label>><input type="checkbox" class="chart-toggle" data-chart="marketSalesChart" checked> DS theo Th·ªã
              <label><input type="checkbox" class="chart-toggle" data-chart="cpsChart" checked tr∆∞·ªùng</label>
          </div>
          <div class="charts-container">
            <div class="chart> CPS</label>
              <label><input type="checkbox" class="chart-toggle" data-chart="cp-wrapper" data-chart="cpqcChart"><canvas id="cpqcChart"></canvas></div>
            <divDsRatioChart" checked> %CP/DS</label>
              <label><input type="checkbox" class="chart- class="chart-wrapper" data-chart="dsChotChart"><canvas id="dsChotChart"></canvastoggle" data-chart="productSalesChart" checked> DS theo S·∫£n ph·∫©m</label>
              <label><input type></div>
            <div class="chart-wrapper" data-chart="rateChart"><canvas id="rateChart="checkbox" class="chart-toggle" data-chart="marketSalesChart" checked> DS theo Th·ªã tr∆∞·ªùng</label>"></canvas></div>
            <div class="chart-wrapper" data-chart="messChart"><canvas id="
          </div>
          <div class="charts-container">
            <div class="chart-wrapper" datamessChart"></canvas></div>
            <div class="chart-wrapper" data-chart="cpsChart"><canvas-chart="cpqcChart"><canvas id="cpqcChart"></canvas></div>
            <div class="chart-wrapper" id="cpsChart"></canvas></div>
            <div class="chart-wrapper" data-chart="cpDsRatioChart">< data-chart="dsChotChart"><canvas id="dsChotChart"></canvas></div>
            <divcanvas id="cpDsRatioChart"></canvas></div>
            <div class="chart-wrapper" data-chart class="chart-wrapper" data-chart="rateChart"><canvas id="rateChart"></canvas></div>
            ="productSalesChart"><canvas id="productSalesChart"></canvas></div>
            <div class="chart-wrapper<div class="chart-wrapper" data-chart="messChart"><canvas id="messChart"></canvas></div>" data-chart="marketSalesChart"><canvas id="marketSalesChart"></canvas></div>
          </div>
        
            <div class="chart-wrapper" data-chart="cpsChart"><canvas id="cpsChart"></canvas</div>
      </div>
  </div>

  <div id="MktReport" class="tab-content">
></div>
            <div class="chart-wrapper" data-chart="cpDsRatioChart"><canvas id="      <div class="report-header">
          <div class="report-title">TH·ªêNG K√äcpDsRatioChart"></canvas></div>
            <div class="chart-wrapper" data-chart="productSales HI·ªÜU QU·∫¢ MARKETING THEO S·∫¢N PH·∫®M & TH·ªä TR∆Ø·ªúNG</div>
          <divChart"><canvas id="productSalesChart"></canvas></div>
            <div class="chart-wrapper" data- class="report-date" id="report-date-mkt"></div>
      </div>
      <div classchart="marketSalesChart"><canvas id="marketSalesChart"></canvas></div>
          </div>
        </div>
      ="filter-container">
          <div class="filter-group"> <label for="start-date-m</div>
  </div>

  <!-- ======================= TAB 4: B√ÅO C√ÅO HI·ªÜU QUkt">T·ª´ ng√†y:</label> <input type="date" id="start-date-mkt"> </div>
          <·∫¢ MKT (M·ªöI) ======================= -->
  <div id="MktReport" class="tab-contentdiv class="filter-group"> <label for="end-date-mkt">ƒê·∫øn ng√†y:</label> <input">
      <div class="report-header">
          <div class="report-title">TH·ªêNG K√ä type="date" id="end-date-mkt"> </div>
          <div class="filter-group"> <label for="market-filter-mkt">Th·ªã tr∆∞·ªùng:</label> <select id="market- HI·ªÜU QU·∫¢ MARKETING THEO S·∫¢N PH·∫®M & TH·ªä TR∆Ø·ªúNG</div>
          <div class="report-date" id="report-date-mkt"></div>
      </div>
      <div classfilter-mkt"></select> </div>
          <div class="filter-group"> <label for="team="filter-container">
          <div class="filter-group"> <label for="start-date-m-filter-mkt">Team:</label> <select id="team-filter-mkt"></select> </div>
          <div class="filter-group"> <label for="ca-filter-mkt">Ca:</label> <kt">T·ª´ ng√†y:</label> <input type="date" id="start-date-mkt"> </div>
          <div class="filter-group"> <label for="end-date-mkt">ƒê·∫øn ng√†y:</label> <inputselect id="ca-filter-mkt"></select> </div>
          <button id="apply-filter-m type="date" id="end-date-mkt"> </div>
          <div class="filter-groupkt">√Åp d·ª•ng</button>
      </div>
      <div id="loading-mkt" class=""> <label for="market-filter-mkt">Th·ªã tr∆∞·ªùng:</label> <select id="market-loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
      <div id="error-message-mkt" class="error-messagefilter-mkt"></select> </div>
          <div class="filter-group"> <label for="team-" style="display: none;"></div>
      <div id="non-asia-market-mkt" style="display:filter-mkt">Team:</label> <select id="team-filter-mkt"></select> </div>
          <div class="filter-group"> <label for="ca-filter-mkt">Ca:</label> <select id=" none;">
          <div class="section-title">TH·ªä TR∆Ø·ªúNG NGO√ÄI CH√ÇUca-filter-mkt"></select> </div>
          <button id="apply-filter-mkt"> √Å</div>
          <table id="non-asia-table-mkt">
              <thead><tr><th>S·∫£n ph·∫©m</th><th>√Åp d·ª•ng</button>
      </div>
      <div id="loading-mkt" class="loading">Th·ªã tr∆∞·ªùng</th><th class="text-right">CPQC</th><th class="text-center">S·ªëƒêang t·∫£i d·ªØ li·ªáu...</div>
      <div id="error-message-mkt" class="error- ƒë∆°n</th><th class="text-right">DS Ch·ªët</th><th class="text-center">%CP/DS</th><th class="text-right">CPS</th><th class="text-right">Gi√° ƒë∆°n TB</th><thmessage" style="display: none;"></div>
      <div id="non-asia-market-mkt" style="display: none;">
          <div class="section-title">TH·ªä TR∆Ø·ªúNG NGO√Ä class="text-center">T·ªâ l·ªá ch·ªët</th></tr></thead>
              <tbody id="non-asia-body-I CH√ÇU √Å</div>
          <table id="non-asia-table-mkt">
              <thead><tr>mkt"></tbody>
          </table>
      </div>
      <div id="asia-market-mkt" style="display: none;">
          <div class="section-title">TH·ªä TR∆Ø·ªúNG CH√ÇU √Å</div>
          <table<th>S·∫£n ph·∫©m</th><th>Th·ªã tr∆∞·ªùng</th><th class="text-right">CPQC</th><th class="text id="asia-table-mkt">
              <thead><tr><th>S·∫£n ph·∫©m</th><th>Th·ªã tr∆∞·ªùng</th><th class="-center">S·ªë ƒë∆°n</th><th class="text-right">DS Ch·ªët</th><th class="text-center">%text-right">CPQC</th><th class="text-center">S·ªë ƒë∆°n</th><th class="text-CP/DS</th><th class="text-right">CPS</th><th class="text-right">Gi√° ƒë∆°nright">DS Ch·ªët</th><th class="text-center">%CP/DS</th><th class="text-right"> TB</th><th class="text-center">T·ªâ l·ªá ch·ªët</th></tr></thead>
              <tbody id="CPS</th><th class="text-right">Gi√° ƒë∆°n TB</th><th class="text-center">T·ªânon-asia-body-mkt"></tbody>
          </table>
      </div>
      <div id="asia-market-m l·ªá ch·ªët</th></tr></thead>
              <tbody id="asia-body-mkt"></tbody>
          </table>
      </div>
kt" style="display: none;">
          <div class="section-title">TH·ªä TR∆Ø·ªúNG      <div id="summary-mkt" style="display: none;">
          <div class="section-title">T·ªîNG H·ª¢P T·∫§T C·∫¢ TH·ªä TR∆Ø·ªúNG</div>
          <table id="summary-table-mkt">
              <thead><tr><th>S·∫£n ph·∫©m</th><th></th><th class="text-right"> CH√ÇU √Å</div>
          <table id="asia-table-mkt">
              <thead><tr><th>S·∫£n ph·∫©m</th><th>Th·ªã tr∆∞·ªùng</th><th class="text-right">CPQC</th><th class="text-center">S·ªë ƒë∆°n</th><th class="text-right">DS Ch·ªët</th><th class="text-center">%CPQC</th><th class="text-center">S·ªë ƒë∆°n</th><th class="text-right">DS Ch·ªët</th><CP/DS</th><th class="text-right">CPS</th><th class="text-right">Gi√° ƒë∆°nth class="text-center">%CP/DS</th><th class="text-right">CPS</th><th class="text- TB</th><th class="text-center">T·ªâ l·ªá ch·ªët</th></tr></thead>
              <tbody id="right">Gi√° ƒë∆°n TB</th><th class="text-center">T·ªâ l·ªá ch·ªët</th></tr></thead>
              asia-body-mkt"></tbody>
          </table>
      </div>
      <div id="summary-mkt" style="display: none;">
          <div class="section-title">T·ªîNG H·ª¢P T·∫§T C<tbody id="summary-body-mkt"></tbody>
          </table>
      </div>
  </div>

  <!--·∫¢ TH·ªä TR∆Ø·ªúNG</div>
          <table id="summary-table-mkt">
              <thead><tr><th>S·∫£n ph·∫©m</th><th></th><th class="text-right">CPQC</th><th class="text-center">S·ªë ======================= TAB 5: B√ÅO C√ÅO NH√ÇN S·ª∞ (T√çCH H·ª¢P) ƒë∆°n</th><th class="text-right">DS Ch·ªët</th><th class="text-center">%CP/DS</th> ======================= -->
  <div id="StaffReport" class="tab-content">
      <div class="report-<th class="text-right">CPS</th><th class="text-right">Gi√° ƒë∆°n TB</th><thcontainer">
          <div class="sidebar">
              <h3>B·ªô l·ªçc chi ti·∫øt</h3>
              <label for="start-date class="text-center">T·ªâ l·ªá ch·ªët</th></tr></thead>
              <tbody id="summary-body--staff">T·ª´ ng√†y:</label> <input type="date" id="start-date-staff">
              <labelmkt"></tbody>
          </table>
      </div>
  </div>

  <!-- ======================= TAB 5: B√ÅO C for="end-date-staff">ƒê·∫øn ng√†y:</label> <input type="date" id="end-date√ÅO NH√ÇN S·ª∞ (T√çCH H·ª¢P) ======================= -->
  <div id="StaffReport"-staff">
              <label for="team-filter-staff">Ch·ªçn Team (gi·ªØ Ctrl/Cmd ƒë·ªÉ class="tab-content">
      <div class="report-container">
          <div class="sidebar"> ch·ªçn nhi·ªÅu):</label> <select id="team-filter-staff" multiple size="6"></select>
              <
              <h3>B·ªô l·ªçc chi ti·∫øt</h3>
              <label for="start-date-staff">T·ª´ ng√†y:</label> <input type="date" id="start-date-staff">
              <label for="end-date-staff">ƒêlabel for="staff-filter-staff">Ch·ªçn ƒë·ªëi t∆∞·ª£ng xem:</label> <select id="staff-filter-staff·∫øn ng√†y:</label> <input type="date" id="end-date-staff">
              <label for"></select>
              <button id="apply-filter-staff">Xem B√°o c√°o</button>
          </div>
          <div class="main-detailed">
              <div class="header">
                  <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325="team-filter-staff">Ch·ªçn Team (gi·ªØ Ctrl/Cmd ƒë·ªÉ ch·ªçn nhi·ªÅu):</label> <select id="045268&tableName=Kho%20%E1%BA%A3nh&fileNameteam-filter-staff" multiple size="6"></select>
              <label for="staff-filter-staff">Ch·ªçn=Kho%20%E1%BA%A3nh_Images%2Ff930e667.%E1%BA%A2nh.025539.jpg" alt="Logo">
 ƒë·ªëi t∆∞·ª£ng xem:</label> <select id="staff-filter-staff"></select>
              <button id="apply-filter                  <h2>B√ÅO C√ÅO HI·ªÜU SU·∫§T NH√ÇN S·ª∞</h2>
              </div>
  -staff">Xem B√°o c√°o</button>
          </div>
          <div class="main-detailed">
              
              <div id="staff-content-wrapper">
                  <div id="staff-placeholder"><p>V<div class="header">
                  <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_ui l√≤ng ch·ªçn Team v√† ƒë·ªëi t∆∞·ª£ng xem b√°o c√°o.</p></div>
              
                  <div id="staff-resultsImages%2Ff930e667.%E1%BA%A2nh.02-container" style="display: none;">
                      <h3 id="staff-report-title" class="report-title5539.jpg" alt="Logo">
                  <h2>B√ÅO C√ÅO HI·ªÜU SU"></h3>
                      <div id="staff-summary-container">
                          <h4 class="section-title">T·ªïng·∫§T NH√ÇN S·ª∞</h2>
              </div>
  
              <div id="staff-content-wrapper">
                  < h·ª£p hi·ªáu su·∫•t trong k·ª≥ (Click v√†o nh√¢n s·ª± ƒë·ªÉ xem bi·ªÉu ƒë·ªì)</h4>
                          <div class="table-responsive-container"> <table id="staff-summary-table"></table> </div>
                      </div>
                      <div id="staffdiv id="staff-placeholder"><p>Vui l√≤ng ch·ªçn Team v√† ƒë·ªëi t∆∞·ª£ng xem b√°o c√°o.</p></div>-daily-breakdown-container">
                          <h4 class="section-title">Chi ti·∫øt hi·ªáu su·∫•t theo
              
                  <div id="staff-results-container" style="display: none;">
                      <h ng√†y</h4>
                           <div class="table-responsive-container"> <div id="daily-breakdown-table-wrapper">3 id="staff-report-title" class="report-title"></h3>
                      <div id="staff-</div> </div>
                      </div>
                      <div id="daily-comparison-container" style="display: none;">
summary-container">
                          <h4 class="section-title">T·ªïng h·ª£p hi·ªáu su·∫•t trong k·ª≥ (Click v√†o                        <h4 class="section-title">Xu H∆∞·ªõng Doanh S·ªë Ch·ªët To√†n Team Theo Ng√†y</h4> nh√¢n s·ª± ƒë·ªÉ xem bi·ªÉu ƒë·ªì)</h4>
                          <div class="table-responsive-container"> <table id="staff
                        <div id="daily-trend-chart-container"><canvas id="teamDailyTrendChart"></canvas></div>
                      -summary-table"></table> </div>
                      </div>
                      <div id="staff-daily-breakdown-container"></div>
                      <h4 class="section-title">Bi·ªÉu ƒë·ªì t·ªïng quan</h4>
                      <div id="charts-container
                          <h4 class="section-title">Chi ti·∫øt hi·ªáu su·∫•t theo ng√†y</h4>
                           <div class="table-responsive-staff" class="chart-grid">
                          <div class="chart-container" data-chart="dough-container"> <div id="daily-breakdown-table-wrapper"></div> </div>
                      </div>
                      <nut" style="display: none;">
                            <div id="doughnut-chart-title" class="chart-div id="daily-comparison-container" style="display: none;">
                        <h4 class="section-title"><i class="fas fa-chart-pie"></i>T·ªâ L·ªá ƒê√≥ng G√≥p Doanh S·ªëtitle">Xu H∆∞·ªõng Doanh S·ªë Ch·ªët To√†n Team Theo Ng√†y</h4>
                        <div id="daily-</div>
                            <div class="chart-wrapper"><canvas id="teamDoughnutChart"></canvas></div>
trend-chart-container"><canvas id="teamDailyTrendChart"></canvas></div>
                      </div>
                      <h4 class                          </div>
                          <div class="chart-container" data-chart="line" style="display: none;"> <="section-title">Bi·ªÉu ƒë·ªì t·ªïng quan</h4>
                      <div id="charts-container-staff" class="chart-div class="chart-title"><i class="fas fa-chart-line" style="color: var(--dangergrid">
                          <div class="chart-container" data-chart="doughnut" style="display: none;">
                            -color);"></i>Xu H∆∞·ªõng Doanh S·ªë C√° Nh√¢n</div> <div class="chart-wrapper"><canvas id="staff<div id="doughnut-chart-title" class="chart-title"><i class="fas fa-chartLineChart"></canvas></div> </div>
                          <div class="chart-container" data-chart="combo" style="display: none;"> <div class="chart-title"><i class="fas fa-chart-area" style="color-pie"></i>T·ªâ L·ªá ƒê√≥ng G√≥p Doanh S·ªë</div>
                            <div class="chart-wrapper"><canvas: var(--info-color);"></i>Doanh S·ªë & T·ªâ l·ªá Ch·ªët C√° Nh√¢n</div> <div class=" id="teamDoughnutChart"></canvas></div>
                          </div>
                          <div class="chart-container" data-chartchart-wrapper"><canvas id="staffComboChart"></canvas></div> </div>
                      </div>
                  </div>
              </div>="line" style="display: none;"> <div class="chart-title"><i class="fas fa-chart-line
          </div>
      </div>
  </div>


<script>
    document.addEventListener('DOMContentLoaded', () => {

" style="color: var(--danger-color);"></i>Xu H∆∞·ªõng Doanh S·ªë C√° Nh√¢n</div> <div class="chart        const loader = document.getElementById('loading-overlay');
        const showLoader = () => loader.classList.add('-wrapper"><canvas id="staffLineChart"></canvas></div> </div>
                          <div class="chart-container" datavisible');
        const hideLoader = () => loader.classList.remove('visible');

        window.openTab =-chart="combo" style="display: none;"> <div class="chart-title"><i class="fas fa-chart-area" style="color: var(--info-color);"></i>Doanh S·ªë & T·ªâ l·ªá Ch function(evt, tabName) {
            document.querySelectorAll(".tab-content").forEach(tc => tc.·ªët C√° Nh√¢n</div> <div class="chart-wrapper"><canvas id="staffComboChart"></canvas></div> </div>
style.display = "none");
            document.querySelectorAll(".tablinks").forEach(tl => tl.classList.remove("                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>


<script>
    documentactive"));
            const targetTab = document.getElementById(tabName);
            if(targetTab) targetTab.style.addEventListener('DOMContentLoaded', () => {
        const loader = document.getElementById('loading-overlay');
        const showLoader.display = "block";
            evt.currentTarget.classList.add("active");

            if (tabName === = () => loader.classList.add('visible');
        const hideLoader = () => loader.classList.remove(' 'CostReport' && !costReportApp.isInitialized) { costReportApp.init(); } 
            else ifvisible');

        window.openTab = function(evt, tabName) {
            document.querySelectorAll(".tab-content (tabName === 'SaleReport' && !saleReportApp.isInitialized) { saleReportApp.init();").forEach(tc => tc.style.display = "none");
            document.querySelectorAll(".tablinks").forEach(tl }
            else if (tabName === 'ChartReport' && !chartReportApp.isInitialized) { chart => tl.classList.remove("active"));
            const targetTab = document.getElementById(tabName);
            ifReportApp.init(); }
            else if (tabName === 'MktReport' && !mktReportApp.isInitialized) { mktReportApp.init(); }
            else if (tabName === 'StaffReport'(targetTab) targetTab.style.display = "block";
            evt.currentTarget.classList.add(" && !staffReportApp.isInitialized) { staffReportApp.init(); }
        }
        
        constactive");

            if (tabName === 'CostReport' && !costReportApp.isInitialized) { costReportApp.init(); } 
            else if (tabName === 'SaleReport' && !saleReportApp.isInitialized formatUtils = {
            formatDate: v => { const d=new Date(v); return isNaN(d) { saleReportApp.init(); }
            else if (tabName === 'ChartReport' && !chartReportApp.getTime())?v:`${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1.isInitialized) { chartReportApp.init(); }
            else if (tabName === 'MktReport' && !mktReportApp.isInitialized) { mktReportApp.init(); }
            else if).padStart(2,'0')}/${d.getFullYear()}`},
            formatCurrency: v => Number(v (tabName === 'StaffReport' && !staffReportApp.isInitialized) { staffReportApp.init(); }
        }
        
        const formatUtils = {
            formatDate: v => { const d=||0).toLocaleString('vi-VN',{style:'currency',currency:'VND'}),
            formatNumber: v => Number(v||0).toLocaleString('vi-VN'),
            formatPercent: v => !isFinite(v)?'new Date(v); return isNaN(d.getTime())?v:`${String(d.getDate()).padStart(20.00%':`${(Number(v||0)*100).toFixed(2)}%`,,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`
            formatPriceShort: v => { const n=Number(v||0); return n>=1e6},
            formatCurrency: v => Number(v||0).toLocaleString('vi-VN',{style:'currency',currency?(n/1e6).toFixed(1)+'tr':(n>=1e3?(n/1e3).toFixed:'VND'}),
            formatNumber: v => Number(v||0).toLocaleString('vi-VN'),
            format(0)+'k':n.toLocaleString('vi-VN'))}
        };
        
        function handleCheckboxPercent: v => !isFinite(v)?'0.00%':`${(Number(v||0)*100).toFixed(2)}%`,
            formatPriceShort: v => { const n=Number(v||0(masterId, childClass, target) {
            if(target.id === masterId) document.querySelectorAll(`.${childClass}`).forEach(cb => cb.checked = target.checked);
            else if(target.classList); return n>=1e6?(n/1e6).toFixed(1)+'tr':(n>=1e3.contains(childClass)) document.getElementById(masterId).checked = [...document.querySelectorAll(`.${childClass}`)?(n/1e3).toFixed(0)+'k':n.toLocaleString('vi-VN'))}
        };
].every(cb => cb.checked);
        }
        
        // ===================================================================
        //        
        function handleCheckbox(masterId, childClass, target) {
            if(target.id === =========== MODULE CHO B√ÅO C√ÅO CHI PH√ç (TAB 1) ====================
        // ================================================= masterId) document.querySelectorAll(`.${childClass}`).forEach(cb => cb.checked = target.checked);
            else if(target.classList.contains(childClass)) document.getElementById(masterId).checked = [...document.querySelectorAll(`==================
        const costReportApp = {
            isInitialized: false, rawData: [], groupChildren: { '.${childClass}`)].every(cb => cb.checked);
        }
        
        // ===================================================================
        // =========== MODULE CHO B√ÅO C√ÅO CHI PH√ç (TAB 1) ====================
        // ===================================================================
        const costReportApp = {
            isInitialized: false, rawCh√¢u √Å': ['H√†n Qu·ªëc','Nh·∫≠t B·∫£n','VN'], 'Ngo√†i Ch√¢u √Å': ['√öc','US', 'Canada'] },
            init: function() { this.addEventListeners(); this.setDefaultDates(); this.fetchData(); this.isInitialized = true; },
            addEventListeners: function() { document.getElementById('CostReport').addEventListenerData: [], groupChildren: { 'Ch√¢u √Å': ['H√†n Qu·ªëc','Nh·∫≠t B·∫£n','VN'], '('change', e => e.target.matches('input')&&this.handleFilters(e.target)); },Ngo√†i Ch√¢u √Å': ['√öc','US', 'Canada'] },
            init: function() { this.add
            setDefaultDates: function() { const t=new Date(),s=new Date(t.getFullYear(),t.getMonth(),EventListeners(); this.setDefaultDates(); this.fetchData(); this.isInitialized = true; },
            addEventListeners: function()1),e=new Date(t.getFullYear(),t.getMonth()+1,0),f=d=>d. { document.getElementById('CostReport').addEventListener('change', e => e.target.matches('input')&&this.handletoISOString().split('T')[0]; document.getElementById('start-date-tab1').value=f(s);documentFilters(e.target)); },
            setDefaultDates: function() { const t=new Date(),s=new Date(.getElementById('end-date-tab1').value=f(e);},
            fetchData: function()t.getFullYear(),t.getMonth(),1),e=new Date(t.getFullYear(),t.getMonth()+1, {
                showLoader();
                fetch('https://script.google.com/macros/s/AKfy0),f=d=>d.toISOString().split('T')[0]; document.getElementById('start-date-tab1').value=f(s);document.getElementById('end-date-tab1').value=f(ecbwGwSBxeXplEzAM-jJDPaXPkiWjNyKmpR70o);},
            fetchData: function() {
                showLoader();
                fetch('https://script.google6nCY5_ynqoF-3WA1gvF91RIQQfDZ9fvAQ/.com/macros/s/AKfycbwGwSBxeXplEzAM-jJDPaXPkiexec')
                    .then(res => res.json()).then(data => {
                        this.rawData = data.map(r => ({...r, team:r.team||'Kh√°c', ten:r.tenWjNyKmpR70o6nCY5_ynqoF-3WA1gvF91||'N/A', dsChot:+r.dsChot||0, cpqc:+r.cpqc||RIQQfDZ9fvAQ/exec')
                    .then(res => res.json()).then(data0, soDon:+r.soDon||0, soMessCmt:+r.soMessCmt||0, doanhsoTC:+r.doanhsoTC||0, doanhSo:+r.doanhSo||0, doanhSo => {
                        this.rawData = data.map(r => ({...r, team:r.team||'Kh√°c', ten:r.ten||'N/A', dsChot:+r.dsChot||SauShip:+r.doanhSoSauShip||0, kpis:+r.kpis||0 }));
                        this0, cpqc:+r.cpqc||0, soDon:+r.soDon||0, soMessC.populateAllFilters(this.rawData); this.applyFilters();
                    }).catch(err => { console.error("mt:+r.soMessCmt||0, doanhsoTC:+r.doanhsoTC||0, doanhSoL·ªói Cost Data:", err); alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu chi ph√≠.'); }).finally(hideLoader);
            :+r.doanhSo||0, doanhSoSauShip:+r.doanhSoSauShip||0, k},
            populateAllFilters: function(data) { const pS=new Set(),cS=new Set(),pis:+r.kpis||0 }));
                        this.populateAllFilters(this.rawData); this.applyFilters();
                    }).catch(err => { console.error("L·ªói Cost Data:", err); alert('Kh√¥ngtS=new Set(),mS=new Set(); data.forEach(r=>{if(r.sanPham th·ªÉ t·∫£i d·ªØ li·ªáu chi ph√≠.'); }).finally(hideLoader);
            },
            populateAllFilters: function(data))pS.add(r.sanPham);if(r.ca)cS.add(r.ca);if { const pS=new Set(),cS=new Set(),tS=new Set(),mS=new Set(r.team)tS.add(r.team);if(r.thiTruong)mS.add(r.thiTruong);}); document.getElementById('product-options-tab1').innerHTML=Array.from((); data.forEach(r=>{if(r.sanPham)pS.add(r.sanPham);if(r.ca)cS.add(r.ca);if(r.team)tS.add(pS).sort().map(p=>`<label class='indent'><input type='checkbox' class='filter-productr.team);if(r.thiTruong)mS.add(r.thiTruong);});-tab1' value='${p}' checked> ${p}</label>`).join('');const mH=Object document.getElementById('product-options-tab1').innerHTML=Array.from(pS).sort().map(p.keys(this.groupChildren).map(g=>`<label><input type='checkbox' class='filter-market=>`<label class='indent'><input type='checkbox' class='filter-product-tab1' value='${p-tab1' value='${g}' checked> ${g}</label>`+this.groupChildren[g].map(c=>`<label class='indent'><input type='checkbox' class='filter-market-tab1' value='${}' checked> ${p}</label>`).join('');const mH=Object.keys(this.groupChildren).map(g=>`<label><input type='checkbox' class='filter-market-tab1' value='${gc}' checked> ${c}</label>`).join('')).join('');const oM=Array.from(m}' checked> ${g}</label>`+this.groupChildren[g].map(c=>`<label class='indent'><inputS).filter(m=>!Object.values(this.groupChildren).flat().map(c=>(c||' type='checkbox' class='filter-market-tab1' value='${c}' checked> ${c}</label').toLowerCase()).includes((m||'').toLowerCase())).sort().map(m=>`<label><input type='checkbox' class='>`).join('')).join('');const oM=Array.from(mS).filter(m=>!Object.valuesfilter-market-tab1' value='${m}' checked> ${m}</label>`).join('');document.getElementById('market-options-tab1').innerHTML=mH+oM;document.getElementById('ca-options-tab1').innerHTML(this.groupChildren).flat().map(c=>(c||'').toLowerCase()).includes((m||'').toLowerCase=Array.from(cS).sort().map(c=>`<label class='indent'><input type='checkbox'())).sort().map(m=>`<label><input type='checkbox' class='filter-market-tab1' value=' class='filter-ca-tab1' value='${c}' checked> ${c}</label>`).join('');${m}' checked> ${m}</label>`).join('');document.getElementById('market-options-tab1').innerHTML=document.getElementById('team-options-tab1').innerHTML=Array.from(tS).sort().map(tmH+oM;document.getElementById('ca-options-tab1').innerHTML=Array.from(cS=>`<label class='indent'><input type='checkbox' class='filter-team-tab1' value='${).sort().map(c=>`<label class='indent'><input type='checkbox' class='filter-ca-tab1' value='${c}' checked> ${c}</label>`).join('');document.getElementById('team-options-t}' checked> ${t}</label>`).join('');},
            getFilteredData: function() { const stab1').innerHTML=Array.from(tS).sort().map(t=>`<label class='indent'><inputV=document.getElementById('start-date-tab1').value,eV=document.getElementById('end-date-tab type='checkbox' class='filter-team-tab1' value='${t}' checked> ${t}</label>1').value,pA=document.getElementById('product-all-tab1').checked,sP=pA?null:[...document.querySelectorAll(`.filter-product-tab1:checked`)].map(c=>c`).join('');},
            getFilteredData: function() { const sV=document.getElementById('start-date-tab.value),mA=document.getElementById('market-all-tab1').checked,sM=mA?null:[...1').value,eV=document.getElementById('end-date-tab1').value,pA=document.getElementById('productdocument.querySelectorAll(`.filter-market-tab1:checked`)].map(c=>c.value),cA=document.getElementById-all-tab1').checked,sP=pA?null:[...document.querySelectorAll(`.filter-product-('ca-all-tab1').checked,sC=!cA?[...document.querySelectorAll(`.filter-ca-tab1:tab1:checked`)].map(c=>c.value),mA=document.getElementById('market-all-tab1').checked`)].map(c=>c.value):null,tA=document.getElementById('team-all-tab1checked,sM=mA?null:[...document.querySelectorAll(`.filter-market-tab1:checked`)].map(').checked,sT=!tA?[...document.querySelectorAll(`.filter-team-tab1:checked`)].mapc=>c.value),cA=document.getElementById('ca-all-tab1').checked,sC=(c=>c.value):null; return this.rawData.filter(r=>{if(!r.ngay!cA?[...document.querySelectorAll(`.filter-ca-tab1:checked`)].map(c=>c.value):null,tA=document.getElementById('team-all-tab1').checked,sT=!tA?[)return false;const d=new Date(r.ngay);if(isNaN(d.getTime()))return false;const...document.querySelectorAll(`.filter-team-tab1:checked`)].map(c=>c.value):null dS=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;const dO=(!sV||dS>=sV)&&; return this.rawData.filter(r=>{if(!r.ngay)return false;const d=new Date((!eV||dS<=eV);const pO=!sP||sP.includes(r.sanPham);constr.ngay);if(isNaN(d.getTime()))return false;const dS=`${d.getFullYear() mG=this.getGroup((r.thiTruong||'').trim().toLowerCase());const mO=!sM}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(||sM.includes(mG)||sM.includes(r.thiTruong);const cO=!sC2,'0')}`;const dO=(!sV||dS>=sV)&&(!eV||dS<=eV);||sC.includes(r.ca);const tO=!sT||sT.includes(r.team);returnconst pO=!sP||sP.includes(r.sanPham);const mG=this.getGroup dO&&pO&&mO&&cO&&tO;});},
            getGroup: function(n((r.thiTruong||'').trim().toLowerCase());const mO=!sM||sM.includes(){for(let g in this.groupChildren){if(this.groupChildren[g].map(c=>(c||'').toLowerCase()).includes(n))return g;}return n.charAt(0).toUpperCase()+n.slice(mG)||sM.includes(r.thiTruong);const cO=!sC||sC.includes(r.ca);const tO=!sT||sT.includes(r.team);return dO&&pO&&m1);},
            handleFilters: function(t){showLoader();setTimeout(()=>{handleCheckbox('product-all-tab1','filter-product-tab1',t);handleCheckbox('ca-all-tab1','filter-O&&cO&&tO;});},
            getGroup: function(n){for(let g in thisca-tab1',t);handleCheckbox('team-all-tab1','filter-team-tab1',.groupChildren){if(this.groupChildren[g].map(c=>(c||'').toLowerCase()).includes(n))return g;}return n.charAt(0).toUpperCase()+n.slice(1);},
            handleFilters:t);handleCheckbox('market-all-tab1','filter-market-tab1',t);this.applyFilters(); function(t){showLoader();setTimeout(()=>{handleCheckbox('product-all-tab1','filter-product-tabhideLoader();},10);},
            applyFilters: function(){const f=this.getFilteredData();this1',t);handleCheckbox('ca-all-tab1','filter-ca-tab1',t);handle.renderSummaryCost(f);this.renderKpiSummary(f);this.renderDailyBreakdownCost(Checkbox('team-all-tab1','filter-team-tab1',t);handleCheckbox('market-all-tab1','filter-market-tab1',t);this.applyFilters();hideLoader();},10);f);},
            renderSummaryCost: function(d){const sD={};d.forEach(r=>{const n=r.ten;if(!sD[n])sD[n]={team:r.team,},
            applyFilters: function(){const f=this.getFilteredData();this.renderSummaryCost(f);this.renderKpiSummary(f);this.renderDailyBreakdownCost(f);},
            renderSummaryCost: function(mess:0,don:0,chot:0,cpqc:0};sD[n].mess+=r.soMessCmt;sD[n].don+=r.soDon;sD[n].chot+=r.d){const sD={};d.forEach(r=>{const n=r.ten;if(!sD[dsChot;sD[n].cpqc+=r.cpqc;});const fL=Object.keys(sn])sD[n]={team:r.team,mess:0,don:0,chot:0,cpqc:0};sD[n].mess+=r.soMessCmt;sD[n].don+=rD).map(n=>({name:n,team:sD[n].team,data:sD[.soDon;sD[n].chot+=r.dsChot;sD[n].cpn]})).sort((a,b)=>b.data.chot-a.data.chot);letqc+=r.cpqc;});const fL=Object.keys(sD).map(n=>({ t={mess:0,don:0,chot:0,cpqc:0};let bH=fname:n,team:sD[n].team,data:sD[n]})).sort((a,L.map((i,x)=>{const s=i.data;t.mess+=s.mess;t.don+=b)=>b.data.chot-a.data.chot);let t={mess:0,dons.don;t.chot+=s.chot;t.cpqc+=s.cpqc;const:0,chot:0,cpqc:0};let bH=fL.map((i,x r=s.mess?s.don/s.mess:0,pm=s.mess?s.cpqc/s.mess:0,pd=s.don?s.cpqc/s.don:0,)=>{const s=i.data;t.mess+=s.mess;t.don+=s.don;t.chot+=s.chot;t.cpqc+=s.cpqc;const r=spc=s.chot?s.cpqc/s.chot:0,pdt=s.don?s.mess?s.don/s.mess:0,pm=s.mess?s.cpqc/.chot/s.don:0;const rC=r>0.1?'bg-green':'s.mess:0,pd=s.don?s.cpqc/s.don:0,pc=s.chot?s.cpqc/s.chot:0,pdt=s.don?s.bg-yellow';let R=x===0?'top-1':(x===1?'top-2':(x===chot/s.don:0;const rC=r>0.1?'bg-green':(2?'top-3':''));return `<tr class="${R}"><td class="text-center">${x+1}r>0.05?'bg-yellow':'');let R=x===0?'top-1':(x</td><td class="text-left">${i.team}</td><td class="text-left">${i.===1?'top-2':(x===2?'top-3':''));return `<tr class="${R}name}</td><td>${formatUtils.formatNumber(s.mess)}</td><td>${formatUtils.formatCurrency(s.cpqc)}</td><td>${formatUtils.formatNumber(s.don)}</td><td>${formatUtils.formatCurrency(s"><td class="text-center">${x+1}</td><td class="text-left">${i.team}.chot)}</td><td class="${rC}">${formatUtils.formatPercent(r)}</td><td>${formatUtils.</td><td class="text-left">${i.name}</td><td>${formatUtils.formatNumber(s.mess)}</td>formatCurrency(pm)}</td><td>${formatUtils.formatCurrency(pd)}</td><td>${formatUtils.formatPercent(pc<td>${formatUtils.formatCurrency(s.cpqc)}</td><td>${formatUtils.formatNumber(s.don)}</td><td>${formatUtils.formatCurrency(s.chot)}</td><td class="${rC}">${formatUtils.format)}</td><td>${formatUtils.formatCurrency(pdt)}</td></tr>`;}).join('');const tR=tPercent(r)}</td><td>${formatUtils.formatCurrency(pm)}</td><td>${formatUtils.formatCurrency(pd.mess?t.don/t.mess:0,tP=t.mess?t.cpqc/)}</td><td>${formatUtils.formatPercent(pc)}</td><td>${formatUtils.formatCurrency(pdt)}</td></tr>t.mess:0,tD=t.don?t.cpqc/t.don:0,tC=t.chot?t.cpqc/t.chot:0,tT=t.don`;}).join('');const tR=t.mess?t.don/t.mess:0,tP=t.?t.chot/t.don:0;const fH=`<tr class="total-row"><tdmess?t.cpqc/t.mess:0,tD=t.don?t.cpqc/t class="total-label" colspan="3">T·ªîNG C·ªòNG</td><td>${formatUtils.formatNumber.don:0,tC=t.chot?t.cpqc/t.chot:0,t(t.mess)}</td><td>${formatUtils.formatCurrency(t.cpqc)}</td><td>${formatUtils.formatT=t.don?t.chot/t.don:0;const fH=`<tr class="totalNumber(t.don)}</td><td>${formatUtils.formatCurrency(t.chot)}</td><td>${formatUtils.-row"><td class="total-label" colspan="3">T·ªîNG C·ªòNG</td><td>${formatformatPercent(tR)}</td><td>${formatUtils.formatCurrency(tP)}</td><td>${formatUtils.formatCurrency(tUtils.formatNumber(t.mess)}</td><td>${formatUtils.formatCurrency(t.cpqc)}</td><td>${formatD)}</td><td>${formatUtils.formatPercent(tC)}</td><td>${formatUtils.formatCurrency(tUtils.formatNumber(t.don)}</td><td>${formatUtils.formatCurrency(t.chot)}</td><td>T)}</td></tr>`;document.getElementById('summary-body-cost').innerHTML=bH;document.getElementById('${formatUtils.formatPercent(tR)}</td><td>${formatUtils.formatCurrency(tP)}</td><td>${formatUtils.summary-foot-cost').innerHTML=fH;},
            renderKpiSummary: function(d){const sM={};d.forEach(r=>{const m=r.ten;if(!sM[m])sMformatCurrency(tD)}</td><td>${formatUtils.formatPercent(tC)}</td><td>${formatUtils.[m]={cpqc:0,dsChot:0,dsDi:0,dsSauShip:0,dsThformatCurrency(tT)}</td></tr>`;document.getElementById('summary-body-cost').innerHTML=bH;document.getElementById('summary-foot-cost').innerHTML=fH;},
            renderKpiSummary: functionanhCong:0,kpiValue:r.kpis,team:r.team};sM[m].cp(d){const sM={};d.forEach(r=>{const m=r.ten;if(!sqc+=r.cpqc;sM[m].dsChot+=r.dsChot;sM[m].dsDi+=r.doanhSo;sM[m].dsSauShip+=r.doM[m])sM[m]={cpqc:0,dsChot:0,dsDi:0,dsanhSoSauShip;sM[m].dsThanhCong+=r.doanhsoTC;});constSauShip:0,dsThanhCong:0,kpiValue:r.kpis,team:r. sK=Object.keys(sM).sort((a,b)=>sM[b].dsChotteam};sM[m].cpqc+=r.cpqc;sM[m].dsChot+=-sM[a].dsChot);let t={cpqc:0,dsChot:0,dsDi:r.dsChot;sM[m].dsDi+=r.doanhSo;sM[m0,dsSauShip:0,dsThanhCong:0,kpis:0};let bH=s].dsSauShip+=r.doanhSoSauShip;sM[m].dsThanhCong+=rK.map((m,i)=>{const s=sM[m];t.cpqc+=s.cpqc;t.doanhsoTC;});const sK=Object.keys(sM).sort((a,b)=>.dsChot+=s.dsChot;t.dsDi+=s.dsDi;t.dsSauShip+=sM[b].dsChot-sM[a].dsChot);let t={cpqc:0,dsChot:0,dsDi:0,dsSauShip:0,dsThanhCong:0s.dsSauShip;t.dsThanhCong+=s.dsThanhCong;t.kpis+=s.kpiValue;const c=s.dsSauShip?s.cpqc/s.dsSauShip:0,kpis:0};let bH=sK.map((m,i)=>{const s=sM[m];,k=s.kpiValue?s.dsSauShip/s.kpiValue:0;lett.cpqc+=s.cpqc;t.dsChot+=s.dsChot;t.ds R=i===0?'top-1':(i===1?'top-2':(i===2?'Di+=s.dsDi;t.dsSauShip+=s.dsSauShip;t.dsThanhtop-3':''));return `<tr class="${R}"><td class="text-center">${i+1}</td><Cong+=s.dsThanhCong;t.kpis+=s.kpiValue;const c=s.td class="text-left">${s.team}</td><td class="text-left">${m}</td><td>${formatdsSauShip?s.cpqc/s.dsSauShip:0,k=s.kpiValue?sUtils.formatCurrency(s.cpqc)}</td><td>${formatUtils.formatCurrency(s.dsChot.dsSauShip/s.kpiValue:0;let R=i===0?'top-1':()}</td><td>${formatUtils.formatCurrency(s.dsDi)}</td><td>${formatUtils.formatCurrency(s.dsi===1?'top-2':(i===2?'top-3':''));return `<tr class="${RSauShip)}</td><td>${formatUtils.formatCurrency(s.dsThanhCong)}</td><td>${formatUtils.formatPercent(c)}</td><td>${formatUtils.formatPercent(k)}</td></tr>`;}).join('');const}"><td class="text-center">${i+1}</td><td class="text-left">${s.team} tC=t.dsSauShip?t.cpqc/t.dsSauShip:0;const tK</td><td class="text-left">${m}</td><td>${formatUtils.formatCurrency(s.cpqc)}=t.kpis?t.dsSauShip/t.kpis:0;const fH=`<tr class="</td><td>${formatUtils.formatCurrency(s.dsChot)}</td><td>${formatUtils.formatCurrency(total-row"><td class="total-label" colspan="3">T·ªîNG C·ªòNG</td><td>${s.dsDi)}</td><td>${formatUtils.formatCurrency(s.dsSauShip)}</td><td>${formatformatUtils.formatCurrency(t.cpqc)}</td><td>${formatUtils.formatCurrency(t.dsChot)}</td><td>${formatUtils.formatCurrency(t.dsDi)}</td><td>${formatUtils.formatCurrency(t.dsSauShip)}</td><td>${formatUtils.formatCurrency(t.dsThanhCong)}</td><td>${formatUtils.formatPercent(tC)}</td><td>${formatUtils.formatPercent(tK)}</td></tr>`;document.getElementById('Utils.formatCurrency(s.dsThanhCong)}</td><td>${formatUtils.formatPercent(c)}</td><td>${formatUtils.formatPercent(k)}</td></tr>`;}).join('');const tC=t.dsSauShip?t.cpqc/t.dsSauShip:0;const tK=t.kpis?t.kpi-summary-body').innerHTML=bH;document.getElementById('kpi-summary-foot').innerHTML=fHdsSauShip/t.kpis:0;const fH=`<tr class="total-row"><td class="total-label" colspan="3">T·ªîNG C·ªòNG</td><td>${formatUtils.formatCurrency(t.cpqc)};},
            renderDailyBreakdownCost: function(d){const c=document.getElementById('daily-breakdown-cost');c.innerHTML='';const g={};d.forEach(r=>{const D=formatUtils.formatDate</td><td>${formatUtils.formatCurrency(t.dsChot)}</td><td>${formatUtils.formatCurrency(t.dsDi)}</td><td>${formatUtils.formatCurrency(t.dsSauShip)}</td><td>${formatUtils.formatCurrency(t.dsThanhCong)}</td><td>${formatUtils.formatPercent(tC)}</td><td>${formatUtils.formatPercent(tK)}</td></tr>`;document.getElementById('kpi-summary-body').innerHTML(r.ngay);(g[D]||(g[D]=[])).push(r);});Object=bH;document.getElementById('kpi-summary-foot').innerHTML=fH;},
            renderDailyBreakdownCost: function(d){const c=document.getElementById('daily-breakdown-cost');c..keys(g).sort((a,b)=>new Date(b.split('/').reverse().join('-'))-new Date(innerHTML='';const g={};d.forEach(r=>{const D=formatUtils.formatDate(r.nga.split('/').reverse().join('-'))).forEach(dt=>{let m=0,D=0,chay);(g[D]||(g[D]=[])).push(r);});Object.keys(g=0,pc=0;const sD=g[dt].sort((a,b)=>((a.ten||'').localeCompare(b.ten||''))||(b.dsChot-a.dsChot).sort((a,b)=>new Date(b.split('/').reverse().join('-'))-new Date(a.split('/').));const rH=sD.map(r=>{m+=r.soMessCmt;D+=r.reverse().join('-'))).forEach(dt=>{let m=0,D=0,ch=0,pcsoDon;ch+=r.dsChot;pc+=r.cpqc;return`<tr><td class="text=0;const sD=g[dt].sort((a,b)=>((a.ten||'').-center">${r.id}</td><td class="text-left">${r.ten}</td><td class="localeCompare(b.ten||''))||(b.dsChot-a.dsChot));consttext-left">${r.ca}</td><td class="text-left">${r.page}</td><td rH=sD.map(r=>{m+=r.soMessCmt;D+=r.soDon class="text-left">${r.sanPham}</td><td class="text-left">${r.thiTruong};ch+=r.dsChot;pc+=r.cpqc;return`<tr><td class="text</td><td>${formatUtils.formatNumber(r.soMessCmt)}</td><td>${formatUtils.formatNumber(r-center">${r.id}</td><td class="text-left">${r.ten}</td><td class.soDon)}</td><td>${formatUtils.formatCurrency(r.dsChot)}</td><td>${formatUtils.format="text-left">${r.ca}</td><td class="text-left">${r.page}</td><Currency(r.cpqc)}</td><td class="text-left">${r.team}</td></tr>`}).join('');consttd class="text-left">${r.sanPham}</td><td class="text-left">${r.thi fH=`<tr class='total-row'><td colspan='6' class='total-label'>T·ªïng</td><td>${Truong}</td><td>${formatUtils.formatNumber(r.soMessCmt)}</td><td>${formatUtils.formatUtils.formatNumber(m)}</td><td>${formatUtils.formatNumber(D)}</td><td>${formatUtils.formatformatNumber(r.soDon)}</td><td>${formatUtils.formatCurrency(r.dsChot)}</td><td>${Currency(ch)}</td><td>${formatUtils.formatCurrency(pc)}</td><td></td></tr>`;const tH=`<divformatUtils.formatCurrency(r.cpqc)}</td><td class="text-left">${r.team}</td></tr>`}).join('');const fH=`<tr class='total-row'><td colspan='6' class=' class="table-responsive-container"><table><thead><tr><th>ID</th><th>T√™n</th><th>Ca</th><th>Page</th><th>S·∫£n ph·∫©m</th><th>Th·ªã tr∆∞·ªùng</th><th>Mess</th><th>ƒê∆°n</th><th>DS Ch·ªët</th><th>CPQC</th><th>total-label'>T·ªïng</td><td>${formatUtils.formatNumber(m)}</td><td>${formatUtils.formatNumber(D)}</td><td>${formatUtils.formatCurrency(ch)}</td><td>${formatUtils.formatCurrency(pc)}</td><td></td>Team</th></tr></thead><tbody>${rH}</tbody><tfoot>${fH}</tfoot></table></div>`;c.innerHTML+=`<div class="daily</tr>`;const tH=`<div class="table-responsive-container"><table><thead><tr><th>ID</th><th>T-breakdown"><h3>Chi ti·∫øt ng√†y: ${dt}</h3>${tH}</div>`;});}
        };√™n</th><th>Ca</th><th>Page</th><th>S·∫£n ph·∫©m</th><th>Th·ªã tr∆∞·ªùng</th><th>Mess</th><th>ƒê∆°n</th><th>DS

        // ===================================================================
        // =========== MODULE CHO B√ÅO C√ÅO SALE (TAB 2) =======================
        // ===================================================================
        const saleReportApp = {
            is Ch·ªët</th><th>CPQC</th><th>Team</th></tr></thead><tbody>${rH}</tbody><tfoot>${fH}</tfoot></table></div>Initialized: false, rawData: [],
            init: function() { this.addEventListeners(); this.setDefaultDates`;c.innerHTML+=`<div class="daily-breakdown"><h3>Chi ti·∫øt ng√†y: ${dt}</h3>${(); this.fetchAndProcessData(); this.isInitialized = true; },
            addEventListeners: function() { document.getElementById('SaleReport').addEventListener('change', e => e.target.matches('input')&&this.handletH}</div>`;});}
        };

        // ===================================================================
        // =========== MODULEFilters(e.target)); document.getElementById('SaleReport').addEventListener('click', e => { const r=e CHO B√ÅO C√ÅO SALE (TAB 2) =======================
        // ===================================================================
        const saleReportApp = {
            isInitialized: false, rawData: [],
            init:.target.closest('tbody tr');if(!r||r.classList.contains('total-row'))return; function() { this.addEventListeners(); this.setDefaultDates(); this.fetchAndProcessData(); this.isInitialized =const s=r.classList.contains('row-selected');document.querySelectorAll('#SaleReport tbody tr.row- true; },
            addEventListeners: function() { document.getElementById('SaleReport').addEventListener('change', e =>selected').forEach(R=>R.classList.remove('row-selected'));if(!s)r.classList.add('row-selected');});},
            setDefaultDates: function() { const t=new Date(),s=new Date e.target.matches('input')&&this.handleFilters(e.target)); document.getElementById('SaleReport').addEventListener('click', e => { const r=e.target.closest('tbody tr');if(!r||r.classList(t.getFullYear(),t.getMonth(),1),e=new Date(t.getFullYear(),t.getMonth()+.contains('total-row'))return;const s=r.classList.contains('row-selected');document.querySelectorAll('#SaleReport tbody tr.row-selected').forEach(R=>R.classList.remove('row-selected'));if1,0),f=d=>d.toISOString().split('T')[0];document.getElementById('start-date-sale').value=f(s);document.getElementById('end-date-sale').value=f(e);},(!s)r.classList.add('row-selected');});},
            setDefaultDates: function() { const
            fetchAndProcessData: function() { showLoader(); fetch('https://script.google.com/macros/s t=new Date(),s=new Date(t.getFullYear(),t.getMonth(),1),e=new Date(t.getFullYear(),t.getMonth()+1,0),f=d=>d.toISOString().split('T')[0];document.getElementById('start-date-sale').value=f(s);document.getElementById('end/AKfycbzd8KdWC7PVuv7ttnQLV7oIxmAgWWdLfs-date-sale').value=f(e);},
            fetchAndProcessData: function() { showLoader(); fetch('https://script.google.com/macros/s/AKfycbzd8KdWC7PVuv73laMDoL7w5GhvCWd_71_Xc33e-GaUSiG_3/exec').then(res=>res.json()).then(rS=>{this.rawData=rS.filterttnQLV7oIxmAgWWdLfs3laMDoL7w5GhvCWd(r=>r.trangThai&&String(r.trangThai).trim()!==''&&r.ten&&_71_Xc33e-GaUSiG_3/exec').then(res=>res.json()).String(r.ten).trim()!==''&&r.team&&String(r.team).trim()then(rS=>{this.rawData=rS.filter(r=>r.trangThai&&String(r.tr!=='').map(r=>({...r,ten:(r.ten||'').trim(),team:(r.team||angThai).trim()!==''&&r.ten&&String(r.ten).trim()!==''&&r.'').trim(),soMessCmt:+r.soMess||0,soDon:+r.donMess||0,dsteam&&String(r.team).trim()!=='').map(r=>({...r,ten:(r.ten||Chot:+r.doanhSoMess||0,phanHoi:+r.phanHoi||0}));this.populateAllFilters(this.rawData);this.applyFilters();}).catch(err=>{console.error("L'').trim(),team:(r.team||'').trim(),soMessCmt:+r.soMess||0,so·ªói Sale Data:",err);alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu Sale.');}).finally(hideLoader);},
            Don:+r.donMess||0,dsChot:+r.doanhSoMess||0,phanHoi:+r.phanHoi||0}));this.populateAllFilters(this.rawData);this.applyFilters();populateAllFilters: function(d){const p=(k,c,n)=>{const C=document.getElementById(c}).catch(err=>{console.error("L·ªói Sale Data:",err);alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu Sale),u=[...new Set(d.map(r=>r[k]).filter(v=>v!=null&&v.');}).finally(hideLoader);},
            populateAllFilters: function(d){const p=(k,c,n!==''))].sort();C.innerHTML=u.map(v=>`<label><input type='checkbox' class=')=>{const C=document.getElementById(c),u=[...new Set(d.map(r=>r[k]).${n}' value='${v}' checked> ${v}</label>`).join('');};p('sanPham','product-options-sale','filter-product-sale');p('thiTruong','market-options-sale','filter-filter(v=>v!=null&&v!==''))].sort();C.innerHTML=u.map(vmarket-sale');p('ca','ca-options-sale','filter-ca-sale');p('team','=>`<label><input type='checkbox' class='${n}' value='${v}' checked> ${v}</label>team-options-sale','filter-team-sale');},
            getFilteredData: function(){const sV=document.getElementById('start-date-sale').value,eV=document.getElementById('end-date-sale`).join('');};p('sanPham','product-options-sale','filter-product-sale');p('thiTruong','market-options-sale','filter-market-sale');p('ca','ca-options-sale','filter-').value,s=sV?new Date(sV+'T00:00:00'):ca-sale');p('team','team-options-sale','filter-team-sale');},
            getnull,e=eV?new Date(eV+'T23:59:59'):null;constFilteredData: function(){const sV=document.getElementById('start-date-sale').value,eV=document. g=(m,c)=>document.getElementById(m).checked?null:[...document.querySelectorAll(`.${c}:getElementById('end-date-sale').value,s=sV?new Date(sV+'T00:00checked`)].map(b=>b.value);const sP=g('product-all-sale','filter-product:00'):null,e=eV?new Date(eV+'T23:59:59'):-sale'),sM=g('market-all-sale','filter-market-sale'),sC=g('ca-null;const g=(m,c)=>document.getElementById(m).checked?null:[...document.querySelectorAll(`all-sale','filter-ca-sale'),sT=g('team-all-sale','filter-team-sale');return this.rawData.filter(r=>{const d=new Date(r.ngay);return.${c}:checked`)].map(b=>b.value);const sP=g('product-all-sale','filter-product-sale'),sM=g('market-all-sale','filter-market-sale'),s((!s||d>=s)&&(!e||d<=e))&&(!sP||sP.includes(r.C=g('ca-all-sale','filter-ca-sale'),sT=g('team-allsanPham))&&(!sM||sM.includes(r.thiTruong))&&(!sC||sC-sale','filter-team-sale');return this.rawData.filter(r=>{const d=new Date(r..includes(String(r.ca)))&&(!sT||sT.includes(String(r.teamngay);return((!s||d>=s)&&(!e||d<=e))&&(!sP||s)));});},
            handleFilters: function(t){showLoader();setTimeout(()=>{handleCheckbox('product-all-saleP.includes(r.sanPham))&&(!sM||sM.includes(r.thiTruong','filter-product-sale',t);handleCheckbox('ca-all-sale','filter-ca-sale',t);handle))&&(!sC||sC.includes(String(r.ca)))&&(!sT||sT.Checkbox('team-all-sale','filter-team-sale',t);handleCheckbox('market-all-saleincludes(String(r.team)));});},
            handleFilters: function(t){showLoader();setTimeout(()=>{','filter-market-sale',t);this.applyFilters();hideLoader();},10);},
            applyFilters:handleCheckbox('product-all-sale','filter-product-sale',t);handleCheckbox('ca-all-sale','filter function(){const f=this.getFilteredData();this.renderSummarySale(f);this.renderDailyBreak-ca-sale',t);handleCheckbox('team-all-sale','filter-team-sale',t);downSale(f);},
            renderSummarySale: function(d){const sD={};d.forEach(rhandleCheckbox('market-all-sale','filter-market-sale',t);this.applyFilters();hideLoader();},1=>{const n=r.ten;if(!sD[n])sD[n]={team:r.team,0);},
            applyFilters: function(){const f=this.getFilteredData();this.renderSummarySalemess:0,don:0,chot:0,phanHoi:0};sD[n].mess+=r(f);this.renderDailyBreakdownSale(f);},
            renderSummarySale: function(d){const s.soMessCmt;sD[n].don+=r.soDon;sD[n].chot+=D={};d.forEach(r=>{const n=r.ten;if(!sD[n])sD[nr.dsChot;sD[n].phanHoi+=r.phanHoi;});const fL=Object]={team:r.team,mess:0,don:0,chot:0,phanHoi:.keys(sD).map(n=>({name:n,team:sD[n].team,data:s0};sD[n].mess+=r.soMessCmt;sD[n].don+=r.soDon;sD[n].chot+=r.dsChot;sD[n].phanHoiD[n]})).sort((a,b)=>b.data.chot-a.data.chot+=r.phanHoi;});const fL=Object.keys(sD).map(n=>({||a.name.localeCompare(b.name));let bH=fL.map((i,x)=>{name:n,team:sD[n].team,data:sD[n]})).sort((aconst s=i.data;const r=s.mess?s.don/s.mess:0;let R=x===0?'top-1':(x===1?'top-2':(x===2,b)=>b.data.chot-a.data.chot||a.name.localeCompare(?'top-3':''));return `<tr class="${R}"><td class="text-center">${x+1b.name));let bH=fL.map((i,x)=>{const s=i.data;const}</td><td class="text-left">${i.team}</td><td class="text-left">${i.name} r=s.mess?s.don/s.mess:0;let R=x===0?'top-1':(x===1?'top-2':(x===2?'top-3':''));return `<</td><td>${formatUtils.formatNumber(s.mess)}</td><td>${formatUtils.formatNumber(s.don)}</td><td>${formatUtils.formatNumber(s.phanHoi)}</td><td>${formatUtils.formatCurrency(str class="${R}"><td class="text-center">${x+1}</td><td class="text-left">${i.chot)}</td><td class="${r>=0.1?'bg-green':(r>0.0.team}</td><td class="text-left">${i.name}</td><td>${formatUtils.formatNumber(s.mess)}</td><td>${formatUtils.formatNumber(s.don)}</td><td>${formatUtils.formatNumber(5?'bg-yellow':'')}">${formatUtils.formatPercent(r)}</td></tr>`;}).join('');const t=s.phanHoi)}</td><td>${formatUtils.formatCurrency(s.chot)}</td><td class="${rfL.reduce((a,i)=>({mess:a.mess+i.data.mess,don:a.>=0.1?'bg-green':(r>0.05?'bg-yellow':'')}">${formatUtils.formatdon+i.data.don,chot:a.chot+i.data.chot,phanHoi:a.phanHoi+i.data.phanHoi}),{mess:0,don:0,Percent(r)}</td></tr>`;}).join('');const t=fL.reduce((a,i)=>({messchot:0,phanHoi:0});const tR=t.mess?t.don/t:a.mess+i.data.mess,don:a.don+i.data.don,chot:a.mess:0;const fH=`<tr class="total-row"><td class="total-label" colspan.chot+i.data.chot,phanHoi:a.phanHoi+i.data="3">T·ªîNG C·ªòNG</td><td>${formatUtils.formatNumber(t.mess)}</td><td>.phanHoi}),{mess:0,don:0,chot:0,phanHoi:0});const${formatUtils.formatNumber(t.don)}</td><td>${formatUtils.formatNumber(t.phanH tR=t.mess?t.don/t.mess:0;const fH=`<tr class="total-oi)}</td><td>${formatUtils.formatCurrency(t.chot)}</td><td>${formatUtils.formatPercentrow"><td class="total-label" colspan="3">T·ªîNG C·ªòNG</td><td>${formatUtils.formatNumber(t.mess)}</td><td>${formatUtils.formatNumber(t.don)}</td><td>${formatUtils.formatNumber(t.phanHoi)}</td><td>${formatUtils.formatCurrency(t.ch(tR)}</td></tr>`;document.getElementById('summary-body-sale').innerHTML=bH;document.getElementById('summary-foot-sale').innerHTML=fH;},
            renderDailyBreakdownSale: function(d){constot)}</td><td>${formatUtils.formatPercent(tR)}</td></tr>`;document.getElementById('summary-body-sale').innerHTML=bH;document.getElementById('summary-foot-sale').innerHTML=fH;},
 c=document.getElementById('daily-breakdown-sale');c.innerHTML='';if(d.length===0)            renderDailyBreakdownSale: function(d){const c=document.getElementById('daily-breakdown-salereturn;const g={};d.forEach(r=>{const D=formatUtils.formatDate(r.ngay);(g[D]=g[D]||[]).push(r);});const sD=Object.keys(g).sort((a,b)=>new Date(b.split('/').reverse().join('-'))-new Date(a');c.innerHTML='';if(d.length===0)return;const g={};d.forEach(r=>{const D=formatUtils.formatDate(r.ngay);(g[D]=g[D].split('/').reverse().join('-')));sD.forEach(dt=>{let t={mess:0,don:0,ch||[]).push(r);});const sD=Object.keys(g).sort((a,b)=>newot:0,phanHoi:0};const SD=g[dt].sort((a,b)=>a.ten. Date(b.split('/').reverse().join('-'))-new Date(a.split('/').reverse().join('-')));localeCompare(b.ten)||(b.dsChot-a.dsChot));const rH=SDsD.forEach(dt=>{let t={mess:0,don:0,chot:0,phanHoi:.map(r=>{t.mess+=r.soMessCmt;t.don+=r.soDon;t0};const SD=g[dt].sort((a,b)=>a.ten.localeCompare(b.ten)||(.chot+=r.dsChot;t.phanHoi+=r.phanHoi;return`<tr><tdb.dsChot-a.dsChot));const rH=SD.map(r=>{t.mess+=r class="text-left">${r.ten}</td><td class="text-left">${r.ca}</td>.soMessCmt;t.don+=r.soDon;t.chot+=r.dsCh<td class="text-left">${r.sanPham}</td><td class="text-left">${r.ot;t.phanHoi+=r.phanHoi;return`<tr><td class="text-left">${r.thiTruong}</td><td>${formatUtils.formatNumber(r.soMessCmt)}</td><td>${formatUtils.formatNumber(r.soDon)}</td><td>${formatUtils.formatNumber(r.phanHoiten}</td><td class="text-left">${r.ca}</td><td class="text-left">${r.sanPham}</td><td class="text-left">${r.thiTruong}</td><td>${format)}</td><td>${formatUtils.formatCurrency(r.dsChot)}</td><td class="text-left">${rUtils.formatNumber(r.soMessCmt)}</td><td>${formatUtils.formatNumber(r.so.team}</td></tr>`}).join('');const fH=`<tr class='total-row'><td colspan='4Don)}</td><td>${formatUtils.formatNumber(r.phanHoi)}</td><td>${formatUtils.formatCurrency(r' class='total-label'>T·ªïng</td><td>${formatUtils.formatNumber(t.mess)}</td><td>${formatUtils.dsChot)}</td><td class="text-left">${r.team}</td></tr>`}).join('');.formatNumber(t.don)}</td><td>${formatUtils.formatNumber(t.phanHoi)}</td>const fH=`<tr class='total-row'><td colspan='4' class='total-label'>T·ªïng<td>${formatUtils.formatCurrency(t.chot)}</td><td></td></tr>`;const tH=`<div class="</td><td>${formatUtils.formatNumber(t.mess)}</td><td>${formatUtils.formatNumber(t.don)}table-responsive-container"><table><thead><tr><th>T√™n</th><th>Ca</th><th>S·∫£n ph·∫©m</th><th>Th·ªã tr∆∞·ªùng</th><th></td><td>${formatUtils.formatNumber(t.phanHoi)}</td><td>${formatUtils.formatCurrency(Mess</th><th>ƒê∆°n</th><th>Ph·∫£n h·ªìi</th><th>DS Ch·ªët</th><th>Team</th></tr></thead><tbody>${rHt.chot)}</td><td></td></tr>`;const tH=`<div class="table-responsive-container"><table><thead>}</tbody><tfoot>${fH}</tfoot></table></div>`;c.innerHTML+=`<div class="daily-breakdown"><tr><th>T√™n</th><th>Ca</th><th>S·∫£n ph·∫©m</th><th>Th·ªã tr∆∞·ªùng</th><th>Mess</th><th>ƒê∆°n</th><th>Ph<h3>Chi ti·∫øt ng√†y: ${dt}</h3>${tH}</div>`;});}
        };
        
        //·∫£n h·ªìi</th><th>DS Ch·ªët</th><th>Team</th></tr></thead><tbody>${rH}</tbody><tfoot>${fH}</tfoot> ===================================================================
        // =========== MODULE CHO B√ÅO C√ÅO BI·ªÇU ƒê·ªí (TAB 3</table></div>`;c.innerHTML+=`<div class="daily-breakdown"><h3>Chi ti·∫øt ng√†y: ${dt}) ===================
        // ===================================================================
        const chartReportApp = {
            isInitialized: false, rawData: [], charts: {}, groupChildren: { 'Ch√¢u √Å': ['H√†n Qu·ªëc</h3>${tH}</div>`;});}
        };
        
        // ===================================================================
','Nh·∫≠t B·∫£n','VN'], 'Ngo√†i Ch√¢u √Å': ['√öc','US', 'Canada'] },
                    // =========== MODULE CHO B√ÅO C√ÅO BI·ªÇU ƒê·ªí (TAB 3) ===================
        // ===================================================================
        const chartReportApp = {
            isInitialized: false, rawinit: function() { this.addEventListeners(); this.setDefaultDates(); this.fetchData(); this.isInitializedData: [], charts: {}, groupChildren: { 'Ch√¢u √Å': ['H√†n Qu·ªëc','Nh·∫≠t B·∫£n','VN'], ' = true; },
            addEventListeners: function() { document.getElementById('ChartReport').addEventListener('change', eNgo√†i Ch√¢u √Å': ['√öc','US', 'Canada'] },
            init: function() { this.add => e.target.matches('input')&&this.handleFilters(e.target)); },
            setDefaultDates: function()EventListeners(); this.setDefaultDates(); this.fetchData(); this.isInitialized = true; },
            addEventListeners { const t=new Date(),s=new Date(t.getFullYear(),t.getMonth(),1),e=: function() { document.getElementById('ChartReport').addEventListener('change', e => e.target.matches('inputnew Date(t.getFullYear(),t.getMonth()+1,0),f=d=>d.toISOString().split')&&this.handleFilters(e.target)); },
            setDefaultDates: function() { const t=new Date(),s('T')[0];document.getElementById('start-date-tab3').value=f(s);document.=new Date(t.getFullYear(),t.getMonth(),1),e=new Date(t.getFullYear(),tgetElementById('end-date-tab3').value=f(e);},
            fetchData: function() {
                show.getMonth()+1,0),f=d=>d.toISOString().split('T')[0];document.getElementById('start-date-tab3').value=f(s);document.getElementById('end-date-tab3Loader();
                fetch('https://script.google.com/macros/s/AKfycbwGwSBxeXplEzAM-jJDPaXPkiWjNyKmpR70o6nCY').value=f(e);},
            fetchData: function() {
                showLoader();
                fetch('https://5_ynqoF-3WA1gvF91RIQQfDZ9fvAQ/exec')
script.google.com/macros/s/AKfycbwGwSBxeXplEzAM-jJDPaXP                    .then(res => res.json()).then(data => {
                        this.rawData = data.map(kiWjNyKmpR70o6nCY5_ynqoF-3WA1gvFr => ({...r, dsChot:+r.dsChot||0, cpqc:+r.cpqc||091RIQQfDZ9fvAQ/exec')
                    .then(res => res.json()).then, soDon:+r.soDon||0, soMessCmt:+r.soMessCmt||0}));
(data => {
                        this.rawData = data.map(r => ({...r, dsChot:+r.dsChot||0, cpqc:+r.cpqc||0, soDon:+r.soDon||0                        this.populateAllFilters(this.rawData);
                        this.initAllCharts(); this.applyFilters();
                    }).catch(err => { console.error("L·ªói Chart Data:", err); alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu, soMessCmt:+r.soMessCmt||0}));
                        this.populateAllFilters(this.rawData);
                        this.initAllCharts(); this.applyFilters();
                    }).catch(err => { console.error("L·ªói Chart Data:", err); alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu bi·ªÉu ƒë·ªì.'); }).finally(hideLoader);
            },
            populateAllFilters: function(data){const pS=new Set(),mS=new Set();data.forEach(r=>{if(r.sanPham)pS.add(r.sanPham);if(r.thiTruong)mS.add(r.thiTruong);});document.getElementById('product-options-tab3').innerHTML=Array.from(pS).sort().map(p=>`<label class='indent'><input type='checkbox' class='filter-product-tab3' value='${p}' checked> ${p}</label>`).join('');const mH=Object.keys(this.groupChildren).map(g=>`<label><input type='checkbox' class='filter-market-tab3' value='${g}' checked> ${g}</label>`+this.groupChildren[g].map(c=>`<label class='indent'><input type='checkbox' class='filter-market-tab3' value='${c}' checked> ${c}</label> bi·ªÉu ƒë·ªì.'); }).finally(hideLoader);
            },
            populateAllFilters: function(data){const pS=new Set(),mS=new Set();data.forEach(r=>{if(r.sanPham)pS.add(r.sanPham);if(r.thiTruong)mS.add(r.thiTruong);});document.getElementById('product-options-tab3').innerHTML=Array.from(pS).sort().map(p=>`<label class='indent'><input type='checkbox' class='filter-product-tab3' value='${p}' checked> ${p}</label>`).join('');const mH=Object.keys(this.groupChildren).map(g=>`<label><input type='checkbox' class='filter-market-tab3' value='${g}' checked> ${g}</label>`+this.groupChildren[g].map(c=>`<label class='indent'><input type='checkbox' class='filter-market-tab3' value='${c}' checked> ${c}</label>`).join('')).join('');const oM=Array.from(mS).filter(m=>!Object.values(this.groupChildren).flat().map(c=>(c||`).join('')).join('');const oM=Array.from(mS).filter(m=>!Object.'').toLowerCase()).includes((m||'').toLowerCase())).sort().map(m=>`<label><input type='checkbox' classvalues(this.groupChildren).flat().map(c=>(c||'').toLowerCase()).includes((m||='filter-market-tab3' value='${m}' checked> ${m}</label>`).join('');document.getElementById(''').toLowerCase())).sort().map(m=>`<label><input type='checkbox' class='filter-market-market-options-tab3').innerHTML=mH+oM;},
            getFilteredData: function(){const sV=document.getElementById('start-date-tab3').value,eV=document.getElementById('end-datetab3' value='${m}' checked> ${m}</label>`).join('');document.getElementById('market-options-tab3').innerHTML=mH+oM;},
            getFilteredData: function(){const sV=document.getElementById-tab3').value,pA=document.getElementById('product-all-tab3').checked,sP=pA?null:[...document.querySelectorAll(`.filter-product-tab3:checked`)].map(c=>c.('start-date-tab3').value,eV=document.getElementById('end-date-tab3').valuevalue),mA=document.getElementById('market-all-tab3').checked,sM=mA?null:[...document.,pA=document.getElementById('product-all-tab3').checked,sP=pA?null:[querySelectorAll(`.filter-market-tab3:checked`)].map(c=>c.value);return this.rawData...document.querySelectorAll(`.filter-product-tab3:checked`)].map(c=>c.value),mA.filter(r=>{if(!r.ngay)return false;const d=new Date(r.ng=document.getElementById('market-all-tab3').checked,sM=mA?null:[...document.ay);if(isNaN(d.getTime()))return false;const dS=`${d.getFullYear()}-${StringquerySelectorAll(`.filter-market-tab3:checked`)].map(c=>c.value);return this.rawData(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;const dO=(!sV||dS>=sV)&&(!eV||dS<=eV);const p.filter(r=>{if(!r.ngay)return false;const d=new Date(r.ngO=!sP||sP.includes(r.sanPham);const mG=costReportApp.getay);if(isNaN(d.getTime()))return false;const dS=`${d.getFullYear()}-${String(d.Group((r.thiTruong||'').trim().toLowerCase());const mO=!sM||sM.includes(mgetMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;G)||sM.includes(r.thiTruong);return dO&&pO&&mO;});},
            handleconst dO=(!sV||dS>=sV)&&(!eV||dS<=eV);const pO=!sPFilters: function(t){showLoader();setTimeout(()=>{if(t.id==='toggle-all-charts'||||sP.includes(r.sanPham);const mG=costReportApp.getGroup((r.t.classList.contains('chart-toggle')){if(t.id==='toggle-all-charts')document.querySelectorAll('.thiTruong||'').trim().toLowerCase());const mO=!sM||sM.includes(mG)||sMchart-toggle').forEach(c=>c.checked=t.checked);else document.getElementById('toggle-all-charts.includes(r.thiTruong);return dO&&pO&&mO;});},
            handleFilters: function(').checked=[...document.querySelectorAll('.chart-toggle')].every(c=>c.checked);this.togglet){showLoader();setTimeout(()=>{if(t.id==='toggle-all-charts'||t.classList.ChartVisibility();hideLoader();return;}handleCheckbox('product-all-tab3','filter-product-tab3contains('chart-toggle')){if(t.id==='toggle-all-charts')document.querySelectorAll('.chart-toggle').',t);handleCheckbox('market-all-tab3','filter-market-tab3',t);this.applyforEach(c=>c.checked=t.checked);else document.getElementById('toggle-all-charts').checked=[Filters();hideLoader();},10);},
            applyFilters: function(){if(!this.rawData.length)return;...document.querySelectorAll('.chart-toggle')].every(c=>c.checked);this.toggleChartVisibility();hideLoader();const f=this.getFilteredData();this.renderDailyTable(f);this.renderAllDailyCharts(f);},return;}handleCheckbox('product-all-tab3','filter-product-tab3',t);handleCheckbox('market-all
            renderDailyTable: function(d){const D={};d.forEach(r=>{const k=formatUtils.-tab3','filter-market-tab3',t);this.applyFilters();hideLoader();},10formatDate(r.ngay);if(!D[k])D[k]={cpqc:0,don:0,);},
            applyFilters: function(){if(!this.rawData.length)return;const f=this.mess:0,chot:0};D[k].cpqc+=r.cpqc;D[k].getFilteredData();this.renderDailyTable(f);this.renderAllDailyCharts(f);},
            renderDailydon+=r.soDon;D[k].mess+=r.soMessCmt;D[k].Table: function(d){const D={};d.forEach(r=>{const k=formatUtils.formatDate(rchot+=r.dsChot;});let bH=Object.keys(D).sort((a,b)=>new.ngay);if(!D[k])D[k]={cpqc:0,don:0,mess:0, Date(a.split('/').reverse().join('-'))-new Date(b.split('/').reverse().join('-'))).mapchot:0};D[k].cpqc+=r.cpqc;D[k].don+=r.so(d=>{const y=D[d];const a=y.mess?y.don/y.mess:0Don;D[k].mess+=r.soMessCmt;D[k].chot+=r.dsChot;});let bH=Object.keys(D).sort((a,b)=>new Date(a.split('/').reverse,g=y.mess?y.cpqc/y.mess:0,c=y.don?y.cpqc/y.don:0,p=y.chot?y.cpqc/y.chot:().join('-'))-new Date(b.split('/').reverse().join('-'))).map(d=>{const y0;return`<tr><td class="text-left"><b>${d}</b></td><td>${formatUtils.=D[d];const a=y.mess?y.don/y.mess:0,g=yformatPriceShort(y.cpqc)}</td><td>${formatUtils.formatPriceShort(y.chot)}.mess?y.cpqc/y.mess:0,c=y.don?y.cpqc/</td><td>${formatUtils.formatPercent(a)}</td><td>${formatUtils.formatPriceShort(g)}</td><td>${y.don:0,p=y.chot?y.cpqc/y.chot:0formatUtils.formatPriceShort(c)}</td><td>${formatUtils.formatPercent(p)}</td></tr>`;}).join('');document;return`<tr><td class="text-left"><b>${d}</b></td><td>${formatUtils.formatPriceShort.getElementById('date-summary-body').innerHTML=bH;},
            toggleChartVisibility: function(){document.querySelectorAll('.(y.cpqc)}</td><td>${formatUtils.formatPriceShort(y.chot)}</td><td>${formatUtils.chart-toggle').forEach(c=>{const n=c.dataset.chart,w=document.querySelector(`#ChartReport .formatPercent(a)}</td><td>${formatUtils.formatPriceShort(g)}</td><td>${formatUtils.formatchart-wrapper[data-chart="${n}"]`);if(w){w.style.display=c.checked?'blockPriceShort(c)}</td><td>${formatUtils.formatPercent(p)}</td></tr>`;}).join('');document.getElementById('date-summary-body').innerHTML=bH;},
            toggleChartVisibility: function(){document.querySelectorAll('.chart-toggle').':'none';}});},
            initAllCharts: function(){const c=(i,C)=>new Chart(document.getElementById(forEach(c=>{const n=c.dataset.chart,w=document.querySelector(`#ChartReport .chart-wrapper[i).getContext('2d'),C);this.charts.cpqcChart=c('cpqcChart',this.getLinedata-chart="${n}"]`);if(w){w.style.display=c.checked?'block':'none';ChartConfig('CPQC (VND)'));this.charts.dsChotChart=c('dsChotChart',}});},
            initAllCharts: function(){const c=(i,C)=>new Chart(document.getElementById(this.getLineChartConfig('DS Ch·ªët (VND)'));this.charts.rateChart=c('i).getContext('2d'),C);this.charts.cpqcChart=c('cpqcChart',this.getLinerateChart',this.getLineChartConfig('T·ªâ l·ªá ch·ªët (%)',formatUtils.formatPercent));this.charts.messChart=c('messChart',this.getLineChartConfig('Gi√° Mess (VND)'));this.charts.ChartConfig('CPQC (VND)'));this.charts.dsChotChart=c('dsChotChart',cpsChart=c('cpsChart',this.getLineChartConfig('CPS (VND)'));this.chartsthis.getLineChartConfig('DS Ch·ªët (VND)'));this.charts.rateChart=c('.cpDsRatioChart=c('cpDsRatioChart',this.getLineChartConfig('%CP/DS',rateChart',this.getLineChartConfig('T·ªâ l·ªá ch·ªët (%)',formatUtils.formatPercent));this.chartsformatUtils.formatPercent));this.charts.productSalesChart=c('productSalesChart',this.getBarChartConfig());.messChart=c('messChart',this.getLineChartConfig('Gi√° Mess (VND)'));this.charts.this.charts.marketSalesChart=c('marketSalesChart',this.getBarChartConfig());this.togglecpsChart=c('cpsChart',this.getLineChartConfig('CPS (VND)'));this.chartsChartVisibility();},
            renderAllDailyCharts: function(d){if(!Object.keys(this.charts)..cpDsRatioChart=c('cpDsRatioChart',this.getLineChartConfig('%CP/DS',length)return;const D={};d.forEach(r=>{const k=formatUtils.formatDate(r.ngformatUtils.formatPercent));this.charts.productSalesChart=c('productSalesChart',this.getBarChartConfig());this.charts.marketSalesChart=c('marketSalesChart',this.getBarChartConfig());this.toggleay);if(!D[k])D[k]={cpqc:0,don:0,mess:0ChartVisibility();},
            renderAllDailyCharts: function(d){if(!Object.keys(this.charts).,chot:0};D[k].cpqc+=r.cpqc;D[k].don+=length)return;const D={};d.forEach(r=>{const k=formatUtils.formatDate(r.ngr.soDon;D[k].mess+=r.soMessCmt;D[k].chot+=r.dsChot;});const l=Object.keys(D).sort((a,b)=>neway);if(!D[k])D[k]={cpqc:0,don:0,mess:0,chot:0};D[k].cpqc+=r.cpqc;D[k].don+=r. Date(a.split('/').reverse().join('-'))-new Date(b.split('/').reverse().join('-')));soDon;D[k].mess+=r.soMessCmt;D[k].chot+=r.dsChot;});const l=Object.keys(D).sort((a,b)=>new Date(a.const C=()=>({cpqc:{b:'#3F51B5',f:'rgba(63,8split('/').reverse().join('-'))-new Date(b.split('/').reverse().join('-')));const C=()1,181,0.2)'},dsChot:{b:'var(--primary-color)',f=>({cpqc:{b:'#3F51B5',f:'rgba(63,81,:'rgba(45,124,45,0.2)'},rate:{b:'#F44181,0.2)'},dsChot:{b:'var(--primary-color)',f:'rgba(4336',f:'rgba(244,67,54,0.2)'},mess:{b:'#FF9800',f:'rgba(255,152,0,0.25,124,45,0.2)'},rate:{b:'#F44336',f:'rgba(244,67,54,0.2)'},mess:{b:'#)'},cps:{b:'#009688',f:'rgba(0,150,136,0.2)'},cpDsRatio:{b:'#9C27B0',f:'rgba(FF9800',f:'rgba(255,152,0,0.2)'},cps156,39,176,0.2)'},product:{b:'#607D8:{b:'#009688',f:'rgba(0,150,136,0B'},market:{b:'#795548'}});this.updateChart(this.charts.cp.2)'},cpDsRatio:{b:'#9C27B0',f:'rgba(156,39,176,0.2)'},product:{b:'#607D8B'},marketqcChart,'CPQC',l,l.map(d=>D[d].cpqc),C().cpqc);this.updateChart(this.charts.dsChotChart,'DS Ch·ªët',l,l.map(d=>:{b:'#795548'}});this.updateChart(this.charts.cpqcChart,'D[d].chot),C().dsChot);this.updateChart(this.charts.rateChart,'TCPQC',l,l.map(d=>D[d].cpqc),C().cpqc);this·ªâ l·ªá ch·ªët',l,l.map(d=>D[d].mess?D[d].don.updateChart(this.charts.dsChotChart,'DS Ch·ªët',l,l.map(d=>/D[d].mess:0),C().rate);this.updateChart(this.charts.messChart,'D[d].chot),C().dsChot);this.updateChart(this.charts.rateChart,'TGi√° Mess',l,l.map(d=>D[d].mess?D[d].cpqc/D·ªâ l·ªá ch·ªët',l,l.map(d=>D[d].mess?D[d].don[d].mess:0),C().mess);this.updateChart(this.charts.cpsChart,'CPS/D[d].mess:0),C().rate);this.updateChart(this.charts.messChart,'',l,l.map(d=>D[d].don?D[d].cpqc/D[Gi√° Mess',l,l.map(d=>D[d].mess?D[d].cpqc/Dd].don:0),C().cps);this.updateChart(this.charts.cpDsRatioChart,'[d].mess:0),C().mess);this.updateChart(this.charts.cpsChart,'CPS%CP/DS',l,l.map(d=>D[d].chot?D[d].cp',l,l.map(d=>D[d].don?D[d].cpqc/D[qc/D[d].chot:0),C().cpDsRatio);const pS={},mS={d].don:0),C().cps);this.updateChart(this.charts.cpDsRatioChart,'};d.forEach(r=>{if(r.sanPham)pS[r.sanPham]=(pS[r%CP/DS',l,l.map(d=>D[d].chot?D[d].cpqc.sanPham]||0)+r.dsChot;if(r.thiTruong)mS[r.thi/D[d].chot:0),C().cpDsRatio);const pS={},mS={};Truong]=(mS[r.thiTruong]||0)+r.dsChot;});const sPd.forEach(r=>{if(r.sanPham)pS[r.sanPham]=(pS[r=Object.entries(pS).sort((a,b)=>b[1]-a[1]),sM.sanPham]||0)+r.dsChot;if(r.thiTruong)mS[r.=Object.entries(mS).sort((a,b)=>b[1]-a[1]);this.updatethiTruong]=(mS[r.thiTruong]||0)+r.dsChot;});constChart(this.charts.productSalesChart,'DS theo SP',sP.map(p=>p[0]),s sP=Object.entries(pS).sort((a,b)=>b[1]-a[1]),sP.map(p=>p[1]),C().product,'bar');this.updateChart(this.charts.M=Object.entries(mS).sort((a,b)=>b[1]-a[1]);thismarketSalesChart,'DS theo TT',sM.map(m=>m[0]),sM.map(m=>m.updateChart(this.charts.productSalesChart,'DS theo SP',sP.map(p=>p[0]),[1]),C().market,'bar');},
            getLineChartConfig: function(y,f=formatUtils.formatsP.map(p=>p[1]),C().product,'bar');this.updateChart(this.charts.PriceShort){return{type:'line',options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{positionmarketSalesChart,'DS theo TT',sM.map(m=>m[0]),sM.map(m=>m[1]),C().market,'bar');},
            getLineChartConfig: function(y,f=formatUtils.format:'top'},tooltip:{callbacks:{label:c=>`${c.dataset.label}: ${f(c.raw)}`}},datalabels:{align:'top',anchor:'end',color:'#fff',font:{weight:'boldPriceShort){return{type:'line',options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position'},formatter:f,padding:6,offset:4,backgroundColor:c=>c.dataset.borderColor}},scales:'top'},tooltip:{callbacks:{label:c=>`${c.dataset.label}: ${f(c.raw:{y:{ticks:{callback:f}}}}};},
            getBarChartConfig: function(){return{type:'bar)}`}},datalabels:{align:'top',anchor:'end',color:'#fff',font:{weight:'bold'},',options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',plugins:{legend:{display:false},tooltipformatter:f,padding:6,offset:4,backgroundColor:c=>c.dataset.borderColor}},scales:{y:{callbacks:{label:c=>`${c.parsed.x.toLocaleString()} VND`}},datalabels:{anchor:{ticks:{callback:f}}}}};},
            getBarChartConfig: function(){return{type:'bar',options:{responsive:'end',align:'right',offset:8,color:'#333',font:{weight:'600'},:true,maintainAspectRatio:false,indexAxis:'y',plugins:{legend:{display:false},tooltip:{callbacks:{labelformatter:formatUtils.formatPriceShort}},scales:{x:{display:false},y:{grid:{display:false:c=>`${c.parsed.x.toLocaleString()} VND`}},datalabels:{anchor:'end',align}}}}};},
            updateChart: function(c,l,L,d,C,t='line'){c:'right',offset:8,color:'#333',font:{weight:'600'},formatter:format.data.labels=L;c.data.datasets=[this.createDataset(l,d,C,tUtils.formatPriceShort}},scales:{x:{display:false},y:{grid:{display:false}}}}};},
            )];c.update('none');},
            createDataset: function(l,d,c,t='lineupdateChart: function(c,l,L,d,C,t='line'){c.data.labels'){const i=t==='line';return{label:l,data:d,backgroundColor:i?c.f=L;c.data.datasets=[this.createDataset(l,d,C,t)];c.update(':c.b,borderColor:c.b,type:t,fill:i,tension:0.4,bordernone');},
            createDataset: function(l,d,c,t='line'){const i=t==Width:i?3:1,pointRadius:i?5:undefined,pointBackgroundColor:'#fff',pointBorderWidth='line';return{label:l,data:d,backgroundColor:i?c.f:c.b:2,borderRadius:i?0:4};}
        };

        // ===================================================================
        //,borderColor:c.b,type:t,fill:i,tension:0.4,borderWidth:i =========== MODULE CHO B√ÅO C√ÅO HI·ªÜU QU·∫¢ MKT (TAB 4) ==============
        // ===================================================================
        const mktReportApp = {
            isInitialized: false, allData: [], market?3:1,pointRadius:i?5:undefined,pointBackgroundColor:'#fff',pointBorderWidth:2,borderRadius:i?0:4};}
        };

        // ===================================================================
        //Groups: { 'Ch√¢u √Å': ['H√†n Qu·ªëc', 'Nh·∫≠t B·∫£n', 'VN'], 'Ngo√†i Ch√¢u √Å': ['√öc', 'US', 'Canada'] },
            init: function() { this.addEventListeners(); this =========== MODULE CHO B√ÅO C√ÅO HI·ªÜU QU·∫¢ MKT (TAB 4) ==============
        // =.setDefaultDates(); this.loadData(); this.isInitialized = true; },
            addEventListeners: function() { document==================================================================
        const mktReportApp = {
            isInitialized: false, allData: [], marketGroups: { 'Ch√¢u √Å': ['H√†n Qu·ªëc', 'Nh·∫≠t B·∫£n', 'VN'], 'Ngo√†i Ch√¢u √Å':.getElementById('apply-filter-mkt').addEventListener('click', () => this.applyFilters()); },
            setDefault ['√öc', 'US', 'Canada'] },
            init: function() { this.addEventListeners(); thisDates: function() { const today = new Date(); const firstDayOfMonth = new Date(today.getFullYear(), today.setDefaultDates(); this.loadData(); this.isInitialized = true; },
            addEventListeners: function() { document.getMonth(), 1); document.getElementById('start-date-mkt').value = this.formatDateInput.getElementById('apply-filter-mkt').addEventListener('click', () => this.applyFilters()); },
            setDefault(firstDayOfMonth); document.getElementById('end-date-mkt').value = this.formatDateInput(today);Dates: function() { const today = new Date(); const firstDayOfMonth = new Date(today.getFullYear(), today },
            loadData: function() {
                const loadingElement = document.getElementById('loading-mkt'), error.getMonth(), 1); document.getElementById('start-date-mkt').value = this.formatDateInputElement = document.getElementById('error-message-mkt');
                if (loadingElement) loadingElement.style.(firstDayOfMonth); document.getElementById('end-date-mkt').value = this.formatDateInput(today);display = 'block'; if (errorElement) errorElement.style.display = 'none';
                fetch('https:// },
            loadData: function() {
                const loadingElement = document.getElementById('loading-mkt'), errorscript.google.com/macros/s/AKfycbwGwSBxeXplEzAM-jJElement = document.getElementById('error-message-mkt');
                if (loadingElement) loadingElement.style.DPaXPkiWjNyKmpR70o6nCY5_ynqoF-3WAdisplay = 'block'; if (errorElement) errorElement.style.display = 'none';
                fetch('https://1gvF91RIQQfDZ9fvAQ/exec')
                    .then(res => res.script.google.com/macros/s/AKfycbwGwSBxeXplEzAM-jJjson()).then(data => {
                        if (loadingElement) loadingElement.style.display = 'none';DPaXPkiWjNyKmpR70o6nCY5_ynqoF-3WA
                        this.allData = data.map(r => ({ ...r, cpqc: +r.cp1gvF91RIQQfDZ9fvAQ/exec')
                    .then(res => res.qc || 0, soDon: +r.soDon || 0, dsChot: +r.dsChjson()).then(data => {
                        if (loadingElement) loadingElement.style.display = 'none';
ot || 0, soMessCmt: +r.soMessCmt || 0, team: r                        this.allData = data.map(r => ({ ...r, cpqc: +r.cpqc.team || 'Kh√°c', thiTruong: r.thiTruong || 'Kh√°c' }));
                        this || 0, soDon: +r.soDon || 0, dsChot: +r.dsCh.populateFilters(); this.applyFilters();
                    }).catch(err => { console.error('Error fetching Mkt dataot || 0, soMessCmt: +r.soMessCmt || 0, team: r:', err); if (loadingElement) loadingElement.style.display = 'none'; if (errorElement) { errorElement.textContent = `L·ªói khi t·∫£i d·ªØ li·ªáu: ${err.message}`; errorElement.style.display = '.team || 'Kh√°c', thiTruong: r.thiTruong || 'Kh√°c' }));
                        this.populateblock'; } });
            },
            populateFilters: function() {
                const markets = [...new Set(Filters(); this.applyFilters();
                    }).catch(err => { console.error('Error fetching Mkt data:', err); if (loadingElement) loadingElement.style.display = 'none'; if (errorElement) {this.allData.map(r => r.thiTruong).filter(Boolean))].sort(), teams = [...new Set(this.allData.map(r => r.team).filter(Boolean))].sort(), shifts = [...new Set errorElement.textContent = `L·ªói khi t·∫£i d·ªØ li·ªáu: ${err.message}`; errorElement.style.display = 'block'; } });
            },
            populateFilters: function() {
                const markets = [...new Set((this.allData.map(r => r.ca).filter(ca => ca != null && ca !==this.allData.map(r => r.thiTruong).filter(Boolean))].sort(), teams = [...new Set ''))].sort((a, b) => a - b);
                const marketSelect = document.getElementById('market-filter(this.allData.map(r => r.team).filter(Boolean))].sort(), shifts = [...new Set(this.allData.map(r => r.ca).filter(ca => ca != null && ca !==-mkt'), teamSelect = document.getElementById('team-filter-mkt'), shiftSelect = document.getElementById('ca- ''))].sort((a, b) => a - b);
                const marketSelect = document.getElementById('market-filterfilter-mkt');
                marketSelect.innerHTML = '<option value="">T·∫•t c·∫£ Th·ªã tr∆∞·ªùng</option>'-mkt'), teamSelect = document.getElementById('team-filter-mkt'), shiftSelect = document.getElementById('ca- + markets.map(m => `<option value="${m}">${m}</option>`).join('');
                teamSelect.innerHTML =filter-mkt');
                marketSelect.innerHTML = '<option value="">T·∫•t c·∫£ Th·ªã tr∆∞·ªùng</option>' '<option value="">T·∫•t c·∫£ Team</option>' + teams.map(t => `<option value="${t}">${t + markets.map(m => `<option value="${m}">${m}</option>`).join('');
                teamSelect.innerHTML =}</option>`).join('');
                shiftSelect.innerHTML = '<option value="">T·∫•t c·∫£ Ca</option>' + shifts.map(s => `<option value="${s}">${s}</option>`).join('');
            },
             '<option value="">T·∫•t c·∫£ Team</option>' + teams.map(t => `<option value="${t}">${t}</option>`).join('');
                shiftSelect.innerHTML = '<option value="">T·∫•t c·∫£ Ca</option>' + shiftsapplyFilters: function() {
                const startDateInput = document.getElementById('start-date-mkt').value, endDate.map(s => `<option value="${s}">${s}</option>`).join('');
            },
            applyInput = document.getElementById('end-date-mkt').value, selectedMarket = document.getElementById('market-filterFilters: function() {
                const startDateInput = document.getElementById('start-date-mkt').value, endDate-mkt').value, selectedTeam = document.getElementById('team-filter-mkt').value, selectedCa = document.getElementById('ca-filter-mkt').value;
                document.getElementById('report-date-Input = document.getElementById('end-date-mkt').value, selectedMarket = document.getElementById('market-filtermkt').textContent = `T·ª´ ng√†y ${formatUtils.formatDate(startDateInput)} ƒë·∫øn ng√†y ${formatUtils.formatDate(-mkt').value, selectedTeam = document.getElementById('team-filter-mkt').value, selectedCa = document.getElementById('ca-filter-mkt').value;
                document.getElementById('report-date-endDateInput)}`;
                const startDate = startDateInput ? new Date(startDateInput + 'T00:00:00') : null, endDate = endDateInput ? new Date(endDateInput + 'T23:59mkt').textContent = `T·ª´ ng√†y ${formatUtils.formatDate(startDateInput)} ƒë·∫øn ng√†y ${formatUtils.formatDate(endDateInput)}`;
                const startDate = startDateInput ? new Date(startDateInput + 'T00:00::59') : null;
                const filteredData = this.allData.filter(record => {
                    00') : null, endDate = endDateInput ? new Date(endDateInput + 'T23:59:if (!record.ngay) return false; const recordDate = new Date(record.ngay); if (59') : null;
                const filteredData = this.allData.filter(record => {
                    if (!record.ngay) return false; const recordDate = new Date(record.ngay); if (isNaN(recordDate.getTime())) return false;
                    const dateMatch = (!startDate || recordDate >= startDate)isNaN(recordDate.getTime())) return false;
                    const dateMatch = (!startDate || recordDate >= startDate) && (!endDate || recordDate <= endDate), marketMatch = !selectedMarket || record.thiTruong === selectedMarket, && (!endDate || recordDate <= endDate), marketMatch = !selectedMarket || record.thiTruong === selectedMarket, teamMatch = !selectedTeam || record.team === selectedTeam, caMatch = !selectedCa || String(record teamMatch = !selectedTeam || record.team === selectedTeam, caMatch = !selectedCa || String(record.ca) === selectedCa;
                    return dateMatch && marketMatch && teamMatch && caMatch;
                });.ca) === selectedCa;
                    return dateMatch && marketMatch && teamMatch && caMatch;
                });

                this.processAndDisplayData(filteredData);
            },
            processAndDisplayData: function(data                this.processAndDisplayData(filteredData);
            },
            processAndDisplayData: function(data) {
                const processedData = { nonAsiaMarket: [], asiaMarket: [], summary: data };
                data) {
                const processedData = { nonAsiaMarket: [], asiaMarket: [], summary: data };
                data.forEach(record => { let region = null; for (const group in this.marketGroups) { if (this.forEach(record => { let region = null; for (const group in this.marketGroups) { if (.marketGroups[group].includes(record.thiTruong)) { region = group; break; } } if (regionthis.marketGroups[group].includes(record.thiTruong)) { region = group; break; } } if (region === 'Ngo√†i Ch√¢u √Å') processedData.nonAsiaMarket.push(record); else if (region === === 'Ngo√†i Ch√¢u √Å') processedData.nonAsiaMarket.push(record); else if (region === 'Ch 'Ch√¢u √Å') processedData.asiaMarket.push(record); });
                this.displayTable(processed√¢u √Å') processedData.asiaMarket.push(record); });
                this.displayTable(processedData.nonAsiaData.nonAsiaMarket, 'non-asia', true); this.displayTable(processedData.asiaMarket,Market, 'non-asia', true); this.displayTable(processedData.asiaMarket, 'asia', true 'asia', true); this.displayTable(processedData.summary, 'summary', false);
            },
            display); this.displayTable(processedData.summary, 'summary', false);
            },
            displayTable: function(data, prefix, showMarket) {
                let container; if (prefix === 'summary') container = document.getElementById('Table: function(data, prefix, showMarket) {
                let container; if (prefix === 'summary') container =summary-mkt'); else container = document.getElementById(`${prefix}-market-mkt`);
                const tableBody = document. document.getElementById('summary-mkt'); else container = document.getElementById(`${prefix}-market-mkt`);
                const tablegetElementById(`${prefix}-body-mkt`);
                if (container && tableBody) { if (data && dataBody = document.getElementById(`${prefix}-body-mkt`);
                if (container && tableBody) { if (data.length > 0) { container.style.display = 'block'; this.renderTable(data, tableBody, && data.length > 0) { container.style.display = 'block'; this.renderTable(data showMarket); } else { container.style.display = 'block'; tableBody.innerHTML = `<tr><td, tableBody, showMarket); } else { container.style.display = 'block'; tableBody.innerHTML = colspan="9" class="text-center">Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p v·ªõi b·ªô l·ªçc.</td></tr>`; } `<tr><td colspan="9" class="text-center">Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p v·ªõi b·ªô l·ªçc.</td> }
            },
            renderTable: function(data, tableBody, showMarket) {
                tableBody.</tr>`; } }
            },
            renderTable: function(data, tableBody, showMarket) {
                innerHTML = ''; const productGroups = {};
                data.forEach(record => { const productKey = record.sanPhamtableBody.innerHTML = ''; const productGroups = {};
                data.forEach(record => { const productKey = record.sanPham || 'Kh√¥ng x√°c ƒë·ªãnh', marketKey = showMarket ? (record.thiTruong || 'Kh√¥ng || 'Kh√¥ng x√°c ƒë·ªãnh', marketKey = showMarket ? (record.thiTruong || 'Kh√¥ng x√°c ƒë·ªãnh') : '_'; if (!productGroups[productKey]) productGroups[productKey] = {}; if (!productGroups[ x√°c ƒë·ªãnh') : '_'; if (!productGroups[productKey]) productGroups[productKey] = {}; if (productKey][marketKey]) productGroups[productKey][marketKey] = { cpqc: 0, so!productGroups[productKey][marketKey]) productGroups[productKey][marketKey] = { cpqc: 0, soDon: 0, dsChot: 0, soMessCmt: 0 }; constDon: 0, dsChot: 0, soMessCmt: 0 }; const group = productGroups[ group = productGroups[productKey][marketKey]; group.cpqc += record.cpqc; group.soproductKey][marketKey]; group.cpqc += record.cpqc; group.soDon += record.soDon; groupDon += record.soDon; group.dsChot += record.dsChot; group.soMessC.dsChot += record.dsChot; group.soMessCmt += record.soMessCmt; });mt += record.soMessCmt; });
                const grandTotal = { cpqc: 0, soDon:
                const grandTotal = { cpqc: 0, soDon: 0, dsChot: 0, so 0, dsChot: 0, soMessCmt: 0 };
                Object.keys(MessCmt: 0 };
                Object.keys(productGroups).sort().forEach(product => { const marketsproductGroups).sort().forEach(product => { const markets = productGroups[product], productTotal = { cpqc: 0 = productGroups[product], productTotal = { cpqc: 0, soDon: 0, dsChot: , soDon: 0, dsChot: 0, soMessCmt: 0 }; Object.keys(markets0, soMessCmt: 0 }; Object.keys(markets).sort().forEach(market => { const).sort().forEach(market => { const marketData = markets[market]; tableBody.appendChild(this.createRow marketData = markets[market]; tableBody.appendChild(this.createRow(product, market, marketData, showMarket(product, market, marketData, showMarket)); productTotal.cpqc += marketData.cpqc; productTotal.)); productTotal.cpqc += marketData.cpqc; productTotal.soDon += marketData.soDonsoDon += marketData.soDon; productTotal.dsChot += marketData.dsChot; product; productTotal.dsChot += marketData.dsChot; productTotal.soMessCmt += marketTotal.soMessCmt += marketData.soMessCmt; }); if (showMarket && Object.keys(marketsData.soMessCmt; }); if (showMarket && Object.keys(markets).length > 1) table).length > 1) tableBody.appendChild(this.createRow(product, 'T·ªïng', productTotal, showBody.appendChild(this.createRow(product, 'T·ªïng', productTotal, showMarket, 'highlight')); grandMarket, 'highlight')); grandTotal.cpqc += productTotal.cpqc; grandTotal.soDon += productTotal.cpqc += productTotal.cpqc; grandTotal.soDon += productTotal.soDon; grandTotal.Total.soDon; grandTotal.dsChot += productTotal.dsChot; grandTotal.soMessdsChot += productTotal.dsChot; grandTotal.soMessCmt += productTotal.soMessCmt += productTotal.soMessCmt; });
                if (Object.keys(productGroups).length >Cmt; });
                if (Object.keys(productGroups).length > 0) tableBody.appendChild( 0) tableBody.appendChild(this.createRow('T·ªîNG C·ªòNG', '', grandTotal, showMarketthis.createRow('T·ªîNG C·ªòNG', '', grandTotal, showMarket, 'total-row'));
, 'total-row'));
            },
            createRow: function(productName, marketName, data, show            },
            createRow: function(productName, marketName, data, showMarket, className = '') {
                constMarket, className = '') {
                const tr = document.createElement('tr'); if (className) tr.className tr = document.createElement('tr'); if (className) tr.className = className;
                const costPercent = data = className;
                const costPercent = data.dsChot ? data.cpqc / data.dsCh.dsChot ? data.cpqc / data.dsChot : 0, cps = data.soot : 0, cps = data.soDon ? data.cpqc / data.soDon : 0,Don ? data.cpqc / data.soDon : 0, avgOrderValue = data.soDon ? data avgOrderValue = data.soDon ? data.dsChot / data.soDon : 0, closing.dsChot / data.soDon : 0, closingRate = data.soMessCmt ? data.soDonRate = data.soMessCmt ? data.soDon / data.soMessCmt : 0;
 / data.soMessCmt : 0;
                const rateClass = closingRate > 0.1                const rateClass = closingRate > 0.1 ? 'bg-green' : (closingRate > 0 ? 'bg-green' : (closingRate > 0.05 ? 'bg-yellow' : '');.05 ? 'bg-yellow' : '');
                let html = `<td class="text-left">${product
                let html = `<td class="text-left">${productName}</td><td class="text-left">${marketName}</td><td class="text-left">${marketName}</td><td>${formatUtils.formatCurrency(dataName}</td><td>${formatUtils.formatCurrency(data.cpqc)}</td><td class="text-center">${format.cpqc)}</td><td class="text-center">${formatUtils.formatNumber(data.soDon)}Utils.formatNumber(data.soDon)}</td><td>${formatUtils.formatCurrency(data.dsChot</td><td>${formatUtils.formatCurrency(data.dsChot)}</td><td class="text-center">${format)}</td><td class="text-center">${formatUtils.formatPercent(costPercent)}</td><td>${formatUtils.Utils.formatPercent(costPercent)}</td><td>${formatUtils.formatCurrency(cps)}</td><td>${formatUtils.formatformatCurrency(cps)}</td><td>${formatUtils.formatCurrency(avgOrderValue)}</td><td class="text-center ${Currency(avgOrderValue)}</td><td class="text-center ${rateClass}">${formatUtils.formatPercent(closingrateClass}">${formatUtils.formatPercent(closingRate)}</td>`;
                tr.innerHTML = html; return tr;Rate)}</td>`;
                tr.innerHTML = html; return tr;
            },
            formatDateInput: function(date
            },
            formatDateInput: function(date) { const year = date.getFullYear(), month = String) { const year = date.getFullYear(), month = String(date.getMonth() + 1).padStart(2,(date.getMonth() + 1).padStart(2, '0'), day = String(date.getDate()).padStart(2 '0'), day = String(date.getDate()).padStart(2, '0'); return `${year}-${month}-${day}`;, '0'); return `${year}-${month}-${day}`; }
        };

        // ===================================================================
        // =========== MODULE CHO B√ÅO C√ÅO NH√ÇN S·ª∞ (TAB 5) ====================
         }
        };
        
        // ===================================================================
        // =========== MODULE CHO B√ÅO C√ÅO NH√ÇN S·ª∞ (TAB 5) ====================
        // ===================================================================
        const// ===================================================================
        const staffReportApp = {
            isInitialized: false, allData: [], charts staffReportApp = {
            isInitialized: false, allData: [], charts: {}, fullReportData: [],
: {}, fullReportData: [],
            currentSummaryData: [], currentDailyData: {},

            init: function            currentSummaryData: [], currentDailyData: {},

            init: function() { this.addEventListeners(); this() { this.addEventListeners(); this.setDefaultDates(); this.fetchData(); this.isInitialized = true;.setDefaultDates(); this.fetchData(); this.isInitialized = true; },
            
            addEventListeners: },
            
            addEventListeners: function() {
                document.getElementById('team-filter-staff').addEventListener('change', () => this.updateStaffFilter());
                document.getElementById('apply-filter-staff').addEventListener('click function() {
                document.getElementById('team-filter-staff').addEventListener('change', () => this.updateStaffFilter());
                document.getElementById('apply-filter-staff').addEventListener('click', () => this.applyFilters());', () => this.applyFilters());
                document.getElementById('staff-summary-container').addEventListener('click', (e) => { const staffRow = e.target.closest('.clickable-staff-row'); if (staffRow) {
                document.getElementById('staff-summary-container').addEventListener('click', (e) => { const staffRow this.handleStaffRowClick(staffRow); } else { this.handleTableSort(e, 'staff-summary-table = e.target.closest('.clickable-staff-row'); if (staffRow) { this.handleStaffRow'); } });
                document.getElementById('daily-breakdown-table-wrapper').addEventListener('click', (eClick(staffRow); } else { this.handleTableSort(e, 'staff-summary-table'); } });) => { const summaryRow = e.target.closest('.daily-summary-row'); const header = e.target
                document.getElementById('daily-breakdown-table-wrapper').addEventListener('click', (e) => { const summary.closest('.sortable-header'); if (summaryRow && !header) { this.toggleDayDetails(summaryRow = e.target.closest('.daily-summary-row'); const header = e.target.closest('.sortRow); } else if (header) { const nestedTable = header.closest('.nested-table-container'); if (nestedable-header'); if (summaryRow && !header) { this.toggleDayDetails(summaryRow); } elseTable) { this.handleTableSort(e, 'nested', nestedTable.dataset.date); } else { this. if (header) { const nestedTable = header.closest('.nested-table-container'); if (nestedTable) {handleTableSort(e, 'daily-breakdown'); } } });
            },
            
            handleStaffRowClick: function(row) {
                const staffName = row.dataset.staffName; if (!staffName) return this.handleTableSort(e, 'nested', nestedTable.dataset.date); } else { this.handleTableSort(;
                showLoader();
                setTimeout(() => {
                    document.querySelectorAll('#staff-summary-table .clickable-staff-row').forEach(r => r.classList.remove('highlighted-row'));
                    rowe, 'daily-breakdown'); } } });
            },
            
            handleStaffRowClick: function(row.classList.add('highlighted-row');
                    const staffData = this.fullReportData.filter(r =>) {
                const staffName = row.dataset.staffName; if (!staffName) return;
                showLoader(); r.ten === staffName);
                    document.querySelectorAll('#StaffReport .chart-container[data-chart="
                setTimeout(() => {
                    document.querySelectorAll('#staff-summary-table .clickable-staff-row').forEach(r => r.classList.remove('highlighted-row'));
                    row.classList.add('highlighted-row');line"], #StaffReport .chart-container[data-chart="combo"]').forEach(c => c.style.display
                    const staffData = this.fullReportData.filter(r => r.ten === staffName);
 = 'block');
                    this.renderIndividualCharts(staffData);
                    document.getElementById('charts-container                    document.querySelectorAll('#StaffReport .chart-container[data-chart="line"], #StaffReport .chart-container[data-staff').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    hideLoader();
-chart="combo"]').forEach(c => c.style.display = 'block');
                    this.renderIndividual                }, 10);
            },

            toggleDayDetails: function(summaryRow) {
                const dateKey = summaryRow.dataset.date;
                const detailsRow = document.querySelector(`#StaffReport .details-container-rowCharts(staffData);
                    document.getElementById('charts-container-staff').scrollIntoView({ behavior: 'smooth[data-date='${dateKey}']`);
                const isExpanded = summaryRow.classList.toggle('expanded', block: 'center' });
                    hideLoader();
                }, 10);
            },

            toggleDay');
                if (isExpanded) {
                    detailsRow.style.display = 'table-row';
Details: function(summaryRow) {
                const dateKey = summaryRow.dataset.date;
                const details                    if (!detailsRow.querySelector('td').innerHTML) { this.renderNestedTable(detailsRow.querySelector('td'), dateKey, this.currentDailyData[dateKey].members); }
                    this.updateDoughnutChart('Row = document.querySelector(`#StaffReport .details-container-row[data-date='${dateKey}']`);
daily', this.currentDailyData[dateKey].members, dateKey);
                    document.querySelector('#StaffReport .                const isExpanded = summaryRow.classList.toggle('expanded');
                if (isExpanded) {
                    detailsRow.chart-container[data-chart="doughnut"]').scrollIntoView({ behavior: 'smooth', block: 'centerstyle.display = 'table-row';
                    if (!detailsRow.querySelector('td').innerHTML) { this.render' });
                } else {
                    detailsRow.style.display = 'none';
                    this.updateNestedTable(detailsRow.querySelector('td'), dateKey, this.currentDailyData[dateKey].members); }
                    DoughnutChart('overall', this.fullReportData);
                }
            },
            
            resetthis.updateDoughnutChart('daily', this.currentDailyData[dateKey].members, dateKey);
                    UIStates: function() {
                if (this.fullReportData && this.fullReportData.length > 0document.querySelector('#StaffReport .chart-container[data-chart="doughnut"]').scrollIntoView({ behavior: 'smooth) { this.updateDoughnutChart('overall', this.fullReportData); }
                document.querySelectorAll', block: 'center' });
                } else {
                    detailsRow.style.display = 'none';('#staff-summary-table .clickable-staff-row').forEach(r => r.classList.remove('highlight
                    this.updateDoughnutChart('overall', this.fullReportData);
                }
            },
            
ed-row'));
                const isFullTeamView = document.getElementById('staff-filter-staff').value === '__            resetUIStates: function() {
                if (this.fullReportData && this.fullReportData.FULL_TEAM__';
                if (!isFullTeamView) { document.querySelectorAll('#StaffReport .chart-length > 0) { this.updateDoughnutChart('overall', this.fullReportData); }
container[data-chart="line"], #StaffReport .chart-container[data-chart="combo"]').forEach(c => c                document.querySelectorAll('#staff-summary-table .clickable-staff-row').forEach(r => r.classList.remove('highlighted-row'));
                const isFullTeamView = document.getElementById('staff-filter-staff').value.style.display = 'block'); }
            },

            fetchData: function() {
                showLoader();
                fetch('https://script.google.com/macros/s/AKfycbwGwSBxeXplEzAM-jJDPaXPkiWjNyKmpR70o6nCY5_ynqoF === '__FULL_TEAM__';
                if (!isFullTeamView) { document.querySelectorAll('#StaffReport .chart--3WA1gvF91RIQQfDZ9fvAQ/exec')
                .then(rescontainer[data-chart="line"], #StaffReport .chart-container[data-chart="combo"]').forEach(c => c.style.display = 'block'); }
            },

            fetchData: function() {
                showLoader(); => res.json())
                .then(data => {
                    const startOfToday = new Date(); start
                fetch('https://script.google.com/macros/s/AKfycbwGwSBxeXOfToday.setHours(0, 0, 0, 0);
                    this.allData = data.plEzAM-jJDPaXPkiWjNyKmpR70o6nCY5_ynqoF-3WA1gvF91RIQQfDZ9fvAQ/exec')
                .then(resfilter(r => r.ngay && new Date(r.ngay) < startOfToday)
                                => res.json())
                .then(data => {
                    const startOfToday = new Date(); startOfToday.        .map(r => ({ ...r, team: String(r.team || 'Kh√°c').trim(), tensetHours(0, 0, 0, 0);
                    this.allData = data.filter(r =>: String(r.ten || 'N/A').trim(), soMessCmt: +r.soMessCmt || r.ngay && new Date(r.ngay) < startOfToday)
                                       .map(r => ({ 0, soDon: +r.soDon || 0, dsChot: +r.dsCh ...r, team: String(r.team || 'Kh√°c').trim(), ten: String(r.tenot || 0, cpqc: +r.cpqc || 0 }));
                    this.populateTeamFilter || 'N/A').trim(), soMessCmt: +r.soMessCmt || 0, so(); this.updateStaffFilter(); this.initCharts();
                }).catch(err => { console.error("L·ªói StaffDon: +r.soDon || 0, dsChot: +r.dsChot || 0 Data:", err); document.getElementById('staff-placeholder').innerHTML = `<p style="color: red;">L·ªói:, cpqc: +r.cpqc || 0 }));
                    this.populateTeamFilter(); this.update Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.<br>H√£y ki·ªÉm tra k·∫øt n·ªëi m·∫°ng v√† th·ª≠ l·∫°i.</p>`; }).finally(hideStaffFilter(); this.initCharts();
                }).catch(err => { console.error("L·ªói Staff Data:", err);Loader);
            },
            
            applyFilters: function() {
                showLoader();
                setTimeout(() document.getElementById('staff-placeholder').innerHTML = `<p style="color: red;">L·ªói: Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu => { 
                    const startDate = document.getElementById('start-date-staff').value, endDate = document.getElementById('end-date-staff').value, selectedTeams = Array.from(document.getElementById('team-filter-staff.<br>H√£y ki·ªÉm tra k·∫øt n·ªëi m·∫°ng v√† th·ª≠ l·∫°i.</p>`; }).finally(hideLoader);
            },
            
').selectedOptions).map(opt => opt.value), selectedTarget = document.getElementById('staff-filter-staff').value            applyFilters: function() {
                showLoader();
                setTimeout(() => { 
                    const startDate = document.getElementById('start-date-staff').value, endDate = document.getElementById('end-date-staff').value;
                    const placeholder = document.getElementById('staff-placeholder'), resultsContainer = document.getElementById('staff-results, selectedTeams = Array.from(document.getElementById('team-filter-staff').selectedOptions).map(opt => opt-container'), dailyComparisonContainer = document.getElementById('daily-comparison-container');
                    if (selectedTeams.length === 0 || !selectedTarget) { placeholder.style.display = 'block'; resultsContainer.style.display.value), selectedTarget = document.getElementById('staff-filter-staff').value;
                    const placeholder = document.getElementById('staff-placeholder'), resultsContainer = document.getElementById('staff-results-container'), dailyComparisonContainer = document.getElementById('daily- = 'none'; hideLoader(); return; }
                    const dateFilteredData = this.allData.filter(r =>comparison-container');
                    if (selectedTeams.length === 0 || !selectedTarget) { placeholder.style { if (!r.ngay) return false; const dateStr = new Date(r.ngay).toISOString().split.display = 'block'; resultsContainer.style.display = 'none'; hideLoader(); return; }
                    const('T')[0]; return (!startDate || dateStr >= startDate) && (!endDate || dateStr <= endDate); }); dateFilteredData = this.allData.filter(r => { if (!r.ngay) return false; const
                    const isFullTeamView = selectedTarget === '__FULL_TEAM__';
                    this.fullReportData dateStr = new Date(r.ngay).toISOString().split('T')[0]; return (!startDate || dateStr >= startDate = isFullTeamView ? dateFilteredData.filter(r => selectedTeams.includes(r.team)) : dateFilteredData.filter(r => r.ten === selectedTarget);
                    if (this.fullReportData.length === ) && (!endDate || dateStr <= endDate); });
                    const isFullTeamView = selectedTarget === '__FULL_TEAM0) { placeholder.style.display = 'block'; placeholder.innerHTML = `<p>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho__';
                    this.fullReportData = isFullTeamView ? dateFilteredData.filter(r => selectedTeams.includes l·ª±a ch·ªçn c·ªßa b·∫°n.</p>`; resultsContainer.style.display = 'none'; } 
                    else { const report(r.team)) : dateFilteredData.filter(r => r.ten === selectedTarget);
                    if (thisTitle = isFullTeamView ? `B√°o c√°o Team: ${selectedTeams.join(', ')}` : `.fullReportData.length === 0) { placeholder.style.display = 'block'; placeholder.innerHTML =B√°o c√°o chi ti·∫øt: ${selectedTarget}`;
                        placeholder.style.display = 'none'; resultsContainer.style. `<p>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho l·ª±a ch·ªçn c·ªßa b·∫°n.</p>`; resultsContainer.style.display = 'nonedisplay = 'block'; document.getElementById('staff-report-title').textContent = reportTitle;
                        this.'; } 
                    else { const reportTitle = isFullTeamView ? `B√°o c√°o Team: ${selectedresetUIStates(); this.updateChartVisibility(isFullTeamView); this.renderSummaryTable(this.fullReportData, isFullTeamView); this.renderDailyBreakdownTable(this.fullReportData, isFullTeamView);Teams.join(', ')}` : `B√°o c√°o chi ti·∫øt: ${selectedTarget}`;
                        placeholder.style.display = 'none'; resultsContainer.style.display = 'block'; document.getElementById('staff-report-
                        if (isFullTeamView) { dailyComparisonContainer.style.display = 'block'; this.renderTeamtitle').textContent = reportTitle;
                        this.resetUIStates(); this.updateChartVisibility(isFullTeamViewTrendChart(this.fullReportData); this.renderTeamCharts(this.fullReportData); } 
                        else {); this.renderSummaryTable(this.fullReportData, isFullTeamView); this.renderDailyBreakdownTable dailyComparisonContainer.style.display = 'none'; this.renderIndividualCharts(this.fullReportData); }(this.fullReportData, isFullTeamView);
                        if (isFullTeamView) { dailyComparisonContainer.style
                    }
                    hideLoader();
                }, 10);
            },
            
            calculateMetrics.display = 'block'; this.renderTeamTrendChart(this.fullReportData); this.renderTeamCharts(this.fullReportData); } 
                        else { dailyComparisonContainer.style.display = 'none'; this: (dataset) => { const totals = dataset.reduce((acc, r) => { acc.mess += r.renderIndividualCharts(this.fullReportData); }
                    }
                    hideLoader();
                }, 10);.soMessCmt; acc.don += r.soDon; acc.chot += r.dsCh
            },
            
            calculateMetrics: (dataset) => { const totals = dataset.reduce((acc,ot; acc.cpqc += r.cpqc; return acc; }, { mess: 0, don: 0, r) => { acc.mess += r.soMessCmt; acc.don += r.soDon; chot: 0, cpqc: 0 }); return { ...totals, tiLeChot: totals.mess ? acc.chot += r.dsChot; acc.cpqc += r.cpqc; return acc; totals.don / totals.mess : 0, giaMess: totals.mess ? totals.cpqc / totals.mess : }, { mess: 0, don: 0, chot: 0, cpqc: 0 }); return 0, cps: totals.don ? totals.cpqc / totals.don : 0, cpDsRatio: { ...totals, tiLeChot: totals.mess ? totals.don / totals.mess : 0, gia totals.chot ? totals.cpqc / totals.chot : 0, giaTbDon: totals.donMess: totals.mess ? totals.cpqc / totals.mess : 0, cps: totals.don ? ? totals.chot / totals.don : 0, }; },
            
            initCharts: function() { totals.cpqc / totals.don : 0, cpDsRatio: totals.chot ? totals.cp
                Object.values(this.charts).forEach(c => c.destroy && c.destroy());
                constqc / totals.chot : 0, giaTbDon: totals.don ? totals.chot / totals.don : 0, }; },
            
            initCharts: function() {
                Object.values(this.charts chartColors = ['#2d7c2d', '#4CAF50', '#FFC107).forEach(c => c.destroy && c.destroy());
                const chartColors = ['#2d7', '#e67e22', '#e74c3c', '#9b59b6', '#3c2d', '#4CAF50', '#FFC107', '#e67e22', '#e4495e'];
                const baseOptions = { responsive: true, maintainAspectRatio: false };
                this74c3c', '#9b59b6', '#34495e'];
                const.charts.doughnut = new Chart(document.getElementById('teamDoughnutChart'), { type: 'dough baseOptions = { responsive: true, maintainAspectRatio: false };
                this.charts.doughnut = new Chart(documentnut', data: { datasets: [{ backgroundColor: chartColors }] }, options: { ...baseOptions, cutout: '7.getElementById('teamDoughnutChart'), { type: 'doughnut', data: { datasets: [{ backgroundColor: chartColors }]0%', plugins: { legend: { position: 'bottom' }, datalabels: { color: '#fff', font: }, options: { ...baseOptions, cutout: '70%', plugins: { legend: { position: 'bottom { weight: 'bold' }, formatter: (v, ctx) => { const sum = ctx.chart.data' }, datalabels: { color: '#fff', font: { weight: 'bold' }, formatter: (.datasets[0].data.reduce((a, b) => a + b, 0); return sum > 0 ?v, ctx) => { const sum = ctx.chart.data.datasets[0].data.reduce((a `${((v / sum) * 100).toFixed(0)}%` : '0%'; } } }, b) => a + b, 0); return sum > 0 ? `${((v / sum) * 10 }, plugins: [ChartDataLabels] });
                this.charts.line = new Chart(document.getElementById('0).toFixed(0)}%` : '0%'; } } } }, plugins: [ChartDataLabels] });staffLineChart'), { type: 'line', data: {}, options: { ...baseOptions, plugins: { legend
                this.charts.line = new Chart(document.getElementById('staffLineChart'), { type: 'line', data: { display: false } }, scales: { y: { beginAtZero: true } } } });
                this.: {}, options: { ...baseOptions, plugins: { legend: { display: false } }, scales: { y:charts.combo = new Chart(document.getElementById('staffComboChart'), { type: 'bar', data: {}, options: { ...baseOptions, scales: { y: { type: 'linear', position: 'left', title: { { beginAtZero: true } } } });
                this.charts.combo = new Chart(document.getElementById(' display: true, text: 'Doanh s·ªë' } }, y1: { type: 'linear', position: 'rightstaffComboChart'), { type: 'bar', data: {}, options: { ...baseOptions, scales: { y', grid: { drawOnChartArea: false }, title: { display: true, text: 'T·ªâ l·ªá: { type: 'linear', position: 'left', title: { display: true, text: 'Doanh s·ªë ch·ªët (%)' } } } } });
                this.charts.teamTrend = new Chart(document.getElementById('team' } }, y1: { type: 'linear', position: 'right', grid: { drawOnChartAreaDailyTrendChart'), { type: 'line', data: {}, options: { ...baseOptions, plugins: { legend: false }, title: { display: true, text: 'T·ªâ l·ªá ch·ªët (%)' } } } }: { display: false }, tooltip: { callbacks: { label: (ctx) => `DS Ch·ªët: ${format });
                this.charts.teamTrend = new Chart(document.getElementById('teamDailyTrendChart'), { type: 'Utils.formatCurrency(ctx.raw)}` } } }, scales: { y: { ticks: { callback: (valline', data: {}, options: { ...baseOptions, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => `DS Ch·ªët: ${formatUtils.formatCurrency(ctx.raw)}`) => new Intl.NumberFormat('vi-VN', { notation: "compact", maximumFractionDigits: 1 }).format(val) } } } } });
            },
            
            updateChartVisibility: function(is } } }, scales: { y: { ticks: { callback: (val) => new Intl.NumberFormat('viFullTeamView) { document.querySelectorAll('#StaffReport .chart-container[data-chart]').forEach(el => { el-VN', { notation: "compact", maximumFractionDigits: 1 }).format(val) } } } }.style.display = (isFullTeamView ? ['doughnut'].includes(el.dataset.chart) : });
            },
            
            updateChartVisibility: function(isFullTeamView) { document.querySelectorAll('#StaffReport . ['line', 'combo'].includes(el.dataset.chart)) ? 'block' : 'none'; }); },
            renderchart-container[data-chart]').forEach(el => { el.style.display = (isFullTeamView ? ['doughnut'].includes(el.dataset.chart) : ['line', 'combo'].includes(el.dataset.chartTeamCharts: function(data) { this.updateDoughnutChart('overall', data); },
            updateDoughnutChart: function(mode, data, dateKey = null) {
                if (!this.charts.doughnut) return;)) ? 'block' : 'none'; }); },
            renderTeamCharts: function(data) { this.updateDoughnutChart('overall', data); },
            updateDoughnutChart: function(mode, data let memberMetrics;
                const titleEl = document.getElementById('doughnut-chart-title');
                if (mode, dateKey = null) {
                if (!this.charts.doughnut) return; let memberMetrics; === 'daily') { memberMetrics = Object.entries(data).map(([name, records]) => ({ name,
                const titleEl = document.getElementById('doughnut-chart-title');
                if (mode === 'daily metrics: this.calculateMetrics(records) })); titleEl.innerHTML = `<i class="fas fa-search-dollar') { memberMetrics = Object.entries(data).map(([name, records]) => ({ name, metrics: this" style="color: var(--warning-color);"></i> Ph√¢n t√≠ch DS Ch·ªët ng√†y ${formatUtils.formatDate(date.calculateMetrics(records) })); titleEl.innerHTML = `<i class="fas fa-search-dollar" style="colorKey)}`; } 
                else { memberMetrics = Object.entries(data.reduce((acc, r) => { (: var(--warning-color);"></i> Ph√¢n t√≠ch DS Ch·ªët ng√†y ${formatUtils.formatDate(dateKey)}`;acc[r.ten] = acc[r.ten] || []).push(r); return acc; }, } 
                else { memberMetrics = Object.entries(data.reduce((acc, r) => { ( {})).map(([name, records]) => ({ name, metrics: this.calculateMetrics(records) })); titleEl.innerHTML =acc[r.ten] = acc[r.ten] || []).push(r); return acc; }, `<i class="fas fa-chart-pie" style="color: var(--primary-color);"></i>T·ªâ L·ªá ƒê {})).map(([name, records]) => ({ name, metrics: this.calculateMetrics(records) })); titleEl.innerHTML =√≥ng G√≥p Doanh S·ªë`; }
                memberMetrics = memberMetrics.filter(item => item.metrics. `<i class="fas fa-chart-pie" style="color: var(--primary-color);"></i>T·ªâ L·ªá ƒêchot > 0).sort((a, b) => b.metrics.chot - a.metrics.chot);√≥ng G√≥p Doanh S·ªë`; }
                memberMetrics = memberMetrics.filter(item => item.metrics.ch
                const chart = this.charts.doughnut; chart.data.labels = memberMetrics.map(mot > 0).sort((a, b) => b.metrics.chot - a.metrics.chot); => m.name); chart.data.datasets[0].data = memberMetrics.map(m => m.metrics.ch
                const chart = this.charts.doughnut; chart.data.labels = memberMetrics.map(mot); chart.update();
            },
            
            renderTeamTrendChart: function(data) { const daily => m.name); chart.data.datasets[0].data = memberMetrics.map(m => m.metrics.chData = data.reduce((acc, r) => { const date = formatUtils.formatDate(r.ngot); chart.update();
            },
            
            renderTeamTrendChart: function(data) { constay); if (!acc[date]) acc[date] = { dsChot: 0, dateObj: new dailyData = data.reduce((acc, r) => { const date = formatUtils.formatDate(r.ng Date(r.ngay) }; acc[date].dsChot += r.dsChot; return accay); if (!acc[date]) acc[date] = { dsChot: 0, dateObj: new; }, {}); const sortedDailyData = Object.entries(dailyData).sort(([, a], [, b]) => a Date(r.ngay) }; acc[date].dsChot += r.dsChot; return acc; }, {});.dateObj - b.dateObj); this.charts.teamTrend.data.labels = sortedDailyData. const sortedDailyData = Object.entries(dailyData).sort(([, a], [, b]) => a.datemap(([date]) => date); this.charts.teamTrend.data.datasets = [{ label: 'T·ªïng DS Ch·ªët',Obj - b.dateObj); this.charts.teamTrend.data.labels = sortedDailyData.map(([ data: sortedDailyData.map(([, data]) => data.dsChot), borderColor: 'var(--primary-date]) => date); this.charts.teamTrend.data.datasets = [{ label: 'T·ªïng DS Ch·ªët',color)', backgroundColor: 'rgba(45, 124, 45, 0.1)', fill data: sortedDailyData.map(([, data]) => data.dsChot), borderColor: 'var(--primary-: true, tension: 0.3 }]; this.charts.teamTrend.update(); },
            
            color)', backgroundColor: 'rgba(45, 124, 45, 0.1)', fillrenderSummaryTable: function(data, isFullTeamView, sortKey = 'chot', sortDir = 'desc: true, tension: 0.3 }]; this.charts.teamTrend.update(); },
            
            ') {
                const table = document.getElementById('staff-summary-table');
                const createRowHtml = (metricsrenderSummaryTable: function(data, isFullTeamView, sortKey = 'chot', sortDir = ', label, staffName, rowClass) => { const rateClass = metrics.tiLeChot > 0.1desc') {
                const table = document.getElementById('staff-summary-table');
                const createRowHtml ? 'bg-green' : (metrics.tiLeChot > 0.05 ? 'bg-yellow = (metrics, label, staffName, rowClass) => { const rateClass = metrics.tiLeChot > 0.1 ? 'bg-green' : (metrics.tiLeChot > 0.05' : ''); return `<tr class="${rowClass}" data-staff-name="${staffName || ''}"><td>${label}</td><td>${formatUtils.formatNumber(metrics.mess)}</td><td>${formatUtils.formatCurrency(metrics.cpqc ? 'bg-yellow' : ''); return `<tr class="${rowClass}" data-staff-name="${staffName ||)}</td><td>${formatUtils.formatNumber(metrics.don)}</td><td>${formatUtils.formatCurrency(metrics.chot ''}"><td>${label}</td><td>${formatUtils.formatNumber(metrics.mess)}</td><td>${formatUtils.formatCurrency(metrics.cpqc)}</td><td>${formatUtils.formatNumber(metrics.don)}</td><td>)}</td><td class="${rateClass}">${formatUtils.formatPercent(metrics.tiLeChot)}</td><td>${formatUtils.formatCurrency(metrics.giaMess)}</td><td>${formatUtils.formatCurrency(metrics.cps)}</td><td>${formatUtils.formatCurrency(metrics.chot)}</td><td class="${rateClass}">${formatUtils.formatPercent(metrics.tiLeChot)}</td><td>${formatUtils.formatCurrency(metrics.giaMess)}</td><td>${formatUtils.${formatUtils.formatPercent(metrics.cpDsRatio)}</td><td>${formatUtils.formatCurrency(metrics.giaTbDonformatCurrency(metrics.cps)}</td><td>${formatUtils.formatPercent(metrics.cpDsRatio)}</td><td>${format)}</td></tr>`; };
                const headerHtml = `<thead><tr><th class="sortable-header" data-sortUtils.formatCurrency(metrics.giaTbDon)}</td></tr>`; };
                const headerHtml = `<thead><tr><="name">Th√†nh vi√™n</th><th class="sortable-header" data-sort="mess">S·ªë Mess</th><thth class="sortable-header" data-sort="name">Th√†nh vi√™n</th><th class="sortable class="sortable-header" data-sort="cpqc">CPQC</th><th class="sortable-header" data-header" data-sort="mess">S·ªë Mess</th><th class="sortable-header" data-sort="-sort="don">S·ªë ƒê∆°n</th><th class="sortable-header" data-sort="chot">DScpqc">CPQC</th><th class="sortable-header" data-sort="don">S·ªë ƒê∆°n</th>< Ch·ªët</th><th class="sortable-header" data-sort="tiLeChot">T·ªâ l·ªáth class="sortable-header" data-sort="chot">DS Ch·ªët</th><th class="sort ch·ªët</th><th class="sortable-header" data-sort="giaMess">Gi√° Mess</th><th class="sortable-header" data-sort="tiLeChot">T·ªâ l·ªá ch·ªët</th><th class="sortable-header" data-sort="cps">CPS</th><th class="sortable-header" data-sort="cpDsable-header" data-sort="giaMess">Gi√° Mess</th><th class="sortable-header" data-sort="Ratio">%CP/DS</th><th class="sortable-header" data-sort="giaTbDon">Gi√° TBcps">CPS</th><th class="sortable-header" data-sort="cpDsRatio">%CP/DS</th> ƒê∆°n</th></tr></thead>`;
                let bodyHtml = '';
                if (isFullTeamView) { const member<th class="sortable-header" data-sort="giaTbDon">Gi√° TB ƒê∆°n</th></tr></thead>`;Stats = data.reduce((acc, r) => { (acc[r.ten] = acc[r.ten
                let bodyHtml = '';
                if (isFullTeamView) { const memberStats = data.reduce((acc] || []).push(r); return acc; }, {}); let memberMetrics = Object.keys(memberStats).map(, r) => { (acc[r.ten] = acc[r.ten] || []).push(r); returnname => ({ name, metrics: this.calculateMetrics(memberStats[name]) })); memberMetrics.sort((a, b acc; }, {}); let memberMetrics = Object.keys(memberStats).map(name => ({ name, metrics: this) => { const valA = sortKey === 'name' ? a.name : a.metrics[sortKey]; const.calculateMetrics(memberStats[name]) })); memberMetrics.sort((a, b) => { const valA = valB = sortKey === 'name' ? b.name : b.metrics[sortKey]; if (typeof valA === sortKey === 'name' ? a.name : a.metrics[sortKey]; const valB = sortKey === 'name 'string') return sortDir === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA); return sortDir === 'asc' ? valA - valB : valB - valA; }); this' ? b.name : b.metrics[sortKey]; if (typeof valA === 'string') return sortDir === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA); return.currentSummaryData = memberMetrics; let memberRowsHtml = memberMetrics.map(item => createRowHtml( sortDir === 'asc' ? valA - valB : valB - valA; }); this.currentSummaryData = memberitem.metrics, item.name, item.name, 'clickable-staff-row')).join(''); const totalMetrics = thisMetrics; let memberRowsHtml = memberMetrics.map(item => createRowHtml(item.metrics, item.name,.calculateMetrics(data); bodyHtml = `<tbody>${createRowHtml(totalMetrics, 'T·ªîNG C·ªòNG TEAM item.name, 'clickable-staff-row')).join(''); const totalMetrics = this.calculateMetrics(data); body', '', 'total-row')}${memberRowsHtml}</tbody>`; } 
                else { this.currentSummaryHtml = `<tbody>${createRowHtml(totalMetrics, 'T·ªîNG C·ªòNG TEAM', '', 'total-row')Data = []; const metrics = this.calculateMetrics(data); bodyHtml = `<tbody>${createRowHtml(metrics}${memberRowsHtml}</tbody>`; } 
                else { this.currentSummaryData = []; const metrics = this.calculate, data[0]?.ten || 'T·ªïng c·ªông', '', '')}</tbody>`; }
                table.innerHTML = headerMetrics(data); bodyHtml = `<tbody>${createRowHtml(metrics, data[0]?.ten || 'T·ªïngHtml + bodyHtml; table.querySelector(`#StaffReport th[data-sort="${sortKey}"]`)?.classList.add c·ªông', '', '')}</tbody>`; }
                table.innerHTML = headerHtml + bodyHtml; table.querySelector(`#Staff(sortDir === 'desc' ? 'sorted-desc' : 'sorted-asc');
            },
            
            renderDailyBreakdownTable: function(data, isFullTeamView, sortKey = 'dateObj', sortDirReport th[data-sort="${sortKey}"]`)?.classList.add(sortDir === 'desc' ? 'sorted-desc' : 'sorted-asc');
            },
            
            renderDailyBreakdownTable: function(data = 'desc') {
                const wrapper = document.getElementById('daily-breakdown-table-wrapper');
, isFullTeamView, sortKey = 'dateObj', sortDir = 'desc') {
                const wrapper                const createHeader = (isTeamView) => `<thead><tr><th class="sortable-header" data-sort=" = document.getElementById('daily-breakdown-table-wrapper');
                const createHeader = (isTeamView) => `dateObj">${isTeamView ? 'Ng√†y' : 'Ng√†y'}</th><th class="sortable-header" data-sort<thead><tr><th class="sortable-header" data-sort="dateObj">${isTeamView ? 'Ng√†y' : '="chot">DS Ch·ªët</th><th class="sortable-header" data-sort="don">S·ªëNg√†y'}</th><th class="sortable-header" data-sort="chot">DS Ch·ªët</th>< ƒê∆°n</th><th class="sortable-header" data-sort="mess">S·ªë Mess</th><th class="sortableth class="sortable-header" data-sort="don">S·ªë ƒê∆°n</th><th class="sortable-header"-header" data-sort="tiLeChot">T·ªâ l·ªá ch·ªët</th><th class="sortable-header" data-sort="cpqc">CPQC</th><th class="sortable-header" data- data-sort="mess">S·ªë Mess</th><th class="sortable-header" data-sort="tiLeChot">sort="cps">CPS</th></tr></thead>`;
                const createRowContent = (metrics) => { const rateClass = metrics.tiLeChot > 0.1 ? 'bg-green' : (metrics.tiLeChot >T·ªâ l·ªá ch·ªët</th><th class="sortable-header" data-sort="cpqc">CPQC 0.05 ? 'bg-yellow' : ''); return `<td>${formatUtils.formatCurrency(metrics.chot</th><th class="sortable-header" data-sort="cps">CPS</th></tr></thead>`;
                const createRowContent)}</td><td>${formatUtils.formatNumber(metrics.don)}</td><td>${formatUtils.formatNumber(metrics = (metrics) => { const rateClass = metrics.tiLeChot > 0.1 ? 'bg.mess)}</td><td class="${rateClass}">${formatUtils.formatPercent(metrics.tiLeChot)}</td>-green' : (metrics.tiLeChot > 0.05 ? 'bg-yellow' :<td>${formatUtils.formatCurrency(metrics.cpqc)}</td><td>${formatUtils.formatCurrency(metrics.cps ''); return `<td>${formatUtils.formatCurrency(metrics.chot)}</td><td>${formatUtils.formatNumber(metrics.)}</td>`; };
                const dailyGroupedData = data.reduce((acc, r) => { const datedon)}</td><td>${formatUtils.formatNumber(metrics.mess)}</td><td class="${rateClass}">${formatKey = new Date(r.ngay).toISOString().split('T')[0]; if (!acc[dateKey])Utils.formatPercent(metrics.tiLeChot)}</td><td>${formatUtils.formatCurrency(metrics.cpqc)} acc[dateKey] = { members: {}, dateObj: new Date(r.ngay) }; if (!acc[date</td><td>${formatUtils.formatCurrency(metrics.cps)}</td>`; };
                const dailyGroupedData =Key].members[r.ten]) acc[dateKey].members[r.ten] = []; acc[dateKey]. data.reduce((acc, r) => { const dateKey = new Date(r.ngay).toISOString().split('Tmembers[r.ten].push(r); return acc; }, {});
                this.currentDailyData = daily')[0]; if (!acc[dateKey]) acc[dateKey] = { members: {}, dateObj: new DateGroupedData; let dailyArray = Object.entries(dailyGroupedData).map(([dateKey, value]) => ({ date(r.ngay) }; if (!acc[dateKey].members[r.ten]) acc[dateKeyKey, dateObj: value.dateObj, metrics: this.calculateMetrics(Object.values(value.members).flat].members[r.ten] = []; acc[dateKey].members[r.ten].push(r); return acc()) }));
                dailyArray.sort((a, b) => { const valA = sortKey === 'date; }, {});
                this.currentDailyData = dailyGroupedData; let dailyArray = Object.entries(dailyObj' ? a.dateObj.getTime() : a.metrics[sortKey]; const valB = sortKeyGroupedData).map(([dateKey, value]) => ({ dateKey, dateObj: value.dateObj, === 'dateObj' ? b.dateObj.getTime() : b.metrics[sortKey]; return sortDir === ' metrics: this.calculateMetrics(Object.values(value.members).flat()) }));
                dailyArray.sort((desc' ? valB - valA : valA - valB; });
                let bodyHtml = dailyArray.map(a, b) => { const valA = sortKey === 'dateObj' ? a.dateObj.getTime() : a.metrics[sortKey]; const valB = sortKey === 'dateObj' ? b.dateObj.getTimeitem => { const rowHtml = `<tr class="daily-summary-row" data-date="${item.date() : b.metrics[sortKey]; return sortDir === 'desc' ? valB - valA : valAKey}"><td><i class="fas fa-chevron-right expand-icon"></i> ${formatUtils.formatDate - valB; });
                let bodyHtml = dailyArray.map(item => { const rowHtml = `<(item.dateKey)}</td>${createRowContent(item.metrics)}</tr>`; const detailsRow = `<trtr class="daily-summary-row" data-date="${item.dateKey}"><td><i class="fas fa-chevron-right expand-icon"></i> ${formatUtils.formatDate(item.dateKey)}</td>${ class="details-container-row" data-date="${item.dateKey}"><td colspan="7"></td></tr>`; returncreateRowContent(item.metrics)}</tr>`; const detailsRow = `<tr class="details-container-row" data isFullTeamView ? rowHtml + detailsRow : rowHtml.replace('<tr class="daily-summary-row-date="${item.dateKey}"><td colspan="7"></td></tr>`; return isFullTeamView ? row"', '<tr'); }).join('');
                wrapper.innerHTML = `<table>${createHeader(isFullTeamView)}<tbody>${bodyHtml}</tbody></table>`; wrapper.querySelector(`#StaffReport th[data-sort="${sortKey}"]`)?.classList.Html + detailsRow : rowHtml.replace('<tr class="daily-summary-row"', '<tr'); }).join('');
                add(sortDir === 'desc' ? 'sorted-desc' : 'sorted-asc');
            },
wrapper.innerHTML = `<table>${createHeader(isFullTeamView)}<tbody>${bodyHtml}</tbody></table>`; wrapper            
            renderNestedTable: function(container, dateKey, memberData, sortKey = 'chot', sortDir.querySelector(`#StaffReport th[data-sort="${sortKey}"]`)?.classList.add(sortDir === 'desc' = 'desc') {
                const createNestedHeader = () => `<thead><tr><th class="sortable-header ? 'sorted-desc' : 'sorted-asc');
            },
            
            renderNestedTable: function(container, dateKey, memberData, sortKey = 'chot', sortDir = 'desc') {
                const" data-sort="name">Th√†nh vi√™n</th><th class="sortable-header" data-sort=" createNestedHeader = () => `<thead><tr><th class="sortable-header" data-sort="name">Thchot">DS Ch·ªët</th><th class="sortable-header" data-sort="don">S·ªë ƒê∆°n</th><√†nh vi√™n</th><th class="sortable-header" data-sort="chot">DS Ch·ªët</th><th class="sortable-header" data-sort="tiLeChot">T·ªâ l·ªá ch·ªët</th></tr></thead>`;
                const createNestedRow = (metrics, name) => { const rateClass = metrics.tiLeth class="sortable-header" data-sort="don">S·ªë ƒê∆°n</th><th class="sortable-header" data-sort="tiLeChot">T·ªâ l·ªá ch·ªët</th></tr></thead>`;
                constChot > 0.1 ? 'bg-green' : (metrics.tiLeChot > 0 createNestedRow = (metrics, name) => { const rateClass = metrics.tiLeChot > 0.05 ? 'bg-yellow' : ''); return `<td>${name}</td><td>${formatUtils.format.1 ? 'bg-green' : (metrics.tiLeChot > 0.05 ? 'Currency(metrics.chot)}</td><td>${formatUtils.formatNumber(metrics.don)}</td><td class="${ratebg-yellow' : ''); return `<td>${name}</td><td>${formatUtils.formatCurrency(metrics.chot)}</td>Class}">${formatUtils.formatPercent(metrics.tiLeChot)}</td>`; };
                let memberArray = Object.entries<td>${formatUtils.formatNumber(metrics.don)}</td><td class="${rateClass}">${formatUtils.formatPercent(memberData).map(([name, records]) => ({ name, metrics: this.calculateMetrics(records) }));
(metrics.tiLeChot)}</td>`; };
                let memberArray = Object.entries(memberData).map(([                memberArray.sort((a, b) => { const valA = sortKey === 'name' ? aname, records]) => ({ name, metrics: this.calculateMetrics(records) }));
                memberArray.sort.name : a.metrics[sortKey]; const valB = sortKey === 'name' ? b.name((a, b) => { const valA = sortKey === 'name' ? a.name : a. : b.metrics[sortKey]; if (typeof valA === 'string') return sortDir === 'asc' ? valAmetrics[sortKey]; const valB = sortKey === 'name' ? b.name : b.metrics[sortKey.localeCompare(valB) : valB.localeCompare(valA); return sortDir === 'asc']; if (typeof valA === 'string') return sortDir === 'asc' ? valA.localeCompare( ? valA - valB : valB - valA; });
                const bodyHtml = memberArray.mapvalB) : valB.localeCompare(valA); return sortDir === 'asc' ? valA -(item => `<tr>${createNestedRow(item.metrics, item.name)}</tr>`).join('');
                container.innerHTML = `<div class="nested-table-container" data-date="${dateKey}"><table>${create valB : valB - valA; });
                const bodyHtml = memberArray.map(item => `NestedHeader()}<tbody>${bodyHtml}</tbody></table></div>`; container.querySelector(`#StaffReport th[data-sort="${sort<tr>${createNestedRow(item.metrics, item.name)}</tr>`).join('');
                container.innerHTML =Key}"]`)?.classList.add(sortDir === 'desc' ? 'sorted-desc' : 'sorted- `<div class="nested-table-container" data-date="${dateKey}"><table>${createNestedHeader()}<tbody>${bodyasc');
            },
            
            handleTableSort: function(event, tableType, dateKey = null)Html}</tbody></table></div>`; container.querySelector(`#StaffReport th[data-sort="${sortKey}"]`)?.classList.add(sortDir === 'desc' ? 'sorted-desc' : 'sorted-asc');
            },
            
 { const header = event.target.closest('.sortable-header'); if (!header) return; const sortKey = header.dataset.sort; if (!sortKey) return; let currentSortDir = 'desc'; if (header.classList.            handleTableSort: function(event, tableType, dateKey = null) { const header = event.targetcontains('sorted-desc')) { currentSortDir = 'asc'; } showLoader(); setTimeout(() => { if (table.closest('.sortable-header'); if (!header) return; const sortKey = header.dataset.sort; if (!sortType === 'staff-summary-table') { this.renderSummaryTable(this.fullReportData, true, sortKeyKey) return; let currentSortDir = 'desc'; if (header.classList.contains('sorted-desc')) {, currentSortDir); } else if (tableType === 'daily-breakdown') { this.renderDailyBreakdownTable currentSortDir = 'asc'; } showLoader(); setTimeout(() => { if (tableType === 'staff-summary-table(this.fullReportData, true, sortKey, currentSortDir); } else if (tableType === '') { this.renderSummaryTable(this.fullReportData, true, sortKey, currentSortDir); } elsenested' && dateKey) { const detailsRow = document.querySelector(`#StaffReport .details-container-row[data-date if (tableType === 'daily-breakdown') { this.renderDailyBreakdownTable(this.fullReportData, true='${dateKey}'] td`); this.renderNestedTable(detailsRow, dateKey, this.currentDailyData, sortKey, currentSortDir); } else if (tableType === 'nested' && dateKey) { const details[dateKey].members, sortKey, currentSortDir); } hideLoader(); }, 10); },
            
Row = document.querySelector(`#StaffReport .details-container-row[data-date='${dateKey}'] td            renderIndividualCharts: function(data) { const dailyData = Object.entries(data.reduce((acc,r) => { const date = formatUtils.formatDate(r.ngay); if (!acc[date]) acc[date] =`); this.renderNestedTable(detailsRow, dateKey, this.currentDailyData[dateKey].members, sort { mess: 0, don: 0, chot: 0, dateObj: new Date(r.ngKey, currentSortDir); } hideLoader(); }, 10); },
            
            renderIndividualCharts: function(dataay) }; acc[date].chot += r.dsChot; acc[date].don += r.so) { const dailyData = Object.entries(data.reduce((acc,r) => { const date = formatUtils.Don; acc[date].mess += r.soMessCmt; return acc; }, {})).sort((aformatDate(r.ngay); if (!acc[date]) acc[date] = { mess: 0,,b) => a[1].dateObj - b[1].dateObj).reduce((acc,[key,val]) don: 0, chot: 0, dateObj: new Date(r.ngay) }; acc => ({...acc, [key]:val}), {}); const sortedDates = Object.keys(dailyData); this.charts.line[date].chot += r.dsChot; acc[date].don += r.soDon; acc[date.data.labels = sortedDates; this.charts.line.data.datasets = [{ label: 'DS Ch].mess += r.soMessCmt; return acc; }, {})).sort((a,b) => a[·ªët', data: sortedDates.map(d => dailyData[d].chot), borderColor: 'var(--1].dateObj - b[1].dateObj).reduce((acc,[key,val]) => ({...acc,danger-color)', backgroundColor: 'rgba(231, 76, 60, 0.1)', fill [key]:val}), {}); const sortedDates = Object.keys(dailyData); this.charts.line.data.labels: true, tension: 0.3 }]; this.charts.line.update(); this.charts.combo.data.labels = sortedDates; this.charts.line.data.datasets = [{ label: 'DS Ch·ªët', data: = sortedDates; this.charts.combo.data.datasets = [ { type: 'bar', label: 'Doanh s·ªë', data: sortedDates.map(d => dailyData[d].chot), backgroundColor: 'var sortedDates.map(d => dailyData[d].chot), borderColor: 'var(--danger-color)', backgroundColor: 'rgba(231, 76, 60, 0.1)', fill: true, tension(--primary-color)', yAxisID: 'y' }, { type: 'line', label: 'T·ªâ l·ªá ch·ªët', data: sortedDates.map(d => (dailyData[d].mess > 0 ? dailyData[d].: 0.3 }]; this.charts.line.update(); this.charts.combo.data.labels = sortedDates; this.charts.combo.data.datasets = [ { type: 'bar', label: 'Dodon / dailyData[d].mess : 0) * 100), borderColor: 'var(--info-color)',anh s·ªë', data: sortedDates.map(d => dailyData[d].chot), backgroundColor: 'var tension: 0.3, yAxisID: 'y1' } ]; this.charts.combo.update(); },
        
            populateTeamFilter: function() { const teams = [...new Set(this.allData.(--primary-color)', yAxisID: 'y' }, { type: 'line', label: 'T·ªâ l·ªá ch·ªët', data: sortedDates.map(d => (dailyData[d].mess > 0 ? dailyData[d].map(r => r.team))].sort(); document.getElementById('team-filter-staff').innerHTML = teams.map(t => `<option value="${t}">${t}</option>`).join(''); },
            updateStaffFilter: function()don / dailyData[d].mess : 0) * 100), borderColor: 'var(--info-color)', { const selectedTeams = Array.from(document.getElementById('team-filter-staff').selectedOptions).map(opt => tension: 0.3, yAxisID: 'y1' } ]; this.charts.combo.update(); },
        
            populateTeamFilter: function() { const teams = [...new Set(this.allData. opt.value); const staffSelect = document.getElementById('staff-filter-staff'); staffSelect.innerHTML = ''; if (map(r => r.team))].sort(); document.getElementById('team-filter-staff').innerHTML = teams.map(selectedTeams.length === 0) { staffSelect.innerHTML = '<option value="">-- Vui l√≤ng ch·ªçn Teamt => `<option value="${t}">${t}</option>`).join(''); },
            updateStaffFilter: function() { const selectedTeams = Array.from(document.getElementById('team-filter-staff').selectedOptions).map(opt => --</option>'; return; } staffSelect.innerHTML = '<option value="__FULL_TEAM__">-- XEM B opt.value); const staffSelect = document.getElementById('staff-filter-staff'); staffSelect.innerHTML = ''; if (selected√ÅO C√ÅO TO√ÄN TEAM --</option>'; const staffInTeams = this.allData.filter(r =>Teams.length === 0) { staffSelect.innerHTML = '<option value="">-- Vui l√≤ng ch·ªçn Team -- selectedTeams.includes(r.team)); const staffNames = [...new Set(staffInTeams.map(r => r</option>'; return; } staffSelect.innerHTML = '<option value="__FULL_TEAM__">-- XEM B.ten))].sort(); staffSelect.innerHTML += staffNames.map(name => `<option value="${name}">${name}</option>`).join(''); },
            setDefaultDates: function() { const today = new Date(); const firstDayOfMonth =√ÅO C√ÅO TO√ÄN TEAM --</option>'; const staffInTeams = this.allData.filter(r => selectedTeams.includes(r.team)); const staffNames = [...new Set(staffInTeams.map(r => r new Date(today.getFullYear(), today.getMonth(), 1); const formatDate = d => d.toISOString().split('T.ten))].sort(); staffSelect.innerHTML += staffNames.map(name => `<option value="${name}">${')[0]; document.getElementById('start-date-staff').value = formatDate(firstDayOfMonth); document.getElementById('end-date-staff').value = formatDate(today); },
        };

        document.getElementById("defaultOpen").clickname}</option>`).join(''); },
            setDefaultDates: function() { const today = new Date(); const firstDayOfMonth =();
    });
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>B√°o C√°o MKT LumiGlobal</title>
  <style>
    :root {
      --primary-color: #0056b3;
      --primary-color-dark: #003d82;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --info-color: #17a2b8;
      --light-gray: #f8f9fa;
      --medium-gray: #ddd;
      --dark-gray: #333;
      --border-radius: 6px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--light-gray);
      color: var(--dark-gray);
      line-height: 1.6;
    }
    
    .container {
      max-width: 95vw;
      margin: 2rem auto;
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }
    
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .logo {
      height: 60px;
      margin-right: 1.5rem;
    }
    
    h1 {
      color: var(--primary-color);
      margin: 0;
      font-weight: 600;
      font-size: 2rem;
    }
    
    .table-wrapper {
      overflow-x: auto;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      table-layout: fixed; /* Gi√∫p ki·ªÉm so√°t chi·ªÅu r·ªông c·ªôt t·ªët h∆°n */
    }
    
    th, td {
      border: 1px solid var(--medium-gray);
      padding: 0.8rem 1rem;
      text-align: left;
      vertical-align: middle;
      white-space: nowrap;
      word-wrap: break-word; /* H·ªó tr·ª£ ng·∫Øt t·ª´ n·∫øu c·∫ßn */
    }
    
    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    tr:nth-child(even) { background-color: var(--light-gray); }
    tr:hover { background-color: #e9ecef; }
    
    input, textarea, button, select {
      box-sizing: border-box;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
      width: 100%;
      font-family: inherit;
      font-size: 0.95rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    td input, td select {
        white-space: normal; /* Cho ph√©p text wrap */
        height: auto;       /* Chi·ªÅu cao t·ª± ƒë·ªông theo n·ªôi dung */
        min-height: 38px;   /* ƒê·∫£m b·∫£o chi·ªÅu cao t·ªëi thi·ªÉu ƒë·ªÉ giao di·ªán kh√¥ng b·ªã v·ª° */
    }
    
    input:focus, select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2);
        outline: none;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover { background-color: var(--primary-color-dark); }
    
    .action-buttons { display: flex; gap: 0.5rem; justify-content: center; }
    .action-buttons button { padding: 0.4rem 0.6rem; }
    
    .add-row-btn { 
      background-color: var(--success-color); 
      margin-bottom: 1.5rem; 
      padding: 0.75rem 1.5rem;
      font-size: 1.1rem;
    }
    .add-row-btn:hover { background-color: #218838; }
    
    .submit-btn { 
      background-color: var(--danger-color); 
      margin-top: 1.5rem; 
      padding: 0.75rem 1.5rem; 
      font-size: 1.1rem; 
    }
    .submit-btn:hover { background-color: #c82333; }
    
    #responseMessage { 
      margin-top: 1.5rem; 
      padding: 1rem; 
      border-radius: var(--border-radius); 
      text-align: center; 
      font-weight: bold; 
    }
    .success { background-color: #d4edda; color: #155724; }
    .error { background-color: #f8d7da; color: #721c24; }
    .error-cell { background-color: #f8d7da !important; border: 1px solid var(--danger-color) !important; }

    .hidden { display: none; }
    .addSimilar { background-color: var(--info-color); }
    .addSimilar:hover { background-color: #138496; }
    .removeRow { background-color: #6c757d; }
    .removeRow:hover { background-color: #5a6268; }
    
    .input-container { display: flex; align-items: center; gap: 0.5rem; }
    .input-container input { flex-grow: 1; }
    .input-container .addSimilar {
        flex-shrink: 0;
        width: 38px;
        height: 38px;
        padding: 0;
        font-size: 1.2rem;
    }

    .status {
      background: #e9ecef;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 14px;
      color: #495057;
    }

    /* [ƒê√É TH√äM] CSS ƒë·ªÉ ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông c·ªôt */
    #dataTable th:nth-child(1), /* H√†nh ƒë·ªông */
    #dataTable td:nth-child(1) {
      width: 80px;
    }
    
    #dataTable th:nth-child(6), /* Th·ªã tr∆∞·ªùng */
    #dataTable td:nth-child(6),
    #dataTable th:nth-child(8), /* TKQC */
    #dataTable td:nth-child(8),
    #dataTable th:nth-child(9), /* CPQC */
    #dataTable td:nth-child(9),
    #dataTable th:nth-child(10), /* Via log */
    #dataTable td:nth-child(10),
    #dataTable th:nth-child(11), /* S·ªë Mess+Cmt */
    #dataTable td:nth-child(11) {
      width: 120px; /* ƒê·∫∑t chi·ªÅu r·ªông c·ªë ƒë·ªãnh nh·ªè h∆°n cho c√°c c·ªôt n√†y */
    }

    #dataTable th:nth-child(7), /* Page */
    #dataTable td:nth-child(7) {
      width: 30%; /* Cho ph√©p c·ªôt Page chi·∫øm m·ªôt ph·∫ßn l·ªõn kh√¥ng gian */
      min-width: 300px; /* ƒê·∫£m b·∫£o c·ªôt c√≥ chi·ªÅu r·ªông t·ªëi thi·ªÉu h·ª£p l√Ω */
      white-space: normal; /* Quan tr·ªçng: cho ph√©p n·ªôi dung trong √¥ n√†y xu·ªëng d√≤ng */
    }
    /* K·∫øt th√∫c kh·ªëi CSS ƒë√£ th√™m */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2Ff930e667.%E1%BA%A2nh.025539.jpg" alt="LumiGlobal Logo" class="logo">
      <h1>B√°o C√°o MKT LumiGlobal</h1>
    </div>

    <div class="status" id="status">ƒê√£ s·∫µn s√†ng - Click "Th√™m d√≤ng tr·ªëng" ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>

    <button id="addRowBtn" type="button" class="add-row-btn">‚ûï Th√™m d√≤ng tr·ªëng</button>
    
    <form id="dataForm" novalidate>
      <div class="table-wrapper">
        <table id="dataTable">
          <thead>
            <tr>
              <th>H√†nh ƒë·ªông</th>
              <th>T√™n</th>
              <th>Ng√†y</th>
              <th>Ca</th>
              <th>S·∫£n ph·∫©m</th>
              <th>Th·ªã tr∆∞·ªùng</th>
              <th>Page</th>
              <th>TKQC</th>
              <th>CPQC</th>
              <th>Via log</th>
              <th>S·ªë Mess+Cmt</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Rows will be added here -->
          </tbody>
        </table>
      </div>
      <button type="submit" id="submitBtn" class="submit-btn">üöÄ G·ª≠i b√°o c√°o</button>
    </form>

    <div id="responseMessage"></div>
  </div>

  <script>
    // Data
    const employeeList = ["Nguy·ªÖn ƒê·ª©c Anh","Nguy·ªÖn VƒÉn VI·ªát","L√¢m Th·ªã Thu Th·∫£o","Nguy·ªÖn Nam Kh√°nh","Nguy·ªÖn Quang Minh","Nguy·ªÖn ƒê·ª©c Anh","Nguy·ªÖn Danh Nam","Nguy·ªÖn VƒÉn Vi·ªát","L√¢m Th·ªã Thu Th·∫£o","Nguy·ªÖn Quang Minh","Nguy·ªÖn Duy Hi·∫øu","Ph·∫°m Ti·∫øn Th√†nh","L√™ ƒê√¨nh To·∫£n","Tr·∫ßn Qu·ªëc Kh·∫£i","M·∫°nh C∆∞·ªùng","Nguy·ªÖn Th·ªã Hi·∫øu","V≈© Vi·∫øt Anh","L·ª•c Tr·∫ßn Minh Tr√≠","ƒêo√†n Ng·ªçc Hu√¢n","Nguy·ªÖn Hi·ªÅn L∆∞∆°ng","Tr·∫ßn Huy H√πng","Nguy·ªÖn Anh Tu·∫•n","Tr·∫ßn Ti·∫øn","Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh","Nguy·ªÖn Quang Tr∆∞·ªùng"];
    const productList = ["Kem body","CF FG","CB BAKU","Bakuchiol","C√† ph√™","N√°m","K·∫πo D√¢u","Serum S√¢m","K·∫πo D√¢u New","Body TBN","Baku TBN","DG","K·∫πo T√°o"];
    const marketList = ["Nh·∫≠t","H√†n","Canada","US","√öc","Anh"];
    const shiftList = ["H·∫øt ca","Gi·ªØa ca","Ca Chi·ªÅu"];
    
    const tkqcData = { "L√™ ƒê√¨nh To·∫£n": ["lumi hn 07(1)","tcm 365(1)","tcm 386(1)","tcm 389-b(1)","tcm 427-b"], "L·ª•c Tr·∫ßn Minh Tr√≠": ["tcm 399-b","tcm 456"], "M·∫°nh C∆∞·ªùng": ["lumi hn 04","lumi hn 06","tcm 372-b","tcm 376-b","tcm 378(1)","tcm 394(1)","tcm 407(1)","tcm 418(1)","tcm 442(1)"], "Nguy·ªÖn Anh Tu·∫•n": ["lumi hn 11","tcm  395"], "Nguy·ªÖn Hi·ªÅn L∆∞∆°ng": ["lumi hn 13(1)","tcm 410-b(1)","tcm 430-b","tcm 434-b(1)"], "Nguy·ªÖn Quang Tr∆∞·ªùng": ["lumi hn 09"], "Nguy·ªÖn Th·ªã Hi·∫øu": ["lumi hn 10","tcm 381(1)","tcm 406(1)","tcm 413-b","tcm 440(1)","tcm 443(1)"], "Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh": ["lumi hn 08 hold"], "Ph·∫°m Ti·∫øn Th√†nh": ["lumi hn 05(1)","lumi hn 14(1)","tcm 300","tcm 393(1)","tcm 431(1)","tcm 449(1)"], "Tr·∫ßn Huy H√πng": ["lumi hn 01","tcm 429-b(1)","tcm 438(1)"], "Tr·∫ßn Qu·ªëc Kh·∫£i": ["lumi hn 02(1)","lumi hn 12","tcm 369-b(1)","tcm 380(1)","tcm 387(1)","tcm 455"], "Tr·∫ßn Ti·∫øn": ["tcm 426-b"], "V≈© Vi·∫øt Anh": ["tcm 390","tcm 450(1)"], "ƒêo√†n Ng·ªçc Hu√¢n": ["lumi hn 03(1)","tcm 400-b(1)"] };
    const pageData ={
  "Tr·∫ßn Qu·ªëc Kh·∫£i": [
    " FitGum 20X Collagen Chia Coffee - JAPAN - 100% FDA 01",
    "Body Lotion Venature Glutathione - CA -100% FDA",
    "Body Lotion Venature Glutathione - JAPAN -100% FDA",
    "Body Lotion Venature Glutathione - JAPAN -100% FDA 01",
    "Body Lotion Venature Glutathione - Korea -100% FDA",
    "Body Lotion Venature Glutathione - US -100% FDA",
    "FitGum 20X Collagen Chia Coffee - JAPAN - 100% FDA",
    "FitGum 20X Collagen Chia Coffee - Korea - 100% FDA",
    "FitGum 20X Collagen Chia Coffee - US - 100% FDA",
    "Serum Bakuchiol genuine product - CA - INC",
    "Serum Bakuchiol genuine product - US - INC",
    "Venature Bakuchiol Retinol - Canada - 100% FDA",
    "Venature Bakuchiol Retinol - JAPAN - 100% FDA",
    "Venature Bakuchiol Retinol - JAPAN - 100% FDA 1",
    "Venature Bakuchiol Retinol - Korea - 100% FDA",
    "Venature Bakuchiol Retinol - US - 100% FDA",
    "Venature Ginseng 24K Gold Serum - JAPAN -100% FDA",
    "Venature Ginseng Serum Gold 24K - US -100% FDA",
    "Venature Glutathione Body Lotion - Australia -100% FDA",
    "Vicky Belo Bakuchiol retinol genuine product - CA",
    "Vicky Belo Bakuchiol retinol genuine product - US"
  ],
  "Tr·∫ßn Huy H√πng": [
    "50X CA Store Legit - Body Lotion Venature Glutathione",
    "50X JAPAN Store Legit - Body Lotion Venature Glutathione",
    "50X US Store Legit - Body Lotion Venature Glutathione ",
    "AUS Store Legit - Venature Bakuchiol ",
    "Bakuchiol Retinol Number 01 EU: Bright, smooth, flawless skin",
    "Bakuchiol Retinol Serum - Natural Skin Care - Canada",
    "Bloom Collagen Coffee INC - Health Tips For Canada ",
    "Canada - Glutahione Collagen Glow Strawberry - INC",
    "Canada Glutathione Collagen Store Legit - INC ",
    "Dr Willie Ong & Liza - Healthy Tip Daily in USA",
    "Dr. Hancy Melasma Cream In USA- Form Beauty",
    "Dr. Hancy Melasma Remover",
    "Dr. Hancy Melasma Remover AUS INC",
    "Dr. Hancy Melasma Remover CA INC",
    "Dr. Willie Ong - Healthy Life In US",
    "Dr. Williee & Lizza Ong - Health Tips For Canada",
    "Dr.Alvin Franciso - Healthy Tips INC - EU ",
    "EU Glutathion Collagen Glow Store - Whiten Skin",
    "EU Glutathion Collagen Glow Store Legit - INC",
    "EU Glutathione Collagen Store Legit - INC",
    "EU INC ùëÆùíçùíñùíïùíÇùíïùíâùíäùíêùíèùíÜ ùë™ùíêùíçùíçùíÇùíàùíÜùíè ùëÆùíñùíéùíéùíäùíÜùíî - Whiten Skin ",
    "Fitgum Collagen Chia Coffee - Japan Store Legit",
    "Fitgum Collagen Chia Coffee - US Store Legit ",
    "Genuine Japanese Cosmetics In CA",
    "Glutathion Collagen Glow - EU INC",
    "Glutathione Collagen Glow - Natural Cosmetics in Canada",
    "Glutathione Collagen Glow In CA - Inc",
    "Glutathione Collagen Glow Korea INC",
    "Glutathione Collagen in Korea Inc ",
    "INC Glutathione Collagen In Canada ",
    "INC Glutathione Collagen Store In UK ",
    "Japan Venature Bakuchiol & Cream - Store Legit",
    "Korea SuperGummy - Barley Apple Cider Vitamins - Store Legit",
    "Korea Venature Bakuchiol - Store Legit ",
    "Nature Glow Glutathione Collagen AUS INC",
    "Nature Glow Glutathione Collagen CA INC",
    "Nature Glow Glutathione Collagen EU INC",
    "Nature Glow Glutathione Collagen strawberry - INC",
    "Nature Glutathione Collagen Store In US ",
    "Nugen Bloom Collagen Coffee In Australia",
    "Nugen Bloom Collagen Coffee In US",
    "Nugen Bloom Collagen Coffee INC - Health Tips For Canada ",
    "OfficiaI Store - Nature Glutathione Collagen CA INC",
    "OfficiaI Store - Nature Glutathione Collagen EU INC",
    "OfficiaI Store - Nature Glutathione Collagen INC US",
    "RadiantSkin Beauty Venature Bakuchiol Retinol In USA",
    "Store US - Nature Glutathione Collagen",
    "UK Glutathione Collagen Store Legit - INC",
    "US Glutathione Collagen Glow INC  ",
    "US Legit Melasma Treatment Cream - DR.Hancy ",
    "US Store Legit - Body Lotion Venature Glutathione 50X ",
    "US SuperGummy - Barley Apple Cider Vitamins - Store Legit",
    "US Venature Bakuchiol - Store Legit ",
    "Venature Bakuchiol - Store Legit Canada ",
    "Venature Bakuchiol retinol CAD INC",
    "Venature Bakuchiol retinol US INC\n",
    "Whiten Skin Melasma Cream In AU",
    "Whiten Skin Venature Bakuchiol Retinol In CA",
    "Whiten Skin Venature Bakuchiol Retinol In EU"
  ],
  "Nguy·ªÖn Th·ªã Hi·∫øu": [
    "Anna Store - Venature Bakuchiol Retinol In Japan ",
    "Anna Store 2 In JP - Venature Glutathione Body Lotion  \n",
    "Anna Store Genuine In US - Body Lotion Venature Glutathione  \n",
    "Anna Store In AU - Venature Bakuchiol Retinol Serum And Cream",
    "Anna Store in AU - Venature Glutathione 50X Body Lotion  \n",
    "Anna Store In CA - Serum & Cream Venature Bakuchiol ",
    "Anna Store In JP - Venature Ginseng Gold Serum \n",
    "Anna Store In JP - Venature Glutathione Body Lotion \n",
    "Anna Store In Korea - Venature Glutathione 50X Body Lotion ",
    "Anna Store in US - Body Lotion Venature Glutathione ",
    "Anna Store In US - Ginseng Serum Gold 24K \n",
    "Anna Store In USA - Venature Bakuchiol Retinol",
    "Anna Store Korea - Barley Apple Cider Vitamins ",
    "Anna Store USA - Gummy Apple Cider Vingegar Barley ",
    "Bakuchiol Retinol Serum - Beauty Cosmestic USA ",
    "Bakuchiol Retinol Serum & Cream - Beauty Magic Store CA",
    "Bakuchiol Retinol Serum & Cream - Beauty Magic Store Japan",
    "Bakuchiol Retinol Serum & Cream - Beauty Magic Store Kr",
    "Bakuchiol Retinol Serum & Cream - Beauty Magic Store US",
    "Barley Apple Cider Gummy In USA- Anna Store",
    "Body Lotion Venature Glutathione 50X Tone-Up Canada- Anna Store \n",
    "Collagen Chia Coffee-Fitgum In Korea - Anna Store \n",
    "Dr HANCY Japanese Melasma Cream In CA - Anna Store",
    "Dr Hancy Premium Melasma Cream In AU- Anna Store ",
    "Fitgum 20X Collagen In US- Anna Store \n",
    "Fitgum Collagen Chia Coffee - Anna Store In JP \n",
    "Gummy Barley Apple Cider- Anna Store In Japan ",
    "Loci√≥n corporal con Glutati√≥n Venature- Anna Store In USA \n",
    "Melasma Cream.USA - Anna Store \n",
    "Supergummy Apple Cider Barley - Magic Store - JP",
    "Supergummy Apple Cider Barley - Nature - Health JP",
    "Supergummy Apple Cider Barley - Nature - Health Kr",
    "Supergummy Apple Cider Barley - Nature - Healthy",
    "Supergummy Apple Cider Barley - Nature - Healthy US ",
    "Venature Bakuchiol Retinol in Kr - Anna Store ",
    "Venature Body Lotion In US - Anna Store \n",
    "Venature Ginseng Gold Serum- Anna Store In US ",
    "Venature Glutathione 50X Body Lotion Genuine In US- Anna Store \n",
    "Venature Glutathione Body Lotion - Beauty Magic Australia ",
    "Venature Glutathione Body Lotion - Beauty Magic CA ",
    "Venature Glutathione Body Lotion - Beauty Magic Korea",
    "Venature Glutathione Body Lotion - Beauty Magic US",
    "Venature Glutathione Body Lotion - Beauty Magic USA "
  ],
  "Nguy·ªÖn Hi·ªÅn L∆∞∆°ng": [
    "Bakuchiol Retinol Anti-Aging Serum In US - Natural Products  ",
    "Bakuchiol Retinol In Australia - Beauty Support",
    "Bakuchiol Retinol In Canada - Beauty Support",
    "Bakuchiol Retinol In Canada 01 - Beauty Support",
    "Bakuchiol Retinol In Japan - Beauty Support ",
    "Bakuchiol Retinol In Japan 01 - Beauty Support  ",
    "Bakuchiol Retinol In Japan 02 - Beauty Support",
    "Bakuchiol Retinol In Korea - Beauty Support",
    "Bakuchiol Retinol In US - Beauty Support",
    "Bakuchiol Retinol In US 01 - Beauty Support ",
    "Bakuchiol Retinol Serum - Radiant Skin Care Canada ",
    "Bakuchiol Retinol Serum - Radiant Skin Care USA",
    "Bakuchiol Retinol Serum & Cream - Skin Sciences Korean 01",
    "Bakuchiol Retinol Serum + Cream in Korea - Beautiful Flawless",
    "Bakuchiol Retinol Serum + Cream in Korea - Beautiful Flawless No.1",
    "Bakuchiol Retinol Serum In US - Natural Products \n",
    "Barley Apple Cider Vitamins In US - Healthy support",
    "Dr Hancy In AU - Beautiful Flawless",
    "Dr Hancy In AU - Beautiful Flawless.",
    "Dr. Hancy Japan Melasma Cream - Skin Sciences USA",
    "Dr. Hancy Japan Melasma Cream In Australia - Beauty Support  ",
    "Dr. Hancy Japan Melasma Cream In Canada - Beauty Support ",
    "Dr. Hancy Japan Melasma Cream In US - Beauty Support",
    "Dr. Hancy Japan Melasma Cream In US - Radiant Beauty",
    "DR. Hancy Melasma Remover In CA - Skin Sciences",
    "Dr.Hancy Melasma Remover In CA - Natural Products  \n",
    "Dr.Hancy Melasma Remover In US - Natural Products",
    "Fitgum Collagen Chia Coffee - Beauty Support In Korea ",
    "Fitgum Collagen Chia Coffee In Japan - Beauty Support",
    "Fitgum Collagen Chia Coffee In USA - Beauty Support ",
    "Genuine Bakuchiol Retinol Anti-Aging Serum in CA: Natural Products",
    "Glutathione Collagen Glow In AU",
    "Glutathione Collagen Glow In Canada",
    "Glutathione Collagen Glow In Canada - Beauty Support ",
    "Glutathione Collagen Glow In Japan",
    "Glutathione Collagen Glow In JaPan - Beauty Support",
    "Glutathione Collagen Glow In Korea ",
    "Glutathione Collagen Glow In Korea - Beauty Support",
    "Glutathione Collagen Glow In Us ",
    "Glutathione Collagen Glow In Us - INC ",
    "Japanese Melasma Cream Beautiful Flawless In Canada ",
    "Japanese Melasma Cream Beautiful Flawless No.1 In USA",
    "ùë¥ùíÜùíçùíÇùíîùíéùíÇ ùë™ùíìùíÜùíÇùíé ùë∞ùíè ùë™ùë® - Make Beautiful Flawless",
    "Nature Glow Glutathione Collagen strawberry - INC",
    "Nature Glow Glutathione Collagen strawberry - INC - USA ",
    "Venature Bakuchiol Retinol IN canada - beautiful natural skin",
    "Venature Bakuchiol Retinol IN US - beautiful natural skin",
    "Venature Glutathione Body Lotion - Beauty Support In Canada",
    "Venature Glutathione Body Lotion - Beauty Support In Japan",
    "Venature Glutathione Body Lotion - Beauty Support In USA",
    "Venature Glutathione Body Lotion In Australia - Beauty Support"
  ],
  "ƒêo√†n Ng·ªçc Hu√¢n": [
    "Bakuchiol Retinol in AU.inc - Skin rejuvenation store",
    "Bakuchiol Retinol In Canada - Skin rejuvenation store",
    "Bakuchiol Retinol In Canada.inc - Skin rejuvenation store",
    "Bakuchiol Retinol In Korea - Skin rejuvenation store",
    "Bakuchiol Retinol In US - Skin rejuvenation store",
    "Bakuchiol Retinol Serum - Canada - Beautyful Flawless .",
    "Bakuchiol Retinol Serum & Cream - Skin Sciences USA",
    "Collagen Coffee 20X - Rejuvenation Store in the Japan",
    "Collagen Coffee 20X - Rejuvenation Store in the Korea",
    "Collagen Coffee 20X - Rejuvenation Store in the USA",
    "Dr. Hancy Japan Melasma Cream in Canada - Top 1 skin care reviews",
    "Dr. Hancy Japan Melasma Cream in USA - Top 1 skin care reviews",
    "Glutathione 50x Tone Up Body Lotion - Skin rejuvenation store US",
    "Venature Ginseng Gold 24K Serum US. INC - Skin rejuvenation store",
    "Venature Glutathione Body Lotion - top skin care reviews in Korea",
    "Venature Glutathione Body Lotion - top skin care reviews in USA"
  ],
  "M·∫°nh C∆∞·ªùng": [
    "Bakuchiol Retinol Serum - Beauty Skin Australia",
    "Bakuchiol Retinol Serum - Beauty Skin Canada",
    "Bakuchiol Retinol Serum - Beauty Skin EU",
    "Bakuchiol Retinol Serum - Beauty Skin Japan",
    "Bakuchiol Retinol Serum - Beauty Skin US",
    "Bakuchiol Retinol Serum - Health And Beauty Australia",
    "Bakuchiol Retinol Serum - Health And Beauty Canada",
    "Bakuchiol Retinol Serum - Health and beauty eu",
    "Bakuchiol Retinol Serum - Skin House AU",
    "Bakuchiol Retinol Serum - Skin House Canada",
    "Bakuchiol Retinol Serum - Skin House EU",
    "Bakuchiol Retinol Serum - Skin House USA",
    "Bakuchiol Retinol Serum - SkinHouse USA",
    "Bakuchiol Retinol Serum.USA - Healthy tips",
    "Fitgum 20X Collagen Chia Coffee Korea - Healthy Tips  ",
    "Fitgum Collagen Chia Coffee Japan - Healthy Tips",
    "Fitgum Collagen Chia Coffee USA - Healthy Tips",
    "Glutathione Collagen Glow - Beauty Skinn Japan",
    "Glutathione Collagen Glow - Skin Beauty Australia 03",
    "Glutathione Collagen Glow In AU",
    "Glutathione Collagen Glow In Canada",
    "Glutathione Collagen Glow in JAPAN - Healthy tips ",
    "Glutathione Collagen Glow Store Canada - Beauty Skin\n",
    "Glutathione Collagen Glow Store In Canada",
    "Glutathione Collagen Glow Store in Korea",
    "Glutathione Collagen Gummies - No.1 Skin Beauty in USA",
    "Glutathione Collagen Store in Australia",
    "Glutathione Collagen Store in Canada",
    "Glutathione Collagen Store in Japan",
    "Glutathione Collagen Store in Korea",
    "Glutathione Collagen Store US - Beauty Skin",
    "Japan Melasma Cream Express. Canada - Healthy Tips",
    "Japanese Melasma Cream - Dorae Store CA",
    "Melasma Cream Canada - Health And Beauty",
    "Melasma Cream EU - Health And Beauty",
    "Melasma Cream.AU - No. 1 Skin Care Cosmetics",
    "Melasma Cream.CA - No. 1 Skin Care Cosmetics ",
    "Melasma Cream.USA - Healthy Tips",
    "US Venature Glutathione Body Lotion - Beauty Skin ",
    "Venature Bakuchiol Retinol - Japan's No. 1 Skin Care Cosmetic",
    "Venature Bakuchiol Retinol - Korea's No. 1 Skin Care Cosmetic",
    "Venature Bakuchiol Retinol - Natural Cosmetics US",
    "Venature Bakuchiol Retinol - ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ú‡∏¥‡∏ß‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1 ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ",
    "Venature Glutathione Body Lotion - Online Shop in US"
  ],
  "Nguy·ªÖn Quang Tr∆∞·ªùng": [
    "Bakuchiol Retinol Serum - Online Shop in Japan ",
    "Bakuchiol Retinol Serum - Online Shop USA ",
    "Bakuchiol Retinol Serum & Cream - Online Shop in EU  ",
    "Barley Apple Cider Vitamins In US - Online Shop ",
    "Dr Willie 0ng Bloom Coffee Colagen in U.S",
    "Dr. Vicki BeI0 - Online Shop in US ",
    "Fitgum Collagen Chia Coffee - Online Shop in Korea ",
    "Fitgum Collagen Chia Coffee - Online Shop in US",
    "Glutathione Collagen Glow in Japan - Online Shop ",
    "Glutathione Collagen Glow in Japan - Online Shop ",
    "Glutathione Collagen Store in Australia - Online Shop",
    "Glutathione Collagen Store in Canada - Online Shop ",
    "Glutathione Collagen Store in Germany - Online Shop ",
    "Glutathione Collagen Store in Japan INC - Online Shop ",
    "Glutathione Collagen Store in Korea - Online Shop ",
    "Glutathione Collagen Store in US - Online Shop",
    "Japanese Melasma Cream - Online Shop AU ",
    "Japanese Melasma Cream - Online Shop CA ",
    "Nugen Bloom Collagen Coffee Global 02 ",
    "Nugen Bloom Collagen Coffee In Australia ",
    "Nugen Bloom Collagen Coffee in Canada  ",
    "Nugen Bloom Collagen Coffee in Germany ",
    "Nugen Bloom Collagen Coffee In USA ",
    "Venature Bakuchiol Retinol Serum - Online Shop in Canada",
    "Venature Bakuchiol Retinol Serum - Online Shop in EU ",
    "Venature Bakuchiol Retinol Serum - Online Shop in US ",
    "Venature Bakuchiol Retinol Serum in Australia - Online Shop",
    "Venature Glutathione Body Lotion 50x Tone Up Canada - Beauty & Health \n",
    "Venature Glutathione Body Lotion in Japan - Beauty & Health  \n",
    "Venature Glutathione Body Lotion in Korea - Beauty & Health \n",
    "Venature Glutathione Body Lotion in US - Beauty & Health \n"
  ],
  "Ph·∫°m Ti·∫øn Th√†nh": [
    "Bakuchiol Retinol Serum - Top Skincare Store AU",
    "Bakuchiol Retinol Serum - Top Skincare Store CA ",
    "Bakuchiol Retinol Serum - Top Skincare Store EU ",
    "Bakuchiol Retinol Serum - Top Skincare Store US ",
    "Bakuchiol Retinol Serum - Top Skincare Store USA",
    "Bakuchiol Retinol Serum + Cream - Top Skincare Store US ",
    "Barley Apple Cider Vitamins Gummies - Top Health Central Canada  ",
    "Barley Apple Cider Vitamins Gummies - Top Health Central USA ",
    "Dr. Hancy Melasma Remover - Top Skincare Store US ",
    "Dr.Hancy Melasma Remover - Top Skincare CA ",
    "Dr.Hancy Melasma Remover - Top Skincare Store Australia ",
    "Dr.Hancy Melasma Remover - Top Skincare Store EU ",
    "Fitgum Collagen Chia Coffee - Top Health Central Japan",
    "Fitgum Collagen Chia Coffee - Top Health Central Korea",
    "Fitgum Collagen Chia Coffee - Top Health Central USA ",
    "Ginseng Serum Gold 24k - Lumi Central USA",
    "Glutathione 50x Tone Up Body Lotion - Top Skincare Store AU",
    "Glutathione 50x Tone Up Body Lotion - Top Skincare Store Canada",
    "Glutathione 50x Tone Up Body Lotion - Top Skincare Store USA",
    "Glutathione Body Lotion - Top Skincare Store USA",
    "Glutathione Collagen Glow - TopSkincare Store EU ",
    "Glutathione Collagen Glow - TopSkincare Store US ",
    "Glutathione Collagen Glow CA - TopSkincare Store ",
    "Glutathione Collagen Glow EU - TopSkincare Store ",
    "Loci√≥n Corporal Iluminadora con Glutati√≥n 50x - Lumi Central USA",
    "Organic Hair Growth Shampoo - Lumi Central USA "
  ],
  "Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh": [
    "Bakuchiol Retinol Serum + Cream CA - Genuine Cosmetics",
    "Bakuchiol Retinol Serum + Cream in Japan - Genuine Cosmetics ",
    "Bakuchiol Retinol Serum + Cream in Korea - Genuine Cosmetics  ",
    "Barley Apple Cider Vitamins Gummies Canada - Genuine Store",
    "Barley Apple Cider Vitamins Gummies Korea - Genuine Cosmetics  ",
    "Barley Apple Cider Vitamins Gummies Korea - Genuine Store",
    "Barley Apple Cider Vitamins Gummies USA - Genuine Store",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Cream - Luxury Store in EU ",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Cream - Luxury Store On Top EU ",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Remover AU - Genuine Cosmetics 1",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Remover AU - Genuine Cosmetics 1",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Remover Canada - Genuine Cosmetics ",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Remover EU - Genuine Cosmetics  ",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Remover US - Genuine Cosmetics",
    "ùêÉùê´. ùêáùêöùêßùêúùê≤ Melasma Remover US -1- Genuine Cosmetics ",
    "Fitgum Collagen Chia Coffee Korea - Genuine Store ",
    "Fitgum Collagen Chia Coffee USA - Genuine Store ",
    "Glutathione Collagen Glow - Genuine Store EU",
    "Glutathione Collagen Glow - Genuine Store EU 1",
    "Glutathione Collagen Glow Gummies in Japan - Beauty Store ",
    "Glutathione Collagen Glow in Japan - Beauty Store ",
    "Glutathione Collagen Store in Australia - 1 - Genuine Cosmetics ",
    "Glutathione Collagen Store in EU - 1 - Genuine Cosmetics  ",
    "Glutathione Collagen Store in EU - 2 - Genuine Cosmetics",
    "Glutathione Collagen Store in EU - 2 - Genuine Cosmetics  ",
    "Glutathione Collagen Store in EU - 3 - Genuine Cosmetics  ",
    "Glutathione Collagen Store in Japan - 1 - Beauty Store ",
    "Glutathione Collagen Store in Japan - 2 - Beauty Store",
    "Glutathione Collagen Store in Japan - 3 - Beauty Store",
    "Glutathione Collagen Store in Japan - Beauty Store ",
    "Glutathione Collagen Store in Korea - 1 - Beauty Store",
    "Glutathione Collagen Store in UK - 1 - Genuine Cosmetics",
    "Glutathione Collagen Store in UK - 2 - Genuine Cosmetics",
    "Glutathione Collagen Store in UK - 3 - Genuine Cosmetics",
    "Glutathione Collagen Store in US - 1 - Genuine Cosmetics",
    "Japanese Melasma Cream Genuine Store Canada",
    "Japanese Melasma Cream Genuine Store US ",
    "ùêéùê•ùê¢ùêØùê¢ùêö ùêêùêÆùê¢ùêùùê®-ùêÇùê®. EU - Genuine Cosmetics",
    "ùêéùê•ùê¢ùêØùê¢ùêö ùêêùêÆùê¢ùêùùê®-ùêÇùê®. EU 1 Genuine Cosmetics",
    "ùêéùê•ùê¢ùêØùê¢ùêö ùêêùêÆùê¢ùêùùê®-ùêÇùê®. US - Genuine Cosmetics",
    "ùêéùê•ùê¢ùêØùê¢ùêö ùêêùêÆùê¢ùêßùêùùê®-ùêÇùê®. UK - Genuine Cosmetics",
    "ùêéùê•ùê¢ùêØùê¢ùêö ùêêùêÆùê¢ùêßùêùùê®-ùêÇùê®. UK - Genuine Cosmetics 1",
    "Venature Bakuchiol Retinol Serum + Cream in AU - Genuine Cosmetics ",
    "Venature Bakuchiol Retinol Serum in US - Genuine Cosmetics  ",
    "Venature Glutathione Body Lotion 50x Tone Up US - Genuine Cosmetics",
    "Venature Glutathione Body Lotion in Korea - Genuine Cosmetics "
  ],
  "V≈© Vi·∫øt Anh": [
    "FitGum 20X Collagen Chia Coffee in Japan - Genuine NO.1  ",
    "FitGum 20X Collagen Chia Coffee in USA - Genuine NO.1 ",
    "FitGum Collagen Chia Coffee in Japan - Genuine NO.1  ",
    "Genuine NO.1 - Store FitGum 20X Collagen Chia Coffee in Korea",
    "Lauder Cosmetics - Venature Glutathione Body Lotion 50x Tone Up USA",
    "Venature Ginseng Gold Serum in US - Genuine NO.1",
    "Venature Glutathione Body Lotion - D2T Cosmetics In USA\n",
    "Venature Glutathione Body Lotion 50x Tone Up AU - Genuine NO.1",
    "Venature Glutathione Body Lotion 50x Tone Up AU2 - Genuine NO.1",
    "Venature Glutathione Body Lotion 50x Tone Up Australia - Lauder Cosmetics",
    "Venature Glutathione Body Lotion 50x Tone Up Canada - Genuine NO.1 ",
    "Venature Glutathione Body Lotion 50x Tone Up Canada - Lauder Cosmetics",
    "Venature Glutathione Body Lotion 50x Tone Up Japan - Genuine NO.1 ",
    "Venature Glutathione Body Lotion 50x Tone Up Japan - Lauder Cosmetics",
    "Venature Glutathione Body Lotion 50x Tone Up Japan 2 - Genuine NO.1 ",
    "Venature Glutathione Body Lotion 50x Tone Up JP - Lauder Cosmetics",
    "Venature Glutathione Body Lotion 50x Tone Up Korean - Genuine NO.1",
    "Venature Glutathione Body Lotion 50X Tone Up USA - Genuine NO.1",
    "Venature Glutathione Body Lotion 50x Tone Up USA - Genuine NO.1 ",
    "Venature Glutathione Body Lotion Korea - Lauder Cosmetics ",
    "Venature Glutathione Body Lotion US - Genuine NO.1 ",
    "Genuine NO.1 - Store FitGum 20X Collagen Chia Coffee in Canada"
  ],
  "L·ª•c Tr·∫ßn Minh Tr√≠": [
    "Fitgum Collagen Chia Coffee - Store Mintres in Japan",
    "Fitgum Collagen Chia Coffee - Store Mintres in US",
    "Fitgum Collagen Chia Coffee Japan - SlimFast+ ",
    "Fitgum Collagen Chia Coffee Korea - SlimFast+ ",
    "Fitgum Collagen Chia Coffee USA - SlimFast+ ",
    "Venature Ginseng Serum Gold 24K - Store Mintres in US",
    "Venature Glutathione Body Lotion - Store 2 Mintres in US",
    "Venature Glutathione Body Lotion - Store 3 Mintres in US",
    "Venature Glutathione Body Lotion - Store Mintres in AUS",
    "Venature Glutathione Body Lotion - Store Mintres in Canada",
    "Venature Glutathione Body Lotion - Store Mintres in Jp",
    "Venature Glutathione Body Lotion - Store Mintres in Korea",
    "Venature Glutathione Body Lotion - Store Mintres in US"
  ]
};

    // DOM elements
    const tableBody = document.getElementById('tableBody');
    const addRowBtn = document.getElementById('addRowBtn');
    const form = document.getElementById('dataForm');
    const statusDiv = document.getElementById('status');
    const respMsg = document.getElementById('responseMessage');
    
    let rowCounter = 0;

    // Utility functions
    function updateStatus(message) {
      console.log('[STATUS]', message);
      statusDiv.textContent = new Date().toLocaleTimeString() + ': ' + message;
    }

    function formatCurrency(input) {
        let rawValue = input.value.replace(/[^0-9]/g, '');
        if (!rawValue) {
            input.value = '';
            return;
        }
        const formattedValue = parseInt(rawValue, 10).toLocaleString('vi-VN');
        input.value = formattedValue;
    }
    window.formatCurrency = formatCurrency;

    function getToday() {
      const today = new Date();
      return today.toISOString().split('T')[0];
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str || '';
      return div.innerHTML;
    }

    function createOptions(list, selectedValue = '') { return list.map(item => `<option value="${escapeHtml(item)}" ${item === selectedValue ? 'selected' : ''}>${escapeHtml(item)}</option>`).join(''); }
    function createDatalistOptions(list) { return list.map(item => `<option value="${escapeHtml(item)}"></option>`).join(''); }

    function updateEmployeeData(employeeName, row) {
      const tkqcInput = row.querySelector('.tkqc-input');
      const pageInput = row.querySelector('.page-input');
      const rowId = row.dataset.rowId;
      tkqcInput.value = '';
      pageInput.value = '';
      const tkqcList = tkqcData[employeeName] || [];
      document.getElementById(`tkqc-${rowId}`).innerHTML = createDatalistOptions(tkqcList);
      const pageList = pageData[employeeName] || [];
      document.getElementById(`page-${rowId}`).innerHTML = createDatalistOptions(pageList);
      updateStatus(`C·∫≠p nh·∫≠t d·ªØ li·ªáu cho ${employeeName}: ${tkqcList.length} TKQC, ${pageList.length} Page`);
    }

    function addNewRow(data = {}) {
      rowCounter++;
      const rowId = `row${rowCounter}`;
      
      const row = document.createElement('tr');
      row.dataset.rowId = rowId;
      
      row.innerHTML = `
        <td class="action-buttons">
          <button type="button" class="removeRow" onclick="removeRow(this)">‚ùå</button>
        </td>
        <td><select name="T√™n" onchange="updateEmployeeData(this.value, this.closest('tr'))"><option value="">-- Ch·ªçn t√™n --</option>${createOptions(employeeList, data.T√™n)}</select></td>
        <td><input name="Ng√†y" type="date" value="${data.Ng√†y || getToday()}"></td>
        <td><select name="ca"><option value="">-- Ch·ªçn ca --</option>${createOptions(shiftList, data.ca)}</select></td>
        <td><input name="S·∫£n_ph·∫©m" list="product-${rowId}" value="${escapeHtml(data.S·∫£n_ph·∫©m)}"><datalist id="product-${rowId}">${createDatalistOptions(productList)}</datalist></td>
        <td><div class="input-container"><input name="Th·ªã_tr∆∞·ªùng" list="market-${rowId}" value="${escapeHtml(data.Th·ªã_tr∆∞·ªùng)}"><button type="button" class="addSimilar" onclick="addSimilarRow(this, false)">‚ûï</button><datalist id="market-${rowId}">${createDatalistOptions(marketList)}</datalist></div></td>
        <td><div class="input-container"><input name="page" class="page-input" list="page-${rowId}" value="${escapeHtml(data.page)}"><button type="button" class="addSimilar" onclick="addSimilarRow(this, true)">‚ûï</button><datalist id="page-${rowId}">${createDatalistOptions(pageData[data.T√™n] || [])}</datalist></div></td>
        <td><input name="TKQC" class="tkqc-input" list="tkqc-${rowId}" value="${escapeHtml(data.TKQC)}"><datalist id="tkqc-${rowId}">${createDatalistOptions(tkqcData[data.T√™n] || [])}</datalist></td>
        <td><input name="CPQC" type="text" value="${data.CPQC || ''}" oninput="formatCurrency(this)"></td>
        <td><input name="Via_log" value="${escapeHtml(data.Via_log)}"></td>
        <td><input name="S·ªë_Mess_Cmt" type="number" value="${data.S·ªë_Mess_Cmt || ''}"></td>
        <td class="hidden"><input name="id" value="${data.id || 'id_' + Date.now() + rowCounter}" readonly></td>
        <td class="hidden"><input name="Team" value="${data.Team || ''}"></td>
        <td class="hidden"><input name="id_NS" value="${data.id_NS || ''}"></td>
      `;

      tableBody.appendChild(row);
      
      const cpqcInput = row.querySelector('[name="CPQC"]');
      if (cpqcInput.value) {
          formatCurrency(cpqcInput);
      }

      updateStatus(`ƒê√£ th√™m d√≤ng ${rowCounter}`);
      return row;
    }

    function removeRow(button) {
      button.closest('tr').remove();
      updateStatus('ƒê√£ x√≥a d√≤ng');
    }

    function addSimilarRow(button, keepPageData) {
      const currentRow = button.closest('tr');
      const data = {};
      currentRow.querySelectorAll('input, select').forEach(input => {
        if (input.name && input.value) {
            if (input.name === 'CPQC') {
                data[input.name] = input.value.replace(/\./g, '');
            } else {
                data[input.name] = input.value;
            }
        }
      });
      delete data.id;
      if (!keepPageData) {
        ['page', 'TKQC', 'CPQC', 'Via_log', 'S·ªë_Mess_Cmt'].forEach(k => delete data[k]);
      } else {
        ['CPQC', 'S·ªë_Mess_Cmt'].forEach(k => delete data[k]);
      }
      addNewRow(data);
    }

    window.updateEmployeeData = updateEmployeeData;
    window.removeRow = removeRow;
    window.addSimilarRow = addSimilarRow;

    function validateForm() {
      document.querySelectorAll('.error-cell').forEach(cell => cell.classList.remove('error-cell'));
      let isValid = true;
      const rows = tableBody.querySelectorAll('tr');
      if (rows.length === 0) {
        respMsg.className = 'error';
        respMsg.textContent = 'Ch∆∞a c√≥ d√≤ng n√†o ƒë·ªÉ g·ª≠i!';
        return false;
      }
      const requiredFields = ['T√™n', 'Ng√†y', 'ca', 'S·∫£n_ph·∫©m', 'Th·ªã_tr∆∞·ªùng', 'page', 'TKQC', 'CPQC', 'Via_log', 'S·ªë_Mess_Cmt'];
      rows.forEach(row => {
        requiredFields.forEach(fieldName => {
          const input = row.querySelector(`[name="${fieldName}"]`);
          if (input && !input.value.trim()) {
            isValid = false;
            input.closest('td').classList.add('error-cell');
          }
        });
      });
      if (!isValid) {
        respMsg.className = 'error';
        respMsg.textContent = 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin v√†o c√°c √¥ ƒë∆∞·ª£c ƒë√°nh d·∫•u m√†u ƒë·ªè';
      }
      return isValid;
    }

    function parseUrlData(dataString) {
      try {
        const result = [];
        const rows = dataString.split('_b_');
        const fieldMap = { 'id': 'id', 'T√™n': 'T√™n', 'Ng√†y': 'Ng√†y', 'Ca': 'ca', 'S·∫£nph·∫©m': 'S·∫£n_ph·∫©m', 'Th·ªãtr∆∞·ªùng': 'Th·ªã_tr∆∞·ªùng', 'Page': 'page', 'TKQC': 'TKQC', 'CPQC': 'CPQC', 'Vialog': 'Via_log', 'S·ªëMessCmt': 'S·ªë_Mess_Cmt', 'Team': 'Team', 'idNS': 'id_NS' };
        rows.forEach((rowStr, index) => {
          if (!rowStr.trim()) return;
          const rowData = {};
          const fields = rowStr.split('_a_');
          for (let i = 0; i < fields.length; i += 2) {
            const fieldName = fields[i];
            const fieldValue = fields[i + 1];
            if (fieldMap[fieldName] && fieldValue !== undefined) {
              rowData[fieldMap[fieldName]] = decodeURIComponent(fieldValue.replace(/\+/g, ' '));
            }
          }
          if (Object.keys(rowData).length > 0) result.push(rowData);
        });
        return result;
      } catch (error) {
        console.error('Error parsing URL data:', error);
        return [];
      }
    }

    function loadDataFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      const dataString = urlParams.get('data');
      if (!dataString) {
        updateStatus('Kh√¥ng c√≥ d·ªØ li·ªáu t·ª´ URL');
        return false;
      }
      try {
        const data = parseUrlData(dataString);
        if (data.length === 0) throw new Error('D·ªØ li·ªáu trong URL kh√¥ng h·ª£p l·ªá ho·∫∑c r·ªóng');
        tableBody.innerHTML = '';
        rowCounter = 0;
        data.forEach(rowData => addNewRow(rowData));
        respMsg.className = 'success';
        respMsg.textContent = `ƒê√£ t·∫£i th√†nh c√¥ng ${data.length} d√≤ng t·ª´ URL`;
        setTimeout(() => respMsg.textContent = '', 5000);
        updateStatus(`ƒê√£ t·∫£i ${data.length} d√≤ng t·ª´ URL`);
        return true;
      } catch (error) {
        respMsg.className = 'error';
        respMsg.textContent = 'L·ªói khi ƒë·ªçc d·ªØ li·ªáu t·ª´ URL: ' + error.message;
        updateStatus('L·ªói t·∫£i URL: ' + error.message);
        return false;
      }
    }

    function handleSubmit(e) {
      e.preventDefault();
      if (!validateForm()) return;
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ƒêang g·ª≠i...';
      const allRows = [];
      tableBody.querySelectorAll('tr').forEach(row => {
        const rowData = {};
        row.querySelectorAll('input, select').forEach(input => {
          if (input.name) {
            if (input.name === 'CPQC') {
                rowData[input.name] = input.value.replace(/\./g, '');
            } else {
                rowData[input.name] = input.value;
            }
          }
        });
        if (Object.keys(rowData).length > 0) allRows.push(rowData);
      });
      
      const formData = new FormData();
      formData.append('rows', JSON.stringify(allRows));
      fetch('https://script.google.com/macros/s/AKfycbwNYTpMqLITYXVaBYIvu3H_xwt3klyJEiuUELR6VFWeZGuwXDUy65eYKB64yeqOlOR5/exec', { method: 'POST', body: formData })
      .then(response => response.json())
      .then(result => {
        if (result.error) {
          respMsg.className = 'error';
          respMsg.textContent = 'L·ªói: ' + result.error;
        } else {
          respMsg.className = 'success';
          respMsg.textContent = result.message || `ƒê√£ g·ª≠i th√†nh c√¥ng ${allRows.length} d√≤ng d·ªØ li·ªáu!`;
          tableBody.innerHTML = '';
          rowCounter = 0;
          addNewRow();
        }
      })
      .catch(error => {
        respMsg.className = 'error';
        respMsg.textContent = 'L·ªói khi g·ª≠i d·ªØ li·ªáu: ' + error.message;
      })
      .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üöÄ G·ª≠i b√°o c√°o';
        updateStatus('Ho√†n th√†nh g·ª≠i b√°o c√°o');
      });
    }

    addRowBtn.addEventListener('click', () => addNewRow());
    form.addEventListener('submit', handleSubmit);
    document.addEventListener('DOMContentLoaded', () => {
      updateStatus('·ª®ng d·ª•ng ƒë√£ s·∫µn s√†ng');
      if (!loadDataFromUrl()) addNewRow();
    });
  </script>
</body>
</html>

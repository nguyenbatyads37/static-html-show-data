function doPost(e) {
  try {
    // Phân tích chuỗi JSON được gửi trong phần body của request
    var data = JSON.parse(e.postData.contents);
    var rows = data.rows; // Đây là một mảng các đối tượng (mỗi đối tượng là một dòng)
    
    // Thay 'Sheet1' bằng tên trang tính của bạn
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Sheet1"); 
    
    // Lấy hàng cuối cùng có dữ liệu
    var lastRow = sheet.getLastRow();
    
    // Mảng để chứa dữ liệu sẽ được ghi vào trang tính
    var valuesToAppend = [];
    
    // Lấy tiêu đề từ trang tính để đảm bảo thứ tự cột chính xác
    var headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    
    // Lặp qua từng dòng dữ liệu nhận được
    rows.forEach(function(rowData) {
      var newRow = [];
      // Sắp xếp dữ liệu theo thứ tự của tiêu đề
      headers.forEach(function(header) {
        // Nếu tên cột (header) tồn tại trong dữ liệu gửi lên thì lấy giá trị, nếu không thì để trống
        newRow.push(rowData[header] || ""); 
      });
      valuesToAppend.push(newRow);
    });
    
    // Ghi tất cả các dòng mới vào trang tính một lúc để tăng hiệu suất
    if (valuesToAppend.length > 0) {
      sheet.getRange(lastRow + 1, 1, valuesToAppend.length, valuesToAppend[0].length).setValues(valuesToAppend);
    }

    // Trả về phản hồi thành công (quan trọng cho chế độ CORS)
    return ContentService
      .createTextOutput(JSON.stringify({ "status": "success", "message": "Đã nhận " + rows.length + " dòng." }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    // Trả về thông báo lỗi nếu có vấn đề
    return ContentService
      .createTextOutput(JSON.stringify({ "status": "error", "message": error.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}













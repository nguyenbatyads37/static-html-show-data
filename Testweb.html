<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>B√°o C√°o MKT LumiGlobal</title>
  <style>
    :root {
      --primary-color: #0056b3;
      --primary-color-dark: #003d82;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --info-color: #17a2b8;
      --light-gray: #f8f9fa;
      --medium-gray: #ddd;
      --dark-gray: #333;
      --border-radius: 6px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--light-gray);
      color: var(--dark-gray);
      line-height: 1.6;
    }
    
    .container {
      max-width: 95vw;
      margin: 2rem auto;
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }
    
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .logo {
      height: 60px;
      margin-right: 1.5rem;
    }
    
    h1 {
      color: var(--primary-color);
      margin: 0;
      font-weight: 600;
      font-size: 2rem;
    }
    
    .table-wrapper {
      overflow-x: auto;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
    }
    
    th, td {
      border: 1px solid var(--medium-gray);
      padding: 0.8rem 1rem;
      text-align: left;
      vertical-align: middle;
      white-space: nowrap;
    }
    
    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    
    th:nth-child(1), td:nth-child(1) { min-width: 6rem; text-align: center; }
    th:nth-child(2), td:nth-child(2) { min-width: 12rem; }
    th:nth-child(3), td:nth-child(3) { min-width: 9rem; }
    th:nth-child(4), td:nth-child(4) { min-width: 8rem; }
    th:nth-child(5), td:nth-child(5) { min-width: 10rem; }
    th:nth-child(6), td:nth-child(6) { min-width: 11rem; }
    th:nth-child(7), td:nth-child(7) { min-width: 25rem; }
    th:nth-child(8), td:nth-child(8) { min-width: 12rem; }
    th:nth-child(9), td:nth-child(9) { min-width: 8rem; }
    th:nth-child(10), td:nth-child(10) { min-width: 8rem; }
    th:nth-child(11), td:nth-child(11) { min-width: 9rem; }

    tr:nth-child(even) { background-color: var(--light-gray); }
    tr:hover { background-color: #e9ecef; }
    
    input, textarea, button, select {
      box-sizing: border-box;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
      width: 100%;
      font-family: inherit;
      font-size: 0.95rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    input:focus, select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2);
        outline: none;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover { background-color: var(--primary-color-dark); }
    
    .action-buttons { display: flex; gap: 0.5rem; justify-content: center; }
    .action-buttons button { padding: 0.4rem 0.6rem; }
    
    .add-row-btn { background-color: var(--success-color); margin-bottom: 1.5rem; }
    .add-row-btn:hover { background-color: #218838; }
    
    .submit-btn { background-color: var(--danger-color); margin-top: 1.5rem; padding: 0.75rem 1.5rem; font-size: 1.1rem; }
    .submit-btn:hover { background-color: #c82333; }
    
    #responseMessage { margin-top: 1.5rem; padding: 1rem; border-radius: var(--border-radius); text-align: center; font-weight: bold; }
    .success { background-color: #d4edda; color: #155724; }
    .error { background-color: #f8d7da; color: #721c24; }
    .error-cell { background-color: #f8d7da !important; border: 1px solid var(--danger-color) !important; }
    .error-cell input, .error-cell select { border-color: var(--danger-color) !important; }

    .hidden { display: none; }
    .addSimilar { background-color: var(--info-color); }
    .addSimilar:hover { background-color: #138496; }
    .removeRow { background-color: #6c757d; }
    .removeRow:hover { background-color: #5a6268; }
    
    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1rem;
      padding-right: 2.5rem;
    }
    
    .input-container { display: flex; align-items: center; gap: 0.5rem; }
    .input-container input { flex-grow: 1; width: 1%; }
    
    .input-container .addSimilar {
        flex-shrink: 0;
        width: 38px;
        height: 38px;
        padding: 0;
        font-size: 1.5rem;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2Ff930e667.%E1%BA%A2nh.025539.jpg" alt="LumiGlobal Logo" class="logo">
      <h1>B√°o C√°o MKT LumiGlobal</h1>
    </div>

    <button id="addRow" type="button" class="add-row-btn">‚ûï Th√™m d√≤ng tr·ªëng</button>
    
    <form id="dataForm" novalidate>
      <div class="table-wrapper">
        <table id="dataTable">
          <thead>
            <tr>
              <th>H√†nh ƒë·ªông</th>
              <th>T√™n</th>
              <th>Ng√†y</th>
              <th>Ca</th>
              <th>S·∫£n ph·∫©m</th>
              <th>Th·ªã tr∆∞·ªùng</th>
              <th>Page</th>
              <th>TKQC</th>
              <th>CPQC</th>
              <th>Via log</th>
              <th>S·ªë Mess+Cmt</th>
              <th class="hidden">id</th>
              <th class="hidden">Team</th>
              <th class="hidden">id NS</th>
            </tr>
          </thead>
          <tbody>
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m t·ª± ƒë·ªông v√†o ƒë√¢y -->
          </tbody>
        </table>
      </div>
      <button type="submit" id="submitBtn" class="submit-btn">üöÄ G·ª≠i b√°o c√°o</button>
    </form>

    <p id="responseMessage"></p>
  </div>

  <script>
    // === DOM Elements ===
    const addRowBtn = document.getElementById('addRow');
    const tbody = document.querySelector('#dataTable tbody');
    const form = document.getElementById('dataForm');
    const respMsg = document.getElementById('responseMessage');
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwNYTpMqLITYXVaBYIvu3H_xwt3klyJEiuUELR6VFWeZGuwXDUy65eYKB64yeqOlOR5/exec';

    // === Data Lists ===
    const productList=["Kem body","CF FG","CB BAKU","Bakuchiol","C√† ph√™","N√°m","K·∫πo D√¢u","Serum S√¢m","K·∫πo D√¢u New","Body TBN","Baku TBN","DG","K·∫πo T√°o"],marketList=["Nh·∫≠t","H√†n","Canada","US","√öc","Anh"],shiftList=["H·∫øt ca","Gi·ªØa ca","Ca Chi·ªÅu"],employeeList=["Ph·∫°m Ti·∫øn Th√†nh","L√™ ƒê√¨nh To·∫£n","Tr·∫ßn Qu·ªëc Kh·∫£i","M·∫°nh C∆∞·ªùng","Nguy·ªÖn Th·ªã Hi·∫øu","V≈© Vi·∫øt Anh","L·ª•c Tr·∫ßn Minh Tr√≠","ƒêo√†n Ng·ªçc Hu√¢n","Nguy·ªÖn Hi·ªÅn L∆∞∆°ng","Tr·∫ßn Huy H√πng","Nguy·ªÖn Anh Tu·∫•n","Tr·∫ßn Ti·∫øn","Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh","Nguy·ªÖn Quang Tr∆∞·ªùng"],tkqcData={L√™ƒê√¨nhTo·∫£n:["lumi hn 07(1)","tcm 365(1)","tcm 386(1)","tcm 389-b(1)","tcm 427-b"],L·ª•cTr·∫ßnMinhTr√≠:["tcm 399-b","tcm 456"],M·∫°nhC∆∞·ªùng:["lumi hn 04","lumi hn 06","tcm 372-b","tcm 376-b","tcm 378(1)","tcm 394(1)","tcm 407(1)","tcm 418(1)","tcm 442(1)"],Nguy·ªÖnAnhTu·∫•n:["lumi hn 11","tcm  395"],Nguy·ªÖnHi·ªÅnL∆∞∆°ng:["lumi hn 13(1)","tcm 410-b(1)","tcm 430-b","tcm 434-b(1)"],Nguy·ªÖnQuangTr∆∞·ªùng:["lumi hn 09"],Nguy·ªÖnTh·ªãHi·∫øu:["lumi hn 10","tcm 381(1)","tcm 406(1)","tcm 413-b","tcm 440(1)","tcm 443(1)"],Nguy·ªÖnTh·ªãNh∆∞Qu·ª≥nh:["lumi hn 08 hold"],Ph·∫°mTi·∫ønTh√†nh:["lumi hn 05(1)","lumi hn 14(1)","tcm 300","tcm 393(1)","tcm 431(1)","tcm 449(1)"],Tr·∫ßnHuyH√πng:["lumi hn 01","tcm 429-b(1)","tcm 438(1)"],Tr·∫ßnQu·ªëcKh·∫£i:["lumi hn 02(1)","lumi hn 12","tcm 369-b(1)","tcm 380(1)","tcm 387(1)","tcm 455"],Tr·∫ßnTi·∫øn:["tcm 426-b"],V≈©Vi·∫øtAnh:["tcm 390","tcm 450(1)"],ƒêo√†nNg·ªçcHu√¢n:["lumi hn 03(1)","tcm 400-b(1)"]},pageData={Tr·∫ßnQu·ªëcKh·∫£i:["FitGum 20X Collagen Chia Coffee - JAPAN - 100% FDA 01","Body Lotion Venature Glutathione - CA -100% FDA"],Tr·∫ßnHuyH√πng:["50X CA Store Legit - Body Lotion Venature Glutathione","AUS Store Legit - Venature Bakuchiol"],Nguy·ªÖnTh·ªãHi·∫øu:["Anna Store - Venature Bakuchiol Retinol In Japan","Anna Store 2 In JP - Venature Glutathione Body Lotion"],Nguy·ªÖnHi·ªÅnL∆∞∆°ng:["Bakuchiol Retinol Anti-Aging Serum In US - Natural Products","Bakuchiol Retinol In Australia - Beauty Support"],ƒêo√†nNg·ªçcHu√¢n:["Bakuchiol Retinol in AU.inc - Skin rejuvenation store","Bakuchiol Retinol In Canada - Skin rejuvenation store"],M·∫°nhC∆∞·ªùng:["Bakuchiol Retinol Serum - Beauty Skin Australia","Bakuchiol Retinol Serum - Beauty Skin Canada"],Nguy·ªÖnQuangTr∆∞·ªùng:["Bakuchiol Retinol Serum - Online Shop in Japan","Bakuchiol Retinol Serum - Online Shop USA"],Ph·∫°mTi·∫ønTh√†nh:["Bakuchiol Retinol Serum - Top Skincare Store AU","Bakuchiol Retinol Serum - Top Skincare Store CA"],Nguy·ªÖnTh·ªãNh∆∞Qu·ª≥nh:["Bakuchiol Retinol Serum + Cream CA - Genuine Cosmetics","Barley Apple Cider Vitamins Gummies Canada - Genuine Store"],V≈©Vi·∫øtAnh:["FitGum 20X Collagen Chia Coffee in Japan - Genuine NO.1","FitGum 20X Collagen Chia Coffee in USA - Genuine NO.1"],L·ª•cTr·∫ßnMinhTr√≠:["Fitgum Collagen Chia Coffee - Store Mintres in Japan","Fitgum Collagen Chia Coffee - Store Mintres in US"]};
    const escapeAttr = (str) => str.toString().replace(/"/g, '"');

    function formatDate(date){const d=new Date(date);let month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();if(month.length<2)month="0"+month;if(day.length<2)day="0"+day;return[year,month,day].join("-")}
    function getToday(){return formatDate(new Date)}
    
    function createRow(data={},insertAfter=null){const tr=document.createElement("tr"),uniqueId="id_"+Date.now()+Math.random().toString(36).substr(2,9);
      // [UPDATED] Changed TKQC from <select> to <input> with <datalist>
      tr.innerHTML=`<td class=action-buttons><button type=button class=removeRow title="X√≥a d√≤ng">‚ùå</button></td><td><select name=T√™n class=name-select><option value="">-- Ch·ªçn t√™n --</option>${employeeList.map(name=>`<option value="${escapeAttr(name)}" ${data.T√™n===name?"selected":""}>${name}</option>`).join("")}</select></td><td><input name=Ng√†y type=date value="${data.Ng√†y?formatDate(data.Ng√†y):getToday()}"></td><td><select name=ca>${shiftList.map(shift=>`<option value="${escapeAttr(shift)}" ${data.ca===shift?"selected":""}>${shift}</option>`).join("")}</select></td><td><input name=S·∫£n_ph·∫©m list=productList_${uniqueId} value="${data.S·∫£n_ph·∫©m||""}"><datalist id=productList_${uniqueId}>${productList.map(product=>`<option value="${escapeAttr(product)}"></option>`).join("")}</datalist></td><td><div class=input-container><input name=Th·ªã_tr∆∞·ªùng list=marketList_${uniqueId} value="${data.Th·ªã_tr∆∞·ªùng||""}"><button type=button class="addSimilar addSimilarMarket" title="Th√™m d√≤ng t∆∞∆°ng t·ª± (gi·ªØ l·∫°i th·ªã tr∆∞·ªùng)">‚ûï</button><datalist id=marketList_${uniqueId}>${marketList.map(market=>`<option value="${escapeAttr(market)}"></option>`).join("")}</datalist></div></td><td><div class=input-container><input name=page value="${data.page||""}" class=page-input list=pageList_${uniqueId}><button type=button class="addSimilar addSimilarPage" title="Th√™m d√≤ng gi·ªëng h·ªát">‚ûï</button><datalist id=pageList_${uniqueId}>${data.T√™n&&pageData[data.T√™n]?pageData[data.T√™n].map(p=>`<option value="${escapeAttr(p)}"></option>`).join(""):""}</datalist></div></td><td><input name=TKQC class=tkqc-input value="${data.TKQC||""}" list="tkqcList_${uniqueId}"><datalist id="tkqcList_${uniqueId}">${data.T√™n&&tkqcData[data.T√™n]?tkqcData[data.T√™n].map(tkqc=>`<option value="${escapeAttr(tkqc)}"></option>`).join(""):""}</datalist></td><td><input name=CPQC type=number value="${data.CPQC||""}"></td><td><input name=Via_log value="${data.Via_log||""}"></td><td><input name=S·ªë_Mess_Cmt type=number value="${data.S·ªë_Mess_Cmt||""}"></td><td class=hidden><input name=id value="${data.id||"id_"+Date.now()}" readonly></td><td class=hidden><input name=Team value="${data.Team||""}" readonly></td><td class=hidden><input name=id_NS value="${data.id_NS||""}" readonly></td>`;
      
      // [UPDATED] Event listener now updates both Page and TKQC datalists
      tr.querySelector(".name-select").addEventListener("change",function(){const selectedName=this.value,currentRow=this.closest("tr"),tkqcInput=currentRow.querySelector(".tkqc-input"),tkqcDatalist=currentRow.querySelector(`#${tkqcInput.getAttribute("list")}`),pageInput=currentRow.querySelector(".page-input"),pageDatalist=currentRow.querySelector(`#${pageInput.getAttribute("list")}`);tkqcInput.value="";tkqcDatalist.innerHTML="";pageInput.value="";pageDatalist.innerHTML="";if(selectedName){if(tkqcData[selectedName]){tkqcData[selectedName].forEach(tkqc=>{const option=document.createElement("option");option.value=tkqc;tkqcDatalist.appendChild(option)})}if(pageData[selectedName]){pageData[selectedName].forEach(page=>{const option=document.createElement("option");option.value=page;pageDatalist.appendChild(option)})}}});
      
      tr.querySelector(".removeRow").addEventListener("click",()=>tr.remove());const addSimilar=keepPageAndBelow=>{const rowData={id:"id_"+Date.now(),T√™n:tr.querySelector('[name="T√™n"]').value,Ng√†y:tr.querySelector('[name="Ng√†y"]').value,ca:tr.querySelector('[name="ca"]').value,S·∫£n_ph·∫©m:tr.querySelector('[name="S·∫£n_ph·∫©m"]').value,Th·ªã_tr∆∞·ªùng:tr.querySelector('[name="Th·ªã_tr∆∞·ªùng"]').value};if(keepPageAndBelow){rowData.page=tr.querySelector('[name="page"]').value;rowData.TKQC=tr.querySelector('[name="TKQC"]').value;rowData.Via_log=tr.querySelector('[name="Via_log"]').value}const newRow=createRow(rowData,tr),firstInput=newRow.querySelector(keepPageAndBelow?'[name="CPQC"]':'[name="page"]');if(firstInput)firstInput.focus()};tr.querySelector(".addSimilarMarket").addEventListener("click",()=>addSimilar(false));tr.querySelector(".addSimilarPage").addEventListener("click",()=>addSimilar(true));if(insertAfter){tbody.insertBefore(tr,insertAfter.nextSibling)}else{tbody.appendChild(tr)}return tr}
    function parseUrlData(dataString){const result=[],rows=dataString.split("_b_"),fieldMap={id:"id",T√™n:"T√™n",Ng√†y:"Ng√†y",Ca:"ca",S·∫£nph·∫©m:"S·∫£n_ph·∫©m",Th·ªãtr∆∞·ªùng:"Th·ªã_tr∆∞·ªùng",Page:"page",TKQC:"TKQC",CPQC:"CPQC",Vialog:"Via_log",S·ªëMessCmt:"S·ªë_Mess_Cmt"};rows.forEach((rowStr,index)=>{if(!rowStr)return;const rowData={},fields=rowStr.split("_a_");for(let i=0;i<fields.length;i+=2){const fieldName=fields[i],fieldValue=fields[i+1];if(fieldMap[fieldName]&&fieldValue!==void 0){rowData[fieldMap[fieldName]]=decodeURIComponent(fieldValue.replace(/\+/g," "))}}if(Object.keys(rowData).length>0){rowData.id=rowData.id||`id_url_${Date.now()}_${index}`;result.push(rowData)}});return result}
    function loadDataFromUrl(){const urlParams=new URLSearchParams(window.location.search),dataString=urlParams.get("data");if(!dataString)return false;try{const data=parseUrlData(dataString);if(data.length===0)throw new Error("D·ªØ li·ªáu trong URL kh√¥ng h·ª£p l·ªá ho·∫∑c r·ªóng.");tbody.innerHTML="";data.forEach(rowData=>createRow(rowData));respMsg.className="success";respMsg.innerText=`ƒê√£ t·∫£i th√†nh c√¥ng ${data.length} d√≤ng t·ª´ URL.`;setTimeout(()=>respMsg.innerText="",5e3);return true}catch(error){respMsg.className="error";respMsg.innerText="L·ªói khi ƒë·ªçc d·ªØ li·ªáu t·ª´ URL: "+error.message;return false}}
    function validateForm(){document.querySelectorAll(".error-cell").forEach(cell=>cell.classList.remove("error-cell"));let isValid=!0;const rows=tbody.querySelectorAll("tr");if(0===rows.length){respMsg.className="error";respMsg.innerText="Ch∆∞a c√≥ d√≤ng n√†o ƒë·ªÉ g·ª≠i!";return!1}const requiredFields=["T√™n","Ng√†y","ca","S·∫£n_ph·∫©m","Th·ªã_tr∆∞·ªùng","page","TKQC","CPQC","Via_log","S·ªë_Mess_Cmt"];rows.forEach(row=>{requiredFields.forEach(fieldName=>{const input=row.querySelector(`[name="${fieldName}"]`);if(input&&!input.value.trim()){isValid=!1;input.closest("td").classList.add("error-cell")}})});if(!isValid){respMsg.className="error";respMsg.innerText="L·ªói: Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin v√†o c√°c √¥ ƒë∆∞·ª£c ƒë√°nh d·∫•u m√†u ƒë·ªè."}else{respMsg.innerText="";respMsg.className=""}return isValid}
    function handleFormSubmit(e){e.preventDefault();if(!validateForm())return;const submitBtn=document.getElementById("submitBtn");submitBtn.disabled=!0;submitBtn.textContent="ƒêang g·ª≠i...";const allRows=Array.from(tbody.querySelectorAll("tr")).map(tr=>{const obj={};tr.querySelectorAll("input, select").forEach(inp=>{if(inp.name)obj[inp.name]=inp.value});return obj}),payload=new FormData;payload.append("rows",JSON.stringify(allRows));fetch(SCRIPT_URL,{method:"POST",body:payload}).then(r=>r.json()).then(json=>{respMsg.className=json.error?"error":"success";respMsg.innerText=json.error?"L·ªói: "+json.error:json.message;if(!json.error){tbody.innerHTML="";createRow()}}).catch(err=>{respMsg.className="error";respMsg.innerText="L·ªói khi g·ª≠i d·ªØ li·ªáu: "+err.message}).finally(()=>{submitBtn.disabled=!1;submitBtn.textContent="üöÄ G·ª≠i b√°o c√°o"})}
    function initializeApp(){const loadedFromUrl=loadDataFromUrl();if(!loadedFromUrl)createRow();addRowBtn.addEventListener("click",()=>{const newRow=createRow(),firstInput=newRow.querySelector(".name-select");if(firstInput)firstInput.focus()});form.addEventListener("submit",handleFormSubmit)}
    document.addEventListener("DOMContentLoaded",initializeApp);
  </script>
</body>
</html>















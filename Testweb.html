<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>B√°o C√°o MKT LumiGlobal</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-image: url('https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2Ff930e667.%E1%BA%A2nh.025539.jpg');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      color: #333;
    }
    
    .container {
      width: 100%; 
      min-height: 100vh;
      margin: 0;
      background-color: rgba(255, 255, 255, 0.95);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      padding: 20px;
      box-sizing: border-box;
    }
    
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #0056b3;
    }
    
    .logo {
      height: 60px;
      margin-right: 20px;
    }
    
    h1 {
      color: #0056b3;
      margin: 0;
      font-weight: 600;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      table-layout: fixed;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
      word-wrap: break-word;
    }
    
    th {
      background-color: #0056b3;
      color: white;
      font-weight: 500;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    
    /* Widths are for VISIBLE columns */
    th:nth-child(1), td:nth-child(1) { width: 5%; }  /* H√†nh ƒë·ªông */
    th:nth-child(2), td:nth-child(2) { width: 11%; } /* T√™n */
    th:nth-child(3), td:nth-child(3) { width: 9%; }  /* Ng√†y */
    th:nth-child(4), td:nth-child(4) { width: 8%; }  /* Ca */
    th:nth-child(5), td:nth-child(5) { width: 10%; } /* S·∫£n ph·∫©m */
    th:nth-child(6), td:nth-child(6) { width: 9%; }  /* Th·ªã tr∆∞·ªùng */
    th:nth-child(7), td:nth-child(7) { width: 15%; } /* Page */
    th:nth-child(8), td:nth-child(8) { width: 11%; } /* TKQC */
    th:nth-child(9), td:nth-child(9) { width: 7%; }  /* CPQC */
    th:nth-child(10), td:nth-child(10) { width: 8%; } /* Via log */
    th:nth-child(11), td:nth-child(11) { width: 7%; } /* S·ªë Mess+Cmt */
    
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    
    tr:hover {
      background-color: #f1f1f1;
    }
    
    input, textarea, button, select {
      box-sizing: border-box;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100%;
      font-family: inherit;
      font-size: 14px;
    }
    
    input[readonly] {
      background-color: #f5f5f5;
    }
    
    .hidden {
      display: none;
    }
    
    /* Other styles... */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2Ff930e667.%E1%BA%A2nh.025539.jpg" alt="LumiGlobal Logo" class="logo">
      <h1>B√°o C√°o MKT LumiGlobal</h1>
    </div>

    <button id="addRow" type="button" class="add-row-btn">‚ûï Th√™m d√≤ng tr·ªëng</button>

    <form id="dataForm">
      <table id="dataTable">
        <thead>
          <tr>
            <!-- C√°c c·ªôt hi·ªÉn th·ªã -->
            <th>H√†nh ƒë·ªông</th>
            <th>T√™n</th>
            <th>Ng√†y</th>
            <th>Ca</th>
            <th>S·∫£n ph·∫©m</th>
            <th>Th·ªã tr∆∞·ªùng</th>
            <th>Page</th>
            <th>TKQC</th>
            <th>CPQC</th>
            <th>Via log</th>
            <th>S·ªë Mess+Cmt</th>
            <!-- C√°c c·ªôt ·∫©n -->
            <th class="hidden">id</th>
            <th class="hidden">Team</th>
            <th class="hidden">id NS</th>
          </tr>
        </thead>
        <tbody>
          <!-- C√°c d√≤ng s·∫Ω ƒë∆∞·ª£c th√™m t·ª± ƒë·ªông v√†o ƒë√¢y -->
        </tbody>
      </table>
      <button type="submit" id="submitBtn" class="submit-btn">üöÄ G·ª≠i b√°o c√°o</button>
    </form>

    <p id="responseMessage"></p>
  </div>

  <script>
    // ... (To√†n b·ªô c√°c h·∫±ng s·ªë v√† h√†m ph·ª• tr·ª£ nh∆∞ c≈©)
    const addRowBtn = document.getElementById('addRow');
    const tbody = document.querySelector('#dataTable tbody');
    const form = document.getElementById('dataForm');
    const respMsg = document.getElementById('responseMessage');
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby3GWaoNiRVsjgceLF7RKNE-J9tx_v4AyHnFp7PAo5di-ZlBHFcf31OrYUcIp0BAsOnFQ/exec';
    const productList = [ "Kem body", "CF FG", "CB BAKU", "Bakuchiol", "C√† ph√™", "N√°m", "K·∫πo D√¢u", "Serum S√¢m", "K·∫πo D√¢u New", "Body TBN", "Baku TBN", "DG", "K·∫πo T√°o" ];
    const marketList = ["Nh·∫≠t", "H√†n", "Canada", "US", "√öc", "Anh"];
    const shiftList = ["H·∫øt ca", "Gi·ªØa ca", "Ca Chi·ªÅu"];
    const employeeList = [ "Ph·∫°m Ti·∫øn Th√†nh", "L√™ ƒê√¨nh To·∫£n", "Tr·∫ßn Qu·ªëc Kh·∫£i", "M·∫°nh C∆∞·ªùng", "Nguy·ªÖn Th·ªã Hi·∫øu", "V≈© Vi·∫øt Anh", "L·ª•c Tr·∫ßn Minh Tr√≠", "ƒêo√†n Ng·ªçc Hu√¢n", "Nguy·ªÖn Hi·ªÅn L∆∞∆°ng", "Tr·∫ßn Huy H√πng", "Nguy·ªÖn Anh Tu·∫•n", "Tr·∫ßn Ti·∫øn", "Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh", "Nguy·ªÖn Quang Tr∆∞·ªùng" ];
    const tkqcData = {
      "Ph·∫°m Ti·∫øn Th√†nh": ["tcm 393(1)", "lumi hn 05(1)", "lumi hn 06", "lumi hn 53", "lumi hn 54", "lumi hn 68", "lumi hn 75", "lumi hn 82", "lumi hn 83"],
      "L√™ ƒê√¨nh To·∫£n": ["tcm 427-b", "lumi hn 26", "lumi hn 40"],
      "Tr·∫ßn Qu·ªëc Kh·∫£i": ["tcm 369-b(1)", "tcm 380(1)", "tcm 455", "lumi hn 12", "lumi hn 35", "lumi hn 47", "lumi hn 48"],
      "M·∫°nh C∆∞·ªùng": ["tcm 376-b", "tcm 378(1)", "tcm 394(1)", "tcm 407(1)", "tcm 442(1)", "lumi hn 04", "lumi hn 24", "lumi hn 50", "lumi hn 63"],
    };
    function formatDate(d){ /*...*/ return [d.getFullYear(), ('0'+(d.getMonth()+1)).slice(-2), ('0'+d.getDate()).slice(-2)].join('-');}
    function getToday(){ return formatDate(new Date()); }

    // T·∫°o m·ªôt d√≤ng m·ªõi
    function createRow(data = {}, insertAfter = null) {
      const tr = document.createElement('tr');
      const uniqueId = `id_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      
      // >>>>> THAY ƒê·ªîI QUAN TR·ªåNG: C·∫•u tr√∫c HTML c·ªßa d√≤ng m·ªõi <<<<<
      tr.innerHTML = `
        <!-- C√°c c·ªôt hi·ªÉn th·ªã -->
        <td class="action-buttons">
          <button type="button" class="removeRow" title="X√≥a d√≤ng n√†y">‚ùå</button>
        </td>
        <td>
          <select name="T√™n" class="editable name-select">
            <option value="">-- Ch·ªçn t√™n --</option>
            ${employeeList.map(name => `<option value="${name}" ${data.T√™n === name ? 'selected' : ''}>${name}</option>`).join('')}
          </select>
        </td>
        <td><input name="Ng√†y" type="date" value="${data.Ng√†y || getToday()}" class="editable"></td>
        <td>
          <select name="ca" class="editable">
            ${shiftList.map(shift => `<option value="${shift}" ${data.ca === shift ? 'selected' : ''}>${shift}</option>`).join('')}
          </select>
        </td>
        <td>
          <input name="S·∫£n_ph·∫©m" list="productList" value="${data.S·∫£n_ph·∫©m || ''}" class="editable">
          <datalist id="productList">${productList.map(product => `<option value="${product}">`).join('')}</datalist>
        </td>
        <td>
          <div class="market-container">
            <input name="Th·ªã_tr∆∞·ªùng" list="marketList" value="${data.Th·ªã_tr∆∞·ªùng || ''}" class="editable">
            <datalist id="marketList">${marketList.map(market => `<option value="${market}">`).join('')}</datalist>
            <button type="button" class="addSimilar addSimilarMarket" title="Th√™m d√≤ng m·ªõi v·ªõi c√πng Th·ªã tr∆∞·ªùng">‚ûï</button>
          </div>
        </td>
        <td>
          <div class="page-container">
            <input name="page" value="${data.page || ''}" class="editable">
            <button type="button" class="addSimilar addSimilarPage" title="Th√™m d√≤ng m·ªõi v·ªõi c√πng Page & TKQC">‚ûï</button>
          </div>
        </td>
        <td>
          <select name="TKQC" class="editable tkqc-select">
            <option value="">-- Ch·ªçn TKQC --</option>
            ${data.T√™n && tkqcData[data.T√™n] ? tkqcData[data.T√™n].map(tkqc => `<option value="${tkqc}" ${data.TKQC === tkqc ? 'selected' : ''}>${tkqc}</option>`).join('') : ''}
          </select>
        </td>
        <td><input name="CPQC" value="${data.CPQC || ''}" class="editable" type="number" step="any"></td>
        <td><input name="Via_log" value="${data.Via_log || ''}" class="editable"></td>
        <td><input name="S·ªë_Mess_Cmt" value="${data.S·ªë_Mess_Cmt || ''}" class="editable" type="number" step="1"></td>
        
        <!-- C√°c c·ªôt ·∫©n b√¢y gi·ªù ·ªü cu·ªëi c·∫•u tr√∫c HTML, nh∆∞ng v·∫´n ƒë∆∞·ª£c header map x·ª≠ l√Ω ƒë√∫ng -->
        <td class="hidden"><input name="id" value="${data.id || uniqueId}" readonly></td>
        <td class="hidden"><input name="Team" value="${data.Team || ''}" readonly></td>
        <td class="hidden"><input name="id_NS" value="${data.id_NS || ''}" readonly></td>
      `;

      // Ph·∫ßn c√≤n l·∫°i c·ªßa h√†m createRow v√† c√°c h√†m kh√°c kh√¥ng thay ƒë·ªïi...
      tr.querySelector('.removeRow').addEventListener('click', () => tr.remove());
      const nameSelect = tr.querySelector('.name-select');
      const tkqcSelect = tr.querySelector('.tkqc-select');
      nameSelect.addEventListener('change', function() { /*...*/ });
      if (nameSelect.value) { /*...*/ }
      tr.querySelector('.addSimilarMarket').addEventListener('click', () => { /*...*/ });
      tr.querySelector('.addSimilarPage').addEventListener('click', () => { /*...*/ });
      if (insertAfter) { tbody.insertBefore(tr, insertAfter.nextSibling); } 
      else { tbody.appendChild(tr); }
      return tr;
    }

    // C√°c h√†m c√≤n l·∫°i nh∆∞ initializeRowsFromUrl, addRowBtn, form.submit kh√¥ng c·∫ßn thay ƒë·ªïi
    // v√¨ ch√∫ng d·ª±a v√†o 'name' c·ªßa input, kh√¥ng ph·∫£i th·ª© t·ª± v·∫≠t l√Ω trong HTML.
    
    // ... D√°n to√†n b·ªô c√°c h√†m c√≤n l·∫°i v√†o ƒë√¢y ...
    // ( initializeRowsFromUrl, updateRowInPlace, addRowBtn listener, form listener )
    // V√≠ d·ª•:
    function updateRowInPlace(tr, data) { /* ... */ }
    function initializeRowsFromUrl() { /* ... */ }
    addRowBtn.addEventListener('click', () => { /* ... */ });
    form.addEventListener('submit', e => { /* ... */ });
    
    // G·ªçi h√†m kh·ªüi t·∫°o
    initializeRowsFromUrl();
  </script>
</body>
</html>
















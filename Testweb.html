<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Form G·ª≠i D·ªØ Li·ªáu</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1600px; margin: 20px auto; padding: 0 20px; }
    h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; font-size: 14px; vertical-align: top; }
    th { background-color: #f2f2f2; font-weight: bold; }
    input, select, textarea { width: 100%; box-sizing: border-box; font-size: 14px; padding: 4px; border: 1px solid #ddd; border-radius: 3px;}
    button { padding: 8px 15px; font-size: 14px; cursor: pointer; border: none; border-radius: 4px; }
    #addRow { background-color: #28a745; color: white; margin-bottom: 15px; }
    #submitBtn { background-color: #007bff; color: white; margin-top: 15px; width: 100%; font-weight: bold; }
    .removeRow { background-color: #dc3545; color: white; padding: 4px 8px; font-size: 12px; }
    #responseMessage { text-align: center; font-weight: bold; margin-top: 15px; }
    .idcol { display: none; }

    /* --- ƒêi·ªÅu ch·ªânh ƒë·ªô r·ªông c·ªôt --- */
    #dataTable th:nth-child(1) { width: 5%; }   /* H√†nh ƒë·ªông */
    #dataTable th:nth-child(3) { width: 10%; }  /* T√™n */
    #dataTable th:nth-child(4) { width: 8%; }   /* Ng√†y */
    #dataTable th:nth-child(5) { width: 7%; }   /* Ca */
    #dataTable th:nth-child(6) { width: 8%; }   /* S·∫£n ph·∫©m */
    #dataTable th:nth-child(7) { width: 7%; }   /* Th·ªã tr∆∞·ªùng */
    #dataTable th:nth-child(8) { width: 8%; }   /* Page */
    #dataTable th:nth-child(9) { width: 10%; }  /* TKQC */
    #dataTable th:nth-child(10) { width: 6%; }  /* CPQC */
  </style>
</head>
<body>
  <h2>G·ª≠i Nhi·ªÅu D√≤ng D·ªØ Li·ªáu</h2>
  <button id="addRow" type="button">‚ûï Th√™m d√≤ng</button>
  <form id="dataForm">
    <table id="dataTable">
      <thead>
        <tr>
          <th>H√†nh ƒë·ªông</th>
          <th class="idcol">ID</th>
          <th>T√™n</th>
          <th>Ng√†y</th>
          <th>Ca</th>
          <th>S·∫£n ph·∫©m</th>
          <th>Th·ªã tr∆∞·ªùng</th>
          <th>Page</th>
          <th>TKQC</th>
          <th>CPQC</th>
          <th>Via log</th>
          <th>S·ªë Mess+Cmt</th>
          <th>S·ªë ƒë∆°n</th>
          <th>DS Ch·ªët</th>
          <th>S·ªë ƒë∆°n Ho√†n/H·ªßy</th>
          <th>DS sau Ho√†n/H·ªßy</th>
          <th>S·ªë ƒë∆°n sau ho√†n hu·ª∑</th>
          <th>Team</th>
          <th>id NS</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button type="submit" id="submitBtn">üöÄ G·ª≠i t·∫•t c·∫£</button>
  </form>
  <p id="responseMessage"></p>

  <!-- Datalist cho c√°c tr∆∞·ªùng -->
  <datalist id="nameList">
    <option value="Tr·∫ßn Qu·ªëc Kh·∫£i"></option>
    <option value="M·∫°nh C∆∞·ªùng"></option>
    <option value="Ph·∫°m Ti·∫øn Th√†nh"></option>
    <option value="L·ª•c Tr·∫ßn Minh Tr√≠"></option>
    <option value="Nguy·ªÖn Hi·ªÅn L∆∞∆°ng"></option>
    <option value="Nguy·ªÖn Th·ªã Hi·∫øu"></option>
    <option value="L√™ ƒê√¨nh To·∫£n"></option>
    <option value="Nguy·ªÖn Anh Tu·∫•n"></option>
    <option value="Tr·∫ßn Ti·∫øn"></option>
    <option value="Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh"></option>
    <option value="ƒêo√†n Ng·ªçc Hu√¢n"></option>
    <option value="Tr·∫ßn Huy H√πng"></option>
    <option value="Nguy·ªÖn Quang Tr∆∞·ªùng"></option>
    <option value="Test team C∆∞·ªùng"></option>
    <option value="V≈© Vi·∫øt Anh"></option>
  </datalist>

  <datalist id="tkqcList">
    <option value="tcm 369-b(1)"></option>
    <option value="tcm 376-b"></option>
    <option value="tcm 378(1)"></option>
    <option value="tcm 380(1)"></option>
    <option value="tcm 393(1)"></option>
    <option value="tcm 394(1)"></option>
    <option value="tcm 399-b"></option>
    <option value="tcm 407(1)"></option>
    <option value="tcm 410-b(1)"></option>
    <option value="tcm 413-b"></option>
    <option value="tcm 427-b"></option>
    <option value="tcm 434-b(1)"></option>
    <option value="tcm 440(1)"></option>
    <option value="tcm 442(1)"></option>
    <option value="tcm 443(1)"></option>
    <option value="tcm 449(1)"></option>
    <option value="tcm 455"></option>
    <option value="tcm  395"></option>
    <option value="tcm 426-b"></option>
    <option value="tcm 403"></option>
    <option value="lumi hn 01"></option>
    <option value="lumi hn 03(1)"></option>
    <option value="lumi hn 04"></option>
    <option value="lumi hn 05(1)"></option>
    <option value="lumi hn 06"></option>
    <option value="lumi hn 08 hold"></option>
    <option value="lumi hn 10"></option>
    <option value="lumi hn 12"></option>
    <option value="lumi hn 19"></option>
    <option value="lumi hn 23(hold)"></option>
    <option value="lumi hn 24"></option>
    <option value="lumi hn 25"></option>
    <option value="lumi hn 26"></option>
    <option value="lumi hn 27"></option>
    <option value="lumi hn 30"></option>
    <option value="lumi hn 33"></option>
    <option value="lumi  hn 34"></option>
    <option value="lumi hn 35"></option>
    <option value="lumi hn 37"></option>
    <option value="lumi hn 40"></option>
    <option value="lumi hn 42"></option>
    <option value="lumi hn 44"></option>
    <option value="lumi hn 45"></option>
    <option value="lumi hn 46"></option>
    <option value="lumi hn 47"></option>
    <option value="lumi hn 48"></option>
    <option value="lumi hn 49"></option>
    <option value="lumi hn 50"></option>
    <option value="lumi hn 51"></option>
    <option value="lumi hn 53"></option>
    <option value="lumi hn 54"></option>
    <option value="lumi hn 55"></option>
    <option value="c∆∞·ªùng test 01"></option>
    <option value="lumi hn 61"></option>
    <option value="lumi hn 62"></option>
    <option value="lumi hn 63"></option>
    <option value="lumi hn 64"></option>
    <option value="lumi hn 65 -7"></option>
    <option value="lumi hn 70-7"></option>
    <option value="lumi hn 66"></option>
    <option value="lumi hn 67"></option>
    <option value="lumi hn 68"></option>
    <option value="lumi hn 71"></option>
    <option value="lumi hn 72"></option>
    <option value="lumi hn 73"></option>
    <option value="lumi hn 74"></option>
    <option value="lumi hn 75"></option>
    <option value="lumi hn 76"></option>
    <option value="lumi hn 77"></option>
    <option value="lumi hn 78"></option>
    <option value="lumi hn 79"></option>
    <option value="lumi hn 81"></option>
    <option value="lumi hn 82"></option>
    <option value="lumi hn 83"></option>
    <option value="lumi hn 85 mst"></option>
    <option value="lmi hn 84 mst"></option>
  </datalist>

  <datalist id="productList">
    <option value="Kem body"></option>
    <option value="CF FG"></option>
    <option value="CB BAKU"></option>
    <option value="Bakuchiol"></option>
    <option value="C√† ph√™"></option>
    <option value="N√°m"></option>
    <option value="K·∫πo D√¢u"></option>
    <option value="Serum S√¢m"></option>
    <option value="K·∫πo D√¢u New"></option>
    <option value="Body TBN"></option>
    <option value="Baku TBN"></option>
    <option value="DG"></option>
    <option value="K·∫πo T√°o"></option>
  </datalist>

  <datalist id="marketList">
    <option value="Nh·∫≠t"></option>
    <option value="H√†n"></option>
    <option value="Canada"></option>
    <option value="US"></option>
    <option value="√öc"></option>
    <option value="Anh"></option>
  </datalist>

  <script>
  const addRowBtn = document.getElementById('addRow');
  const tbody = document.querySelector('#dataTable tbody');
  const form = document.getElementById('dataForm');
  const respMsg = document.getElementById('responseMessage');

  const tkqcToNameMap = {
    'tcm 369-b(1)': 'Tr·∫ßn Qu·ªëc Kh·∫£i', 'tcm 376-b': 'M·∫°nh C∆∞·ªùng', 'tcm 378(1)': 'M·∫°nh C∆∞·ªùng', 'tcm 380(1)': 'Tr·∫ßn Qu·ªëc Kh·∫£i', 'tcm 393(1)': 'Ph·∫°m Ti·∫øn Th√†nh', 'tcm 394(1)': 'M·∫°nh C∆∞·ªùng', 'tcm 399-b': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'tcm 407(1)': 'M·∫°nh C∆∞·ªùng', 'tcm 410-b(1)': 'Nguy·ªÖn Hi·ªÅn L∆∞∆°ng', 'tcm 413-b': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'tcm 427-b': 'L√™ ƒê√¨nh To·∫£n', 'tcm 434-b(1)': 'Nguy·ªÖn Hi·ªÅn L∆∞∆°ng', 'tcm 440(1)': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'tcm 442(1)': 'M·∫°nh C∆∞·ªùng', 'tcm 443(1)': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'tcm 449(1)': 'Ph·∫°m Ti·∫øn Th√†nh', 'tcm 455': 'Tr·∫ßn Qu·ªëc Kh·∫£i', 'tcm  395': 'Nguy·ªÖn Anh Tu·∫•n', 'tcm 426-b': 'Tr·∫ßn Ti·∫øn', 'tcm 403': '', 'lumi hn 01': 'Tr·∫ßn Huy H√πng', 'lumi hn 03(1)': 'ƒêo√†n Ng·ªçc Hu√¢n', 'lumi hn 04': 'M·∫°nh C∆∞·ªùng', 'lumi hn 05(1)': 'Ph·∫°m Ti·∫øn Th√†nh', 'lumi hn 06': 'Ph·∫°m Ti·∫øn Th√†nh', 'lumi hn 08 hold': 'Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh', 'lumi hn 10': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'lumi hn 12': 'Tr·∫ßn Qu·ªëc Kh·∫£i', 'lumi hn 19': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 23(hold)': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'lumi hn 24': 'M·∫°nh C∆∞·ªùng', 'lumi hn 25': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'lumi hn 26': 'L√™ ƒê√¨nh To·∫£n', 'lumi hn 27': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 30': 'Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh', 'lumi hn 33': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'lumi  hn 34': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 35': 'Tr·∫ßn Qu·ªëc Kh·∫£i', 'lumi hn 37': 'V≈© Vi·∫øt Anh', 'lumi hn 40': 'L√™ ƒê√¨nh To·∫£n', 'lumi hn 42': 'ƒêo√†n Ng·ªçc Hu√¢n', 'lumi hn 44': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 45': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 46': 'V≈© Vi·∫øt Anh', 'lumi hn 47': 'Tr·∫ßn Qu·ªëc Kh·∫£i', 'lumi hn 48': 'Tr·∫ßn Qu·ªëc Kh·∫£i', 'lumi hn 49': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 50': 'M·∫°nh C∆∞·ªùng', 'lumi hn 51': 'ƒêo√†n Ng·ªçc Hu√¢n', 'lumi hn 53': 'Ph·∫°m Ti·∫øn Th√†nh', 'lumi hn 54': 'Ph·∫°m Ti·∫øn Th√†nh', 'lumi hn 55': 'Nguy·ªÖn Quang Tr∆∞·ªùng', 'c∆∞·ªùng test 01': 'Test team C∆∞·ªùng', 'lumi hn 61': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'lumi hn 62': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 63': 'M·∫°nh C∆∞·ªùng', 'lumi hn 64': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 65 -7': 'L·ª•c Tr·∫ßn Minh Tr√≠', 'lumi hn 70-7': 'Nguy·ªÖn Th·ªã Hi·∫øu', 'lumi hn 66': 'Nguy·ªÖn Hi·ªÅn L∆∞∆°ng', 'lumi hn 67': 'Tr·∫ßn Huy H√πng', 'lumi hn 71': 'ƒêo√†n Ng·ªçc Hu√¢n', 'lumi hn 72': 'Nguy·ªÖn Quang Tr∆∞·ªùng', 'lumi hn 74': 'V≈© Vi·∫øt Anh', 'lumi hn 75': 'Ph·∫°m Ti·∫øn Th√†nh', 'lumi hn 76': 'Tr·∫ßn Ti·∫øn', 'lumi hn 77': 'Nguy·ªÖn Th·ªã Nh∆∞ Qu·ª≥nh', 'lumi hn 78': 'Nguy·ªÖn Anh Tu·∫•n', 'lumi hn 79': 'Nguy·ªÖn Hi·ªÅn L∆∞∆°ng', 'lumi hn 81': 'Nguy·ªÖn Hi·ªÅn L∆∞∆°ng', 'lumi hn 82': 'Ph·∫°m Ti·∫øn Th√†nh', 'lumi hn 83': 'Ph·∫°m Ti·∫øn Th√†nh', 'lumi hn 85 mst': 'Tr·∫ßn Huy H√πng', 'lmi hn 84 mst': 'Nguy·ªÖn Hi·ªÅn L∆∞∆°ng'
  };

  function createRow(data = {}) {
    const tr = document.createElement('tr');
    const today = new Date().toISOString().split('T')[0];
    tr.innerHTML = `
      <td><button type="button" class="removeRow">‚ùå</button></td>
      <td class="idcol"><input name="id" value="${data.id || ''}"></td>
      <td><input name="name" list="nameList" value="${data.name || ''}" readonly></td>
      <td><input name="ngay" type="date" value="${data.ngay || today}"></td>
      <td>
        <select name="ca">
          <option value="">--Ch·ªçn--</option>
          <option value="H·∫øt ca">H·∫øt ca</option>
          <option value="Gi·ªØa ca">Gi·ªØa ca</option>
          <option value="Ca Chi·ªÅu">Ca Chi·ªÅu</option>
        </select>
      </td>
      <td><input name="sanpham" list="productList" value="${data.sanpham || ''}"></td>
      <td><input name="thitruong" list="marketList" value="${data.thitruong || ''}"></td>
      <td><input name="page" value="${data.page || ''}"></td>
      <td><input name="tkqc" list="tkqcList" value="${data.tkqc || ''}"></td>
      <td><input name="cpqc" type="number" value="${data.cpqc || ''}"></td>
      <td><input name="vialog" value="${data.vialog || ''}"></td>
      <td><input name="messcmt" type="number" value="${data.messcmt || ''}"></td>
      <td><input name="sodon" type="number" value="${data.sodon || ''}"></td>
      <td><input name="dschot" type="number" value="${data.dschot || ''}"></td>
      <td><input name="donhuy" type="number" value="${data.donhuy || ''}"></td>
      <td><input name="dssauhh" type="number" value="${data.dssauhh || ''}"></td>
      <td><input name="sosauhh" type="number" value="${data.sosauhh || ''}"></td>
      <td><input name="team" value="${data.team || ''}"></td>
      <td><input name="idns" value="${data.idns || ''}"></td>
    `;
    
    tr.querySelector('.removeRow').addEventListener('click', () => tr.remove());
    
    const tkqcInput = tr.querySelector('input[name="tkqc"]');
    const nameInput = tr.querySelector('input[name="name"]');
    tkqcInput.addEventListener('input', (e) => {
        const selectedTkqc = e.target.value.trim();
        const correspondingName = tkqcToNameMap[selectedTkqc] || '';
        nameInput.value = correspondingName;
    });

    tbody.appendChild(tr);
  }

  document.addEventListener('DOMContentLoaded', () => {
    createRow();
  });
  
  addRowBtn.addEventListener('click', () => createRow());

  form.addEventListener('submit', e => {
    e.preventDefault();
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    respMsg.innerText = 'ƒêang g·ª≠i d·ªØ li·ªáu...';
    respMsg.style.color = 'orange';

    const allRows = Array.from(tbody.querySelectorAll('tr')).map(tr => {
      const rowData = {};
      tr.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.name) {
          rowData[el.name] = el.value;
        }
      });
      return rowData;
    });

    if (!allRows.length) {
      respMsg.style.color = 'red';
      respMsg.innerText = 'Ch∆∞a c√≥ d√≤ng n√†o ƒë·ªÉ g·ª≠i!';
      submitBtn.disabled = false;
      return;
    }

    // *** ƒê√É C·∫¨P NH·∫¨T URL C·ª¶A B·∫†N V√ÄO ƒê√ÇY ***
    const scriptURL = 'https://script.google.com/macros/s/AKfycbx3FBVxpPbcPavMUtfLsbq0VNbnjjnL__F-eJXiVmAbYaiU7XLQbCDAfhsGu2Rh3MVFMA/exec'; 
    
    fetch(scriptURL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ rows: allRows })
    })
    .then(response => response.json()) // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
    .then(data => {
        console.log('Success:', data);
        respMsg.style.color = 'green';
        respMsg.innerText = data.message || 'G·ª≠i th√†nh c√¥ng!';
        tbody.innerHTML = ''; 
        createRow(); 
        submitBtn.disabled = false;
    })
    .catch(error => {
        console.error('Error!', error);
        respMsg.style.color = 'red';
        respMsg.innerText = 'ƒê√£ x·∫£y ra l·ªói khi g·ª≠i. Vui l√≤ng ki·ªÉm tra Console (F12) ƒë·ªÉ bi·∫øt chi ti·∫øt.';
        submitBtn.disabled = false;
    });
  });
</script>
</body>
</html>













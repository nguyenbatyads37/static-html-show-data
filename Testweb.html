<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Form G·ª≠i Nhi·ªÅu D√≤ng</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 30px auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    input, textarea { width: 100%; box-sizing: border-box; }
    button { padding: 6px 12px; margin: 4px; }
    #responseMessage { margin-top: 12px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Th√™m / Ch·ªânh s·ª≠a nhi·ªÅu d√≤ng</h2>
  <button id="addRow" type="button">‚ûï Th√™m d√≤ng</button>

  <form id="dataForm">
    <table id="dataTable">
      <thead>
        <tr>
          <th>T√™n</th>
          <th>Email</th>
          <th>Message</th>
          <th>Dogf</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <!-- C√°c d√≤ng s·∫Ω ƒë∆∞·ª£c th√™m t·ª± ƒë·ªông v√†o ƒë√¢y -->
      </tbody>
    </table>
    <button type="submit" id="submitBtn">üöÄ G·ª≠i t·∫•t c·∫£</button>
  </form>

  <p id="responseMessage"></p>

  <script>
    const addRowBtn = document.getElementById('addRow');
    const tbody     = document.querySelector('#dataTable tbody');
    const form      = document.getElementById('dataForm');
    const respMsg   = document.getElementById('responseMessage');
    // Thay URL ·ªü ƒë√¢y b·∫±ng link c·ªßa b·∫°n
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxIjM0XaM1FvQoquodYmuoCnWO-RBTko6z1PnE3rHEOcfr2Xih48jkzCa1pWus8QuntTQ/exec';

    // T·∫°o m·ªôt d√≤ng m·ªõi, data = {name, email, message, dogf}
    function createRow(data = {}) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input name="name"    value="${data.name || ''}"    required></td>
        <td><input name="email"   type="email" value="${data.email || ''}"   required></td>
        <td><textarea name="message" rows="2">${data.message || ''}</textarea></td>
        <td><input name="dogf"    value="${data.dogf || ''}"></td>
        <td><button type="button" class="removeRow">‚ùå</button></td>
      `;
      tr.querySelector('.removeRow').addEventListener('click', () => tr.remove());
      tbody.appendChild(tr);
    }

    // N·∫øu URL c√≥ param `rows`, prefill
    (()=>{
      const params = new URLSearchParams(window.location.search);
      const rowsParam = params.get('rows');
      if (rowsParam) {
        try {
          const rows = JSON.parse(decodeURIComponent(rowsParam));
          if (Array.isArray(rows)) rows.forEach(r => createRow(r));
        } catch (e) {
          console.warn('Kh√¥ng parse ƒë∆∞·ª£c rows param:', e);
        }
      }
    })();

    // Click th√™m d√≤ng
    addRowBtn.addEventListener('click', () => createRow());

    // Submit form
    form.addEventListener('submit', e => {
      e.preventDefault();
      const allRows = Array.from(tbody.querySelectorAll('tr')).map(tr => ({
        name:    tr.querySelector('[name="name"]').value,
        email:   tr.querySelector('[name="email"]').value,
        message: tr.querySelector('[name="message"]').value,
        dogf:    tr.querySelector('[name="dogf"]').value
      }));
      if (!allRows.length) {
        respMsg.style.color = 'red';
        return respMsg.innerText = 'Ch∆∞a c√≥ d√≤ng n√†o ƒë·ªÉ g·ª≠i!';
      }
      // G·ª≠i d∆∞·ªõi d·∫°ng form-urlencoded ƒë·ªÉ tr√°nh CORS preflight
      const payload = new URLSearchParams({ rows: JSON.stringify(allRows) });
      fetch(SCRIPT_URL, {
        method: 'POST',
        body: payload
      })
      .then(r => r.json())
      .then(json => {
        if (json.error) {
          respMsg.style.color = 'red';
          respMsg.innerText = 'L·ªói: ' + json.error;
        } else {
          respMsg.style.color = 'green';
          respMsg.innerText = json.message;
          tbody.innerHTML = '';
        }
      })
      .catch(err => {
        respMsg.style.color = 'red';
        respMsg.innerText = 'L·ªói g·ª≠i: ' + err;
      });
    });
  </script>
</body>
</html>


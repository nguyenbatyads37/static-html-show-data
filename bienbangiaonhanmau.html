<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Biên bản giao nhận mẫu - Truyền dữ liệu tự động</title>
  <style>
    @page {
      size: A4;
      margin: 2cm;
    }
    body {
      font-family: 'Times New Roman', serif;
      font-size: 14px;
      line-height: 1.6;
    }
    .title {
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .sub-title {
      text-align: center;
      font-size: 14px;
      margin-bottom: 20px;
    }
    .section-title {
      font-weight: bold;
      margin-top: 20px;
      margin-bottom: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    td, th {
      border: 1px solid black;
      padding: 6px;
      vertical-align: top;
    }
    .no-border td {
      border: none;
      padding: 4px;
    }
    .sign-box {
      text-align: center;
      border: 1px solid black;
      padding: 20px 10px;
      height: 120px;
    }
    .centered {
      text-align: center;
    }
    .note {
      font-style: italic;
    }
    /* Phần hiển thị URL (ẩn đi nếu không cần debug) */
    #debug-url {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f0f0f0;
      padding: 10px;
      border: 1px solid #ccc;
      font-size: 12px;
      max-width: 500px;
      display: none; /* Ẩn đi khi không cần debug */
    }
  </style>
</head>
<body>

<!-- Nội dung biên bản gốc (giữ nguyên) -->
<h2 class="title">BIÊN BẢN GIAO NHẬN MẪU</h2>
<div class="sub-title">Số phiếu kiểm nghiệm: -VS-25</div>

<div class="section-title">I. THÔNG TIN MẪU GỬI:</div>
<table class="no-border">
  <tr>
    <td><strong>Ngày lấy mẫu:</strong> 5/16/2025</td>
    <td><strong>Thị trường:</strong></td>
  </tr>
  <tr>
    <td><strong>Mục đích lấy mẫu:</strong> Dịch vụ</td>
    <td><strong>Địa điểm lấy mẫu:</strong></td>
  </tr>
  <tr>
    <td colspan="2"><strong>Ghi chú:</strong></td>
  </tr>
  <tr>
    <td colspan="2"><strong>Quy định tham chiếu:</strong></td>
  </tr>
</table>

<div class="section-title">II. THÔNG TIN MẪU PHÂN TÍCH:</div>
<table id="analysis-table">
  <tr>
    <th>Chỉ tiêu phân tích</th>
    <th>Đơn vị</th>
    <th>Phương pháp thử</th>
    <th>Kết quả</th>
  </tr>
  <tr>
    <td colspan="4"><strong>Tên mẫu: </strong> - Ngày sản xuất: 5/16/2025 - Mã số mẫu: 120601</td>
  </tr>
  <tr>
    <td>Coliform</td>
    <td>Det/Not Det</td>
    <td>ISO 4831: 2006</td>
    <td></td>
  </tr>
</table>

<div class="section-title">Kết luận về mẫu kiểm:</div>

<table style="margin-top: 10px;">
  <tr>
    <td class="centered"><strong>NGƯỜI GIAO MẪU</strong><br><span class="note">(Chữ ký, họ tên)</span></td>
    <td class="centered"><strong>NGƯỜI NHẬN MẪU</strong><br><span class="note">(Chữ ký, họ tên)</span></td>
  </tr>
  <tr>
    <td class="sign-box"></td>
    <td class="sign-box"></td>
  </tr>
</table>

<div class="centered">
  Thời gian: ngày……tháng……năm……
</div>

<div class="centered">
  <strong>ĐẠI DIỆN PHÒNG KIỂM NGHIỆM</strong>
</div>

<!-- Phần debug (có thể ẩn đi) -->
<div id="debug-url"></div>

<script>
  // Hàm mã hóa dữ liệu bảng thành chuỗi
  function encodeTableData(table) {
    let encodedData = "";
    const rows = table.rows;
    
    for (let i = 0; i < rows.length; i++) {
      if (i > 0) encodedData += "_b_"; // Phân cách dòng
      
      const cells = rows[i].cells;
      for (let j = 0; j < cells.length; j++) {
        if (j > 0) encodedData += "_a_"; // Phân cách cột
        encodedData += cells[j].textContent.trim();
      }
    }
    
    return encodedData;
  }

  // Hàm tạo URL với dữ liệu
  function generateDataUrl() {
    // Thu thập thông tin cơ bản
    const formData = {
      so_phieu: "-VS-25",
      ngay_lay_mau: "5/16/2025",
      muc_dich: "Dịch vụ",
      ma_mau: "120601"
    };

    // Mã hóa dữ liệu bảng
    const analysisTable = document.getElementById("analysis-table");
    const tableData = encodeTableData(analysisTable);
    
    // Tạo URL (thay YOUR_ENDPOINT bằng endpoint thực tế)
    const baseUrl = "https://your-api-endpoint.com/nhan-mau";
    const params = new URLSearchParams();
    
    // Thêm thông tin cơ bản
    for (const key in formData) {
      params.append(key, formData[key]);
    }
    
    // Thêm dữ liệu bảng dưới dạng mã hóa
    params.append("data", tableData);
    
    const fullUrl = `${baseUrl}?${params.toString()}`;
    
    // Hiển thị URL để debug (có thể bỏ qua)
    document.getElementById("debug-url").textContent = fullUrl;
    
    return fullUrl;
  }

  // Tự động chạy khi trang tải xong
  document.addEventListener("DOMContentLoaded", function() {
    const dataUrl = generateDataUrl();
    
    // Tự động chuyển hướng (bỏ comment nếu cần)
    // window.location.href = dataUrl;
    
    console.log("URL đã tạo:", dataUrl);
  });
</script>

</body>
</html>

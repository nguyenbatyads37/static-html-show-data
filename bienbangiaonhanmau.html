<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Biên bản giao nhận mẫu</title>
  <style>
    @page { size: A4; margin: 2cm; }
    body { font-family: 'Times New Roman', serif; font-size: 14px; line-height: 1.6; }
    .title { text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 10px; }
    .sub-title { text-align: center; font-size: 14px; margin-bottom: 20px; }
    .section-title { font-weight: bold; margin-top: 20px; margin-bottom: 5px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    td, th { border: 1px solid black; padding: 6px; vertical-align: top; }
    .no-border td { border: none; padding: 4px; }
    .sign-box { text-align: center; border: 1px solid black; padding: 20px 10px; height: 120px; }
    .centered { text-align: center; }
    .note { font-style: italic; }
  </style>
</head>
<body>

<h2 class="title">BIÊN BẢN GIAO NHẬN MẪU</h2>
<div class="sub-title">Số phiếu kiểm nghiệm: <span id="so-phieu">-VS-25</span></div>

<div class="section-title">I. THÔNG TIN MẪU GỬI:</div>
<table class="no-border">
  <tr>
    <td><strong>Ngày lấy mẫu:</strong> <span id="ngay-lay-mau">5/16/2025</span></td>
    <td><strong>Thị trường:</strong> <span id="thi-truong"></span></td>
  </tr>
  <tr>
    <td><strong>Mục đích lấy mẫu:</strong> <span id="muc-dich">Dịch vụ</span></td>
    <td><strong>Địa điểm lấy mẫu:</strong> <span id="dia-diem"></span></td>
  </tr>
  <tr>
    <td colspan="2"><strong>Ghi chú:</strong> <span id="ghi-chu"></span></td>
  </tr>
  <tr>
    <td colspan="2"><strong>Quy định tham chiếu:</strong> <span id="quy-dinh"></span></td>
  </tr>
</table>

<div class="section-title">II. THÔNG TIN MẪU PHÂN TÍCH:</div>
<table id="mau-phan-tich">
  <tr>
    <th>Chỉ tiêu phân tích</th>
    <th>Đơn vị</th>
    <th>Phương pháp thử</th>
    <th>Kết quả</th>
  </tr>
  <tr>
    <td colspan="4">
      <strong>Tên mẫu:</strong> <span id="ten-mau"></span> - 
      <strong>Ngày sản xuất:</strong> <span id="ngay-san-xuat">5/16/2025</span> - 
      <strong>Mã số mẫu:</strong> <span id="ma-mau">120601</span>
    </td>
  </tr>
  <tr>
    <td>Coliform</td>
    <td>Det/Not Det</td>
    <td>ISO 4831: 2006</td>
    <td></td>
  </tr>
</table>

<div class="section-title">Kết luận về mẫu kiểm:</div>

<table style="margin-top: 10px;">
  <tr>
    <td class="centered"><strong>NGƯỜI GIAO MẪU</strong><br><span class="note">(Chữ ký, họ tên)</span></td>
    <td class="centered"><strong>NGƯỜI NHẬN MẪU</strong><br><span class="note">(Chữ ký, họ tên)</span></td>
  </tr>
  <tr>
    <td class="sign-box"></td>
    <td class="sign-box"></td>
  </tr>
</table>

<div class="centered">
  Thời gian: ngày……tháng……năm……
</div>

<div class="centered">
  <strong>ĐẠI DIỆN PHÒNG KIỂM NGHIỆM</strong>
</div>

<script>
  // Hàm chuyển bảng thành chuỗi data
  function convertTableToData() {
    const table = document.getElementById('mau-phan-tich');
    let dataString = '';
    
    // Duyệt qua từng dòng
    const rows = table.getElementsByTagName('tr');
    for (let i = 0; i < rows.length; i++) {
      if (i > 0) dataString += '_b_'; // Phân cách dòng
      
      // Duyệt qua từng ô
      const cells = rows[i].getElementsByTagName('td');
      const headers = rows[i].getElementsByTagName('th');
      const allCells = headers.length > 0 ? headers : cells;
      
      for (let j = 0; j < allCells.length; j++) {
        if (j > 0) dataString += '_a_'; // Phân cách cột
        dataString += allCells[j].textContent.trim();
      }
    }
    
    return dataString;
  }

  // Hàm tạo URL với các tham số
  function generateDataURL() {
    // Thu thập thông tin cơ bản
    const params = new URLSearchParams();
    params.append('so_phieu', document.getElementById('so-phieu').textContent);
    params.append('ngay_lay_mau', document.getElementById('ngay-lay-mau').textContent);
    params.append('muc_dich', document.getElementById('muc-dich').textContent);
    params.append('ma_mau', document.getElementById('ma-mau').textContent);
    
    // Thêm dữ liệu bảng
    const tableData = convertTableToData();
    params.append('data', tableData);
    
    // Tạo URL hoàn chỉnh (thay example.com bằng domain thực tế)
    return `https://example.com/nhan-mau?${params.toString()}`;
  }

  // Tự động tạo URL khi trang tải xong
  document.addEventListener('DOMContentLoaded', function() {
    const dataURL = generateDataURL();
    console.log('URL truyền dữ liệu:', dataURL);
    
    // Tự động chuyển hướng nếu cần
    // window.location.href = dataURL;
  });
</script>

</body>
</html>

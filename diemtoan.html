<!DOCTYPE html>
<html lang="vi">
<head>
    <!-- Phần head giữ nguyên như trước -->
    <style>
        /* Thêm các style mới */
        .summary-panel {
            margin: 30px;
            padding: 25px;
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .summary-title {
            font-family: 'Poppins', sans-serif;
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .summary-card {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid var(--primary);
        }
        
        .summary-card h4 {
            margin: 0 0 10px;
            color: var(--secondary);
            font-size: 16px;
        }
        
        .summary-score {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .comment-content ul, 
        .comment-content ol {
            padding-left: 20px;
            margin: 10px 0;
        }
        
        .comment-content li {
            margin-bottom: 8px;
        }
        
        .comment-content p {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- Phần body giữ nguyên đến trước wish-comment-section -->
    
    <div id="wish-comment-section"></div>
    
    <!-- Phần footer giữ nguyên -->
    
    <script>
        // Các hàm giữ nguyên cho đến hàm generateReport
        
        // Hàm tạo báo cáo - cập nhật để thêm phần tổng hợp điểm
        function generateReport(data) {
            const subjects = {};
            let totalAchieved = 0;
            let totalPossible = 0;
            
            data.forEach(item => {
                if (!subjects[item.subject]) {
                    subjects[item.subject] = [];
                }
                subjects[item.subject].push(item);
                totalAchieved += item.achieved;
                totalPossible += item.total;
            });
            
            const overallPercentage = Math.round((totalAchieved / totalPossible) * 100);
            
            let reportHTML = `
                <div class="summary-panel">
                    <h3 class="summary-title">TỔNG HỢP ĐIỂM</h3>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>Tổng điểm đạt được</h4>
                            <div class="summary-score">${totalAchieved}/${totalPossible}</div>
                        </div>
                        <div class="summary-card">
                            <h4>Tỷ lệ hoàn thành</h4>
                            <div class="summary-score">${overallPercentage}%</div>
                        </div>
                        <div class="summary-card">
                            <h4>Số môn học</h4>
                            <div class="summary-score">${Object.keys(subjects).length}</div>
                        </div>
                    </div>
                </div>
            `;
            
            for (const subject in subjects) {
                // Phần môn học giữ nguyên như trước
            }
            
            document.getElementById('report-content').innerHTML = reportHTML;
        }

        // Hàm hiển thị lời chúc và nhận xét - cập nhật để xử lý HTML
        function renderWishAndComment(comment) {
            const wishCommentHTML = `
                <div class="wish-box">
                    <h3 class="wish-title">LỜI NHẮN GỬI ĐẾN HỌC SINH</h3>
                    <div class="wish-content">
                        <p>Chúc em <strong>${studentName}</strong> tiếp tục phát huy những điểm mạnh và khắc phục những điểm cần cải thiện.</p>
                        <p>Chúc em đạt kết quả cao trong kỳ thi vào lớp 10 sắp tới!</p>
                    </div>
                </div>
                
                ${comment ? `
                <div class="comment-box">
                    <h4 class="comment-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#d97706" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        NHẬN XÉT CỦA GIÁO VIÊN
                    </h4>
                    <div class="comment-content">${formatComment(comment)}</div>
                </div>
                ` : ''}
            `;
            
            document.getElementById('wish-comment-section').innerHTML = wishCommentHTML;
        }

        // Hàm định dạng nhận xét để hiển thị HTML
        function formatComment(comment) {
            // Thay thế xuống dòng bằng thẻ <br>
            let formatted = comment.replace(/\n/g, '<br>');
            
            // Định dạng các đầu mục đánh số
            formatted = formatted.replace(/(\d+\.)\s/g, '<br>$1 '); // Thêm <br> trước mỗi số thứ tự
            formatted = formatted.replace(/<br><br>/g, '<br>'); // Loại bỏ <br> thừa
            
            return formatted;
        }
    </script>
</body>
</html>

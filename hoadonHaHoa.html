<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hóa đơn đặt hàng</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background: white;
            font-size: 14px;
            line-height: 1.5;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        .logo {
            width: 120px;
            height: auto;
        }
        .qr-code {
            width: 70px;
            height: 70px;
        }
        .company-info {
            text-align: center;
            flex-grow: 1;
            margin: 0 15px;
        }
        .company-name {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .invoice-title {
            text-align: center;
            font-weight: bold;
            font-size: 20px;
            margin: 20px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .order-info {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .total {
            text-align: right;
            margin: 15px 0;
            font-weight: bold;
            font-size: 15px;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 13px;
        }
        .barcode {
            text-align: center;
            margin: 25px 0;
        }
        .barcode img {
            height: 60px;
        }
        .signature {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        .signature-box {
            text-align: center;
            width: 45%;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://www.appsheet.com/template/gettablefileurl?appName=B%C3%A1ogi%C3%A1s%E1%BA%A3nph%E1%BA%A9m-325045268&tableName=c%C3%A0i%20%C4%91%E1%BA%B7t%20APP&fileName=C%C3%A0i%20%C4%91%E1%BA%B7t%20APP_Images%2F79ab1bb2.%E1%BA%A2nh.040547.jpg" alt="Logo" class="logo">
        <div class="company-info">
            <div class="company-name">NPP HÀ HÒA</div>
            <div>PHÂN PHỐI CÁC MẶT HÀNG ĐỒ DÙNG 1 LẦN</div>
            <div>NILON - CỐC NHỰA - CỐC GIẤY - KHAY XỐP</div>
            <div>CHAI NHỰA - MÀNG BỌC THỰC PHẨM</div>
            <div>ĐC: TIÊN PHONG, BA VÌ, HÀ NỘI</div>
        </div>
        <img id="qr-code" src="" alt="QR Code" class="qr-code">
    </div>

    <div class="invoice-title">HÓA ĐƠN ĐẶT HÀNG</div>

    <div class="barcode">
        <img id="barcode" src="" alt="Barcode">
    </div>

    <div class="order-info">
        <div>
            <div><strong>Mã đơn hàng:</strong> <span id="order-id"></span></div>
            <div><strong>Khách hàng:</strong> <span id="customer"></span></div>
            <div><strong>Địa chỉ:</strong> <span id="address"></span></div>
        </div>
        <div>
            <div><strong>Thời gian đặt hàng:</strong> <span id="order-time"></span></div>
            <div><strong>Thời gian in:</strong> <span id="print-time"></span></div>
            <div><strong>SĐT NV:</strong> <span id="staff-phone"></span></div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Tên hàng</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Thành tiền</th>
            </tr>
        </thead>
        <tbody id="table-body">
        </tbody>
    </table>

    <div class="total">
        <div>Tổng tiền hàng: <span id="total-amount"></span></div>
        <div>Tổng tiền phải thanh toán: <span id="total-payable"></span></div>
    </div>

    <div class="footer">
        <div><strong>Quý khách lưu ý:</strong></div>
        <div>Kiểm tra hàng hóa trong vòng 02 ngày kể từ ngày giao hàng</div>
        <div>Mọi khiếu nại về số lượng, chất lượng xin liên hệ ngay</div>
        <div>Nhà phân phối không chịu trách nhiệm khi nhân viên đã rời đi</div>
    </div>

    <div class="signature">
        <div class="signature-box">
            <div>Nhân viên giao hàng</div>
            <div>(Ký và ghi rõ họ tên)</div>
        </div>
        <div class="signature-box">
            <div>Khách hàng</div>
            <div>(Ký và ghi rõ họ tên)</div>
        </div>
    </div>

    <script>
        // Hàm lấy query parameters từ URL
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                qr: params.get('qr') || '',
                bar: params.get('bar') || '',
                orderId: params.get('Mã đơn') || '',
                customer: params.get('KH') || '',
                address: params.get('DC') || '',
                time: params.get('time') || '',
                staffPhone: params.get('sđtnv') || '',
                data: params.get('data') || ''
            };
        }

        // Hàm định dạng thời gian hiện tại
        function formatCurrentTime() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        // Lấy dữ liệu từ query params
        const params = getQueryParams();

        // Điền dữ liệu vào HTML
        document.getElementById('qr-code').src = params.qr;
        document.getElementById('barcode').src = params.bar;
        document.getElementById('order-id').textContent = params.orderId;
        document.getElementById('customer').textContent = params.customer;
        document.getElementById('address').textContent = params.address;
        document.getElementById('order-time').textContent = params.time;
        document.getElementById('staff-phone').textContent = params.staffPhone;
        document.getElementById('print-time').textContent = formatCurrentTime();

        // Parse và render bảng dữ liệu
        const tableBody = document.getElementById('table-body');
        let total = 0;
        if (params.data) {
            const rows = params.data.split('_b_');
            rows.forEach(row => {
                if (row) {
                    const [name, quantity, unitPrice, amount] = row.split('_a_');
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${name}</td>
                        <td>${quantity}</td>
                        <td>${unitPrice}</td>
                        <td>${amount}</td>
                    `;
                    tableBody.appendChild(tr);
                    // Tính tổng tiền từ cột Thành tiền
                    const amountValue = parseInt(amount.replace(/,/g, '')) || 0;
                    total += amountValue;
                }
            });
        }

        // Định dạng số tiền
        const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');

        // Điền tổng tiền
        const totalFormatted = formatNumber(total);
        document.getElementById('total-amount').textContent = totalFormatted;
        document.getElementById('total-payable').textContent = totalFormatted;
    </script>
</body>
</html>

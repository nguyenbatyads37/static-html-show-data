<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hóa đơn đặt hàng</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; font-size: 14px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { display: flex; align-items: center; margin-bottom: 10px; }
        .header img { width: 80px; height: auto; margin-right: 10px; }
        .header-text { flex-grow: 1; }
        .header-text h1 { margin: 0; font-size: 18px; color: #000; }
        .header-text p { margin: 2px 0; font-size: 12px; }
        .title { text-align: center; font-size: 16px; font-weight: bold; margin: 10px 0; }
        .info { margin: 5px 0; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #000; padding: 5px; text-align: left; font-size: 12px; }
        th { background-color: #f2f2f2; }
        .total { font-weight: bold; margin-top: 10px; }
        .footer { margin-top: 20px; font-size: 12px; }
        .qr-code { margin-top: 10px; }
        .qr-code img { width: 100px; height: 100px; }
        .note { font-style: italic; margin-top: 10px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Logo -->
        <div class="header">
            <img src="https://www.appsheet.com/template/gettablefileurl?appName=B%C3%A1ogi%C3%A1s%E1%BA%A3nph%E1%BA%A9m-325045268&tableName=c%C3%A0i%20%C4%91%E1%BA%B7t%20APP&fileName=C%C3%A0i%20%C4%91%E1%BA%B7t%20APP_Images%2F79ab1bb2.%E1%BA%A2nh.040547.jpg" alt="Logo">
            <div class="header-text">
                <h1 id="company-name">NPP HÀ HÒA</h1>
                <p>Phân Phối các mặt hàng đồ dùng 1 lần: Nylon, Cốc giấy, Khay xốp các loại, Chai nhựa, <br> Máy bọc thực phẩm...</p>
                <p>ĐC: Tiền Phong, Bà Vì, Hà Nội</p>
                <p>Góp ý chất lượng sản phẩm & dịch vụ: 0973.905.992 - Lương hề phân phối: 0969.250.323</p>
            </div>
        </div>

        <!-- Title -->
        <div class="title">HÓA ĐƠN ĐẶT HÀNG</div>

        <!-- Order Info -->
        <div class="info">
            <strong>Mã đơn hàng:</strong> <span id="order-id">DH017845</span><br>
            <strong>Thời gian đặt hàng:</strong> 24/04/2025 17:21:25<br>
            <strong>Thời gian giao:</strong> 24/04/2025 17:21:25 - Minh LX<br>
            <strong>Khách hàng:</strong> 106 thông bảo vận hòa bà vì<br>
            <strong>NV bán hàng:</strong> NV.038484784<br>
            <strong>SDT:</strong> 0988421931
        </div>

        <!-- Product Table -->
        <table id="product-table">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên hàng</th>
                    <th>Số lượng</th>
                    <th>Đơn giá</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Dữ liệu sẽ được thêm bằng JS -->
            </tbody>
        </table>

        <!-- Total -->
        <div class="total">
            <strong>Tổng tiền:</strong> <span id="total-amount">0</span>đ
        </div>

        <!-- Note -->
        <div class="note">
            <p><strong>Bằng chữ:</strong> Một trăm tám mươi hai nghìn đồng chẵn/</p>
            <p><strong>"Quý Khách lưu ý:</strong> Quý khách đặt hàng lớn từ 02 ngày. Mọi khiếu nại hàng lỗi, sốt, đoản độA. Quý khách kiểm hàng cân đối, đặt đúng số lượng hàng hóa NPP không chịu trách nhiệm khi nhận lại quý khách 1</p>
        </div>

        <!-- QR Code -->
        <div class="qr-code">
            <img id="qr-image" src="" alt="QR Code">
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Ngày kiểm: Xuấn Tình<br>(Quý Khách vui lòng gọi mặt hàng trước 22h tối, giờ tiếp nhận chuyển khoản)</p>
            <p>Nhân viên giao hàng<br>(Ký và Ghi rõ họ tên)</p>
        </div>
    </div>

    <script>
        // Hiển thị tất cả tham số URL để debug
        console.log("Tất cả tham số URL:", window.location.search);
        
        // Lấy tham số từ URL
        const params = new URLSearchParams(window.location.search);
        
        // Hiển thị từng tham số để kiểm tra
        console.log("Tham số id:", params.get('id'));
        console.log("Tham số iddata:", params.get('iddata'));
        console.log("Tham số qr:", params.get('qr'));
        
        // Cập nhật thông tin cơ bản
        if (params.get('id')) {
            document.getElementById('order-id').textContent = params.get('id');
        }
        
        if (params.get('ct')) {
            document.getElementById('company-name').textContent = decodeURIComponent(params.get('ct'));
        }

        // Cập nhật QR code
        if (params.get('qr')) {
            document.getElementById('qr-image').src = decodeURIComponent(params.get('qr'));
        }
        
        // Xử lý dữ liệu bảng
        const tableBody = document.getElementById('table-body');
        if (params.get('iddata')) {
            try {
                const rows = params.get('iddata').split('_b_');
                let total = 0;
                
                rows.forEach((row, index) => {
                    const cols = row.split('_a_');
                    if (cols.length >= 5) {
                        const rowTotal = parseInt(cols[4]) || 0;
                        total += rowTotal;
                        
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${decodeURIComponent(cols[1])}</td>
                            <td>${cols[2]}</td>
                            <td>${parseInt(cols[3]).toLocaleString()}</td>
                            <td>${rowTotal.toLocaleString()}</td>
                        `;
                        tableBody.appendChild(tr);
                    }
                });
                
                document.getElementById('total-amount').textContent = total.toLocaleString();
            } catch (e) {
                console.error("Lỗi khi xử lý dữ liệu bảng:", e);
                tableBody.innerHTML = `<tr><td colspan="5" style="color:red">Lỗi tải dữ liệu sản phẩm</td></tr>`;
            }
        } else {
            tableBody.innerHTML = `<tr><td colspan="5">Không có dữ liệu sản phẩm</td></tr>`;
        }
    </script>
</body>
</html>

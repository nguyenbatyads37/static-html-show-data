<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biên Bản Giao Nhận Hàng Hóa</title>
    <style>
        /* Phần CSS giữ nguyên như trước */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .header-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header h1 {
            font-size: 18px;
            margin: 0;
            margin-left: 60px;
        }

        .header p {
            font-size: 14px;
            margin: 5px 0;
        }

        .logo {
            width: 150px;
            height: auto;
        }

        .company-info {
            text-align: center;
            font-size: 12px;
            width: 50%;
            margin-left: 20px;
        }

        .content {
            margin-top: 20px;
        }

        .content-row {
            display: flex;
            justify-content: space-between;
        }

        .content-left, .content-right {
            width: 48%;
        }

        .content-right {
            display: flex;
            flex-direction: column;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .info-label {
            font-weight: bold;
            margin-right: 10px;
        }

        .info-content {
            font-weight: normal;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .signature-table {
            margin-top: 30px;
            width: 100%;
        }

        .signature-table th, .signature-table td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        .qr-img {
            max-width: 100px;
            height: auto;
        }
    </style>
</head>

<body>
    <div class="header">
        <img src="https://github.com/user-attachments/assets/36e3f245-8d16-4aa4-b7c3-12e2a94e76c3" alt="Logo" class="logo">
        <div>
            <h1>BIÊN BẢN GIAO NHẬN HÀNG HÓA</h1>
            <p>Số: ……/24-BBGN, ngày 08/01/2025 14:20</p>
        </div>
        <div class="company-info">
            <p><strong>HGPT</strong></p>
            <p>KMIH: HGPT-8.2/BM09/Rev:02</p>
            <p>Ngày BH: 01/06/2018</p>
        </div>
    </div>
    <div class="content">
        <div class="content-row">
            <div class="content-left">
                <p><strong>Bên giao:</strong> <span id="bengiao"></span></p> <!-- Thay bằng giá trị động -->
                <p><strong>Đại diện:</strong> Nguyễn Công Đức</p>
                <p><strong>Chức vụ:</strong> Quản kho</p>
                <p><strong>Điện thoại:</strong> 0965486768</p>
                <p><strong>Nơi giao:</strong> Nhà máy sản xuất, đường số 8, KCN Hòa Cầm, Hòa Thọ Tây, Cẩm Lệ, Đà Nẵng.</p>
            </div>
            <div class="content-right">
                <div class="info-item">
                    <p class="info-label"><strong>Bên nhận:</strong></p>
                    <p class="info-content">Hòa Phát</p>
                </div>
                <div class="info-item">
                    <p class="info-label"><strong>Hạng mục:</strong></p>
                    <div class="info-content">
                        <p>037.24-3 - KCT silo 12.000T (SC1.2 - lần 1)</p>
                    </div>
                </div>
                <div class="info-item">
                    <p class="info-label"><strong>Nhà xe:</strong></p>
                    <p class="info-content">………..</p>
                </div>
                <div class="info-item">
                    <p class="info-label"><strong>Biển số:</strong></p>
                    <p class="info-content">………..</p>
                </div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>TT</th>
                    <th>QR</th>
                    <th>TÊN CẤU KIỆN</th>
                    <th>SỐ LƯỢNG</th>
                    <th>ĐƠN GIÁ</th>
                    <th>GHI CHÚ</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Các hàng sẽ được thêm động ở đây -->
            </tbody>
        </table>
    </div>

    <table class="signature-table">
        <thead>
            <tr>
                <th>LÁI XE</th>
                <th>BÊN NHẬN</th>
                <th>BÊN GIAO</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td>Người lập</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td>Kho</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td>dampn@phuoctuongmc.com</td>
            </tr>
        </tbody>
    </table>

    <script>
        const urlParams = new URLSearchParams(window.location.search);

        // Lấy giá trị của biến bengiao từ URL
        const bengiao = urlParams.get('bengiao');

        // Nếu có giá trị bengiao, thay thế nội dung trong phần "Bên giao"
        if (bengiao) {
            document.getElementById("bengiao").textContent = bengiao;
        }

        // Phần còn lại của mã JavaScript giữ nguyên
        function convertToMap(input) {
            const pairs = input.split('_b_');
            const map = new Map();
            pairs.forEach(pair => {
                const [key, chiTietSanPham, soLuongSanPham] = pair.split("_a_");
                if (!map.has(key)) {
                    map.set(key, []);
                }
                map.get(key).push({ chiTietSanPham: chiTietSanPham, soLuongSanPham: soLuongSanPham });
            });
            return map;
        }

        const mst = urlParams.get('mst');
        const diachi = urlParams.get('diachi');
        const lienhe = urlParams.get('lienhe');
        const chitiet = urlParams.get('chitiet');
        const dongia = urlParams.get('dongia');
        const ghichu = urlParams.get('ghichu');
        const tongcong = urlParams.get('tongcong');
        const chietkhau = urlParams.get('chietkhau');
        const vat = urlParams.get('vat');
        const thanhtien = urlParams.get('thanhtien');

        const resultMap = convertToMap(chitiet);

        const mapDongia = new Map();
        if (dongia) {
            const dongias = dongia.split('_b_');
            for (let i = 0; i < dongias.length; i++) {
                const chitietDongia = dongias[i].split('_a_');
                const sanPham = chitietDongia[0];
                const gia = chitietDongia[1];
                mapDongia.set(sanPham, gia);
            }
        }

        const mapGhichu = new Map();
        if (ghichu) {
            const ghichus = ghichu.split('_b_');
            for (let i = 0; i < ghichus.length; i++) {
                const chitietGhichu = ghichus[i].split('_a_');
                let ghichu = "";
                for (let j = 1; j < chitietGhichu.length; j++) {
                    ghichu += chitietGhichu[j] + '-';
                }
                ghichu = ghichu.slice(0, -1);
                const sanPham = chitietGhichu[0];
                mapGhichu.set(sanPham, ghichu);
            }
        }

        const tableBody = document.getElementById("tableBody");
        let itemHtml = "";
        let index = 1;

        for (const [key, value] of resultMap.entries()) {
            const chitietSize = value.length;
            itemHtml += '<tr>' +
                '<td rowspan="' + chitietSize + '">' + index + '</td>' +
                '<td rowspan="' + chitietSize + '"><img src="' + key + '" alt="QR Code" class="qr-img"></td>' +
                '<td>' + value[0].chiTietSanPham + '</td>' +
                '<td>' + value[0].soLuongSanPham + '</td>' +
                '<td rowspan="' + chitietSize + '">' + mapDongia.get(key) + '</td>' +
                '<td rowspan="' + chitietSize + '">' +
                '<img src="' + mapGhichu.get(key) + '" alt="Set Quà" class="img-fluid ghichu-img">' +
                '</td>' +
                '</tr>';

            if (chitietSize > 1) {
                for (let i = 1; i < chitietSize; i++) {
                    itemHtml += '<tr>' +
                        '<td>' + value[i].chiTietSanPham + '</td>' +
                        '<td>' + value[i].soLuongSanPham + '</td>' +
                        '</tr>';
                }
            }
            index++;
        }

        tableBody.innerHTML = itemHtml;
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LỆNH ĐIỀU XE</title>
    <style>
        @page {
            size: A4;
            margin: 2.5cm 2cm 2cm 2cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            font-size: 13pt;
            line-height: 1.6;
            color: #000;
            background: #fff;
            padding: 0;
        }
        
        .container {
            max-width: 21cm;
            margin: 0 auto;
            padding: 0;
            background: white;
        }
        
        /* Header quốc gia */
        .national-header {
            margin-bottom: 20px;
        }
        
        .national-title {
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .national-motto {
            text-align: center;
            font-size: 13pt;
            font-weight: bold;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .date-header {
            text-align: right;
            font-style: normal;
            margin-bottom: 25px;
        }
        
        /* Tiêu đề */
        .title {
            text-align: center;
            font-size: 16pt;
            font-weight: bold;
            text-transform: uppercase;
            margin: 20px 0 30px 0;
            letter-spacing: 1px;
        }
        
        /* Phần kính gửi */
        .recipient {
            margin-bottom: 25px;
        }
        
        .recipient strong {
            font-weight: bold;
        }
        
        /* Bảng thông tin */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .info-table tr {
            margin-bottom: 12px;
        }
        
        .info-label {
            width: 200px;
            font-weight: bold;
            vertical-align: top;
            padding-right: 10px;
            padding-bottom: 10px;
            padding-top: 5px;
        }
        
        .info-value {
            min-height: 25px;
            padding-bottom: 3px;
            vertical-align: bottom;
            word-wrap: break-word;
        }
        
        /* Dòng đặc biệt: Lái xe và Số người theo xe cùng dòng */
        .driver-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 12px;
        }
        
        .driver-left {
            display: flex;
            align-items: baseline;
            flex: 1;
        }
        
        .driver-label {
            font-weight: bold;
            margin-right: 10px;
            min-width: 200px;
        }
        
        .driver-value {
            min-height: 25px;
            padding-bottom: 3px;
            flex: 1;
        }
        
        .people-right {
            margin-left: 20px;
            display: flex;
            align-items: baseline;
        }
        
        .people-label {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .people-value {
            min-height: 25px;
            padding-bottom: 3px;
            min-width: 50px;
        }
        
        /* Container cho Nơi nhận và Chữ ký cùng hàng */
        .footer-section {
            margin-top: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        /* Phần nơi nhận */
        .recipients-section {
            flex: 1;
        }
        
        .recipients-label {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .recipient-item {
            margin-left: 20px;
            margin-bottom: 5px;
        }
        
        /* Phần chữ ký */
        .signature-area {
            text-align: center;
            min-width: 250px;
        }
        
        .signature-title {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12pt;
            margin-bottom: 40px;
        }
        
        .signature-name {
            font-weight: bold;
            margin-top: 3px;
            font-size: 12pt;
        }
        
        /* In ấn */
        @media print {
            body {
                padding: 0;
                margin: 0;
            }
            
            .container {
                max-width: 100%;
            }
        }
        
        /* Chỉnh sửa */
        [contenteditable="true"] {
            outline: none;
            min-height: 20px;
        }
        
        [contenteditable="true"]:focus {
            background-color: #f0f8ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header quốc gia -->
        <div class="national-header">
            <div class="national-title">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</div>
            <div class="national-motto">Độc lập – Tự do – Hạnh phúc</div>
        </div>
        
        <!-- Địa điểm và ngày -->
        <div class="date-header">
            <span id="location">Hà Tĩnh</span>, ngày <span id="day"></span> tháng <span id="month"></span> năm <span id="year"></span>
        </div>
        
        <!-- Tiêu đề -->
        <div class="title">LỆNH ĐIỀU XE</div>
        
        <!-- Kính gửi -->
        <div class="recipient">
            <strong>Kính gửi:</strong> <span id="recipient-name" contenteditable="true"></span>
        </div>
        
        <!-- Bảng thông tin -->
        <table class="info-table">
            <tr>
                <td class="info-label">Căn cứ:</td>
                <td class="info-value" contenteditable="true" id="cancu"></td>
            </tr>
            <tr>
                <td class="info-label">Đơn vị sử dụng xe:</td>
                <td class="info-value" contenteditable="true" id="donvisudungxe"></td>
            </tr>
            <tr>
                <td class="info-label">Lý do sử dụng:</td>
                <td class="info-value" contenteditable="true" id="lydosudung"></td>
            </tr>
            <tr>
                <td class="info-label">Tuyến đường xe chạy:</td>
                <td class="info-value" contenteditable="true" id="tuyenduong"></td>
            </tr>
            <tr>
                <td class="info-label">Ngày giờ xuất phát:</td>
                <td class="info-value" contenteditable="true" id="ngaygioxuatphat"></td>
            </tr>
            <tr>
                <td class="info-label">Kết thúc:</td>
                <td class="info-value" contenteditable="true" id="ngayketthuc"></td>
            </tr>
            <tr>
                <td class="info-label">Xe:</td>
                <td class="info-value" contenteditable="true" id="loaixe"></td>
            </tr>
        </table>
        
        <!-- Dòng đặc biệt: Lái xe và Số người theo xe -->
        <div class="driver-row">
            <div class="driver-left">
                <span class="driver-label">Lái xe:</span>
                <span class="driver-value" contenteditable="true" id="laixe"></span>
            </div>
            <div class="people-right">
                <span class="people-label">Số người theo xe:</span>
                <span class="people-value" contenteditable="true" id="songuoidikem"></span>
            </div>
        </div>
        
        <!-- Tiếp tục bảng thông tin -->
        <table class="info-table">
            <tr>
                <td class="info-label">Lệnh điều xe trong ngày:</td>
                <td class="info-value" contenteditable="true" id="lenhtrongngay"></td>
            </tr>
            <tr>
                <td class="info-label">Số km dự kiến:</td>
                <td class="info-value" contenteditable="true" id="sokmdukien"></td>
            </tr>
        </table>
        
        <!-- Phần nơi nhận và chữ ký cùng hàng -->
        <div class="footer-section">
            <!-- Phần nơi nhận -->
            <div class="recipients-section">
                <div class="recipients-label">Nơi nhận:</div>
                <div class="recipient-item">Như trên;</div>
                <div class="recipient-item">Lưu: VT.</div>
            </div>
            
            <!-- Phần chữ ký -->
            <div class="signature-area">
                <div class="signature-title">PHÓ CHÁNH VĂN PHÒNG</div>
                <div style="height: 40px; margin-bottom: 3px;"></div>
                <div class="signature-name" contenteditable="true" id="nguoiky">Trịnh Quỳnh Trâm</div>
            </div>
        </div>
    </div>
    
    <script>
        // Hàm lấy tham số từ URL
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // Hàm decode URL
        function decodeUrlParam(param) {
            if (!param) return '';
            return decodeURIComponent(param.replace(/\+/g, ' '));
        }
        
        // Tự động cập nhật ngày tháng hiện tại (ngày tạo phiếu)
        function updateCurrentDate() {
            const now = new Date();
            const day = now.getDate();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            
            document.getElementById('day').textContent = day;
            document.getElementById('month').textContent = month;
            document.getElementById('year').textContent = year;
        }
        
        // Mapping các biến từ URL parameters
        const fieldMapping = {
            'cancu': 'cancu',
            'donvisudungxe': 'donvisudungxe',
            'lydosudung': 'lydosudung',
            'tuyenduong': 'tuyenduong',
            'ngaygioxuatphat': 'ngaygioxuatphat',
            'ngayketthuc': 'ngayketthuc',
            'loaixe': 'loaixe',
            'laixe': 'laixe',
            'lenhtrongngay': 'lenhtrongngay',
            'sokmdukien': 'sokmdukien',
            'songuoidikem': 'songuoidikem',
            'recipient': 'recipient-name',
            'nguoiky': 'nguoiky',
            'location': 'location'
        };
        
        // Tự động điền từ URL parameters
        function fillFromUrl() {
            Object.keys(fieldMapping).forEach(urlParam => {
                const fieldId = fieldMapping[urlParam];
                const value = getUrlParameter(urlParam);
                if (value) {
                    const element = document.getElementById(fieldId);
                    if (element) {
                        element.textContent = decodeUrlParam(value);
                    }
                }
            });
        }
        
        // Lưu dữ liệu vào localStorage
        function saveToLocalStorage(id, value) {
            localStorage.setItem('lenhdieuxe_' + id, value);
        }
        
        // Khôi phục dữ liệu từ localStorage (chỉ khi không có URL params)
        function loadFromLocalStorage() {
            const hasUrlParams = window.location.search.length > 0;
            if (hasUrlParams) return; // Không load từ localStorage nếu có URL params
            
            Object.values(fieldMapping).forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element && element.contentEditable === 'true') {
                    const saved = localStorage.getItem('lenhdieuxe_' + fieldId);
                    if (saved && saved.trim() !== '') {
                        element.textContent = saved;
                    }
                }
            });
        }
        
        // Khởi tạo khi trang được tải
        document.addEventListener('DOMContentLoaded', function() {
            // Cập nhật ngày tháng hiện tại
            updateCurrentDate();
            
            // Điền từ URL parameters (ưu tiên)
            fillFromUrl();
            
            // Load từ localStorage nếu không có URL params
            loadFromLocalStorage();
            
            // Lắng nghe sự kiện khi người dùng chỉnh sửa
            const editableElements = document.querySelectorAll('[contenteditable="true"]');
            editableElements.forEach(element => {
                element.addEventListener('blur', function() {
                    const id = this.id;
                    if (id) {
                        saveToLocalStorage(id, this.textContent);
                    }
                });
                
                // Lưu khi nhấn Enter
                element.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            });
        });
        
        // Hàm in (có thể gọi từ console hoặc thêm nút)
        function printDocument() {
            window.print();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Bảng dữ liệu</title>
  <style>
    /* Bạn có thể thêm CSS tùy chỉnh tại đây nếu cần */
  </style>
</head>
<body>
  
  <table border="1">
    <thead>
      <tr>
        <th>STT</th>
        <th>Ngày</th>
        <th>Chuyên cần</th>
        <th>Hoàn thành BT</th>
        <th>Điểm kiểm tra</th>
        <th>Điểm mạnh</th>
        <th>Điểm yếu</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Dữ liệu sẽ được render tại đây -->
    </tbody>
    <tfoot>
      <tr>
        <td colspan="2">Tổng hợp</td>
        <td id="total-attendance"></td>
        <td id="total-homework"></td>
        <td id="total-test"></td>
        <td id="total-sessions" colspan="2"></td>
      </tr>
    </tfoot>
  </table>
  
  <script>
    // Hàm lấy tham số từ URL
    function getUrlParameter(name) {
      name = name.replace(/[\[\]]/g, '\\$&');
      var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
          results = regex.exec(window.location.search);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
  
    // Lấy tham số 'data' từ URL
    const data = getUrlParameter('data');
  
    // Xử lý dữ liệu bảng chi tiết
    if (data) {
      const danhSachHocTap = data.split('_b_').map((item, index) => {
        const parts = item.split('_a_');
        return {
          stt: index + 1,
          ngay: parts[0] || 'N/A',
          chuyenCan: parts[1] ? parseInt(parts[1]) : 0,
          hoanThanhBT: parts[2] ? parseInt(parts[2]) : 0,
          diemKiemTra: parts[3] ? parseInt(parts[3]) : 0,
          diemManh: parts[4] || 'Không có',
          diemYeu: parts[5] || 'Không có'
        };
      });
  
      // Render bảng chi tiết
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = danhSachHocTap.map(item => `
        <tr>
          <td class="center-text">${item.stt}</td>
          <td>${item.ngay}</td>
          <td class="center-text">${item.chuyenCan}%</td>
          <td class="center-text">${item.hoanThanhBT}%</td>
          <td class="center-text">${item.diemKiemTra}%</td>
          <td>${item.diemManh}</td>
          <td>${item.diemYeu}</td>
        </tr>
      `).join('');
  
      // Tính toán tổng hợp
      if (danhSachHocTap.length > 0) {
        const totalAttendance = Math.round(danhSachHocTap.reduce((sum, item) => sum + item.chuyenCan, 0) / danhSachHocTap.length);
        const totalHomework = Math.round(danhSachHocTap.reduce((sum, item) => sum + item.hoanThanhBT, 0) / danhSachHocTap.length);
        const totalTest = Math.round(danhSachHocTap.reduce((sum, item) => sum + item.diemKiemTra, 0) / danhSachHocTap.length);
        
        document.getElementById('total-attendance').textContent = `${totalAttendance}%`;
        document.getElementById('total-homework').textContent = `${totalHomework}%`;
        document.getElementById('total-test').textContent = `${totalTest}%`;
        document.getElementById('total-sessions').textContent = danhSachHocTap.length;
      }
    } else {
      document.getElementById('tableBody').innerHTML = `
        <tr>
          <td colspan="7" class="center-text">Không có dữ liệu học tập</td>
        </tr>
      `;
    }
  </script>
  
</body>
</html>



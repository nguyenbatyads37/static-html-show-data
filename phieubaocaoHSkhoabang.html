<!DOCTYPE html>
<html lang='vi'>
<head>
  <meta charset='UTF-8'>
  <title>Báo cáo chi tiết</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed; /* Cố định bố cục bảng */
    }
    .data-table th, .data-table td {
      border: 1px solid #ddd;
      padding: 8px;
      word-wrap: break-word; /* Tự động xuống dòng */
      vertical-align: top; /* Căn nội dung lên trên */
    }
    .data-table th {
      background-color: #f2f2f2;
      text-align: center;
    }
    .data-table tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .center-text {
      text-align: center;
    }
    .image-cell {
      text-align: center;
      padding: 5px;
    }
    .image-cell img {
      max-width: 80px;
      max-height: 60px;
      object-fit: contain;
    }
    .summary-row {
      font-weight: bold;
      background-color: #e6e6e6;
    }
    
    /* Thiết lập chiều rộng cột */
    .data-table td:nth-child(1) { width: 5%; }  /* STT */
    .data-table td:nth-child(2) { width: 15%; } /* Ảnh */
    .data-table td:nth-child(3) { width: 20%; } /* Mã SP */
    .data-table td:nth-child(4) { width: 10%; } /* Số lượng */
    .data-table td:nth-child(5) { width: 20%; } /* Đơn giá */
    .data-table td:nth-child(6) { width: 20%; } /* Thành tiền */
  </style>
</head>
<body>

<div class='container'>
  <h1>BÁO CÁO CHI TIẾT</h1>
  
  <table class='data-table'>
    <thead>
      <tr>
        <th>STT</th>
        <th>Ảnh sản phẩm</th>
        <th>Mã sản phẩm</th>
        <th>Số lượng</th>
        <th>Đơn giá</th>
        <th>Thành tiền</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr>
        <td colspan="6" class="center-text">Đang tải dữ liệu...</td>
      </tr>
    </tbody>
    <tfoot>
      <tr class="summary-row">
        <td colspan="3">Tổng cộng</td>
        <td class="center-text" id="totalQuantity">0</td>
        <td></td>
        <td id="totalAmount">0</td>
      </tr>
    </tfoot>
  </table>
</div>

<script>
  // Lấy tham số từ URL
  const urlParams = new URLSearchParams(window.location.search);
  
  // Xử lý chi tiết cấu kiện
  const chitiet = urlParams.get('chitiet');
  const danhSachCauKien = chitiet ? chitiet.split('_b_').map(item => {
    const parts = item.split('_a_');
    return {
      id: parts[0] || 'N/A',
      soLuong: parseInt(parts[1]) || 0,
      donGia: parts[2] ? parseInt(parts[2]) : 0,
      anhSP: parts[3] || '' // Thêm link ảnh sản phẩm
    };
  }) : [];

  // Render bảng
  const tableBody = document.getElementById('tableBody');
  
  if (danhSachCauKien.length > 0) {
    tableBody.innerHTML = danhSachCauKien.map((item, index) => `
      <tr>
        <td class="center-text">${index + 1}</td>
        <td class="image-cell">
          ${item.anhSP ? `<img src="${item.anhSP}" alt="Ảnh sản phẩm">` : 'N/A'}
        </td>
        <td>${item.id}</td>
        <td class="center-text">${item.soLuong}</td>
        <td>${item.donGia.toLocaleString('vi-VN')}đ</td>
        <td>${(item.soLuong * item.donGia).toLocaleString('vi-VN')}đ</td>
      </tr>
    `).join('');
    
    // Tính tổng
    const totalQuantity = danhSachCauKien.reduce((sum, item) => sum + item.soLuong, 0);
    const totalAmount = danhSachCauKien.reduce((sum, item) => sum + (item.soLuong * item.donGia), 0);
    
    document.getElementById('totalQuantity').textContent = totalQuantity;
    document.getElementById('totalAmount').textContent = totalAmount.toLocaleString('vi-VN') + 'đ';
  } else {
    tableBody.innerHTML = `
      <tr>
        <td colspan="6" class="center-text">Không có dữ liệu</td>
      </tr>
    `;
  }
</script>

</body>
</html>




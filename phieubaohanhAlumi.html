<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Bảo Hành - Đà Nẵng Aluminium</title>
    <style>
        @page { 
            size: A4; 
            margin: 10mm; 
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            line-height: 1.5;
            background: #e0e0e0;
            padding: 20px;
            -webkit-print-color-adjust: exact; /* Ép trình duyệt in đúng màu sắc và khung */
            print-color-adjust: exact;
        }

        /* Nút bấm thao tác */
        .action-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 9999;
        }
        .btn-action {
            display: inline-block;
            padding: 12px 25px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            text-align: center;
            min-width: 220px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-pdf { background-color: #007bff; }
        .btn-word { background-color: #28a745; }

        /* Tờ giấy A4 */
        .paper {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto;
            padding: 15mm 20mm;
            position: relative;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        /* Watermark */
        .watermark {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            z-index: 0; pointer-events: none; opacity: 0.07;
        }
        .watermark img { width: 450px; }

        .content { position: relative; z-index: 1; }

        /* Header */
        .header { text-align: center; margin-bottom: 10px; border-bottom: 2px solid #c41e3a; padding-bottom: 10px; }
        .header-logo img { width: 100%; max-width: 500px; height: auto; }
        .company-name { font-size: 16pt; font-weight: bold; color: #c41e3a; text-transform: uppercase; margin-top: 5px; }
        .company-info { font-size: 11pt; }
        .hotline { font-weight: bold; color: #c41e3a; margin-top: 5px; }

        .title { text-align: center; font-size: 22pt; font-weight: bold; color: #c41e3a; margin: 20px 0; text-transform: uppercase; }

        /* Khối thông tin khách hàng - Ép hiện khung đỏ */
        .customer-info-box {
            border: 2px solid #ff0000 !important; 
            padding: 15px;
            margin-bottom: 20px;
            background: #fff;
        }
        .info-row { display: flex; margin: 8px 0; align-items: baseline; }
        .info-label { font-weight: bold; min-width: 130px; }
        
        [contenteditable="true"] {
            flex: 1;
            border-bottom: 1px dotted #999;
            padding: 0 5px;
            outline: none;
        }

        /* Bảng sản phẩm - Ép hiện khung đen */
        .product-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .product-table th, .product-table td { 
            border: 1px solid black !important; 
            padding: 10px; 
            position: relative; 
        }
        .product-table th { background: #ffcccc !important; font-weight: bold; text-align: center; }
        
        .col-tt { width: 50px; text-align: center; }
        .col-select { width: 100px; text-align: center; }

        .checkbox-cell {
            width: 28px; height: 28px;
            border: 2px solid #000;
            margin: 0 auto;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 20pt; font-weight: bold; color: #c41e3a;
            background: #fff;
        }

        .btn-add {
            background: #c41e3a; color: white; border: none;
            width: 22px; height: 22px; border-radius: 4px;
            cursor: pointer; vertical-align: middle;
        }
        
        /* Nút X xóa dòng nằm ngoài bảng */
        .btn-del {
            position: absolute; right: -35px; top: 50%; transform: translateY(-50%);
            background: #ff4444; color: white; border: none;
            width: 24px; height: 24px; border-radius: 50%;
            cursor: pointer; font-size: 12px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
        }

        /* Chữ ký & Badge */
        .signature-section { display: flex; justify-content: space-between; margin-top: 40px; }
        .signature-box { flex: 1; text-align: center; position: relative; }
        
        .warranty-badge-wrapper {
            position: relative; width: 150px; margin: 0 auto 10px; display: flex; justify-content: center;
        }
        .warranty-badge-wrapper img { width: 100%; height: auto; }
        .badge-number {
            position: absolute; top: 40%; left: 69%; transform: translate(-50%, -50%);
            font-size: 20pt; font-weight: 900; color: #c41e3a; font-family: Arial;
            text-shadow: 1px 1px 0px #fff, -1px -1px 0px #fff;
        }
        .sig-label { font-weight: bold; font-size: 12pt; margin-top: 10px; }
        .sig-line { border-top: 1px solid #000; width: 80%; margin: 60px auto 0; }

        /* ĐỊNH DẠNG KHI IN */
        @media print {
            body { background: white; padding: 0; margin: 0; }
            .paper { 
                box-shadow: none; 
                margin: 0; 
                width: 100%; 
                padding: 10mm 15mm; 
            }
            .action-buttons, .btn-add, .btn-del { display: none !important; }
            
            /* Đảm bảo khung luôn hiện */
            .customer-info-box { border: 2px solid red !important; }
            .product-table, .product-table th, .product-table td { 
                border: 1px solid black !important; 
            }
            [contenteditable="true"] { border-bottom: 1px dotted #999 !important; }
        }
    </style>
</head>
<body>

<!-- Nút chức năng -->
<div class="action-buttons">
    <button class="btn-action btn-pdf" onclick="window.print()">In Phiếu Bảo Hành (PDF)</button>
    <button class="btn-action btn-word" onclick="exportHTMLtoWord()">Tải File Word (.doc)</button>
</div>

<div class="paper" id="content-to-export">
    <div class="watermark">
        <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2Fd7290d01.%E1%BA%A2nh.141933.png">
    </div>

    <div class="content">
        <!-- Header -->
        <div class="header">
            <div class="header-logo">
                <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2Fd7290d01.%E1%BA%A2nh.141933.png">
            </div>
            <div class="company-name">CÔNG TY CỔ PHẦN NỘI THẤT NHÔM KÍNH ĐÀ NẴNG</div>
            <div class="company-info">Lô 611 - 613 Trần Nam Trung - Phường Hòa Xuân - TP. Đà Nẵng</div>
            <div class="hotline">Hotline bảo hành: 0708 344 446 - 0926 033 777</div>
        </div>

        <div class="title">PHIẾU BẢO HÀNH</div>

        <!-- Khối khách hàng -->
        <div class="customer-info-box">
            <div class="info-row"><span class="info-label">Khách hàng:</span><span contenteditable="true">Nhập tên khách hàng...</span></div>
            <div class="info-row"><span class="info-label">Điện thoại:</span><span contenteditable="true">09xx xxx xxx</span></div>
            <div class="info-row"><span class="info-label">Địa chỉ:</span><span contenteditable="true">Nhập địa chỉ...</span></div>
            <div class="info-row">
                <span class="info-label" style="min-width: 100px;">Xã/Phường:</span><span contenteditable="true">Hòa Xuân</span>
                <span class="info-label" style="min-width: 130px; text-align: right; padding-right: 10px;">Thành phố:</span><span contenteditable="true">Đà Nẵng</span>
            </div>
            <div class="info-row"><span class="info-label">Thời hạn đến:</span><span contenteditable="true" style="font-weight: bold; color: #c41e3a;">03/02/2028</span></div>
        </div>

        <!-- Bảng sản phẩm -->
        <table class="product-table">
            <thead>
                <tr>
                    <th class="col-tt">TT</th>
                    <th>TÊN SẢN PHẨM / THƯƠNG HIỆU</th>
                    <th class="col-select">TÍCH CHỌN <button class="btn-add" onclick="addRow()">+</button></th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr>
                    <td class="col-tt">1</td>
                    <td>
                        <div contenteditable="true" style="font-weight: bold;">CỬA NHÔM KÍNH</div>
                        <div contenteditable="true" style="font-size: 10pt; color: #666; border-bottom: 1px dotted #ccc;">THƯƠNG HIỆU DANANG ALUMINIUM</div>
                    </td>
                    <td class="col-select">
                        <div class="checkbox-cell" onclick="toggleCheck(this)"></div>
                        <button class="btn-del" onclick="deleteRow(this)">X</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Chữ ký -->
        <div class="signature-section">
            <div class="signature-box">
                <div class="warranty-badge-wrapper">
                    <img src="https://www.appsheet.com/template/gettablefileurl?appName=Appsheet-325045268&tableName=Kho%20%E1%BA%A3nh&fileName=Kho%20%E1%BA%A3nh_Images%2F992d5e75.%E1%BA%A2nh.141810.png">
                    <span class="badge-number" contenteditable="true">1</span>
                </div>
                <div class="sig-label">CHẾ ĐỘ BẢO HÀNH</div>
            </div>
            <div class="signature-box"><div class="sig-line"></div><div class="sig-label">Đại diện khách hàng</div></div>
            <div class="signature-box"><div class="sig-line"></div><div class="sig-label">Đại diện công ty</div></div>
        </div>
    </div>
</div>

<script>
    function toggleCheck(el) { el.textContent = el.textContent === '✓' ? '' : '✓'; }

    function addRow() {
        const table = document.getElementById('tableBody');
        const row = table.insertRow(-1);
        row.innerHTML = `
            <td class="col-tt">${table.rows.length}</td>
            <td>
                <div contenteditable="true" style="font-weight:bold;">SẢN PHẨM MỚI</div>
                <div contenteditable="true" style="font-size:10pt;color:#666;border-bottom: 1px dotted #ccc;">THƯƠNG HIỆU</div>
            </td>
            <td class="col-select">
                <div class="checkbox-cell" onclick="toggleCheck(this)"></div>
                <button class="btn-del" onclick="deleteRow(this)">X</button>
            </td>`;
    }

    function deleteRow(btn) { btn.parentNode.parentNode.remove(); updateTT(); }
    
    function updateTT() {
        const rows = document.getElementById('tableBody').rows;
        for (let i = 0; i < rows.length; i++) rows[i].cells[0].textContent = i + 1;
    }

    function exportHTMLtoWord() {
        var header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'></head><body>";
        var footer = "</body></html>";
        var sourceHTML = header + document.getElementById("content-to-export").innerHTML + footer;
        var source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
        var fileDownload = document.createElement("a");
        document.body.appendChild(fileDownload);
        fileDownload.href = source;
        fileDownload.download = 'PhieuBaoHanh.doc';
        fileDownload.click();
        document.body.removeChild(fileDownload);
    }
</script>

</body>
</html>
